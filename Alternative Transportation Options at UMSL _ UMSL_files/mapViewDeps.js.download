// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.32/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/Stage":function(){define("require exports ../../../core/Error ../../../core/has ../../../core/maybe ../../../core/scheduling ../../../core/signal ../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../symbols/cim/cimAnalyzer ./Container ./ManagedCanvas ./webgl/definitions ./webgl/enums ./webgl/Painter ./webgl/PooledUint32Array ./webgl/Profiler ./webgl/TileReshuffleManager ./webgl/shaderGraph/techniques/TechniqueRegistry ./webgl/shaderGraph/techniques/mesh/MeshWriterRegistry ../support/Timeline ../../webgl/enums ../../webgl/FramebufferObject ../../webgl/RenderbufferDescriptor ../../webgl/RenderingContext ../../webgl/TextureDescriptor".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g,q,c,h,u,A,z,t,w,x,B,C,y,v){class F extends b.Container{constructor(D,G){super();this.meshWriterRegistry=new t.MeshWriterRegistry;this._trash=new Set;this._lastFrameRenderTime=this._renderRemainingTime=0;this._renderRequested=l.signal(!1);this.stage=this;this._stationary=!0;this._reshuffleManager=new A.TileReshuffleManager;this._canvas=new f.ManagedCanvas(D);this.context=new y.RenderingContext(this._canvas.gl,G.contextOptions??{});this.painter=new c(this.context,this);
this._cimAnalyzer=new a.CIMAnalyzer(this.painter.textureManager.resourceManager);e("esri-2d-profiler")&&(this._debugOutput=document.createElement("div"),this._debugOutput.setAttribute("style","margin: 24px 64px; position: absolute; color: red;"),D.appendChild(this._debugOutput));const E=()=>this.highlightGradient;this._renderParameters={drawPhase:0,state:this.state,pixelRatio:window.devicePixelRatio,stationary:!1,globalOpacity:1,blendMode:null,deltaTime:-1,time:0,inFadeTransition:!1,effects:null,
context:this.context,painter:this.painter,timeline:G.timeline||new w.Timeline,renderingOptions:G.renderingOptions,requestRender:()=>this.requestRender(),allowDelayedRender:!1,requireFBO:!1,profiler:new u.Profiler(this.context,this._debugOutput),dataUploadCounter:0,get highlightGradient(){return E()},reshuffleManager:this._reshuffleManager,backgroundColor:G.backgroundColor};this._taskHandle=m.addFrameTask({render:H=>this.renderFrame(H)});this._taskHandle.pause();this._lostWebGLContextHandle=this._canvas.events.on("webgl-context-lost",
H=>this.emit("webgl-error",{error:new p("webgl-context-lost",H.statusMessage)}));this._bufferPool=new h.ArrayBufferPool;z.startup()}destroy(){z.shutdown(this.context);this.removeAllChildren();this._emptyTrash();this._taskHandle=n.removeMaybe(this._taskHandle);this._lostWebGLContextHandle=n.removeMaybe(this._lostWebGLContextHandle);this._canvas.destroy();this._debugOutput?.parentNode?.removeChild(this._debugOutput);this._bufferPool.destroy();this.painter.dispose();this.context.dispose();this._canvas=
null}get textureManager(){return this.painter.textureManager}get backgroundColor(){return this._renderParameters.backgroundColor}set backgroundColor(D){this._renderParameters.backgroundColor=D;this.requestRender()}get bufferPool(){return this._bufferPool}get cimAnalyzer(){return this._cimAnalyzer}get renderingOptions(){return this._renderingOptions}set renderingOptions(D){this._renderingOptions=D;this.requestRender()}get renderRequested(){return this._renderRequested.value}get state(){return this._state}set state(D){this._state=
D;this.requestRender()}get stationary(){return this._stationary}set stationary(D){this._stationary!==D&&(this._stationary=D,this.requestRender())}trashDisplayObject(D){this._trash.add(D);this.requestRender()}untrashDisplayObject(D){return this._trash.delete(D)}requestRender(){this._renderRemainingTime=2E3;this.renderRequested||(this._renderRequested.value=!0,this._taskHandle.resume())}renderFrame(D){this._renderRemainingTime-=this._lastFrameRenderTime?D.time-this._lastFrameRenderTime:0;0>=this._renderRemainingTime&&
this._taskHandle.pause();this._lastFrameRenderTime=D.time;this._renderRequested.value=!1;this._renderParameters.state=this._state;this._renderParameters.stationary=this.stationary;this._renderParameters.pixelRatio=window.devicePixelRatio;this._renderParameters.globalOpacity=1;this._renderParameters.time=D.time;this._renderParameters.deltaTime=D.deltaTime;this._renderParameters.effects=null;this.processRender(this._renderParameters);this._emptyTrash()}_createTransforms(){return{displayViewScreenMat3:d.create()}}renderChildren(D){for(const G of this.children)G.beforeRender(D);
this._reshuffleManager.reshuffle(g.MAX_TILE_RESHUFFLES_PER_FRAME);this._canvas.render(D,()=>this._renderChildren(this.children,D));for(const G of this.children)G.afterRender(D)}_renderChildren(D,G){const E=this.context;this.painter.textureUploadManager.upload();E.resetInfo();G.profiler.recordStart("drawLayers");G.dataUploadCounter=0;this.painter.beforeRenderPhases(G,G.backgroundColor,this.state.padding);G.drawPhase=q.WGLDrawPhase.MAP;for(const H of D)H.processRender(G);if(this.children.some(H=>H.hasHighlight)){G.drawPhase=
q.WGLDrawPhase.HIGHLIGHT;for(const H of D)H.processRender(G)}if(this.children.some(H=>H.hasLabels)){G.drawPhase=q.WGLDrawPhase.LABEL;for(const H of D)H.processRender(G)}if(e("esri-tiles-debug")){G.drawPhase=q.WGLDrawPhase.DEBUG;for(const H of D)H.processRender(G)}this.painter.afterRenderPhases(G);G.profiler.recordEnd("drawLayers");E.logInfo()}doRender(D){const G=this.context,{state:E,pixelRatio:H}=D;this._canvas.resize(D);G.setViewport(0,0,H*E.size[0],H*E.size[1]);G.setDepthWriteEnabled(!0);G.setStencilWriteMask(255);
this.renderChildren(D)}async takeScreenshot(D,G,E,H){const K=Math.round(this.state.size[0]*D.resolutionScale),J=Math.round(this.state.size[1]*D.resolutionScale);var L=D.resolutionScale,P=this.context,Q=this._state.clone();if(null!=H){const S=Q.viewpoint;Q.viewpoint.rotation=H;Q.viewpoint=S}H={...this._renderParameters,drawPhase:null,globalOpacity:1,stationary:!0,state:Q,pixelRatio:L,time:performance.now(),deltaTime:0,blendMode:null,effects:null,inFadeTransition:!1,backgroundColor:E};E=new v.TextureDescriptor(K,
J);E.wrapMode=x.TextureWrapMode.CLAMP_TO_EDGE;E.internalFormat=x.SizedPixelFormat.RGBA8;E.isImmutable=!0;E=new B.FramebufferObject(P,E,new C.RenderbufferDescriptor(x.RenderbufferFormat.DEPTH_STENCIL,K,J));L=P.getBoundFramebufferObject();Q=P.getViewport();P.bindFramebuffer(E);P.setViewport(0,0,K,J);this._renderChildren(G??this.children,H);G=this._readbackScreenshot(E,{...D.cropArea,y:J-(D.cropArea.y+D.cropArea.height)});P.bindFramebuffer(L);P.setViewport(Q.x,Q.y,Q.width,Q.height);this.requestRender();
P=await G;1===D.outputScale?D=P:(D=new ImageData(Math.round(P.width*D.outputScale),Math.round(P.height*D.outputScale)),(await new Promise((S,U)=>k(["../../support/screenshotUtils"],S,U))).resampleHermite(P,D,!0));E.dispose();return D}async _readbackScreenshot(D,G){const E=(await new Promise((H,K)=>k(["../../support/screenshotUtils"],H,K))).createEmptyImageData(G.width,G.height,document.createElement("canvas"));await D.readPixelsAsync(G.x,G.y,G.width,G.height,x.PixelFormat.RGBA,x.PixelType.UNSIGNED_BYTE,
new Uint8Array(E.data.buffer));return E}_emptyTrash(){for(;0<this._trash.size;){const D=Array.from(this._trash);this._trash.clear();for(const G of D)G.processDetach()}}}r.Stage=F;r.extraRenderTime=2E3;Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/cimAnalyzer":function(){define("exports ../../core/colorUtils ../../core/fontUtils ../../core/lang ../../core/Logger ../../core/screenUtils ../../core/string ./animationUtils ./CIMSymbolHelper ./defaultCIMValues ./enums ./fitVectorMarker ./OverrideHelper ./SDFHelper ./utils ./effects/CIMEffectHelper ../../views/2d/engine/webgl/definitions".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g,q,c,h,u,A){function z(y){return y&&0===y.indexOf("Level_")&&(y=parseInt(y.slice(6),10),!isNaN(y))?y:0}function t(y){var v=y.symbolLayers;if(!v)return!1;y=v.find(F=>F.effects?.find(D=>"CIMGeometricEffectDashes"===D.type&&null!=D.dashTemplate));v=v.find(F=>F.effects?.find(D=>"CIMGeometricEffectAddControlPoints"===D.type));return!!y||!!v}function w(y){return y.some(v=>"CIMSolidFill"!==v.type&&"CIMSolidStroke"!==v.type&&("CIMVectorMarker"!==v.type&&"CIMPictureMarker"!==
v.type||null!=v.markerPlacement))}function x(y){return e.clone(y).map(v=>({...v,propertyName:h.uncapitalize(v.propertyName)}))}function B(y){return d.shouldUseAnimatedPath(y)?{type:"animation-params",params:y}:null}class C{constructor(y){this._cimLayers=[];this._poMap={};this._primitiveOverrides=[];y&&(this._resourceManager=y)}analyzeSymbolReference(y,v,F){this._cimLayers=F??[];if(!y)return this._cimLayers;this._reset();if(y.primitiveOverrides){this._primitiveOverrides=y.primitiveOverrides;for(const D of this._primitiveOverrides)(F=
D.valueExpressionInfo)?this._setPoMap(D.primitiveName,D.propertyName,F):null!=D.value&&(F=D.value,D.propertyName.includes("Color")&&(r.isRGB(F)&&(F=h.colorToArray(F)),F=h.normalizeAlpha(F)),this._setPoMap(D.primitiveName,D.propertyName,F))}this._analyzeSymbol(y.symbol,v);return this._cimLayers}_reset(){this._cimLayers=[];this._poMap={};this._primitiveOverrides=[]}_analyzeSymbol(y,v){switch(y?.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":this._analyzeMultiLayerSymbol(y,
v)}}_analyzeMultiLayerSymbol(y,v){const F=y?.symbolLayers;if(F){for(var D=0;D<F.length;D++){var G=F[D];"CIMVectorMarker"===G.type&&(F[D]=g.fitVectorMarker(G,this._resourceManager.geometryEngine))}D=y.effects;var E=f.Alignment.SCREEN;G=h.getSize(y)??0;"CIMPointSymbol"===y.type&&"Map"===y.angleAlignment&&(E=f.Alignment.MAP);var H={transform:[0,0,0,1],fromColor:[1,1,1,1],toColor:[1,1,1,1],colorMix:[0,0,0,0],toOpacity:[1,1,1,1],opacityMix:[0,0,0,0],hasAnimations:d.checkForAnimations(y)};H=d.getAnimationParams(this._poMap,
y,H);for(var K="CIMPolygonSymbol"===y.type,J=F.length;J--;){const S=F[J];if(!S||!1===S.enable)continue;let U;D?.length&&(U=[...D]);var L=S.effects;L?.length&&(D?U.push(...L):U=[...L]);L=null;if(U){L=[];for(const X of U){var P=q.OverrideHelper.findEffectOverrides(X,this._primitiveOverrides);P&&L.push(P)}}q.OverrideHelper.findApplicableOverrides(S,this._primitiveOverrides,[]);switch(S.type){case "CIMSolidFill":this._analyzeSolidFill(S,L);break;case "CIMPictureFill":this._analyzePictureFill(S,L);break;
case "CIMHatchFill":this._analyzeHatchFill(S,L);break;case "CIMGradientFill":this._analyzeGradientFill(S,L);break;case "CIMSolidStroke":this._analyzeSolidStroke(S,L,K,G);break;case "CIMPictureStroke":this._analyzePictureStroke(S,L,K,G);break;case "CIMGradientStroke":this._analyzeGradientStroke(S,L,K,G);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":if("CIMLineSymbol"===y.type||"CIMPolygonSymbol"===y.type)E=(E=S.markerPlacement)&&E.angleToLine?f.Alignment.MAP:f.Alignment.SCREEN;
P=[];var Q=S.primitiveName;Q&&P.push(Q);Q=K&&h.isCIMMarkerStrokePlacement(S.markerPlacement);this._analyzeMarker(S,L,null,P,E,G,v,[],H,!1,Q);break;default:n.getLogger("esri.symbols.cim.cimAnalyzer").error("Cannot analyze CIM layer",S.type)}}}}_analyzeSolidFill(y,v){const {primitiveName:F,type:D}=y,G=h.normalizeAlpha(y.color);this._cimLayers.push({type:"fill",spriteRasterizationParam:null,colorLocked:!!y.colorLocked,color:this._getValueOrOverrideExpression(D,F,"Color",G),height:0,angle:0,offsetX:0,
offsetY:0,scaleX:1,effects:v,applyRandomOffset:!1,sampleAlphaOnly:!0,hasUnresolvedReplacementColor:!1})}_analyzePictureFill(y,v){const {primitiveName:F,type:D}=y,G=h.getTintColor(y),E=h.getNumericValue(y.height,b.defaultCIMValues.CIMPictureFill.height);let H=h.getNumericValue(y.scaleX,1);if("width"in y&&"number"===typeof y.width){var K=y.width;let J=1;const L=this._resourceManager.getResource(y.url);null!=L&&(J=L.width/L.height);H/=E/K*J}K={type:"sprite-rasterization-param",resource:y,overrides:this._getPrimitiveMaterialOverrides(F,
D)};this._cimLayers.push({type:"fill",spriteRasterizationParam:K,colorLocked:!!y.colorLocked,effects:v,color:this._getValueOrOverrideExpression(D,F,"TintColor",G),height:this._getValueOrOverrideExpression(D,F,"Height",E),scaleX:this._getValueOrOverrideExpression(D,F,"ScaleX",H),angle:this._getValueOrOverrideExpression(D,F,"Rotation",h.getNumericValue(y.rotation)),offsetX:this._getValueOrOverrideExpression(D,F,"OffsetX",h.getNumericValue(y.offsetX)),offsetY:this._getValueOrOverrideExpression(D,F,"OffsetY",
h.getNumericValue(y.offsetY)),applyRandomOffset:!1,sampleAlphaOnly:!1,hasUnresolvedReplacementColor:!1})}_analyzeHatchFill(y,v){const {primitiveName:F,type:D}=y;var G=this._analyzeMaterialOverrides(F,["Rotation","OffsetX","OffsetY"]);G=h.normalizePrimitiveOverrideProps(G);let E=[255,255,255,1],H=!1;if(y.lineSymbol?.symbolLayers)for(const J of y.lineSymbol.symbolLayers){if("CIMSolidStroke"!==J.type)continue;const L=J.primitiveName??F;H||!L||J.colorLocked||null==this._poMap[L]?.Color&&null==this._poMap[L]?.StrokeColor||
(E=h.normalizeAlpha(J.color),E=this._maybeGetValueOrOverrideExpression(L,"StrokeColor")??this._getValueOrOverrideExpression(D,L,"Color",E),H=!0);var K=this._maybeGetValueOrOverrideExpression(L,"StrokeWidth");if(K){let P=null,Q=null;"number"===typeof K?P=K:Q=K.valueExpressionInfo;(K=G.find(S=>"strokeWidth"===S.propertyName))?K.propertyName="width":(K={type:"CIMPrimitiveOverride",primitiveName:L,propertyName:"width",valueExpressionInfo:Q,value:P,defaultValue:h.getDefaultCIMValue(D,"width")},G.push(K))}}this._cimLayers.push({type:"fill",
spriteRasterizationParam:{type:"sprite-rasterization-param",resource:y,overrides:G},colorLocked:!!y.colorLocked,effects:v,color:E,height:this._getValueOrOverrideExpression(D,F,"Separation",h.getNumericValue(y.separation,b.defaultCIMValues.CIMHatchFill.separation)),scaleX:1,angle:this._getValueOrOverrideExpression(D,F,"Rotation",h.getNumericValue(y.rotation)),offsetX:this._getValueOrOverrideExpression(D,F,"OffsetX",h.getNumericValue(y.offsetX)),offsetY:this._getValueOrOverrideExpression(D,F,"OffsetY",
h.getNumericValue(y.offsetY)),applyRandomOffset:!1,sampleAlphaOnly:!0,hasUnresolvedReplacementColor:!H})}_analyzeGradientFill(y,v){const {angle:F,gradientMethod:D,gradientSize:G,gradientSizeUnits:E,gradientType:H,interval:K,primitiveName:J,type:L}=y,P=b.defaultCIMValues.CIMGradientFill,Q=y.colorRamp;this._cimLayers.push({type:"gradientFill",spriteRasterizationParam:{type:"sprite-rasterization-param",resource:y,overrides:this._getPrimitiveMaterialOverrides(J,L)},colorLocked:!1,effects:v,color:[255,
255,255,1],gradientMethod:this._getValueOrOverrideExpression(L,J,"GradientMethod",D??"Linear"),angle:this._getValueOrOverrideExpression(L,J,"Angle",h.getNumericValue(F,P.angle)),gradientType:this._getValueOrOverrideExpression(L,J,"GradientType",H??P.gradientType),interval:this._getValueOrOverrideExpression(L,J,"Interval",h.getNumericValue(K,"CIMFixedColorRamp"===Q.type?Q.colors.length:P.interval)),gradientSize:this._getValueOrOverrideExpression(L,J,"GradientSize",h.getNumericValue(G,P.gradientSize)),
gradientSizeUnits:"Absolute"===E?f.SymbolUnits.Absolute:"Relative"===E?f.SymbolUnits.Relative:P.gradientSizeUnits})}_analyzeSolidStroke(y,v,F,D){const {primitiveName:G,type:E}=y,H=h.normalizeAlpha(y.color),K=h.getNumericValue(y.width,b.defaultCIMValues.CIMSolidStroke.width),J=h.getEnum(y.capStyle,b.defaultCIMValues.CIMSolidStroke.capstyle),L=h.getEnum(y.joinStyle,b.defaultCIMValues.CIMSolidStroke.joinstyle),P=y.miterLimit;let Q=[];this._analyzePrimitiveOverrides(G,v,null,null)&&(Q=this._getPrimitiveMaterialOverrides(G,
E));let S,U,X,aa;if(v&&Array.isArray(v)&&0<v.length){const ba=v[v.length-1].effect;ba&&"CIMGeometricEffectDashes"===ba.type&&"NoConstraint"===ba.lineDashEnding&&(S=ba.dashTemplate,U=ba.scaleDash,X=ba.offsetAlongLine,aa=ba.primitiveName,v=[...v],v.pop())}null!=aa&&Q.push(...this._getPrimitiveMaterialOverrides(aa,E).filter(ba=>"dashTemplate"===ba.propertyName));this._cimLayers.push({type:"line",spriteRasterizationParam:void 0!==S?{type:"sprite-rasterization-param",resource:{type:"dash",dashTemplate:S,
primitiveName:aa},overrides:Q}:null,isOutline:F,colorLocked:!!y.colorLocked,effects:v,color:this._getValueOrOverrideExpression(E,G,"Color",H),width:this._getValueOrOverrideExpression(E,G,"Width",K),cap:this._getValueOrOverrideExpression(E,G,"CapStyle",J),join:this._getValueOrOverrideExpression(E,G,"JoinStyle",L),miterLimit:P&&this._getValueOrOverrideExpression(E,G,"MiterLimit",P),referenceWidth:D,zOrder:z(y.name),dashTemplate:this._maybeGetValueOrOverrideExpression(aa,"DashTemplate")??S,offsetAlongLine:this._getValueOrOverrideExpression(E,
aa,"OffsetAlongLine",X??0),scaleDash:U,sampleAlphaOnly:!0})}_analyzePictureStroke(y,v,F,D){const {primitiveName:G,type:E}=y,H=h.getTintColor(y),K=h.getNumericValue(y.width,b.defaultCIMValues.CIMPictureStroke.width),J=h.getEnum(y.capStyle,b.defaultCIMValues.CIMPictureStroke.capstyle),L=h.getEnum(y.joinStyle,b.defaultCIMValues.CIMPictureStroke.joinstyle),P=y.miterLimit,Q={type:"sprite-rasterization-param",resource:y,overrides:this._getPrimitiveMaterialOverrides(G,E)};this._cimLayers.push({type:"line",
spriteRasterizationParam:Q,isOutline:F,colorLocked:!!y.colorLocked,effects:v,color:this._getValueOrOverrideExpression(E,G,"TintColor",H),width:this._getValueOrOverrideExpression(E,G,"Width",K),cap:this._getValueOrOverrideExpression(E,G,"CapStyle",J),join:this._getValueOrOverrideExpression(E,G,"JoinStyle",L),miterLimit:P&&this._getValueOrOverrideExpression(E,G,"MiterLimit",P),referenceWidth:D,zOrder:z(y.name),dashTemplate:null,scaleDash:!1,sampleAlphaOnly:!1})}_analyzeGradientStroke(y,v,F,D){const {gradientMethod:G,
gradientSize:E,gradientSizeUnits:H,gradientType:K,interval:J,primitiveName:L,type:P}=y,Q=b.defaultCIMValues.CIMGradientStroke,S=h.getNumericValue(y.width,Q.width),U=h.getEnum(y.capStyle,Q.capstyle),X=h.getEnum(y.joinStyle,Q.joinstyle),aa=y.miterLimit,ba=y.colorRamp;this._cimLayers.push({type:"gradientStroke",spriteRasterizationParam:{type:"sprite-rasterization-param",resource:y,overrides:this._getPrimitiveMaterialOverrides(L,P)},colorLocked:!!y.colorLocked,effects:v,color:[255,255,255,1],width:this._getValueOrOverrideExpression(P,
L,"Width",S),cap:this._getValueOrOverrideExpression(P,L,"CapStyle",U),join:this._getValueOrOverrideExpression(P,L,"JoinStyle",X),miterLimit:aa&&this._getValueOrOverrideExpression(P,L,"MiterLimit",aa),referenceWidth:D,isOutline:F,gradientMethod:this._getValueOrOverrideExpression(P,L,"GradientMethod",G??Q.gradientMethod),gradientType:this._getValueOrOverrideExpression(P,L,"GradientType",K??Q.gradientType),interval:this._getValueOrOverrideExpression(P,L,"Interval",h.getNumericValue(J,"CIMFixedColorRamp"===
ba.type?ba.colors.length:Q.interval)),gradientSize:this._getValueOrOverrideExpression(P,L,"GradientSize",h.getNumericValue(E,Q.gradientSize)),gradientSizeUnits:"Absolute"===H?f.SymbolUnits.Absolute:"Relative"===H?f.SymbolUnits.Relative:Q.gradientSizeUnits})}_analyzeMarker(y,v,F,D,G,E,H,K,J,L=!1,P=!1){L||=!!y.colorLocked;if(!this._analyzeMarkerInsidePolygon(y,v,L)){var Q=h.getNumericValue(y.size,b.defaultCIMValues.CIMVectorMarker.size),S=h.getNumericValue(y.rotation),U=h.getNumericValue(y.offsetX),
X=h.getNumericValue(y.offsetY),{primitiveName:aa,type:ba}=y;Q=this._getValueOrOverrideExpression(ba,aa,"Size",Q);S=this._getValueOrOverrideExpression(ba,aa,"Rotation",S);U=this._getValueOrOverrideExpression(ba,aa,"OffsetX",U);X=this._getValueOrOverrideExpression(ba,aa,"OffsetY",X);J=d.getAnimationParams(this._poMap,y,J);J=d.handleAbsoluteAnchor(y,J);J=d.handleMarker(this._poMap,y,J);J=d.handleRelativeAnchor(y,J);switch(y.type){case "CIMPictureMarker":this._analyzePictureMarker(y,v,F,D,G,E,Q,S,U,X,
K,J,L,P);break;case "CIMVectorMarker":this._analyzeVectorMarker(y,v,F,D,G,E,Q,S,U,X,K,J,H,L,P)}}}_analyzeMarkerInsidePolygon(y,v,F){const {markerPlacement:D,type:G}=y;if(!D||"CIMMarkerPlacementInsidePolygon"!==D.type)return!1;if("CIMVectorMarker"===G||"CIMPictureMarker"===G){var E=y.primitiveName;if(E&&this._analyzePrimitiveOverrides([E],v,null,null)||(E=D.primitiveName)&&this._analyzePrimitiveOverrides([E],v,null,null))return!1;if("CIMVectorMarker"===G){if({markerGraphics:E}=y,E)for(var H of E)if({symbol:E}=
H,"CIMPolygonSymbol"===E?.type&&E.symbolLayers){({symbolLayers:E}=E);for(var K of E)if("CIMSolidStroke"===K.type)return!1}}else if({animatedSymbolProperties:H}=y,H)return!1}K=Math.abs(D.stepX);E=Math.abs(D.stepY);if(0===K||0===E)return!0;if("Random"===D.gridType){H=m.px2pt(A.randomInsidePolygonTextureSize);const J=Math.max(Math.floor(H/K),1);H=E*Math.max(Math.floor(H/E),1);K=J*K/H}else D.shiftOddRows?(H=2*E,K=K/E*.5):(H=E,K/=E);E=h.getTintColor(y);this._cimLayers.push({type:"fill",spriteRasterizationParam:"CIMCharacterMarker"===
y.type?null:{type:"sprite-rasterization-param",resource:y,overrides:[]},colorLocked:F,effects:v,color:E,height:H,scaleX:K,angle:D.gridAngle,offsetX:h.getNumericValue(D.offsetX),offsetY:h.getNumericValue(D.offsetY),applyRandomOffset:"Random"===D.gridType,sampleAlphaOnly:"CIMPictureMarker"!==y.type,hasUnresolvedReplacementColor:!0});return!0}_analyzePictureMarker(y,v,F,D,G,E,H,K,J,L,P,Q,S,U){const {animatedSymbolProperties:X,primitiveName:aa,type:ba}=y;let fa=h.getNumericValue(y.scaleX,1);const I=h.getTintColor(y);
F||=this._createMarkerPlacementOverrideExpression(y.markerPlacement);const M=this._createGIFAnimatedSymbolPropertiesOverrideExpression(X),N=y.anchorPoint??{x:0,y:0};if("width"in y&&"number"===typeof y.width){var R=y.width;let W=1;var T=this._resourceManager.getResource(y.url);null!=T&&(W=T.width/T.height);T=h.getNumericValue(y.size);fa/=T/R*W}D=[...D];y.primitiveName&&D.push(y.primitiveName);X||M?R={type:"animated",url:y.url,urlHash:"H"+l.numericHash(y.url),playAnimation:y.animatedSymbolProperties?.playAnimation,
reverseAnimation:y.animatedSymbolProperties?.reverseAnimation,randomizeStartTime:y.animatedSymbolProperties?.randomizeStartTime,randomizeStartSeed:y.animatedSymbolProperties?.randomizeStartSeed,startTimeOffset:y.animatedSymbolProperties?.startTimeOffset,duration:y.animatedSymbolProperties?.duration,repeatType:y.animatedSymbolProperties?.repeatType,repeatDelay:y.animatedSymbolProperties?.repeatDelay}:(R=e.clone(y),R.markerPlacement=null);D={type:"sprite-rasterization-param",resource:R,overrides:this._getMaterialOverrides(D,
ba)};M&&D.overrides.push(...M.overrides);this._cimLayers.push({type:"marker",spriteRasterizationParam:D,colorLocked:S,effects:v,scaleSymbolsProportionally:!1,alignment:G,size:H,scaleX:this._getValueOrOverrideExpression(ba,aa,"ScaleX",fa),rotation:K,offsetX:J,offsetY:L,transform:{type:"cim-marker-transform-param",params:P},color:this._getValueOrOverrideExpression(ba,aa,"TintColor",I),anchorPoint:{x:N.x,y:N.y},isAbsoluteAnchorPoint:"Relative"!==y.anchorPointUnits,outlineColor:[0,0,0,0],outlineWidth:0,
frameHeight:0,widthRatio:1,rotateClockwise:!!y.rotateClockwise,referenceSize:E,sizeRatio:1,isOutline:U,markerPlacement:F,animationParams:B(Q),baseSize:H})}_analyzeVectorMarker(y,v,F,D,G,E,H,K,J,L,P,Q,S,U,X){var aa=y.markerGraphics;if(aa){var ba=y.frame,fa=0;fa=ba?ba.ymax-ba.ymin:E;var I=!!y.scaleSymbolsProportionally;fa&&(H={offsetX:J,offsetY:L,rotation:K,size:H,frameHeight:fa,rotateClockWise:!!y.rotateClockwise,absoluteAnchorPoint:!1,scaleSymbolsProportionally:I},P=[...P,H]);F||=this._createMarkerPlacementOverrideExpression(y.markerPlacement);
for(const N of aa)if(N){aa=N.symbol;if(!aa)continue;(H=N.primitiveName)&&D.push(H);K=Q;var M=void 0;if(("CIMPointSymbol"===aa.type||"CIMTextSymbol"===aa.type)&&ba){J=M=0;L=N.geometry;"x"in L&&"y"in L&&(M+=L.x-.5*(ba.xmin+ba.xmax),J+=L.y-.5*(ba.ymin+ba.ymax));L=y.anchorPoint;let W=!1;L&&("Absolute"===y.anchorPointUnits?(M-=L.x,J-=L.y,W=!0):ba&&(M-=(ba.xmax-ba.xmin)*L.x,J-=(ba.ymax-ba.ymin)*L.y));M={offsetX:M,offsetY:J,rotation:0,size:0,frameHeight:0,rotateClockWise:!1,absoluteAnchorPoint:W,scaleSymbolsProportionally:I};
M=[...P,M]}const [R,T]=d.getFrameTranslation(N.geometry,ba);if(0!==R||0!==T)K=d.translate(K,R,T);"CIMPointSymbol"===aa.type&&(K=d.getAnimationParams(this._poMap,aa,K));switch(aa.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":S||t(aa)?(K={...K,transform:{type:"AnimatedTransform",relativeTranslation:!1,absoluteScale:!0,translation:d.getStaticParam([0,0]),rotation:d.getStaticParam(0),scale:d.getStaticParam(fa),parent:Q.transform}},this._analyzeMultiLayerGraphicNonSDF(y,v,F,
N,D,G,E,M??P,K,fa,U,X)):this._analyzeMultiLayerGraphic(y,v,F,N,D,G,E,M??P,K,fa,U,X);break;case "CIMTextSymbol":this._analyzeTextGraphic(v,F,N,D,G,E,M??P,U)}H&&D.pop()}}}_analyzeMultiLayerGraphic(y,v,F,D,G,E,H,K,J,L,P,Q){const S=D.symbol.symbolLayers;S&&(!(S&&2===S.length&&S[0].enable&&S[1].enable&&"CIMSolidStroke"===S[0].type&&"CIMSolidFill"===S[1].type&&null==S[0].path&&null==S[1].path)||S[0].effects||S[1].effects||S[0].animations||S[1].animations||d.shouldUseAnimatedPath(J)?w(S)?this._analyzeMultiLayerGraphicNonSDF(y,
v,F,D,G,E,H,K,J,L,!!P,Q):this._analyzeMarkerGraphicSymbolLayers(y,v,F,D,G,E,H,K,J,L,P,Q):this._analyzeCompositeMarkerGraphic(y,v,F,D,S,E,H,K,L,P,Q))}_analyzeMarkerGraphicSymbolLayers(y,v,F,D,G,E,H,K,J,L,P,Q){var S=D.symbol;const U=S.symbolLayers;if(U){var X=this._resourceManager.geometryEngine;if(S=u.CIMEffectHelper.applyEffects(S.effects,D.geometry,X))for(var aa=U.length;aa--;){const T=U[aa];if(!T||!1===T.enable)continue;const W=T.primitiveName;W&&G.push(W);switch(T.type){case "CIMSolidFill":case "CIMSolidStroke":const Y=
u.CIMEffectHelper.applyEffects(T.effects,S,X);var ba=c.getExtent(Y);if(!ba)continue;const Z="Relative"!==y.anchorPointUnits;var fa=h.getStrokeWidth(T)??0;const {frameSizeRatio:da,anchorX:ca,anchorY:ja,widthRatio:ha,sdfPaddingRatio:ka}=c.getSDFMetrics(ba,y.frame,y.size,y.anchorPoint,Z,fa,y.scaleSymbolsProportionally);var I="CIMSolidFill"===T.type,M={type:"sdf",geom:Y,sdfPaddingRatio:ka,asFill:I},{path:N}=T;ba=I?h.normalizeAlpha(h.getFillColor(T)):null==N?h.normalizeAlpha(h.getStrokeColor(T)):[0,0,
0,0];var R=I?[0,0,0,0]:h.normalizeAlpha(h.getStrokeColor(T));if(!I&&!fa)break;const ia=D.primitiveName;let na=null;I&&!T.colorLocked&&(na=this._maybeGetValueOrOverrideExpression(ia,"FillColor"));let ma=null;I||T.colorLocked||(ma=this._maybeGetValueOrOverrideExpression(ia,"StrokeColor"));ba=na??this._getValueOrOverrideExpression(T.type,W,"Color",ba);R=ma??this._getValueOrOverrideExpression(T.type,W,"Color",R);fa=this._maybeGetValueOrOverrideExpression(ia,"StrokeWidth")??this._getValueOrOverrideExpression(T.type,
W,"Width",fa);I=N?{type:"sprite-rasterization-param",resource:{type:"path",path:N,asFill:I},overrides:[]}:{type:"sprite-rasterization-param",resource:M,overrides:[]};M=d.getAnimationParams(this._poMap,T,J);N=h.getNumericValue(y.size,b.defaultCIMValues.CIMVectorMarker.size);N=this._getValueOrOverrideExpression(y.type,y.primitiveName,"Size",N);this._cimLayers.push({type:"marker",spriteRasterizationParam:I,colorLocked:!!T.colorLocked||!!P,effects:v,scaleSymbolsProportionally:!!y.scaleSymbolsProportionally,
alignment:E,anchorPoint:{x:ca,y:ja},isAbsoluteAnchorPoint:Z,size:L,rotation:0,offsetX:0,offsetY:0,scaleX:1,transform:{type:"cim-marker-transform-param",params:K},frameHeight:L,widthRatio:ha,rotateClockwise:!1,referenceSize:H,sizeRatio:da,color:ba,outlineColor:R,outlineWidth:fa,isOutline:Q,markerPlacement:F,animationParams:B(M),isStroke:"CIMSolidFill"===T.type?!1:!0,baseSize:N,...c.getSDFDimensions(Y,ka)});break;case "CIMPictureMarker":case "CIMVectorMarker":T.markerPlacement?n.getLogger("esri.symbols.cim.cimAnalyzer").error("Error analyzing CIM, got unexpected marker placement"):
this._analyzeMarker(T,v,F,G,E,H,!1,K,J,P,Q)}W&&G.pop()}}}_analyzeTextGraphic(y,v,F,D,G,E,H,K){q.OverrideHelper.findApplicableOverrides(F,this._primitiveOverrides,[]);var J=F.geometry;if("x"in J&&"y"in J){J=F.symbol;var L=h.fromCIMFontDecoration(J),P=h.fromCIMFontStyle(J.fontStyleName),Q=p.getFontFamily(J.fontFamilyName);J.font={family:Q,decoration:L,...P};var S=h.getNumericValue(J.height,b.defaultCIMValues.CIMTextSymbol.height),U=h.getNumericValue(J.angle),X=h.getNumericValue(J.offsetX),aa=h.getNumericValue(J.offsetY),
{haloSymbol:ba}=J,fa=h.getNumericValue(J.haloSize,0),I=[0,0,0,0];if(ba?.symbolLayers?.length){ba=ba.symbolLayers;for(var M of ba)if(M.color){I=this._getValueOrOverrideExpression(J?.haloSymbol?.type??"CIMPolygonSymbol",M.primitiveName,"Color",h.normalizeAlpha(M.color));break}}var N=F.primitiveName,R=[0,0,0,1];M=[0,0,0,0];ba=0;var T=!1;if(J.symbol?.symbolLayers)for(var W of J.symbol.symbolLayers){var Y=W.primitiveName;if("CIMSolidStroke"===W.type)M=this._getValueOrOverrideExpression("CIMSolidStroke",
Y,"Color",h.normalizeAlpha(W.color)),ba=this._getValueOrOverrideExpression("CIMSolidStroke",Y,"Width",h.getStrokeWidth(W)??0);else if("CIMSolidFill"===W.type){var Z=h.normalizeAlpha(W.color);T=T??!!W.colorLocked;R=this._getValueOrOverrideExpression("CIMSolidFill",Y??N,"Color",Z)}}var da=Z=Y=W=null,ca=null;N&&(W=this._maybeGetValueOrOverrideExpression(N,"TextSize"),Y=this._maybeGetValueOrOverrideExpression(N,"TextAngle"),Z=this._maybeGetValueOrOverrideExpression(N,"TextOffsetX"),da=this._maybeGetValueOrOverrideExpression(N,
"TextOffsetY"),T||(ca=this._maybeGetValueOrOverrideExpression(N,"FillColor")));N=ca??R;ca=R=null;var ja=0;if(J.callout&&"CIMBackgroundCallout"===J.callout.type){var ha=J.callout;if(ha.backgroundSymbol&&(ha=ha.backgroundSymbol.symbolLayers))for(var ka of ha)"CIMSolidFill"===ka.type?R=h.normalizeAlpha(ka.color):"CIMSolidStroke"===ka.type&&(ca=h.normalizeAlpha(ka.color),ja=h.getNumericValue(ka.width,b.defaultCIMValues.CIMSolidStroke.width))}ka=this._getValueOrOverrideExpression(J.type,F.primitiveName,
"TextString",F.textString??"");null!=ka&&({fontStyleName:ha}=J,Q+=ha?"-"+ha.toLowerCase():"-regular",D=this._getMaterialOverrides(D,J.type),D.push(...this._getPrimitiveMaterialOverrides(F.primitiveName,J.type)),this._cimLayers.push({type:"text",lineWidth:J.lineWidth,textRasterizationParam:{type:"text-rasterization-param",resource:{type:"text",textString:F.textString??"",font:J.font,symbol:J,primitiveName:F.primitiveName},overrides:D},colorLocked:!!K||!!T,effects:y,alignment:G,anchorPoint:{x:0,y:0},
isAbsoluteAnchorPoint:!1,fontName:Q,decoration:L,haloSize:fa,haloColor:I,weight:P.weight,style:P.style,size:W??S,angle:Y??U,offsetX:Z??X,offsetY:da??aa,transform:{type:"cim-marker-transform-param",params:H},horizontalAlignment:h.fromCIMHorizontalAlignment(J.horizontalAlignment),verticalAlignment:h.fromCIMVerticalAlignment(J.verticalAlignment),text:ka,color:N,outlineColor:M,outlineSize:ba,backgroundColor:R,borderLineColor:ca,borderLineWidth:ja,referenceSize:E,sizeRatio:1,markerPlacement:v}))}}_analyzeMultiLayerGraphicNonSDF(y,
v,F,D,G,E,H,K,J,L,P,Q){var S={type:y.type,enable:!0,name:y.name,colorLocked:y.colorLocked,primitiveName:y.primitiveName,anchorPoint:y.anchorPoint,anchorPointUnits:y.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:y.rotateClockwise,rotation:0,size:y.size,billboardMode3D:y.billboardMode3D,depth3D:y.depth3D,frame:y.frame,markerGraphics:[D],scaleSymbolsProportionally:y.scaleSymbolsProportionally,respectFrame:y.respectFrame,clippingPath:y.clippingPath};D=y.primitiveName;var U=this._analyzeMaterialOverrides(D,
["Rotation","OffsetX","OffsetY"]);U=h.normalizePrimitiveOverrideProps(U);const [X,aa,ba]=a.CIMSymbolHelper.getTextureAnchor(S,this._resourceManager,A.rasterizedVectorMarkerMinSize);G=this._getMaterialOverrides(G,y.type);G.push(...U);G={type:"sprite-rasterization-param",resource:{...S,avoidSDFRasterization:!0},overrides:G};S=h.getNumericValue(y.size,b.defaultCIMValues.CIMVectorMarker.size);D=this._getValueOrOverrideExpression(y.type,D,"Size",S);this._cimLayers.push({type:"marker",spriteRasterizationParam:G,
colorLocked:P,effects:v,scaleSymbolsProportionally:!!y.scaleSymbolsProportionally,alignment:E,anchorPoint:{x:X,y:aa},isAbsoluteAnchorPoint:!1,size:L,rotation:0,offsetX:0,offsetY:0,transform:{type:"cim-marker-transform-param",params:K},color:[255,255,255,1],outlineColor:[0,0,0,0],outlineWidth:0,scaleX:1,frameHeight:L,widthRatio:1,rotateClockwise:!!y.rotateClockwise,referenceSize:H,sizeRatio:ba/m.pt2px(y.size),isOutline:Q,markerPlacement:F,animationParams:B(J),baseSize:D})}_createMarkerPlacementOverrideExpression(y){if(!y)return null;
const v=[];q.OverrideHelper.findApplicableOverrides(y,this._primitiveOverrides,v);return{type:"cim-marker-placement-param",placement:y,overrides:x(v)}}_createGIFAnimatedSymbolPropertiesOverrideExpression(y){if(!y)return null;const v=[];q.OverrideHelper.findApplicableOverrides(y,this._primitiveOverrides,v);return{type:"cim-gif-animation-params",animation:y,overrides:x(v)}}_analyzeCompositeMarkerGraphic(y,v,F,D,G,E,H,K,J,L,P){const Q=D.geometry;var S=G[0],U=G[1],X=c.getExtent(Q);if(X){G="Relative"!==
y.anchorPointUnits;var aa=h.getNumericValue(S.width,b.defaultCIMValues.CIMSolidStroke.width),{frameSizeRatio:ba,anchorX:fa,anchorY:I,widthRatio:M,sdfPaddingRatio:N}=c.getSDFMetrics(X,y.frame,y.size,y.anchorPoint,G,aa,y.scaleSymbolsProportionally);({path:X}=U);var R=U.primitiveName,T=S.primitiveName;D=D.primitiveName;var W=null;U.colorLocked||L||(W=this._maybeGetValueOrOverrideExpression(D,"FillColor"));U=W??this._getValueOrOverrideExpression(U.type,R,"Color",h.normalizeAlpha(U.color));R=null;S.colorLocked||
L||(R=this._maybeGetValueOrOverrideExpression(D,"StrokeColor"));R=R??this._getValueOrOverrideExpression(S.type,T,"Color",h.normalizeAlpha(S.color));S=this._maybeGetValueOrOverrideExpression(D,"StrokeWidth")??this._getValueOrOverrideExpression(S.type,T,"Width",aa);this._cimLayers.push({type:"marker",spriteRasterizationParam:{type:"sprite-rasterization-param",resource:X?{type:"path",path:X,asFill:!0}:{type:"sdf",geom:Q,sdfPaddingRatio:N,asFill:!0},overrides:[]},colorLocked:L,effects:v,scaleSymbolsProportionally:!!y.scaleSymbolsProportionally,
alignment:E,anchorPoint:{x:fa,y:I},isAbsoluteAnchorPoint:G,size:J,rotation:0,offsetX:0,offsetY:0,scaleX:1,transform:{type:"cim-marker-transform-param",params:K},frameHeight:J,widthRatio:M,rotateClockwise:!1,referenceSize:H,sizeRatio:ba,color:U,outlineColor:R,outlineWidth:S,isOutline:P,markerPlacement:F})}}_setPoMap(y,v,F){let D;this._poMap[y]?D=this._poMap[y]:(D={},this._poMap[y]=D);D[v]=F}_maybeGetValueOrOverrideExpression(y,v,F){return this._getValueOrOverrideExpression("",y,v,F,!1)}_getValueOrOverrideExpression(y,
v,F,D,G=!0){G&&!h.isValidCIMValue(D)&&(D=h.getDefaultCIMValue(y,F.toLowerCase()));if(null==v)return D;y=this._poMap[v];if(null==y)return D;F=y[F];return"string"===typeof F||"number"===typeof F||Array.isArray(F)?F:F?{valueExpressionInfo:F,defaultValue:D}:D}_analyzePrimitiveOverrides(y,v,F,D){if(null==y)return!1;"string"===typeof y&&(y=[y]);for(const G of this._primitiveOverrides)if(y.includes(G.primitiveName)&&G.valueExpressionInfo)return!0;if(null!=v)for(const G of v)if(0<G?.overrides.length)return!0;
if(null!=F)for(const G of F)if(0<G?.overrides.length)return!0;if(null!=D)for(const G of D)if(0<G?.overrides.length)return!0;return!1}_getMaterialOverrides(y,v){if(!y)return[];const F=[];for(const D of y)F.push(...this._getPrimitiveMaterialOverrides(D,v));return F}_getPrimitiveMaterialOverrides(y,v){if(!y)return[];const F=h.normalizePrimitiveOverrideProps(this._primitiveOverrides.filter(D=>D.primitiveName===y));F.forEach(D=>D.defaultValue=h.getDefaultCIMValue(v,D.propertyName.toLowerCase()));return F}_analyzeMaterialOverrides(y,
v){return this._primitiveOverrides.filter(F=>F.primitiveName!==y||!v.includes(F.propertyName))}}k.CIMAnalyzer=C;k.analyzeCIMResource=function(y,v){if(!v||0===v.length)return y;y=e.clone(y);q.OverrideHelper.applyOverrides(y,v);return y};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/core/colorUtils":function(){define("exports ../Color ./arrayUtils ./lang ./mathUtils ../chunks/vec42 ./libs/gl-matrix-2/factories/vec4f64".split(" "),function(k,r,p,e,n,m,l){function d(v){return"r"in
v&&"g"in v&&"b"in v}function a(v,F){const D=[];let G,E;if(v[0].length!==F.length)throw Error("dimensions do not match");const H=v.length,K=v[0].length;let J=0;for(G=0;G<H;G++){for(E=J=0;E<K;E++)J+=v[G][E]*F[E];D.push(J)}return D}function b(v){v=[v.r/255,v.g/255,v.b/255].map(F=>.04045>=F?F/12.92:((F+.055)/1.055)**2.4);v=a(B,v);return{x:100*v[0],y:100*v[1],z:100*v[2]}}function f(v){v=a(C,[v.x/100,v.y/100,v.z/100]).map(F=>Math.min(1,Math.max(.0031308>=F?12.92*F:1.055*F**(1/2.4)-.055,0)));return{r:Math.round(255*
v[0]),g:Math.round(255*v[1]),b:Math.round(255*v[2])}}function g(v){v=[v.x/95.047,v.y/100,v.z/108.883].map(F=>F>(6/29)**3?F**(1/3):1/3*(29/6)**2*F+4/29);return{l:116*v[1]-16,a:500*(v[0]-v[1]),b:200*(v[1]-v[2])}}function q(v){const F=v.l;v=[(F+16)/116+v.a/500,(F+16)/116,(F+16)/116-v.b/200].map(D=>D>6/29?D**3:3*(6/29)**2*(D-4/29));return{x:95.047*v[0],y:100*v[1],z:108.883*v[2]}}function c(v){if(d(v))return v;if("l"in v&&"c"in v&&"h"in v){var F=v.c,D=v.h;return f(q({l:v.l,a:F*Math.cos(D),b:F*Math.sin(D)}))}if("l"in
v&&"a"in v&&"b"in v)return f(q(v));if("x"in v&&"y"in v&&"z"in v)return f(v);if("h"in v&&"s"in v&&"v"in v){D=(v.h+360)%360/60;F=v.v/100*255;v=v.s/100*F;const G=v*(1-Math.abs(D%2-1));switch(Math.floor(D)){case 0:D={r:v,g:G,b:0};break;case 1:D={r:G,g:v,b:0};break;case 2:D={r:0,g:v,b:G};break;case 3:D={r:0,g:G,b:v};break;case 4:D={r:G,g:0,b:v};break;case 5:case 6:D={r:v,g:0,b:G};break;default:D={r:0,g:0,b:0}}D.r=Math.round(D.r+F-v);D.g=Math.round(D.g+F-v);D.b=Math.round(D.b+F-v);return D}return v}function h(v){if("h"in
v&&"s"in v&&"v"in v)return v;var F=c(v);v=F.r;const D=F.g,G=F.b;F=Math.max(v,D,G);const E=F-Math.min(v,D,G);v=0===E?0:F===v?(D-G)/E%6:F===D?(G-v)/E+2:(v-D)/E+4;0>v&&(v+=6);return{h:60*v,s:100*(0===E?0:E/F),v:100/255*F}}function u(v){return"l"in v&&"a"in v&&"b"in v?v:g(b(c(v)))}function A(v){let {r:F,g:D,b:G,a:E}=v;1>E&&(F=Math.round(E*F+255*(1-E)),D=Math.round(E*D+255*(1-E)),G=Math.round(E*G+255*(1-E)));return new r({r:F,g:D,b:G})}function z(v,F){const {r:D,g:G,b:E}=F?.ignoreAlpha?v:A(v);return.2126*
D+.7152*G+.0722*E}function t(v){v[0]??(v[0]=0);v[1]??(v[1]=0);v[2]??(v[2]=0);return v}function w(v,F,D={}){const G=[],E=v.length-1,H=Math.ceil((F-v.length)/E);a:for(let K=0;K<E;K++){const J=v[K],L=v[K+1];for(let P=1;P<=H;P++)if(G.push(x(J,L,P/(H+1),D)),G.length+v.length===F)break a}return[...v.map(K=>K.clone()),...p.shuffle(G,D.seed??1)]}function x(v,F,D,G={}){var E=v.r,H=v.g;v=v.b;E=Math.round(E+(F.r-E)*D);H=Math.round(H+(F.g-H)*D);F=Math.round(v+(F.b-v)*D);if(!G.offset)return new r([E,H,F]);G=p.getRandomNumberGenerator(G.seed);
return new r([y(E,G),y(H,G),y(F,G)])}const B=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],C=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];k.BrightnessThreshold=void 0;(function(v){v[v.Low=160]="Low";v[v.High=225]="High"})(k.BrightnessThreshold||(k.BrightnessThreshold={}));const y=(v,F)=>{F=Math.floor(10*F())-5;return Math.min(255,Math.max(0,v+F))};k.colorEquals=function(v,F){return v===F||null!=v&&v.equals(F)};k.colorVectorEquals=function(v,F){return v===F||
null!=v&&null!=F&&m.equals(v,F)};k.colorVectorToColorAndOpacity=function(v){return l.fromValues(v[0],v[1],v[2],3<v.length?v[3]:1)};k.createUniqueColors=function(v,F,D={}){if(0===v.length||0>=F)return[];v=v.map(E=>"string"===typeof E?new r(E):E);if(1===v.length||1===F){D=[];v=v[0];for(var G=0;G<F;G++)D.push(v.clone());return D}D.shuffle&&(v=p.shuffle(e.clone(v),D.seed));if(v.length>=F){D=[];G=(v.length-1)/(F-1);for(let E=0;E<F;E++)D.push(v[Math.round(E*G)].clone());return D}return w(v,F,D)};k.darken=
function(v,F){var D=u(v);D.l*=1-F;F=c(D);D=v.clone();D.setColor(F);D.a=v.a;return D};k.desaturate=function(v,F){var D=h(v);D.s*=F;F=c(D);D=v.clone();D.setColor(F);D.a=v.a;return D};k.getColorLuminance=z;k.getColorTheme=function(v){return A(v).isBright?"light":"dark"};k.getContrast=function(v,F=k.BrightnessThreshold.High){return z(v,{ignoreAlpha:!0})>F?new r([0,0,0,v.a]):new r([255,255,255,v.a])};k.isRGB=d;k.multiplyOpacity=function(v,F){v=v.clone();v.a*=F;return v};k.multiplyOpacityToUnitRGBA=function(v,
F){v=r.toUnitRGBA(v);v[3]*=F;return v};k.toHSV=h;k.toLAB=u;k.toLCH=function(v){if(!("l"in v&&"c"in v&&"h"in v)){var F=g(b(c(v)));v=F.l;var D=F.a;const G=F.b;F=Math.sqrt(D*D+G*G);D=Math.atan2(G,D);D=0<D?D:D+2*Math.PI;v={l:v,c:F,h:D}}return v};k.toRGB=c;k.unitRGBAFromColor=function(v){return r.toUnitRGBA(v)};k.validateColor=t;k.validateColorAndOpacity=function(v){v.length=4;t(v);v[3]??(v[3]=1);n.clamp(v[3],0,1);return v};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/core/fontUtils":function(){define(["exports",
"../config"],function(k,r){function p(f){if(!f)return"arial-unicode-ms";f=f.toLowerCase().split(" ").join("-");switch(f){case "serif":return"noto-serif";case "sans-serif":return"arial-unicode-ms";case "monospace":return"ubuntu-mono";case "fantasy":return"cabin-sketch";case "cursive":return"redressed";default:return f}}function e(f){const g=m(f)+l(f);return p(f.family)+(0<g.length?g:"-regular")}function n(f){const g=m(f)+l(f);return(f.family||"arial-unicode-ms")+(0<g.length?g:"-regular")}function m(f){if(!f.weight)return"";
switch(f.weight.toLowerCase()){case "bold":case "bolder":return"-bold"}return""}function l(f){if(!f.style)return"";switch(f.style.toLowerCase()){case "italic":case "oblique":return"-italic"}return""}const d=new Map,a=new Set;class b{constructor(f,g){this.fontFace=f;this.promise=g}}k.clearFonts=function(){const f=document.fonts;d.forEach(g=>{f.delete(g.fontFace)});d.clear();a.clear()};k.defaultFontFamily="arial-unicode-ms";k.getFontFamily=p;k.getFullyQualifiedFontName=e;k.isCachedFontFace=function(f){return a.has(f)};
k.loadFont=async function(f){const g=n(f),q=e(f),c=d.get(g);if(c)return c.promise;const h=new FontFace(f.family,`url('${r.fontsUrl}/woff2/${q}.${"woff2"}') format('${"woff2"}')`,{style:f.style,weight:f.weight}),u=document.fonts;if(u.has(h)&&"loading"===h.status)return h.loaded;f=h.load().then(()=>{u.add(h);return h});d.set(g,new b(h,f));a.add(h);return f};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/animationUtils":function(){define("exports ../../core/Logger ./animationDebugFlags ./defaultCIMValues ./enums ./SDFHelper ./utils ../../views/2d/engine/webgl/animations/instructions".split(" "),
function(k,r,p,e,n,m,l,d){function a(x,B){let C=0,y=0;const v="Absolute"!==x.anchorPointUnits;x.anchorPoint&&(C=-x.anchorPoint.x,y=-x.anchorPoint.y);return{...B,transform:{type:"AnimatedTransform",relativeTranslation:v,absoluteScale:!1,translation:t([C,y]),rotation:t(0),scale:t(1),parent:B.transform}}}function b(x,B){switch(B.type){case "CIMSolidStroke":case "CIMSolidFill":return l.getProcessParam(x,B,"Color");case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":return l.getProcessParam(x,
B,"TintColor")}return[1,1,1,1]}function f(x,B,C){var {animations:y}=B;B=b(x,B);(y=y?.filter(v=>"CIMSymbolAnimationColor"===v.type)[0])&&(B=l.getProcessParam(x,y,"ToColor"));return{type:"AnimatedColor",color:t(B),opacity:t(1),parent:C}}function g(x,B,C){({animations:B}=B);return(B=B?.filter(y=>"CIMSymbolAnimationColor"===y.type)[0])?{type:"AnimatedColor",color:t([1,1,1,1]),opacity:{from:0,to:1,timing:h(x,B?.animatedSymbolProperties)},parent:[1,1,1,1]}:C}function q(x,B,C){var {animations:y}=B;B=t(1);
if(y=y?.filter(v=>"CIMSymbolAnimationTransparency"===v.type)[0])x=l.getProcessParam(x,y,"ToTransparency"),B=t({type:"Process",op:"Transparency",value:x});return{type:"AnimatedColor",color:t([1,1,1,1]),opacity:B,parent:C}}function c(x,B,C){({animations:B}=B);return(B=B?.filter(y=>"CIMSymbolAnimationTransparency"===y.type)[0])?{type:"AnimatedColor",color:t([1,1,1,1]),opacity:{from:0,to:1,timing:h(x,B?.animatedSymbolProperties)},parent:[1,1,1,1]}:C}function h(x,B){if(!B)return{duration:1,startTimeOffset:0,
repeatDelay:0,timeOriginSelector:d.TimeOrigin.Local,repeatType:n.AnimatedSymbolRepeatType.Loop,easing:n.AnimatedSymbolEasingType.Linear,playAnimation:1,reverseAnimation:0};const C=l.getProcessParam(x,B,"Duration");if(l.getProcessParam(x,B,"RandomizeStartTime")){var y=l.getProcessParam(x,B,"RandomizeStartSeed");y={type:"Process",op:"Random",min:0,max:C,seed:y}}else y=l.getProcessParam(x,B,"StartTimeOffset");const v=l.getProcessParam(x,B,"RepeatDelay"),F=l.getProcessParam(x,B,"PlayAnimation");x=l.getProcessParam(x,
B,"ReverseAnimation");const D=l.getValue(B.repeatType,e.defaultCIMValues.CIMAnimatedSymbolProperties.repeattype),G=D===n.AnimatedSymbolRepeatType.None?d.TimeOrigin.Local:d.TimeOrigin.Global;B=l.getValue(B.easing,e.defaultCIMValues.CIMAnimatedSymbolProperties.easing);return{duration:C,startTimeOffset:y,repeatDelay:v,timeOriginSelector:G,repeatType:D,easing:B,playAnimation:F,reverseAnimation:x}}function u(x,B){var {animations:C}=B;if("CIMPictureMarker"!==B.type&&"CIMVectorMarker"!==B.type&&"CIMPointSymbol"!==
B.type)return t(1);B="CIMPictureMarker"===B.type||"CIMVectorMarker"===B.type?l.getProcessParam(x,B,"Size"):l.getSize(B)||10;const y=C?.filter(v=>"CIMSymbolAnimationScale"===v.type)[0];return y?{from:1,to:l.getProcessParam(x,y,"ScaleFactor"),timing:h(x,y.animatedSymbolProperties)}:(C=C?.filter(v=>"CIMSymbolAnimationSize"===v.type)[0])?{from:1,to:{type:"Process",op:"Divide",left:l.getProcessParam(x,C,"ToSize"),right:B},timing:h(x,C.animatedSymbolProperties)}:t(1)}function A(x,B){({animations:B}=B);
B=B?.filter(v=>"CIMSymbolAnimationOffset"===v.type)[0];if(!B)return t([0,0]);const C=l.getProcessParam(x,B,"OffsetX"),y=l.getProcessParam(x,B,"OffsetY");return{from:[0,0],to:[C,y],timing:h(x,B.animatedSymbolProperties)}}function z(x,B){var {animations:C}=B;a:{switch(B.type){case "CIMPictureMarker":case "CIMVectorMarker":var y=l.getProcessParam(x,B,"RotateClockwise");break a}y=0}a:{switch(B.type){case "CIMPictureMarker":case "CIMVectorMarker":B=l.getProcessParam(x,B,"Rotation");break a}B=0}B={type:"Process",
op:"Divide",left:B,right:{type:"Process",op:"Cond",condition:y,ifTrue:-1,ifFalse:1}};C=C?.filter(F=>"CIMSymbolAnimationRotation"===F.type)[0];if(!C)return t(B);y={type:"Process",op:"Add",left:l.getProcessParam(x,C,"ToRotation"),right:{type:"Process",op:"Divide",left:B,right:-1}};const v=l.getProcessParam(x,C,"RotateClockwise");return{from:B,to:{type:"Process",op:"Add",left:B,right:{type:"Process",op:"Cond",condition:v,ifTrue:{type:"Process",op:"MatchWinding",sign:-1,angle:y},ifFalse:{type:"Process",
op:"MatchWinding",sign:1,angle:y}}},timing:h(x,C.animatedSymbolProperties)}}function t(x){return{from:x,to:x,timing:{duration:1,startTimeOffset:0,repeatDelay:0,timeOriginSelector:d.TimeOrigin.Local,repeatType:n.AnimatedSymbolRepeatType.Loop,easing:n.AnimatedSymbolEasingType.Linear,playAnimation:1,reverseAnimation:0}}}function w(x){if(null==x||"object"!==typeof x)return!1;if(x.animations&&Array.isArray(x.animations)&&0<x.animations.length)return!0;for(const B in x)if(w(x[B]))return!0;return!1}k.checkForAnimations=
w;k.getAnimationParams=function(x,B,C){var y=C.transform;var v=A(x,B),F=z(x,B),D=u(x,B);y={type:"AnimatedTransform",relativeTranslation:!1,absoluteScale:!1,translation:v,rotation:F,scale:D,parent:y};v=C.fromColor;F=t(b(x,B));D=t(1);v={type:"AnimatedColor",color:F,opacity:D,parent:v};F=f(x,B,C.toColor);D=g(x,B,C.colorMix);const G=q(x,B,C.toOpacity);x=c(x,B,C.opacityMix);return{transform:y,fromColor:v,toColor:F,colorMix:D,toOpacity:G,opacityMix:x,hasAnimations:C.hasAnimations||!!B.animations&&0<B.animations.length}};
k.getFrameTranslation=function(x,B){const C=B?.5*-(B.xmin+B.xmax):0;B=B?.5*-(B.ymin+B.ymax):0;let y=0;var v=0;if("x"in x&&"y"in x)y=x.x+C,v=x.y+B;else if(x=m.getExtent(x))v=(x[1]+x[3])/2,y=(x[0]+x[2])/2+C,v+=B;return[y,v]};k.getStaticParam=t;k.handleAbsoluteAnchor=function(x,B){return"Absolute"!==x.anchorPointUnits?B:a(x,B)};k.handleAnchor=a;k.handleMarker=function(x,B,C){if("CIMCharacterMarker"===B.type)return r.getLogger("animationUtils").error("#handleMarker()","CIM character markers do not support animations"),
C;const y=l.getProcessParam(x,B,"OffsetX"),v=l.getProcessParam(x,B,"OffsetY");if("CIMPictureMarker"===B.type)return{...C,transform:{type:"AnimatedTransform",relativeTranslation:!1,absoluteScale:!0,translation:t([y,v]),rotation:t(0),scale:t(l.getProcessParam(x,B,"Size")),parent:C.transform}};var F=B.frame;F=F.ymax-F.ymin;return{...C,transform:{type:"AnimatedTransform",relativeTranslation:!1,absoluteScale:!1,translation:t([y,v]),rotation:t(0),scale:t({type:"Process",op:"Divide",left:l.getProcessParam(x,
B,"Size"),right:F}),parent:C.transform}}};k.handleRelativeAnchor=function(x,B){return"Absolute"===x.anchorPointUnits?B:a(x,B)};k.shouldUseAnimatedPath=function(x){return p.animationDebugFlags.forceStaticPath?!1:p.animationDebugFlags.forceAnimatedPath||x.hasAnimations};k.translate=function(x,B,C){return{...x,transform:{type:"AnimatedTransform",relativeTranslation:!1,absoluteScale:!1,translation:t([B,C]),rotation:t(0),scale:t(1),parent:x.transform}}};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},
"esri/symbols/cim/animationDebugFlags":function(){define(["exports","../../core/has"],function(k,r){class p{get forceStaticPath(){return"disabled"===r("esri-cim-animations-enable-status")}get forceAnimatedPath(){return"forced"===r("esri-cim-animations-enable-status")}get freezeGlobalTime(){const n=r("esri-cim-animations-freeze-time");return null==n?!1:n}get spotlightAnimatedSymbols(){return!!r("esri-cim-animations-spotlight")}get forceGlobalTimeOrigin(){return!1!==r("esri-cim-animations-freeze-time")}}
const e=new p;k.animationDebugFlags=e;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/SDFHelper":function(){define(["exports","../../core/floatRGBA","../../geometry/support/jsonUtils","./Rect","../../views/2d/engine/webgl/definitions"],function(k,r,p,e,n){function m(a,b=.5){switch(a.type){case "CIMPointSymbol":b=a.symbolLayers;if(!b||1!==b.length)return null;b=b[0];return"CIMVectorMarker"!==b.type?null:m(b);case "CIMVectorMarker":a=a.markerGraphics;if(!a||1!==a.length)return null;
var f=a[0];if(!f)return null;a=f.geometry;if(!a)return null;f=f.symbol;return!f||"CIMPolygonSymbol"!==f.type&&"CIMLineSymbol"!==f.type||f.symbolLayers?.some(g=>!!g.effects)?null:{type:"sdf",geom:a,sdfPaddingRatio:b,asFill:"CIMPolygonSymbol"===f.type}}}function l(a){let b=Infinity,f=-Infinity,g=Infinity,q=-Infinity;for(const c of a)for(const h of c)h[0]<b&&(b=h[0]),h[0]>f&&(f=h[0]),h[1]<g&&(g=h[1]),h[1]>q&&(q=h[1]);return[b,g,f,q]}function d(a){return a?a.rings?l(a.rings):a.paths?l(a.paths):p.isExtent(a)?
[a.xmin,a.ymin,a.xmax,a.ymax]:null:null}k.buildSDF=function(a){var b=a.geom;var f=b?b.rings?b.rings:b.paths?b.paths:void 0!==b.xmin&&void 0!==b.ymin&&void 0!==b.xmax&&void 0!==b.ymax?[[[b.xmin,b.ymin],[b.xmin,b.ymax],[b.xmax,b.ymax],[b.xmax,b.ymin],[b.xmin,b.ymin]]]:null:null;b=Infinity;var g=-Infinity,q=Infinity;var c=-Infinity;for(var h of f)for(var u of h)u[0]<b&&(b=u[0]),u[0]>g&&(g=u[0]),u[1]<q&&(q=u[1]),u[1]>c&&(c=u[1]);c=new e(b,q,g-b,c-q);u=n.defaultSdfTextureSize;b=n.spritePadding;h=Math.floor(.5*
(u*a.sdfPaddingRatio-b));u-=2*(h+b);var A=u/Math.max(c.width,c.height);b=Math.round(c.width*A)+2*h;g=Math.round(c.height*A)+2*h;q=[];for(var z of f)if(z&&1<z.length){f=[];for(var t of z){let [K,J]=t;K-=c.x;J-=c.y;K*=A;J*=A;K+=h-.5;J+=h-.5;a.asFill?f.push([K,J]):f.push([Math.round(K),Math.round(J)])}if(a.asFill){var w=f.length-1;f[0][0]===f[w][0]&&f[0][1]===f[w][1]||f.push(f[0])}q.push(f)}t=b*g;z=Array(t);f=h*h+1;for(c=0;c<t;++c)z[c]=f;for(var x of q)for(f=x.length,c=1;c<f;++c){A=x[c-1];w=x[c];var B=
void 0,C=void 0;A[0]<w[0]?(B=A[0],C=w[0]):(B=w[0],C=A[0]);var y=void 0,v=void 0;A[1]<w[1]?(y=A[1],v=w[1]):(y=w[1],v=A[1]);var F=Math.floor(B)-h;C=Math.floor(C)+h;y=Math.floor(y)-h;v=Math.floor(v)+h;0>F&&(F=0);C>b&&(C=b);0>y&&(y=0);v>g&&(v=g);B=w[0]-A[0];const K=w[1]-A[1],J=B*B+K*K;for(;F<C;F++)for(let L=y;L<v;L++){var D=F+.5,G=L+.5,E=(D-A[0])*B+(G-A[1])*K;let P;0>E?(P=A[0],E=A[1]):E>J?(P=w[0],E=w[1]):(E/=J,P=A[0]+E*B,E=A[1]+E*K);D=(D-P)*(D-P)+(G-E)*(G-E);G=(g-L-1)*b+F;D<z[G]&&(z[G]=D)}}for(x=0;x<
t;++x)z[x]=Math.sqrt(z[x]);if(a.asFill)for(var H of q)for(x=H.length,q=1;q<x;++q)for(t=H[q-1],f=H[q],t[0]<f[0]?(c=t[0],A=f[0]):(c=f[0],A=t[0]),t[1]<f[1]?(C=t[1],w=f[1]):(C=f[1],w=t[1]),c=Math.floor(c),A=Math.floor(A)+1,C=Math.floor(C),w=Math.floor(w)+1,c<h&&(c=h),A>b-h&&(A=b-h),C<h&&(C=h),w>g-h&&(w=g-h);C<w;++C)if(t[1]>C!==f[1]>C){v=C+.5;y=(g-C-1)*b;for(B=c;B<A;++B)B+.5<(f[0]-t[0])*(v-t[1])/(f[1]-t[1])+t[0]&&(z[y+B]=-z[y+B]);for(v=h;v<c;++v)z[y+v]=-z[y+v]}H=2*h;x=z.length;q=new Uint8Array(4*x);for(t=
0;t<x;++t)r.packFloatRGBA(.5-z[t]/H,q,4*t);return{data:q,width:b,height:g,sdfPaddingRatio:a.sdfPaddingRatio,sdfDecodeCoeff:2*h/u}};k.getExtent=d;k.getSDFDimensions=function(a,b){const [f,g,q,c]=d(a);a=q-f;const h=c-g;var u=n.defaultSdfTextureSize;const A=n.spritePadding;b=Math.floor(.5*(u*b-A));u=(u-2*(b+A))/Math.max(a,h);return{pixelDimensions:[a,h],texelDimensions:[Math.round((Math.round(a*u)+2*b)/u),Math.round((Math.round(h*u)+2*b)/u)]}};k.getSDFInfo=m;k.getSDFMetrics=function(a,b,f,g,q,c,h){const [u,
A,z,t]=a;if(z<u||t<A)return{frameSizeRatio:0,anchorX:0,anchorY:0,widthRatio:1,sdfPaddingRatio:.5};var w=z-u,x=t-A,B=Math.max(w,x);a=.5;null!=c&&null!=f&&(h||null==b||(c*=(b.ymax-b.ymin)/f),c/=c+B,.45<c&&1>c&&(a=Math.min(c+.1,.99)));h=n.defaultSdfTextureSize;var C=n.spritePadding;c=Math.floor(.5*(h*a-C));B=(h-2*(c+C))/B;h=Math.round(w*B);C=Math.round(x*B)+2*c;x=1;b&&(x=C*(1-a)/((b.ymax-b.ymin)*B));let y=0,v=0;w=1;g&&(q?b&&f&&0<b.ymax-b.ymin&&(w=(b.xmax-b.xmin)/(b.ymax-b.ymin),y=g.x/(f*w),v=g.y/f):
(y=g.x,v=g.y));b&&(y=.5*(b.xmax+b.xmin)+y*(b.xmax-b.xmin),v=.5*(b.ymax+b.ymin)+v*(b.ymax-b.ymin));y=(y-u)*B+c;v=(v-A)*B+c;b=y/(h+2*c)-.5;g=v/C-.5;q&&f&&(b*=f*w,g*=f);return{frameSizeRatio:x,anchorX:b,anchorY:g,widthRatio:w,sdfPaddingRatio:a}};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/core/floatRGBA":function(){define(["exports","./mathUtils"],function(k,r){function p(l,d=0){let a=0;for(let b=0;4>b;b++)a+=l[d+b]*n[b];return a}const e=[1,256,65536,16777216],n=[1/256,1/65536,
1/16777216,1/4294967296],m=p(new Uint8ClampedArray([255,255,255,255]));k.packFloatRGBA=function(l,d,a=0){l=r.clamp(l,0,m);for(let g=0;4>g;g++){var b=Math,f=l*e[g];d[a+g]=b.floor.call(b,256*(f-Math.floor(f)))}};k.unpackFloatRGBA=p;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/Rect":function(){define(function(){class k{constructor(r=0,p=0,e=0,n=0){this.x=r;this.y=p;this.width=e;this.height=n}static fromExtent(r){return new k(r.xmin,-r.ymax,r.xmax-r.xmin,r.ymax-r.ymin)}get isEmpty(){return 0>=
this.width||0>=this.height}union(r){this.x=Math.min(this.x,r.x);this.y=Math.min(this.y,r.y);this.width=Math.max(this.width,r.width);this.height=Math.max(this.height,r.height)}}return k})},"esri/views/2d/engine/webgl/animations/instructions":function(){define(["exports"],function(k){function r(A){return[`float duration = clamp(${A.duration}, 0.05, 3600.0);`,`float startTimeOffset = ${A.startTimeOffset};`,`float repeatDelay = ${A.repeatDelay};`,`float timeOriginSelector = ${A.timeOriginSelector};`,
`float repeatType = ${A.repeatType};`,`float easing = ${A.easing};`,`float playAnimation = ${A.playAnimation} * (1.0 - step(0.0, -${A.duration}));`,`float reverseAnimation = ${A.reverseAnimation};`,"float time \x3d globalTime - (timeOriginSelector \x3d\x3d 1.0 ? localTimeOrigin : 0.0);","time *\x3d playAnimation;","time *\x3d 1.0 - reverseAnimation * 2.0;","float period \x3d duration + repeatDelay;","time +\x3d reverseAnimation \x3d\x3d 1.0 ? (period - startTimeOffset - 0.001) : startTimeOffset + 0.001;",
"float omega \x3d time / period;","float oi \x3d floor(omega);","omega \x3d repeatType \x3d\x3d 1.0 || repeatType \x3d\x3d 3.0 ? omega - oi : omega;","float of \x3d omega * period;","of \x3d (clamp(of, reverseAnimation * repeatDelay, period - (1.0 - reverseAnimation) * repeatDelay) - reverseAnimation * repeatDelay) / duration;","of \x3d easing \x3d\x3d 2.0 ? pow(of, 3.0) : of;","of \x3d easing \x3d\x3d 3.0 ? 1.0 - pow(1.0 - of, 3.0) : of;","of \x3d easing \x3d\x3d 4.0 ? of \x3c 0.5 ? 4.0 * pow(of, 3.0) : 1.0 - pow(-2.0 * of + 2.0, 3.0) / 2.0 : of;",
"bool oscillate \x3d repeatType \x3d\x3d 3.0 \x26\x26 mod(oi, 2.0) \x3d\x3d 1.0;",`${A.out} = oscillate ? 1.0 - of : of;`]}function p(A){return[[A.duration,A.startTimeOffset,A.repeatDelay,q[A.timeOriginSelector]],[g[A.repeatType],f[A.easing],A.playAnimation,A.reverseAnimation]]}function e(A){const z=[];z.push(`float globalTime = ${A.globalTime};`);z.push(`float localTimeOrigin = ${A.localTimeOrigin};`);z.push(`vec2 pointer = ${A.animationPointer};`);z.push(`vec2 size = ${A.animationTextureSize};`);
z.push("int top \x3d 0;");z.push("vec4 stack[4];");z.push("for (int counter \x3d 0; counter \x3c 40; counter++) {");z.push(`vec4 atom0 = texture(${A.animationTexture}, (pointer + 0.5) / size);`);z.push("pointer.x +\x3d 1.0;");z.push(`vec2 pixelDimensions = ${A.pixelDimensions};`);z.push("if (false) {");for(const t in u){const w=u[t];z.push(`} else if (int(atom0.x) == ${w.opcode}) {`);for(const x of w.generateSource(A))z.push(x)}z.push("} // End if-else.");z.push("} // End for.");z.push(`${A.out} = top > 0 ? stack[top - 1] : vec4(0.0);`);
return z.join("\n")}k.TimeOrigin=void 0;(function(A){A.Local="Local";A.Global="Global"})(k.TimeOrigin||(k.TimeOrigin={}));class n{generateSource(A){const z=[];for(let w=1;w<this.length;w++)z.push(`vec4 atom${w} = texture(${A.animationTexture}, (pointer + 0.5) / size);`),z.push("pointer.x +\x3d 1.0;");for(A=0;A<this.ins;A++)z.push("top--;"),z.push(`vec4 in${this.ins-A-1} = stack[top];`);for(A=0;A<this.outs;A++)z.push(`vec4 out${A};`);({microcode:A}=this);for(var t of A)z.push(t);for(t=0;t<this.outs;t++)z.push(`stack[top] = out${t};`),
z.push("top++;"),z.push("if (top \x3e\x3d 4) { top \x3d 3; }");return z}}let m=128;class l extends n{constructor(){super(...arguments);this.opcode=++m;this.length=1;this.outs=this.ins=0;this.microcode=["break;"]}encode(){return[[this.opcode,0,0,0]]}}class d extends n{constructor(){super(...arguments);this.opcode=++m;this.length=1;this.ins=0;this.outs=1;this.microcode=["out0 \x3d vec4(atom0.y, atom0.y, atom0.y, atom0.y);"]}encode(A){return[[this.opcode,A,0,0]]}}class a extends n{constructor(){super(...arguments);
this.opcode=++m;this.length=1;this.ins=0;this.outs=1;this.microcode=["out0 \x3d vec4(atom0.yzw, 0.0);"]}encode(A){return[[this.opcode,A[0]||0,A[1]||0,A[2]||0]]}}class b extends n{constructor(){super(...arguments);this.opcode=++m;this.length=2;this.ins=0;this.outs=1;this.microcode=["out0 \x3d atom1;"]}encode(A){return[[this.opcode,0,0,0],A]}}const f={Linear:1,EaseIn:2,EaseOut:3,EaseInOut:4},g={Loop:1,None:2,Oscillate:3},q={Local:1,Global:2};class c extends n{constructor(){super(...arguments);this.opcode=
++m;this.length=10;this.outs=this.ins=1;this.microcode=["vec2 fromTranslation \x3d atom1.xy;","vec2 toTranslation \x3d atom1.zw;","float fromRotation \x3d atom2.x;","float toRotation \x3d atom2.y;","float fromScale \x3d atom2.z;","float toScale \x3d atom2.w;","bool relativeTranslation \x3d atom9.x \x3d\x3d 1.0;","bool absoluteScale \x3d atom9.y \x3d\x3d 1.0;","vec2 translationMultiplier \x3d relativeTranslation ? pixelDimensions : vec2(1.0, 1.0);","float scaleDivisor \x3d absoluteScale ? pixelDimensions.y : 1.0;",
"float fTranslation;","{",...r({duration:"atom3.x",startTimeOffset:"atom3.y",repeatDelay:"atom3.z",timeOriginSelector:"atom3.w",repeatType:"atom4.x",easing:"atom4.y",playAnimation:"atom4.z",reverseAnimation:"atom4.w",out:"fTranslation"}),"}","float fRotation;","{",...r({duration:"atom5.x",startTimeOffset:"atom5.y",repeatDelay:"atom5.z",timeOriginSelector:"atom5.w",repeatType:"atom6.x",easing:"atom6.y",playAnimation:"atom6.z",reverseAnimation:"atom6.w",out:"fRotation"}),"}","float fScale;","{",...r({duration:"atom7.x",
startTimeOffset:"atom7.y",repeatDelay:"atom7.z",timeOriginSelector:"atom7.w",repeatType:"atom8.x",easing:"atom8.y",playAnimation:"atom8.z",reverseAnimation:"atom8.w",out:"fScale"}),"}","vec2 aTranslation \x3d mix(fromTranslation, toTranslation, fTranslation);","float aRotation \x3d mix(fromRotation, toRotation, fRotation);","float aScale \x3d mix(fromScale, toScale, fScale);","vec2 pTranslation \x3d in0.xy;","float pRotation \x3d in0.z;","float pScale \x3d in0.w;","aTranslation *\x3d translationMultiplier;",
"aScale /\x3d scaleDivisor;","float rotation \x3d pRotation + aRotation;","float scale \x3d pScale * aScale;","float sin1 \x3d sin(pRotation);","float cos1 \x3d cos(pRotation);","float s1 \x3d pScale;","float x1 \x3d pTranslation.x;","float y1 \x3d pTranslation.y;","float x2 \x3d aTranslation.x;","float y2 \x3d aTranslation.y;","\n    vec2 translation \x3d vec2(\n      cos1 * s1 * x2 - sin1 * s1 * y2 + x1,\n      sin1 * s1 * x2 + cos1 * s1 * y2 + y1\n    );\n    ","out0 \x3d vec4(translation, rotation, scale);"]}encode(A){return[[this.opcode,
0,0,0],[A.translation.from[0],A.translation.from[1],A.translation.to[0],A.translation.to[1]],[A.rotation.from,A.rotation.to,A.scale.from,A.scale.to],...p(A.translation.timing),...p(A.rotation.timing),...p(A.scale.timing),[A.relativeTranslation?1:0,A.absoluteScale?1:0,0,0]]}}class h extends n{constructor(){super(...arguments);this.opcode=++m;this.length=7;this.outs=this.ins=1;this.microcode=["float fromOpacity \x3d atom0.y;","float toOpacity \x3d atom0.z;","vec4 fromColor \x3d atom1;","vec4 toColor \x3d atom2;",
"float fColor;","{",...r({duration:"atom3.x",startTimeOffset:"atom3.y",repeatDelay:"atom3.z",timeOriginSelector:"atom3.w",repeatType:"atom4.x",easing:"atom4.y",playAnimation:"atom4.z",reverseAnimation:"atom4.w",out:"fColor"}),"}","float fOpacity;","{",...r({duration:"atom5.x",startTimeOffset:"atom5.y",repeatDelay:"atom5.z",timeOriginSelector:"atom5.w",repeatType:"atom6.x",easing:"atom6.y",playAnimation:"atom6.z",reverseAnimation:"atom6.w",out:"fOpacity"}),"}","vec4 aColor \x3d mix(fromColor, toColor, fColor);",
"aColor.a *\x3d mix(fromOpacity, toOpacity, fOpacity);","vec4 pColor \x3d in0;","out0 \x3d aColor * pColor;"]}encode(A){return[[this.opcode,A.opacity.from,A.opacity.to,0],[A.color.from[0],A.color.from[1],A.color.from[2],A.color.from[3]],[A.color.to[0],A.color.to[1],A.color.to[2],A.color.to[3]],...p(A.color.timing),...p(A.opacity.timing)]}}const u={scalar:new d,vector3:new a,vector4:new b,animatedTransform:new c,animatedColor:new h,ret:new l};k.AAnimationInstruction=n;k.AnimatedColorInstruction=h;
k.AnimatedTransformInstruction=c;k.RetInstruction=l;k.ScalarInstruction=d;k.Vector3Instruction=a;k.Vector4Instruction=b;k.easingCodes=f;k.generateGetValueSource=function(A,z){return`\n    vec4 ${A}(int valueIndex) {\n      vec2 thePointer = ${z.animationPointer};\n      float jump = texture(${z.animationTexture}, (0.5 + vec2(thePointer.x + float(valueIndex), thePointer.y)) / ${z.animationTextureSize}).x;\n      thePointer = vec2(thePointer.x + jump, thePointer.y);\n      vec4 theResult;\n      ${e({...z,
out:"theResult",animationPointer:"thePointer"})}\n      return theResult;\n    }\n  `};k.generateVirtualMachineSource=e;k.getTweenFactor=r;k.instructions=u;k.repeatTypeCodes=g;k.timeOriginSelectorCodes=q;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMSymbolHelper":function(){define("exports ../../core/BidiText ../../core/has ../../core/lang ../../core/Logger ../../core/RandomLCG ../../core/screenUtils ../../geometry/support/aaBoundingRect ../../geometry/support/boundsUtils ../Font ./CIMPlacements ./CIMSymbolDrawHelper ./defaultCIMValues ./enums ./utils ../support/defaults ../../views/2d/engine/vectorTiles/GeometryUtils ../../views/2d/engine/webgl/definitions ../../views/2d/engine/webgl/mesh/templates/shapingUtils ../../views/2d/layers/graphics/graphicsUtils".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g,q,c,h,u,A,z,t,w){function x(I,M,N){switch(M.type){case "CIMSymbolReference":return x(I,M.symbol,N);case "CIMPointSymbol":null==N&&(N={x:0,y:0});I.drawSymbol(M,N);break;case "CIMLineSymbol":null==N&&(N={paths:[[[0,0],[10,0]]]});I.drawSymbol(M,N);break;case "CIMPolygonSymbol":null==N&&(N={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]});I.drawSymbol(M,N);break;case "CIMTextSymbol":I.drawSymbol(M,{x:0,y:0});break;case "CIMVectorMarker":N=new f.Placement,I.drawMarker(M,N)}return I.envelope()}
function B(I){if(!I)return 0;switch(I.type){case "CIMMarkerPlacementAlongLineSameSize":return Math.abs(I.offset);case "CIMMarkerPlacementAlongLineRandomSize":return Math.abs(I.offset);case "CIMMarkerPlacementAtExtremities":return Math.abs(I.offset);case "CIMMarkerPlacementAtMeasuredUnits":return Math.abs(I.offset);case "CIMMarkerPlacementAtRatioPositions":return Math.abs(I.offset);case "CIMMarkerPlacementInsidePolygon":return 0;case "CIMMarkerPlacementOnLine":return Math.abs(I.offset);case "CIMMarkerPlacementOnVertices":return Math.abs(I.offset);
case "CIMMarkerPlacementPolygonCenter":return 0;default:return 0}}function C(I){if(!I)return 0;switch(I.type){case "CIMGeometricEffectArrow":return Math.abs(.5*I.width);case "CIMGeometricEffectBuffer":return Math.abs(I.size);case "CIMGeometricEffectControlMeasureLine":return 500;case "CIMGeometricEffectExtension":return Math.abs(I.length);case "CIMGeometricEffectJog":return Math.abs(.5*I.length);case "CIMGeometricEffectMove":return Math.max(Math.abs(h.getNumericValue(I.offsetX)),Math.abs(h.getNumericValue(I.offsetY)));
case "CIMGeometricEffectOffset":return Math.abs(I.offset);case "CIMGeometricEffectOffsetTangent":return Math.abs(I.offset);case "CIMGeometricEffectRadial":return Math.abs(I.length);case "CIMGeometricEffectRegularPolygon":return Math.abs(I.radius);case "CIMGeometricEffectRotate":return 0;case "CIMGeometricEffectScale":return 0;case "CIMGeometricEffectTaperedPolygon":return.5*Math.max(Math.abs(I.fromWidth),Math.abs(I.toWidth));case "CIMGeometricEffectWave":return Math.abs(I.amplitude);case "CIMGeometricEffectDonut":return Math.abs(I.width);
default:return 0}}function y(I){if(!I)return 0;let M=0;for(const N of I)M+=C(N);return M}function v(I,M){if(I)switch(I.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(I=I.symbolLayers)for(const N of I)switch(M(N),N.type){case "CIMVectorMarker":if(I=N.markerGraphics)for(const R of I)R&&(I=R.symbol)&&v(I,M)}}}function F(I,M,N){I.effects&&null==M.geometryEngine&&(M.geometryEnginePromise?N.push(M.geometryEnginePromise):h.isGeometryEngineRequired(I.effects)&&(M.geometryEnginePromise=
h.importGeometryEngine(),N.push(M.geometryEnginePromise),M.geometryEnginePromise.then(R=>M.geometryEngine=R)))}function D(I){if(!I)return null;let M=null;const {cap:N,color:R,join:T,miterLimit:W,style:Y,width:Z}=I;"solid"!==Y&&"none"!==Y&&"esriSLSSolid"!==Y&&"esriSLSNull"!==Y&&(M=[{type:"CIMGeometricEffectDashes",dashTemplate:ba(Y,N),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);return{type:"CIMSolidStroke",color:"esriSLSNull"!==Y&&"none"!==Y?aa(R):[0,0,0,0],capStyle:Q(N),joinStyle:S(T),
miterLimit:W,width:Z,effects:M}}const G=Math.PI,E=G/2,H=Math.PI/180,K=96/72,J=()=>n.getLogger("esri.symbols.cim.CIMSymbolHelper");class L{static getSymbolInflateSize(I,M,N,R,T){I||=[0,0,0,0];return M?this._getInflateSize(I,M,N,R,T):I}static safeSize(I){const M=Math.max(Math.abs(I[0]),Math.abs(I[2]));I=Math.max(Math.abs(I[1]),Math.abs(I[3]));return Math.sqrt(M*M+I*I)}static _vectorMarkerBounds(I,M,N,R){let T=!0;const W=d.create();if(M?.markerGraphics)for(const Y of M.markerGraphics)M=[0,0,0,0],Y.geometry&&
(a.getBoundsXY(W,Y.geometry),M[0]=0,M[1]=0,M[2]=0,M[3]=0,this.getSymbolInflateSize(M,Y.symbol,N,0,R),W[0]+=M[0],W[1]+=M[1],W[2]+=M[2],W[3]+=M[3],T?(I[0]=W[0],I[1]=W[1],I[2]=W[2],I[3]=W[3],T=!1):(I[0]=Math.min(I[0],W[0]),I[1]=Math.min(I[1],W[1]),I[2]=Math.max(I[2],W[2]),I[3]=Math.max(I[3],W[3])));return I}static _getInflateSize(I,M,N,R,T){return void 0!==M.symbolLayers?(I=this._getLayersInflateSize(I,M.symbolLayers,N,R,T),M=y(M.effects),0<M&&(I[0]-=M,I[1]-=M,I[2]+=M,I[3]+=M),I):this._getTextInflatedSize(I,
M,T)}static _getLayersInflateSize(I,M,N,R,T){let W=!0;if(!M)return I;for(const ha of M)if(ha){M=[0,0,0,0];switch(ha.type){case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":var Y=ha,Z=Y.width;null!=Z&&(Z=Y.capStyle===c.LineCapStyle.Square||Y.joinStyle===c.LineJoinStyle.Miter?Z/1.4142135623730951:Z/2,M[0]=-Z,M[1]=-Z,M[2]=Z,M[3]=Z);break;case "CIMCharacterMarker":case "CIMVectorMarker":case "CIMPictureMarker":Y=ha;if("CIMVectorMarker"===ha.type){if(Z=ha,M=this._vectorMarkerBounds(M,
Z,N,T),Z.frame){var da=(Z.frame.xmin+Z.frame.xmax)/2,ca=(Z.frame.ymin+Z.frame.ymax)/2;M[0]-=da;M[1]-=ca;M[2]-=da;M[3]-=ca;null!=Z.size&&(Z=Z.size/(Z.frame.ymax-Z.frame.ymin),M[0]*=Z,M[1]*=Z,M[2]*=Z,M[3]*=Z)}}else"CIMPictureMarker"===ha.type?(Z=ha,ca=N.getResource(Z.url),da=1,null!=ca&&ca.height&&(da=ca.width/ca.height),null!=Y.size&&(M=Y.size/2,Z=Y.size*da*Z.scaleX/2,M=[-Z,-M,Z,M])):null!=Y.size&&(M=Y.size/2,M=[-M,-M,M,M]);Y.anchorPoint&&("Absolute"===Y.anchorPointUnits?(Z=Y.anchorPoint.x,da=Y.anchorPoint.y):
(Z=Y.anchorPoint.x*(M[2]-M[0]),da=Y.anchorPoint.y*(M[3]-M[1])),Z=1.25*Math.sqrt(Z*Z+da*da),M[0]-=Z,M[1]-=Z,M[2]+=Z,M[3]+=Z);Z=h.getNumericValue(Y.rotation);Y.rotateClockwise&&(Z=-Z);R&&(Z-=R);Z&&(da=H*Z,Z=Math.cos(da),da=Math.sin(da),ca=d.create([A.cInfinity,A.cInfinity,-A.cInfinity,-A.cInfinity]),d.expandPointInPlace(ca,[M[0]*Z-M[1]*da,M[0]*da+M[1]*Z]),d.expandPointInPlace(ca,[M[0]*Z-M[3]*da,M[0]*da+M[3]*Z]),d.expandPointInPlace(ca,[M[2]*Z-M[1]*da,M[2]*da+M[1]*Z]),d.expandPointInPlace(ca,[M[2]*Z-
M[3]*da,M[2]*da+M[3]*Z]),M=ca);Z=h.getNumericValue(Y.offsetX);da=h.getNumericValue(Y.offsetY);if(R){var ja=H*R;ca=Math.cos(ja);ja=Math.sin(ja);const ka=Z*ja+da*ca;Z=Z*ca-da*ja;da=ka}M[0]+=Z;M[1]+=da;M[2]+=Z;M[3]+=da;Y=B(Y.markerPlacement);0<Y&&(M[0]-=Y,M[1]-=Y,M[2]+=Y,M[3]+=Y)}Y=y(ha.effects);0<Y&&(M[0]-=Y,M[1]-=Y,M[2]+=Y,M[3]+=Y);W?(I[0]=M[0],I[1]=M[1],I[2]=M[2],I[3]=M[3],W=!1):(I[0]=Math.min(I[0],M[0]),I[1]=Math.min(I[1],M[1]),I[2]=Math.max(I[2],M[2]),I[3]=Math.max(I[3],M[3]))}return I}static _getTextInflatedSize(I,
M,N){var R=w.roundPtToWholePixel(M.height??q.defaultCIMValues.CIMTextSymbol.height);I[0]=-R/2;I[1]=-R/2;I[2]=R/2;I[3]=R/2;if(!N)return I;N=N.get(M);if(!N||!N.glyphMosaicItems.glyphs.length)return I;const {lineGapType:T,lineGap:W}=M,Y=T?g.lineGapType2LineHeight(T,W??0,R):0,Z="CIMBackgroundCallout"===M.callout?.type;M=t.shapeGlyphs(N.glyphMosaicItems,{scale:R/z.glyphSize,angle:h.getNumericValue(M.angle),xOffset:h.getNumericValue(M.offsetX),yOffset:h.getNumericValue(M.offsetY),horizontalAlignment:M.horizontalAlignment,
verticalAlignment:M.verticalAlignment,maxLineWidth:w.getLineWidth(M.lineWidth),lineHeight:z.magicLabelLineHeight*Math.max(.25,Math.min(Y||1,4)),decoration:M.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:Z}).boundsT;R=Math.sqrt(M.width*M.width+M.height*M.height);I[0]-=M.x+R;I[1]-=M.y-R;I[2]+=M.x+R;I[3]+=-M.y+R;return I}}class P{static getEnvelope(I,M,N){if(!I)return null;N=new g.EnvDrawHelper(N);if(Array.isArray(I)){let R;for(const T of I)R?R.union(x(N,T,M)):R=x(N,T,M);return R}return x(N,
I,M)}static getTextureInfo(I,M,N,R,T){I=R??this.getEnvelope(I,null,M);if(!I)return[0,0,0,0,1];M=Math.max(I.width,I.height)*K;T=null!=T?Math.max(T/M,1):1;T*=K;I.x*=T;I.y*=T;I.width*=T;I.height*=T;I.width=Math.max(Math.ceil(I.x+I.width)-Math.floor(I.x),1)-1;I.height=Math.max(Math.ceil(I.y+I.height)-Math.floor(I.y),1)-1;M=I.x+.5*I.width;let W=I.y+.5*I.height;M+=I.x-Math.floor(I.x);W+=I.y-Math.floor(I.y);R||(I.width+=N,I.height+=N,M+=N/2,W+=N/2);return[I.width,I.height,M,W,T]}static getTextureAnchor(I,
M,N){const [R,T,W,Y,Z]=this.getTextureInfo(I,M,2,null,N);return[-W/R,-Y/T,T/Z*K]}static rasterize(I,M,N,R,T=!0,W){const [Y,Z,da,ca,ja]=this.getTextureInfo(M,R,2,N,W);I.width=Y;I.height=Z;N=I.getContext("2d",{willReadFrequently:!0});W=g.Transformation.createScale(ja,-ja);W.translate(.5*Y-da,.5*Z+ca);R=new g.CanvasDrawHelper(N,R,W);switch(M.type){case "CIMPointSymbol":R.drawSymbol(M,{type:"point",x:0,y:0});break;case "CIMVectorMarker":W=new f.Placement,R.drawMarker(M,W)}M=N.getImageData(0,0,I.width,
I.height);M=new Uint8Array(M.data);if(T)for(R=0;R<M.length;R+=4)T=M[R+3]/255,M[R]*=T,M[R+1]*=T,M[R+2]*=T;return[M,I.width,I.height,-da/Y,-ca/Z]}static fromTextSymbol(I){const {text:M}=I;return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:P.createCIMTextSymbolfromTextSymbol(I),textString:M}],
scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}}static fromPictureFillSymbol(I){const {height:M,outline:N,width:R,xoffset:T,xscale:W,yoffset:Y,yscale:Z}=I,da=[],ca={type:"CIMPolygonSymbol",symbolLayers:da};if(N){var ja=D(N);ja&&da.push(ja)}ja=I.url;"esriPFS"===I.type&&I.imageData&&(ja=I.imageData);I="angle"in I?I.angle??0:0;da.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:c.TextureFilter.Picture,tintColor:null,url:ja,height:(M??0)*(Z||
1),width:(R??0)*(W||1),offsetX:h.getNumericValue(T),offsetY:h.getNumericValue(Y),rotation:h.getNumericValue(-I),colorSubstitutions:null});return ca}static fromSimpleFillSymbol(I){const {color:M,style:N,outline:R}=I;I=[];const T={type:"CIMPolygonSymbol",symbolLayers:I};if(R){var W=D(R);W&&I.push(W)}if(N&&"solid"!==N&&"none"!==N&&"esriSFSSolid"!==N&&"esriSFSNull"!==N){W={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",color:aa(M),capStyle:c.LineCapStyle.Butt,joinStyle:c.LineJoinStyle.Miter,
width:.75}]};let Y=0;const Z=l.px2pt("vertical"===N||"horizontal"===N||"cross"===N||"esriSFSCross"===N||"esriSFSVertical"===N||"esriSFSHorizontal"===N?8:10);switch(N){case "vertical":case "esriSFSVertical":Y=90;break;case "forward-diagonal":case "esriSFSForwardDiagonal":Y=-45;break;case "backward-diagonal":case "esriSFSBackwardDiagonal":Y=45;break;case "cross":case "esriSFSCross":Y=0;break;case "diagonal-cross":case "esriSFSDiagonalCross":Y=-45}I.push({type:"CIMHatchFill",lineSymbol:W,offsetX:0,offsetY:0,
rotation:Y,separation:Z});"cross"===N||"esriSFSCross"===N?I.push({type:"CIMHatchFill",lineSymbol:e.clone(W),offsetX:0,offsetY:0,rotation:90,separation:Z}):("diagonal-cross"===N||"esriSFSDiagonalCross"===N)&&I.push({type:"CIMHatchFill",lineSymbol:e.clone(W),offsetX:0,offsetY:0,rotation:45,separation:Z})}else!N||"solid"!==N&&"esriSFSSolid"!==N||I.push({type:"CIMSolidFill",enable:!0,color:aa(M)});return T}static fromSimpleLineSymbol(I){const {cap:M,color:N,join:R,marker:T,miterLimit:W,style:Y,width:Z}=
I;I=null;"solid"!==Y&&"none"!==Y&&"esriSLSSolid"!==Y&&"esriSLSNull"!==Y&&(I=[{type:"CIMGeometricEffectDashes",dashTemplate:ba(Y,M),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);const da=[];if(T){let ca;switch(T.placement){case "begin-end":ca=c.ExtremityPlacement.Both;break;case "begin":ca=c.ExtremityPlacement.JustBegin;break;case "end":ca=c.ExtremityPlacement.JustEnd;break;default:ca=c.ExtremityPlacement.None}const ja=P.fromSimpleMarker(T,Z,N).symbolLayers[0];ja.markerPlacement=
{type:"CIMMarkerPlacementAtExtremities",placePerPart:!1,angleToLine:!0,offset:0,extremityPlacement:ca,offsetAlongLine:0};da.push(ja)}da.push({type:"CIMSolidStroke",color:"none"!==Y&&"esriSLSNull"!==Y?aa(N):[0,0,0,0],capStyle:Q(M),joinStyle:S(R),miterLimit:W,width:Z,effects:I});return{type:"CIMLineSymbol",symbolLayers:da}}static fromPictureMarker(I){const {angle:M,height:N,width:R,xoffset:T,yoffset:W}=I;let Y=I.url;"esriPMS"===I.type&&I.imageData&&(Y=I.imageData);return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",
invertBackfaceTexture:!1,scaleX:1,textureFilter:c.TextureFilter.Picture,tintColor:null,url:Y,size:N,width:R,offsetX:h.getNumericValue(T),offsetY:h.getNumericValue(W),rotation:h.getNumericValue(-M)}]}}static createCIMTextSymbolfromTextSymbol(I){const {angle:M,color:N,font:R,haloColor:T,haloSize:W,horizontalAlignment:Y,kerning:Z,lineWidth:da,text:ca,verticalAlignment:ja,xoffset:ha,yoffset:ka,backgroundColor:ia,borderLineColor:na,borderLineSize:ma}=I;let qa,ra,ta;if(R){var Ha=R.family;var xa=R.style;
var O=R.weight;qa=R.size;ra=R.decoration}I=!1;ca&&(I=r.bidiText(ca)[1]);if(ia||ma)ta={type:"CIMBackgroundCallout",margin:null,backgroundSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:aa(ia)},{type:"CIMSolidStroke",color:aa(na),width:ma}]},accentBarSymbol:null,gap:null,leaderLineSymbol:null,lineStyle:null};var V=c.BlockProgression.BTT,ea=c.FontEffects.Normal,la=c.FontEncoding.Unicode;Ha=Ha||"Arial";b:{if(O)switch(O.toLowerCase()){case "bold":case "bolder":O="bold";break b}O=
""}b:{if(xa)switch(xa.toLowerCase()){case "italic":case "oblique":xa="italic";break b}xa=""}O=O&&xa?`${O}-${xa}`:`${O}${xa}`;return{type:"CIMTextSymbol",angle:M,blockProgression:V,depth3D:1,extrapolateBaselines:!0,fontEffects:ea,fontEncoding:la,fontFamilyName:Ha,fontStyleName:O,fontType:c.FontType.Unspecified,haloSize:W,height:qa,hinting:c.GlyphHinting.Default,horizontalAlignment:U(Y??"center"),kerning:Z,letterWidth:100,ligatures:!0,lineGapType:"Multiple",lineWidth:da,offsetX:h.getNumericValue(ha),
offsetY:h.getNumericValue(ka),strikethrough:"line-through"===ra,underline:"underline"===ra,symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:aa(N)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:aa(T)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:I?c.TextReadingDirection.RTL:c.TextReadingDirection.LTR,verticalAlignment:X(ja??"baseline"),verticalGlyphOrientation:c.VerticalGlyphOrientation.Right,
wordSpacing:100,billboardMode3D:c.BillBoardMode.FaceNearPlane,callout:ta}}static createPictureMarkerRasterizationParam(I){const {angle:M,height:N,width:R,xoffset:T,yoffset:W}=I;return(I=I.url??I.source?.url??I.source?.imageData)?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:c.TextureFilter.Picture,tintColor:null,url:I,size:N,width:R,offsetX:h.getNumericValue(T),offsetY:h.getNumericValue(W),rotation:h.getNumericValue(-M)}}:
null}static createPictureFillRasterizationParam(I){const {width:M,height:N,xoffset:R,yoffset:T,url:W}=I;return W?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureFill",scaleX:1,textureFilter:c.TextureFilter.Picture,tintColor:null,url:W,width:M,height:N,offsetX:h.getNumericValue(R),offsetY:h.getNumericValue(T),rotation:0}}:null}static fromSimpleMarker(I,M,N){var {style:R}=I;N=I.color??N;if("path"===R||"esriSMSPath"===R){M=[];if("outline"in I&&I.outline){var T=I.outline;M.push({type:"CIMSolidStroke",
enable:!0,width:T.width,color:aa(T.color),path:I.path})}M.push({type:"CIMSolidFill",enable:!0,color:aa(N),path:I.path});const [ca,ja]=fa("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:-h.getNumericValue(I.angle),size:h.getNumericValue(I.size||6),offsetX:h.getNumericValue(I.xoffset),offsetY:h.getNumericValue(I.yoffset),scaleSymbolsProportionally:!1,frame:ca,markerGraphics:[{type:"CIMMarkerGraphic",geometry:ja,symbol:{type:"CIMPolygonSymbol",symbolLayers:M}}]}]}}const W=
[];T=I.size;let Y;if("outline"in I&&I.outline&&"none"!==I.outline.style&&"esriSLSNull"!==I.outline.style){const ca=I.outline,ja="solid"!==ca.style&&"esriSLSSolid"!==ca.style;[R,Y]=ja?fa(R,I.size):fa(R);const ha=ca.width??u.defaultPolylineSymbol2D.width;if(ja){var Z=ha/I.size,da=(R.xmax-R.xmin)*Z/2;Z=(R.ymax-R.ymin)*Z/2;R.xmin-=da;R.xmax+=da;R.ymin-=Z;R.ymax+=Z;T&&(T+=ha)}da="cross"!==I.style&&"x"!==I.style||"dot"===I?.outline.style||"short-dot"===I?.outline.style?c.LineDashEnding.HalfGap:c.LineDashEnding.FullPattern;
da=ja?[{type:"CIMGeometricEffectAddControlPoints"},{type:"CIMGeometricEffectDashes",dashTemplate:ba(ca.style,null).map(ka=>ca.width&&0<ca.width?ka*ca.width:ka),lineDashEnding:da,controlPointEnding:c.LineDashEnding.FullPattern}]:void 0;W.push({type:"CIMSolidStroke",capStyle:ja?c.LineCapStyle.Round:c.LineCapStyle.Butt,enable:!0,width:ha,color:aa(ca.color),effects:da})}else!M||"line-marker"!==I.type||"cross"!==I.style&&"x"!==I.style?[R,Y]=fa(R):([R,Y]=fa(R),W.push({type:"CIMSolidStroke",enable:!0,width:M,
color:aa(N)}));W.push({type:"CIMSolidFill",enable:!0,color:aa(N)});N={type:"CIMPolygonSymbol",symbolLayers:W};return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:h.getNumericValue(-I.angle),size:h.getNumericValue(T||6*M),offsetX:h.getNumericValue(I.xoffset),offsetY:h.getNumericValue(I.yoffset),scaleSymbolsProportionally:!1,frame:R,markerGraphics:[{type:"CIMMarkerGraphic",geometry:Y,symbol:N}]}]}}static fromCIMHatchFill(I,M){const N=M*(I.separation??q.defaultCIMValues.CIMHatchFill.separation),
R=N/2;I=e.clone(I.lineSymbol);I.symbolLayers?.forEach(W=>{switch(W.type){case "CIMSolidStroke":null!=W.width&&(W.width*=M);W.effects?.forEach(Y=>{"CIMGeometricEffectDashes"===Y.type&&(Y.dashTemplate=Y.dashTemplate?.map(Z=>Z*M))});break;case "CIMVectorMarker":null!=W.size&&(W.size*=M),W=W.markerPlacement,null!=W&&"placementTemplate"in W&&(W.placementTemplate=W.placementTemplate.map(Y=>Y*M))}});for(var T=this._getLineSymbolPeriod(I)||4;4>T;)T*=2;T/=2;return{type:"CIMVectorMarker",frame:{xmin:-T,xmax:T,
ymin:-R,ymax:R},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-T,0],[T,0]]]},symbol:I}],size:N}}static fetchResources(I,M,N,R=null){if(!I||!M)return N;v(I,T=>{F(T,M,N);"url"in T&&T.url&&N.push(M.fetchResource(T.url,{signal:R}))});return N}static fetchFonts(I,M,N){if(I&&M)if("symbolLayers"in I&&I.symbolLayers)for(const W of I.symbolLayers){if("CIMVectorMarker"===W.type&&W.markerGraphics)for(const Y of W.markerGraphics)Y?.symbol&&P.fetchFonts(Y.symbol,M,N)}else if("CIMTextSymbol"===I.type){const {fontFamilyName:W,
fontStyleName:Y}=I;if(W&&"calcitewebcoreicons"!==W.toLowerCase()){var {style:R,weight:T}=h.fromCIMFontStyle(Y);I=h.fromCIMFontDecoration(I);I=new b({family:W,style:R,weight:T,decoration:I});N.push(M.loadFont(I).catch(()=>{J().error(`Unsupported font ${W} in CIM symbol`)}))}}}static _getLineSymbolPeriod(I){if(I){const M=this._getEffectsRepeat(I.effects);if(M)return M;if(I.symbolLayers)for(const N of I.symbolLayers)if(N){if(I=this._getEffectsRepeat(N.effects))return I;switch(N.type){case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":case "CIMObjectMarker3D":case "CIMglTFMarker3D":if(I=
this._getPlacementRepeat(N.markerPlacement))return I}}}return 0}static _getEffectsRepeat(I){if(I)for(var M of I)if(M)switch(M.type){case "CIMGeometricEffectDashes":if((I=M.dashTemplate)&&I.length){M=0;for(const N of I)M+=N;I.length&1&&(M*=2);return M}break;case "CIMGeometricEffectWave":return M.period;default:J().error(`unsupported geometric effect type ${M.type}`)}return 0}static _getPlacementRepeat(I){if(I)switch(I.type){case "CIMMarkerPlacementAlongLineSameSize":case "CIMMarkerPlacementAlongLineRandomSize":case "CIMMarkerPlacementAlongLineVariableSize":if((I=
I.placementTemplate)&&I.length){let M=0;for(const N of I)M+=+N;I.length&1&&(M*=2);return M}}return 0}static fromCIMInsidePolygon(I){var M=I.markerPlacement;const N={...I,markerPlacement:null,anchorPoint:null};I=Math.abs(M.stepX);const R=Math.abs(M.stepY);var T=(M.randomness??100)/100;let W,Y;if("Random"===M.gridType){var Z=l.px2pt(z.randomInsidePolygonTextureSize);const da=Math.max(Math.floor(Z/I),1),ca=Math.max(Math.floor(Z/R),1);Z=da*I/2;W=ca*R/2;Y=2*W;M=new m(M.seed);const ja=T*I/1.5,ha=T*R/1.5;
T=[];for(let ka=0;ka<da;ka++)for(let ia=0;ia<ca;ia++){const na=ka*I-Z+ja*(.5-M.getFloat()),ma=ia*R-W+ha*(.5-M.getFloat());T.push({x:na,y:ma});0===ka&&T.push({x:na+2*Z,y:ma});0===ia&&T.push({x:na,y:ma+2*W})}}else!0===M.shiftOddRows?(Z=I/2,W=R,Y=2*R,T=[{x:-Z,y:0},{x:Z,y:0},{x:0,y:W},{x:0,y:-W}]):(Z=I/2,W=R/2,Y=R,T=[{x:-I,y:0},{x:0,y:-R},{x:-I,y:-R},{x:0,y:0},{x:I,y:0},{x:0,y:R},{x:I,y:R},{x:-I,y:R},{x:I,y:-R}]);I=T.map(da=>({type:"CIMMarkerGraphic",geometry:da,symbol:{type:"CIMPointSymbol",symbolLayers:[N]}}));
return{type:"CIMVectorMarker",frame:{xmin:-Z,xmax:Z,ymin:-W,ymax:W},markerGraphics:I,size:Y}}}const Q=I=>{if(!I)return c.LineCapStyle.Butt;switch(I){case "butt":return c.LineCapStyle.Butt;case "square":return c.LineCapStyle.Square;case "round":return c.LineCapStyle.Round}},S=I=>{if(!I)return c.LineJoinStyle.Miter;switch(I){case "miter":return c.LineJoinStyle.Miter;case "round":return c.LineJoinStyle.Round;case "bevel":return c.LineJoinStyle.Bevel}},U=I=>{if(null==I)return"Center";switch(I){case "left":return"Left";
case "right":return"Right";case "center":return"Center"}},X=I=>{if(null==I)return"Center";switch(I){case "baseline":return"Baseline";case "top":return"Top";case "middle":return"Center";case "bottom":return"Bottom"}},aa=I=>{if(!I)return[0,0,0,0];const {r:M,g:N,b:R,a:T}=I;return[M,N,R,255*T]},ba=(I,M)=>{const N=p("safari")?.001:0;M="butt"===M;switch(I){case "dash":case "esriSLSDash":return M?[4,3]:[3,4];case "dash-dot":case "esriSLSDashDot":return M?[4,3,1,3]:[3,4,N,4];case "dot":case "esriSLSDot":return M?
[1,3]:[N,4];case "long-dash":case "esriSLSLongDash":return M?[8,3]:[7,4];case "long-dash-dot":case "esriSLSLongDashDot":return M?[8,3,1,3]:[7,4,N,4];case "long-dash-dot-dot":case "esriSLSDashDotDot":return M?[8,3,1,3,1,3]:[7,4,N,4,N,4];case "short-dash":case "esriSLSShortDash":return M?[4,1]:[3,2];case "short-dash-dot":case "esriSLSShortDashDot":return M?[4,1,1,1]:[3,2,N,2];case "short-dash-dot-dot":case "esriSLSShortDashDotDot":return M?[4,1,1,1,1,1]:[3,2,N,2,N,2];case "short-dot":case "esriSLSShortDot":return M?
[1,1]:[N,2];case "solid":case "esriSLSSolid":case "none":return J().error("Unexpected: style does not require rasterization"),[0,0];default:return J().error(`Tried to rasterize SLS, but found an unexpected style: ${I}!`),[0,0]}},fa=(I,M=100)=>{var N=M/2,R;if("circle"===I||"esriSMSCircle"===I){var T=Math.acos(1-.25/N);M=Math.ceil(G/T/4);0===M&&(M=1);T=E/M;M*=4;I=[];I.push([N,0]);for(R=1;R<M;R++)I.push([N*Math.cos(R*T),-N*Math.sin(R*T)]);I.push([N,0]);T={rings:[I]};R={xmin:-N,ymin:-N,xmax:N,ymax:N}}else"cross"===
I||"esriSMSCross"===I?(T={paths:[[[0,N],[0,-N]],[[N,0],[-N,0]]]},R={xmin:-N,ymin:-N,xmax:N,ymax:N}):"diamond"===I||"esriSMSDiamond"===I?(T={rings:[[[-N,0],[0,N],[N,0],[0,-N],[-N,0]]]},R={xmin:-N,ymin:-N,xmax:N,ymax:N}):"square"===I||"esriSMSSquare"===I?(T={rings:[[[-N,-N],[-N,N],[N,N],[N,-N],[-N,-N]]]},R={xmin:-N,ymin:-N,xmax:N,ymax:N}):"x"===I||"esriSMSX"===I?(T={paths:[[[N,N],[-N,-N]],[[N,-N],[-N,N]]]},R={xmin:-N,ymin:-N,xmax:N,ymax:N}):"triangle"===I||"esriSMSTriangle"===I?(N=.5773502691896257*
M,I=-N,R=2/3*M,M=R-M,T={rings:[[[I,M],[0,R],[N,M],[I,M]]]},R={xmin:I,ymin:M,xmax:N,ymax:R}):"arrow"===I&&(T={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},R={xmin:-N,ymin:-N,xmax:N,ymax:N});return[R,T]};k.CIMSymbolHelper=P;k.CIMSymbolInflatedSizeHelper=L;k.capTypeToEnum=Q;k.getEffectsInflateSize=y;k.slsDashToTemplateArray=ba;k.symbolToCIM=function(I){let M;switch(I.type){case "cim":return I.data;case "web-style":return I;case "simple-marker":I=P.fromSimpleMarker(I);if(!I)throw Error("InternalError: Cannot convert symbol to CIM");
M=I;break;case "picture-marker":M=P.fromPictureMarker(I);break;case "simple-line":M=P.fromSimpleLineSymbol(I);break;case "simple-fill":M=P.fromSimpleFillSymbol(I);break;case "picture-fill":M=P.fromPictureFillSymbol(I);break;case "text":M=P.fromTextSymbol(I)}return{type:"CIMSymbolReference",symbol:M}};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/core/BidiText":function(){define(["exports","./BidiEngine"],function(k,r){const p=new r;k.bidiText=function(e){if(null==e)return["",
!1];if(!p.hasBidiChar(e))return[e,!1];let n;n="rtl"===p.checkContextual(e)?"IDNNN":"ICNNN";return[p.bidiTransform(e,n,"VLYSN"),!0]};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/core/BidiEngine":function(){define(["./bidiEngineTables"],function(k){function r(C,y,v,F,D){var G=C;void 0===y&&(y=D.defInFormat);void 0===v&&(v=D.defOutFormat);void 0===F&&(F=D.defSwap);if(y!==v){var E=y.slice(0,1),H=v.slice(0,1);var K=y.slice(1,4);var J=v.slice(1,4);"C"===K.charAt(0)&&(K=p(G),K="ltr"===
K||"rtl"===K?K.toUpperCase():"L"===y.charAt(2)?"LTR":"RTL",y=E+K);"C"===J.charAt(0)&&(K=p(G),"rtl"===K?J="RTL":"ltr"===K?(G=G.split(""),G.reverse(),K=p(G.join("")),J=K.toUpperCase()):J="L"===v.charAt(2)?"LTR":"RTL",v=H+J)}if(y===v)return C;H=y.slice(0,1);G=y.slice(1,4);E=v.slice(0,1);J=v.slice(1,4);D.inFormat=y;D.outFormat=v;D.swap=F;if("L"===H&&"VLTR"===v){if("LTR"===G)return D.dir=0,e(C,D);if("RTL"===G)return D.dir=1,e(C,D)}if("V"===H&&"V"===E)return D.dir="RTL"===G?1:0,m(C,D);if("L"===H&&"VRTL"===
v)return D.dir="LTR"===G?0:1,C=e(C,D),m(C);if("VLTR"===y&&"LLTR"===v)return D.dir=0,e(C,D);if("V"===H&&"L"===E&&G!==J)return C=m(C),"RTL"===G?r(C,"LLTR","VLTR",F,D):r(C,"LRTL","VRTL",F,D);if("VRTL"===y&&"LRTL"===v)return r(C,"LRTL","VRTL",F,D);"L"===H&&"L"===E&&(y=D.swap,D.swap=y.slice(0,1)+"N","RTL"===G?(D.dir=1,C=e(C,D),D.swap="N"+y.slice(1,3),D.dir=0,C=e(C,D)):(D.dir=0,C=e(C,D),D.swap="N"+y.slice(1,3),C=r(C,"VLTR","LRTL",D.swap,D)));return C}function p(C){return(C=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(C))?
"z">=C[0]?"ltr":"rtl":""}function e(C,y){C=C.split("");const v=[];n(C,v,y);if(0!==y.hiLevel&&y.swap[0]!==y.swap[1])for(let G=0;G<C.length;G++)if(1===v[G]){var F=G;b:{let E=void 0;var D=C[G];let H=0,K=k.swapTable.length-1;for(;H<=K;)if(E=Math.floor((H+K)/2),D<k.swapTable[E][0])K=E-1;else if(D>k.swapTable[E][0])H=E+1;else{D=k.swapTable[E][1];break b}}C[F]=D}a(2,C,v,y);a(1,C,v,y);t=v;return C.join("")}function n(C,y,v){const F=C.length;var D=v.dir?k.impTabRtl:k.impTabLtr,G=0,E=-1;const H=[],K=[];v.hiLevel=
v.dir;v.lastArabic=!1;v.hasUbatAl=!1;v.hasUbatB=!1;v.hasUbatS=!1;for(var J=0;J<F;J++){var L=J,P=C[J].charCodeAt(0);const Q=k.primaryTable[P>>8];H[L]=Q<k.tbbase?Q:k.unicodeTable[Q-k.tbbase][P&255]}for(L=0;L<F;L++){J=b(C,H,K,L,v);K[L]=J;G=D[G][J];P=G&240;G&=15;J=D[G][5];y[L]=J;if(0<P){if(16===P)for(;E<L;E++)y[E]=1;E=-1}if(D[G][6])-1===E&&(E=L);else if(-1<E){for(;E<L;E++)y[E]=J;E=-1}H[L]===k.ubatB&&(y[L]=0);v.hiLevel|=J}if(v.hasUbatS)for(C=0;C<F;C++)if(H[C]===k.ubatS)for(y[C]=v.dir,D=C-1;0<=D;D--)if(H[D]===
k.ubatWs)y[D]=v.dir;else break}function m(C,y){C=C.split("");if(y){const v=[];n(C,v,y);t=v}C.reverse();A.reverse();return C.join("")}function l(C){for(let y=0;y<k.arabicAlefBetIntervalsBegine.length;y++)if(C>=k.arabicAlefBetIntervalsBegine[y]&&C<=k.arabicAlefBetIntervalsEnd[y])return!0;return!1}function d(C,y,v,F){for(;y*v<F&&g(C[y]);)y+=v;return y*v<F&&l(C[y])?!0:!1}function a(C,y,v,F){if(!(F.hiLevel<C))if(1!==C||1!==F.dir||F.hasUbatB){F=y.length;for(var D=0,G,E,H;D<F;){if(v[D]>=C){for(G=D+1;G<F&&
v[G]>=C;)G++;for(E=G-1;D<E;D++,E--)H=y[D],y[D]=y[E],y[E]=H,H=A[D],A[D]=A[E],A[E]=H;D=G}D++}}else y.reverse(),A.reverse()}function b(C,y,v,F,D){return{UBAT_L:()=>{D.lastArabic=!1;return k.ubatL},UBAT_R:()=>{D.lastArabic=!1;return k.ubatR},UBAT_ON:()=>k.ubatOn,UBAT_AN:()=>k.ubatAn,UBAT_EN:()=>D.lastArabic?k.ubatAn:k.ubatEn,UBAT_AL:()=>{D.lastArabic=!0;D.hasUbatAl=!0;return k.ubatR},UBAT_WS:()=>k.ubatOn,UBAT_CS:()=>{let G,E;if(1>F||F+1>=y.length||(G=v[F-1])!==k.ubatEn&&G!==k.ubatAn||(E=y[F+1])!==k.ubatEn&&
E!==k.ubatAn)return k.ubatOn;D.lastArabic&&(E=k.ubatAn);return E===G?E:k.ubatOn},UBAT_ES:()=>(0<F?v[F-1]:k.ubatB)===k.ubatEn&&F+1<y.length&&y[F+1]===k.ubatEn?k.ubatEn:k.ubatOn,UBAT_ET:()=>{if(0<F&&v[F-1]===k.ubatEn)return k.ubatEn;if(D.lastArabic)return k.ubatOn;let G=F+1;const E=y.length;for(;G<E&&y[G]===k.ubatEt;)G++;return G<E&&y[G]===k.ubatEn?k.ubatEn:k.ubatOn},UBAT_NSM:()=>{if("VLTR"===D.inFormat){for(var G=y.length,E=F+1;E<G&&y[E]===k.ubatNsm;)E++;if(E<G&&(G=C[F].charCodeAt(0),E=y[E],(1425<=
G&&2303>=G||64286===G)&&(E===k.ubatR||E===k.ubatAl)))return k.ubatR}return 1>F||y[F-1]===k.ubatB?k.ubatOn:v[F-1]},UBAT_B:()=>{D.lastArabic=!0;D.hasUbatB=!0;return D.dir},UBAT_S:()=>{D.hasUbatS=!0;return k.ubatOn},UBAT_LRE:()=>{D.lastArabic=!1;return k.ubatOn},UBAT_RLE:()=>{D.lastArabic=!1;return k.ubatOn},UBAT_LRO:()=>{D.lastArabic=!1;return k.ubatOn},UBAT_RLO:()=>{D.lastArabic=!1;return k.ubatOn},UBAT_PDF:()=>{D.lastArabic=!1;return k.ubatOn},UBAT_BN:()=>k.ubatOn}[k.typesNames[y[F]]]()}function f(C,
y){for(let v=0;v<k.baseForm.length;v++)if(C===k.baseForm[v])return y[v];return C}function g(C){return"\u064b"<=C&&"\u0655">=C}function q(C){return"L"===C?"LTR":"R"===C?"RTL":"C"===C?"CLR":"D"===C?"CRL":""}function c(C,y){for(let v=0;v<k.aLefTable.length;v++)if(C===k.aLefTable[v])return y[v];return C}function h(C,y,v,F){for(let D=0;D<C.length;D++)if(C[D]>y||!v&&C[D]===y)C[D]+=F}class u{constructor(){this.inputFormat="ILYNN";this.outputFormat="VLNNN";this.sourceToTarget=[];this.targetToSource=[];this.levels=
[]}bidiTransform(C,y,v){this.sourceToTarget=[];this.targetToSource=[];if(!C)return"";var F=this.sourceToTarget,D=this.targetToSource,G=C.length;A=[];t=[];for(var E=0;E<G;E++)F[E]=E,D[E]=E,A[E]=E;if(!this.checkParameters(y,v))return C;y=this.inputFormat;v=this.outputFormat;F=C;F=w;E=q(y.charAt(1));D=q(v.charAt(1));var H="I"===y.charAt(0)?"L":y.charAt(0);G="I"===v.charAt(0)?"L":v.charAt(0);E=H+E;D=G+D;G=y.charAt(2)+v.charAt(2);F.defInFormat=E;F.defOutFormat=D;F.defSwap=G;C=r(C,E,D,G,F);F=!1;if("R"===
v.charAt(1))F=!0;else if("C"===v.charAt(1)||"D"===v.charAt(1))F="rtl"===this.checkContextual(C);D=this.sourceToTarget=A;G=Array(D.length);for(E=0;E<D.length;E++)G[D[E]]=E;z=this.targetToSource=G;if(y.charAt(3)===v.charAt(3))F=C;else if("S"===v.charAt(3))if(y=F,v=C,0===v.length)F="";else{void 0===y&&(y=!0);v=String(v);v=v.split("");D=0;C=1;F=v.length;y||(D=v.length-1,C=-1,F=1);E=D;H=0;D=[];for(G=0;E*C<F;E+=C)if(l(v[E])||g(v[E])){var K;if(K="\u0644"===v[E])b:{for(var J=v,L=E+C,P=C,Q=F;L*P<Q&&g(J[L]);)L+=
P;K=" ";if(L*P<Q)for(K=J[L],J=0;J<k.aLefTable.length;J++)if(k.aLefTable[J]===K){K=!0;break b}K=!1}if(K){v[E]=0===H?c(v[E+C],k.lamAlefInialTableFE):c(v[E+C],k.lamAlefMedialTableFE);E+=C;H=v;K=E;J=C;for(L=F;K*J<L&&g(H[K]);)K+=J;K*J<L&&(H[K]=" ");D[G]=E;G++;H=0}else{K=v[E];if(1===H){J=E;if(d(v,E+C,C,F))b:for(L=v[E],P=0;P<k.baseForm.length;P++){if(L===k.baseForm[P]){L=k.medialForm[P];break b}}else L=f(v[E],k.finalForm);v[J]=L}else!0===d(v,E+C,C,F)?v[E]=f(v[E],k.initialForm):v[E]=f(v[E],k.isolatedForm);
g(K)||(H=1);b:{for(J=0;J<k.standAlonForm.length;J++)if(k.standAlonForm[J]===K){K=!0;break b}K=!1}!0===K&&(H=0)}}else H=0;C=D;F="";for(D=0;D<v.length;D++){b:{for(G=0;G<C.length;G++)if(C[G]===D)break b;G=-1}-1<G?(h(z,D,!y,-1),A.splice(D,1)):F+=v[D]}}else if(y=C,v=F,0===y.length)F="";else{void 0===v&&(v=!0);y=String(y);C="";F=y.split("");for(D=0;D<y.length;D++)G=!1,"\ufe70"<=F[D]&&"\ufeff">F[D]?(E=y.charCodeAt(D),"\ufef5"<=F[D]&&"\ufefc">=F[D]?(v?(0<D&&" "===F[D-1]?C=C.slice(0,-1)+"\u0644":(C+="\u0644",
G=!0),C+=k.aLefTable[(E-65269)/2]):(C+=k.aLefTable[(E-65269)/2],C+="\u0644",D+1<y.length&&" "===F[D+1]?D++:G=!0),G&&(h(z,D,!0,1),A.splice(D,0,A[D]))):C+=k.feTo06Table[E-65136]):C+=F[D];F=C}this.sourceToTarget=A;this.targetToSource=z;this.levels=t;return F}_inputFormatSetter(C){if(!x.test(C))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=C}_outputFormatSetter(C){if(!x.test(C))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=
C}checkParameters(C,y){C?this._inputFormatSetter(C):C=this.inputFormat;y?this._outputFormatSetter(y):y=this.outputFormat;return C===y?!1:!0}checkContextual(C){C=p(C);if("ltr"!==C&&"rtl"!==C){try{C=document.dir.toLowerCase()}catch(y){}"ltr"!==C&&"rtl"!==C&&(C="ltr")}return C}hasBidiChar(C){return B.test(C)}}let A=[],z=[],t=[];const w={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,
defOutFormat:""},x=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,B=/[\u0591-\u06ff\ufb1d-\ufefc]/;return u})},"esri/core/bidiEngineTables":function(){define(["exports"],function(k){k.aLefTable=["\u0622","\u0623","\u0625","\u0627"];k.arabicAlefBetIntervalsBegine=["\u0621","\u0641"];k.arabicAlefBetIntervalsEnd=["\u063a","\u064a"];k.baseForm="\u0627\u0628\u062a\u062b\u062c\u062d\u062e\u062f\u0630\u0631\u0632\u0633\u0634\u0635\u0636\u0637\u0638\u0639\u063a\u0641\u0642\u0643\u0644\u0645\u0646\u0647\u0648\u064a\u0625\u0623\u0622\u0629\u0649\u0644\u0645\u0646\u0647\u0648\u064a\u0625\u0623\u0622\u0629\u0649\u06cc\u0626\u0624".split("");
k.feTo06Table="\u064b\u064b\u064c\u061f\u064d\u061f\u064e\u064e\u064f\u064f\u0650\u0650\u0651\u0651\u0652\u0652\u0621\u0622\u0622\u0623\u0623\u0624\u0624\u0625\u0625\u0626\u0626\u0626\u0626\u0627\u0627\u0628\u0628\u0628\u0628\u0629\u0629\u062a\u062a\u062a\u062a\u062b\u062b\u062b\u062b\u062c\u062c\u062c\u062c\u062d\u062d\u062d\u062d\u062e\u062e\u062e\u062e\u062f\u062f\u0630\u0630\u0631\u0631\u0632\u0632\u0633\u0633\u0633\u0633\u0634\u0634\u0634\u0634\u0635\u0635\u0635\u0635\u0636\u0636\u0636\u0636\u0637\u0637\u0637\u0637\u0638\u0638\u0638\u0638\u0639\u0639\u0639\u0639\u063a\u063a\u063a\u063a\u0641\u0641\u0641\u0641\u0642\u0642\u0642\u0642\u0643\u0643\u0643\u0643\u0644\u0644\u0644\u0644\u0645\u0645\u0645\u0645\u0646\u0646\u0646\u0646\u0647\u0647\u0647\u0647\u0648\u0648\u0649\u0649\u064a\u064a\u064a\u064a\ufef5\ufef6\ufef7\ufef8\ufef9\ufefa\ufefb\ufefc\u061f\u061f\u061f".split("");
k.finalForm="\ufe8e\ufe90\ufe96\ufe9a\ufe9e\ufea2\ufea6\ufeaa\ufeac\ufeae\ufeb0\ufeb2\ufeb6\ufeba\ufebe\ufec2\ufec6\ufeca\ufece\ufed2\ufed6\ufeda\ufede\ufee2\ufee6\ufeea\ufeee\ufef2\ufe88\ufe84\ufe82\ufe94\ufef0\ufbfd\ufe8a\ufe86\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe8a\ufe86".split("");k.impTabLtr=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]];k.impTabRtl=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]];k.initialForm=
"\ufe8d\ufe91\ufe97\ufe9b\ufe9f\ufea3\ufea7\ufea9\ufeab\ufead\ufeaf\ufeb3\ufeb7\ufebb\ufebf\ufec3\ufec7\ufecb\ufecf\ufed3\ufed7\ufedb\ufedf\ufee3\ufee7\ufeeb\ufeed\ufef3\ufe87\ufe83\ufe81\ufe93\ufeef\ufbfe\ufe8b\ufe85\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe8b\ufe85".split("");k.isolatedForm="\ufe8d\ufe8f\ufe95\ufe99\ufe9d\ufea1\ufea5\ufea9\ufeab\ufead\ufeaf\ufeb1\ufeb5\ufeb9\ufebd\ufec1\ufec5\ufec9\ufecd\ufed1\ufed5\ufed9\ufedd\ufee1\ufee5\ufee9\ufeed\ufef1\ufe87\ufe83\ufe81\ufe93\ufeef\ufbfc\ufe89\ufe85\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe89\ufe85".split("");
k.lamAlefInialTableFE=["\ufef5","\ufef7","\ufef9","\ufefb"];k.lamAlefMedialTableFE=["\ufef6","\ufef8","\ufefa","\ufefc"];k.medialForm="\ufe8e\ufe92\ufe98\ufe9c\ufea0\ufea4\ufea8\ufeaa\ufeac\ufeae\ufeb0\ufeb4\ufeb8\ufebc\ufec0\ufec4\ufec8\ufecc\ufed0\ufed4\ufed8\ufedc\ufee0\ufee4\ufee8\ufeec\ufeee\ufef4\ufe88\ufe84\ufe82\ufe94\ufef0\ufbff\ufe8c\ufe86\ufe71\ufe72\ufe74\ufe77\ufe79\ufe7b\ufe7d\ufe7f\ufe80\ufe8c\ufe86".split("");k.primaryTable=[100,0,0,0,0,101,102,103,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,104,4,4,4,0,4,0,4,0,4,4,4,0,0,4,4,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,0,0,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,105,7,7,106,107];k.standAlonForm="\u0621\u0622\u0623\u0624\u0625\u0627\u0629\u062f\u0630\u0631\u0632\u0648\u0649".split("");
k.swapTable=[["(",")"],[")","("],["\x3c","\x3e"],["\x3e","\x3c"],["[","]"],["]","["],["{","}"],["}","{"],["\u00ab","\u00bb"],["\u00bb","\u00ab"],["\u2039","\u203a"],["\u203a","\u2039"],["\u207d","\u207e"],["\u207e","\u207d"],["\u208d","\u208e"],["\u208e","\u208d"],["\u2264","\u2265"],["\u2265","\u2264"],["\u2329","\u232a"],["\u232a","\u2329"],["\ufe59","\ufe5a"],["\ufe5a","\ufe59"],["\ufe5b","\ufe5c"],["\ufe5c","\ufe5b"],["\ufe5d","\ufe5e"],["\ufe5e","\ufe5d"],["\ufe64","\ufe65"],["\ufe65","\ufe64"]];
k.tbbase=100;k.typesNames="UBAT_L UBAT_R UBAT_EN UBAT_AN UBAT_ON UBAT_B UBAT_S UBAT_AL UBAT_WS UBAT_CS UBAT_ES UBAT_ET UBAT_NSM UBAT_LRE UBAT_RLE UBAT_PDF UBAT_LRO UBAT_RLO UBAT_BN".split(" ");k.ubatAl=7;k.ubatAn=3;k.ubatB=5;k.ubatBn=18;k.ubatCs=9;k.ubatEn=2;k.ubatEs=10;k.ubatEt=11;k.ubatL=0;k.ubatLre=13;k.ubatLro=16;k.ubatNsm=12;k.ubatOn=4;k.ubatPdf=15;k.ubatR=1;k.ubatRle=14;k.ubatRlo=17;k.ubatS=6;k.ubatWs=8;k.unicodeTable=[[18,18,18,18,18,18,18,18,18,6,5,6,8,5,18,18,18,18,18,18,18,18,18,18,18,18,
18,18,5,5,5,6,8,4,4,11,11,11,4,4,4,4,4,10,9,10,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,18,18,18,18,18,18,5,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,9,4,11,11,11,11,4,4,4,4,0,4,4,18,4,4,11,11,2,2,4,0,4,4,4,2,0,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,
0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,4,4,4,4,4,4,4,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,1,12,1,12,12,1,12,12,1,12,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,4,4,1,1,1,1,1,4,4,4,4,4,4,4,4,4,4,4],[3,3,3,3,4,4,4,4,7,11,11,7,9,7,4,4,12,12,12,12,12,12,12,12,12,12,12,7,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,3,3,3,3,3,3,3,3,3,3,11,3,3,7,7,7,12,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,12,12,12,12,12,12,12,3,4,12,12,12,12,12,12,7,7,12,12,4,12,12,12,12,7,7,2,2,2,2,2,2,2,2,2,2,7,7,7,7,7,7],[7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,7,7,12,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,12,12,
12,12,12,12,12,12,12,12,12,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,12,12,12,12,12,12,12,12,12,1,1,4,4,4,4,1,4,4,4,4,4],[8,8,8,8,8,8,8,8,8,8,8,18,18,18,0,1,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,5,13,14,15,16,17,9,11,11,11,11,11,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,18,18,18,18,18,4,4,4,4,4,18,18,18,18,18,18,2,0,4,4,2,2,2,2,2,2,10,10,4,4,4,0,2,2,2,2,2,2,2,2,2,2,10,
10,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,4,4,4,4,4,1,12,1,1,1,1,1,1,1,1,1,1,10,1,1,1,1,1,1,1,1,1,1,1,1,1,4,1,1,1,1,1,4,1,4,1,1,4,1,1,4,1,1,1,1,1,1,1,1,1,1,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,12,12,12,12,12,12,12,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,9,4,
4,9,4,4,4,4,4,4,4,4,4,11,4,4,10,10,4,4,4,4,4,11,11,4,4,4,4,4,7,7,7,7,7,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,18],[4,4,4,11,11,11,4,4,4,4,4,10,9,10,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,4,4,4,11,11,4,4,4,11,11,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]];Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMPlacements":function(){define(["exports"],
function(k){class r{constructor(){this.setIdentity()}getAngle(){if(null==this.rz||0===this.rz&&1!==this.rzCos&&0!==this.rzSin)this.rz=Math.atan2(this.rzSin,this.rzCos);return this.rz}setIdentity(){this.tz=this.ty=this.tx=0;this.s=1;this.rz=this.ry=this.rx=0;this.rzCos=1;this.rzSin=0}setTranslate(p,e){this.tx=p;this.ty=e}setTranslateZ(p){this.tz=p}setRotateCS(p,e){this.rz=void 0;this.rzCos=p;this.rzSin=e}setRotate(p){this.rz=p;this.rzSin=this.rzCos=void 0}setRotateY(p){this.ry=p}setScale(p){this.s=
p}setMeasure(p){this.m=p}}k.Placement=r;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMSymbolDrawHelper":function(){define("exports ../../core/fontUtils ../../core/has ../../core/lang ../../core/Logger ../../core/mathUtils ../../core/ObjectPool ../../core/screenUtils ../../geometry/GeometryCursor ../../geometry/support/aaBoundingRect ../../geometry/support/boundsUtils ../../geometry/support/centroid ../../geometry/support/jsonUtils ./CIMEffects ./CIMImageColorSubstitutionHelper ./CIMOperators ./CIMPlacements ./defaultCIMValues ./enums ./imageUtils ./mathUtils ./rasterizingUtils ./Rect ./TextRasterizer ./utils ../../views/2d/engine/svgUtils ../../views/2d/engine/webgl/definitions ../../views/2d/engine/webgl/mesh/templates/shapingUtils ../../views/2d/layers/graphics/graphicsUtils".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g,q,c,h,u,A,z,t,w,x,B,C,y,v,F,D,G,E){function H(I,M,N){for(const T of M){M=T.length;for(let W=1;W<M;W++){var R=T[W-1];const Y=T[W];let Z=(Y[0]-R[0])*(Y[0]-R[0])+(Y[1]-R[1])*(Y[1]-R[1]);if(0!==Z&&(Z=Math.sqrt(Z),Math.abs(((Y[0]-R[0])*(I[1]-R[1])-(Y[1]-R[1])*(I[0]-R[0]))/Z)<N&&(R=((Y[0]-R[0])*(I[0]-R[0])+(Y[1]-R[1])*(I[1]-R[1]))/Z,R>-N&&R<Z+N)))return!0}}return!1}function K(I,M=1){const N=v.fromCIMFontDecoration(I);var R=v.fromCIMFontStyle(I.fontStyleName);const T=I.fontFamilyName??
r.defaultFontFamily,{weight:W,style:Y}=R;R=M*(I.height||5);const Z=v.fromCIMHorizontalAlignment(I.horizontalAlignment),da=v.fromCIMVerticalAlignment(I.verticalAlignment),ca=v.getFillColor(I),ja=v.getFillColor(I.haloSymbol),ha=null!=ja?M*(I.haloSize??0):0,ka=v.getStrokeColor(I.symbol);M*=v.getStrokeWidth(I.symbol)||0;var ia="CIMBackgroundCallout"===I.callout?.type?I.callout.backgroundSymbol:null;I=v.getFillColor(ia);const na=v.getStrokeWidth(ia);ia=v.getStrokeColor(ia);return{color:ca,size:R,horizontalAlignment:Z,
verticalAlignment:da,font:{family:T,style:v.getFontStyle(Y),weight:v.getFontWeight(W),decoration:N},outline:{size:M||0,color:ka},halo:{size:ha||0,color:ja,style:Y},backgroundColor:I,borderLine:null!=na&&null!=ia?{size:na,color:ia}:null,pixelRatio:1,premultiplyColors:!0}}function J(I){let M=I[0],N=1;let R,T,W;for(;N<I.length;){var Y=I[N][0]-M[0];R=I[N][1]-M[1];Y=0!==Y?R/Y:Math.PI/2;void 0!==T&&1E-4>=Math.abs(Y-T)?(I.splice(N-1,1),M=W):(W=M,M=I[N],N++);T=Y}}const L=Math.PI/180,P=()=>n.getLogger("esri.symbols.cim.CIMSymbolDrawHelper");
class Q{constructor(I){this._t=I}static createIdentity(){return new Q([1,0,0,0,1,0])}clone(){return new Q(this._t.slice())}transform(I){const M=this._t;return[M[0]*I[0]+M[1]*I[1]+M[2],M[3]*I[0]+M[4]*I[1]+M[5]]}static createScale(I,M){return new Q([I,0,0,0,M,0])}scale(I,M){const N=this._t;N[0]*=I;N[1]*=I;N[2]*=I;N[3]*=M;N[4]*=M;N[5]*=M;return this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(I,M){return new Q([0,0,I,0,0,M])}translate(I,M){const N=
this._t;N[2]+=I;N[5]+=M;return this}static createRotate(I){const M=Math.cos(I);I=Math.sin(I);return new Q([M,-I,0,I,M,0])}rotate(I){return Q.multiply(this,Q.createRotate(I),this)}angle(){const I=this._t[0],M=this._t[3],N=Math.sqrt(I*I+M*M);return[I/N,M/N]}static multiply(I,M,N){I=I._t;M=M._t;const R=I[1]*M[0]+I[4]*M[1],T=I[2]*M[0]+I[5]*M[1]+M[2],W=I[0]*M[3]+I[3]*M[4],Y=I[1]*M[3]+I[4]*M[4],Z=I[2]*M[3]+I[5]*M[4]+M[5],da=N._t;da[0]=I[0]*M[0]+I[3]*M[1];da[1]=R;da[2]=T;da[3]=W;da[4]=Y;da[5]=Z;return N}invert(){const I=
this._t;let M=I[0]*I[4]-I[1]*I[3];if(0===M)return new Q([0,0,0,0,0,0]);M=1/M;return new Q([I[4]*M,-I[1]*M,(I[1]*I[5]-I[2]*I[4])*M,-I[3]*M,I[0]*M,(I[2]*I[3]-I[0]*I[5])*M])}}class S{constructor(I,M){this._resourceManager=I;this._transfos=[];this._sizeTransfos=[];this._geomUnitsPerPoint=1;this._placementPool=new l(A.Placement,void 0,void 0,100);this._earlyReturn=!1;this._mapRotation=0;this._transfos.push(M||Q.createIdentity());this._sizeTransfos.push(M?M.scaleRatio():1)}setTransform(I,M){this._transfos=
[I||Q.createIdentity()];this._sizeTransfos=[M||(I?I.scaleRatio():1)]}setGeomUnitsPerPoint(I){this._geomUnitsPerPoint=I}transformPt(I){return this._transfos[this._transfos.length-1].transform(I)}transformSize(I){return I*this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformPt(I){return this._transfos[this._transfos.length-1].invert().transform(I)}reverseTransformSize(I){return I/this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformScalar(I){return I/this._transfos[this._transfos.length-
1].scaleRatio()}getTransformAngle(){return this._transfos[this._transfos.length-1].angle()}geomUnitsPerPoint(){return this.isEmbedded()?1:this._geomUnitsPerPoint}prevGeomUnitsPerPoint(){return 2<this._transfos.length?1:this._geomUnitsPerPoint}isEmbedded(){return 1<this._transfos.length}back(){return this._transfos[this._transfos.length-1]}push(I,M){M=M?I.scaleRatio():1;Q.multiply(I,this.back(),I);this._transfos.push(I);this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*M)}pop(){this._transfos.splice(-1,
1);this._sizeTransfos.splice(-1,1)}drawSymbol(I,M,N){if(I)switch(I.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":this.drawMultiLayerSymbol(I,M);break;case "CIMTextSymbol":this.drawTextSymbol(I,M,N)}}drawMultiLayerSymbol(I,M){if(I&&M){var N=I.symbolLayers;if(N)if((I=I.effects)&&0<I.length){if(M=this.executeEffects(I,M))for(I=M.next();I;)this.drawSymbolLayers(N,I.asJSON()),I=M.next()}else this.drawSymbolLayers(N,M)}}executeEffects(I,M){const N=this._resourceManager.geometryEngine;
M=new c.SimpleEffectCursor(a.GeometryCursor.fromJSONCIM(M));for(const R of I)(I=u.getEffectOperator(R))&&(M=I.execute(M,R,this.geomUnitsPerPoint(),null,N));return M}drawSymbolLayers(I,M){let N=I.length;for(;N--;){const T=I[N];if(T&&!1!==T.enable){var R=T.effects;if(R&&0<R.length){if(R=this.executeEffects(R,M)){let W=null;for(;(W=R.next())&&(this.drawSymbolLayer(T,W.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(T,M);if(this._earlyReturn)break}}}drawSymbolLayer(I,M){switch(I.type){case "CIMSolidFill":this.drawSolidFill(M,
I.color,I.path);break;case "CIMHatchFill":this.drawHatchFill(M,I);break;case "CIMPictureFill":this.drawPictureFill(M,I);break;case "CIMGradientFill":this.drawGradientFill(M,I);break;case "CIMSolidStroke":this.drawSolidStroke(M,I.color,I.width,I.capStyle,I.joinStyle,I.miterLimit,I.path);break;case "CIMPictureStroke":this.drawPictureStroke(M,I);break;case "CIMGradientStroke":this.drawGradientStroke(M,I);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":this.drawMarkerLayer(I,
M)}}drawHatchFill(I,M){var N=this.geomUnitsPerPoint(),R=v.getNumericValue(M.separation,z.defaultCIMValues.CIMHatchFill.separation)*N;var T=v.getNumericValue(M.rotation);if(0===R)T=null;else{0>R&&(R=-R);for(var W=0,Y=.5*R;W>Y;)W-=R;for(;W<-Y;)W+=R;var Z=b.create();f.getBoundsXY(Z,I);Z[0]-=Y;Z[1]-=Y;Z[2]+=Y;Z[3]+=Y;for(var da=[[Z[0],Z[1]],[Z[0],Z[3]],[Z[2],Z[3]],[Z[2],Z[1]]];180<T;)T-=180;for(;0>T;)T+=180;Z=Math.cos(T*L);var ca=Math.sin(T*L);T=-R*ca;Y=R*Z;W=v.getNumericValue(M.offsetX)*N;N*=v.getNumericValue(M.offsetY);
W=W*ca-N*Z;var ja;var ha=N=Number.MAX_VALUE;var ka=ja=-Number.MAX_VALUE;for(var ia of da){var na=ia[0];const ma=ia[1];da=Z*na+ca*ma;na=-ca*na+Z*ma;ha=Math.min(ha,da);N=Math.min(N,na);ka=Math.max(ka,da);ja=Math.max(ja,na)}N=Math.floor(N/R)*R;ia=Z*ha-ca*N-T*W/R;ha=ca*ha+Z*N-Y*W/R;da=Z*ka-ca*N-T*W/R;Z=ca*ka+Z*N-Y*W/R;R=1+Math.round((ja-N)/R);W=[];for(ca=0;ca<R;ca++)ia+=T,ha+=Y,da+=T,Z+=Y,W.push([[ia,ha],[da,Z]]);T={paths:W}}T&&(this.pushClipPath(I),this.drawMultiLayerSymbol(M.lineSymbol,T),this.popClipPath())}drawPictureFill(I,
M){}drawGradientFill(I,M){}drawPictureStroke(I,M){}drawGradientStroke(I,M){}drawMarkerLayer(I,M){var N=I.markerPlacement;if(N){var R=u.getPlacementOperator(N);if(R){var T="CIMMarkerPlacementInsidePolygon"===N.type||"CIMMarkerPlacementPolygonCenter"===N.type&&N.clipAtBoundary;T&&this.pushClipPath(M);if(M=R.execute(a.GeometryCursor.fromJSONCIM(M),N,this.geomUnitsPerPoint(),null,this._resourceManager.geometryEngine))for(N=null;(N=M.next())&&(this.drawMarker(I,N),!this._earlyReturn););T&&this.popClipPath()}}else{N=
this._placementPool.acquire();if(q.isPoint(M))N.tx=M.x,N.ty=M.y,this.drawMarker(I,N);else if(q.isPolygon(M)){if(M=g.polygonCentroid(M))[N.tx,N.ty]=M,this.drawMarker(I,N)}else if(q.isPolyline(M))for(T of M.paths)for(R of T){if(N.tx=R[0],N.ty=R[1],this.drawMarker(I,N),this._earlyReturn)break}else for(const W of M.points)if(N.tx=W[0],N.ty=W[1],this.drawMarker(I,N),this._earlyReturn)break;this._placementPool.release(N)}}drawMarker(I,M){switch(I.type){case "CIMCharacterMarker":case "CIMPictureMarker":this.drawPictureMarker(I,
M);break;case "CIMVectorMarker":this.drawVectorMarker(I,M)}}drawPictureMarker(I,M){if(I){var N=this._resourceManager.getResource(I.url),R=v.getNumericValue(I.size,z.defaultCIMValues.CIMPictureMarker.size);if(!(null==N||0>=R)){var T=N.width;N=N.height;if(T&&N){N=T/N;var W=v.getNumericValue(I.scaleX,1);T=Q.createIdentity();var Y=I.anchorPoint;if(Y){var Z=Y.x;Y=Y.y;"Absolute"!==I.anchorPointUnits&&(Z*=R*N*W,Y*=R);T.translate(-Z,-Y)}N=v.getNumericValue(I.rotation);I.rotateClockwise&&(N=-N);this._mapRotation&&
(N+=this._mapRotation);N&&T.rotate(N*L);N=v.getNumericValue(I.offsetX);W=v.getNumericValue(I.offsetY);if(N||W){if(this._mapRotation){Y=L*this._mapRotation;Z=Math.cos(Y);Y=Math.sin(Y);const da=N*Y+W*Z;N=N*Z-W*Y;W=da}T.translate(N,W)}N=this.geomUnitsPerPoint();1!==N&&T.scale(N,N);(N=M.getAngle())&&T.rotate(N);T.translate(M.tx,M.ty);this.push(T,!1);this.drawImage(I,R);this.pop()}}}}drawVectorMarker(I,M){if(I){var N=I.markerGraphics;if(N){var R=v.getNumericValue(I.size,z.defaultCIMValues.CIMVectorMarker.size),
T=I.frame,W=T?T.ymax-T.ymin:0;W=R&&W?R/W:1;R=Q.createIdentity();T&&R.translate(.5*-(T.xmax+T.xmin),.5*-(T.ymax+T.ymin));var Y=I.anchorPoint;if(Y){var Z=Y.x;Y=Y.y;"Absolute"!==I.anchorPointUnits?T&&(Z*=T.xmax-T.xmin,Y*=T.ymax-T.ymin):(Z/=W,Y/=W);R.translate(-Z,-Y)}1!==W&&R.scale(W,W);T=v.getNumericValue(I.rotation);I.rotateClockwise&&(T=-T);this._mapRotation&&(T+=this._mapRotation);T&&R.rotate(T*L);T=v.getNumericValue(I.offsetX);W=v.getNumericValue(I.offsetY);if(T||W){if(this._mapRotation){Y=L*this._mapRotation;
Z=Math.cos(Y);Y=Math.sin(Y);const da=T*Y+W*Z;T=T*Z-W*Y;W=da}R.translate(T,W)}T=this.geomUnitsPerPoint();1!==T&&R.scale(T,T);(T=M.getAngle())&&R.rotate(T);R.translate(M.tx,M.ty);this.push(R,I.scaleSymbolsProportionally);for(const da of N)if(da?.symbol&&da.geometry||P().error("Invalid marker graphic",da),I=da.textString,"number"===typeof I&&(I=I.toString()),this.drawSymbol(da.symbol,da.geometry,I),this._earlyReturn)break;this.pop()}}}drawTextSymbol(I,M,N){if(I&&q.isPoint(M)&&!(0>=v.getNumericValue(I.height,
z.defaultCIMValues.CIMTextSymbol.height))){var R=Q.createIdentity(),T=v.getNumericValue(I.angle);(T=-T)&&R.rotate(T*L);T=v.getNumericValue(I.offsetX);var W=v.getNumericValue(I.offsetY);(T||W)&&R.translate(T,W);T=this.geomUnitsPerPoint();1!==T&&R.scale(T,T);R.translate(M.x,M.y);this.push(R,!1);this.drawText(I,N);this.pop()}}}class U extends S{constructor(I,M){super(I,M);this.reset()}reset(){this._xmin=this._ymin=Infinity;this._xmax=this._ymax=-Infinity;this._clipCount=0}envelope(){return new C(this._xmin,
this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}bounds(){return b.fromValues(this._xmin,this._ymin,this._xmax,this._ymax)}drawSolidFill(I){!I||0<this._clipCount||(q.isPolygon(I)?this._processPath(I.rings,0):q.isPolyline(I)?this._processPath(I.paths,0):q.isExtent(I)?(I=ba(I))&&this._processPath(I.rings,0):console.error("drawSolidFill Unexpected geometry type!"))}drawSolidStroke(I,M,N){!I||0<this._clipCount||null==N||0>=N||(M=Math.max(.5*this.transformSize(v.getNumericValue(N,z.defaultCIMValues.CIMSolidStroke.width)),
.25),q.isPolygon(I)?this._processPath(I.rings,M):q.isPolyline(I)?this._processPath(I.paths,M):q.isExtent(I)?(I=ba(I))&&this._processPath(I.rings,M):console.error("drawSolidStroke unexpected geometry type!"))}drawMarkerLayer(I,M){q.isPolygon(M)&&I.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===I.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===I.markerPlacement.type&&I.markerPlacement.clipAtBoundary)?this._processPath(M.rings,0):super.drawMarkerLayer(I,M)}drawHatchFill(I,M){this.drawSolidFill(I)}drawPictureFill(I,
M){this.drawSolidFill(I)}drawGradientFill(I,M){this.drawSolidFill(I)}drawPictureStroke(I,M){this.drawSolidStroke(I,null,M.width)}drawGradientStroke(I,M){this.drawSolidStroke(I,null,M.width)}pushClipPath(I){this.drawSolidFill(I);this._clipCount++}popClipPath(){this._clipCount--}drawImage(I,M){var {url:N}=I;I=v.getNumericValue(I.scaleX,1);let R=I*M;var T=M;N=this._resourceManager.getResource(N);null!=N&&(T=N.height/N.width,R=I*(M?1<T?M:M/T:N.width),T=M?1<T?M*T:M:N.height);this._merge(this.transformPt([-R/
2,-T/2]),0);this._merge(this.transformPt([-R/2,T/2]),0);this._merge(this.transformPt([R/2,-T/2]),0);this._merge(this.transformPt([R/2,T/2]),0)}drawText(I,M){if(M&&0!==M.length){this._textRasterizer||(this._textRasterizer=new y);var N=K(I),[R,T]=this._textRasterizer.computeTextSize(M,N);R=d.px2pt(R);T=d.px2pt(T);M=this.transformSize(1)*this.reverseTransformScalar(1);R*=M;T*=M;M=0;switch(I.horizontalAlignment){case "Left":M=R/2;break;case "Right":M=-R/2}N=0;switch(I.verticalAlignment){case "Bottom":N=
T/2;break;case "Top":N=-T/2;break;case "Baseline":N=T/6}this._merge(this.transformPt([-R/2+M,-T/2+N]),0);this._merge(this.transformPt([-R/2+M,T/2+N]),0);this._merge(this.transformPt([R/2+M,-T/2+N]),0);this._merge(this.transformPt([R/2+M,T/2+N]),0)}}_processPath(I,M){if(I)for(const N of I)if(I=N?N.length:0,1<I){this._merge(this.transformPt(N[0]),M);for(let R=1;R<I;R++)this._merge(this.transformPt(N[R]),M)}}_merge(I,M){I[0]-M<this._xmin&&(this._xmin=I[0]-M);I[0]+M>this._xmax&&(this._xmax=I[0]+M);I[1]-
M<this._ymin&&(this._ymin=I[1]-M);I[1]+M>this._ymax&&(this._ymax=I[1]+M)}}class X extends S{constructor(){super(...arguments);this._searchPoint=[0,0];this._searchDistPoint=0;this._canvas=this._path=this._svg=this._textInfo=null}destroy(){this._svg=F.destroyHiddenSvg(this._svg);this._canvas=this._path=null}hitTest(I,M,N,R,T,W){W*=d.pt2px(1);this.setTransform();this.setGeomUnitsPerPoint(W);this._searchPoint=[(I[0]+I[2])/2,(I[1]+I[3])/2];this._searchDistPoint=(I[2]-I[0])/2/W;this._textInfo=R;this._mapRotation=
M&&("CIMPointSymbol"===M.type&&"Map"!==M.angleAlignment||"CIMTextSymbol"===M.type)?T:0;p("esri-mobile")||(I=d.px2pt(D.hittestToleranceSmallSymbol*window.devicePixelRatio),R=d.px2pt(D.hittestSmallSymbolThreshold),("CIMLineSymbol"!==M?.type&&"CIMPolygonSymbol"!==M?.type||!M.symbolLayers?.some(v.isCIMFill))&&"CIMMeshSymbol"!==M?.type&&(v.getSize(M)??0)<R&&(this._searchDistPoint=I));this._earlyReturn=!1;this.drawSymbol(M,N);return this._earlyReturn}executeEffects(I,M){"CIMGeometricEffectDashes"===I.at(-1)?.type&&
(I=I.slice(0,-1));return super.executeEffects(I,M)}drawSolidFill(I,M,N){null!=N?this._hittestSvgPath(I,N,!0):this._hitTestFill(I)}drawHatchFill(I,M){this._hitTestFill(I)}drawPictureFill(I,M){this._hitTestFill(I)}drawGradientFill(I,M){this._hitTestFill(I)}drawSolidStroke(I,M,N,R,T,W,Y){null!=Y?this._hittestSvgPath(I,Y,!1,N):this._hitTestStroke(I,N)}drawPictureStroke(I,M){this._hitTestStroke(I,M.width)}drawGradientStroke(I,M){this._hitTestStroke(I,M.width)}drawMarkerLayer(I,M){I.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===
I.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===I.markerPlacement.type&&I.markerPlacement.clipAtBoundary)?this._hitTestFill(M):super.drawMarkerLayer(I,M)}pushClipPath(I){}popClipPath(){}drawImage(I,M){var {url:N}=I;I=v.getNumericValue(I.scaleX,1);N=this._resourceManager.getResource(N);if(null!=N&&0!==N.height&&0!==M){M*=this.geomUnitsPerPoint();I=N.width/N.height*I*M;N=this.reverseTransformPt(this._searchPoint);var R=this._searchDistPoint;Math.abs(N[0])<I/2+R&&Math.abs(N[1])<M/2+R&&(this._earlyReturn=
!0)}}drawText(I,M){if((M=this._textInfo)&&(M=M.get(I))&&M.glyphMosaicItems.glyphs.length){var N=E.roundPtToWholePixel(v.getNumericValue(I.height,z.defaultCIMValues.CIMTextSymbol.height)),{lineGapType:R,lineGap:T}=I,W=R?fa(R,v.getNumericValue(T),N):0,Y="CIMBackgroundCallout"===I.callout?.type;I=G.shapeGlyphs(M.glyphMosaicItems,{scale:N/D.glyphSize,angle:0,xOffset:0,yOffset:0,horizontalAlignment:I.horizontalAlignment,verticalAlignment:I.verticalAlignment,maxLineWidth:E.getLineWidth(I.lineWidth),lineHeight:D.magicLabelLineHeight*
Math.max(.25,Math.min(W||1,4)),decoration:I.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:Y});N=this.reverseTransformPt(this._searchPoint);M=N[0];N=N[1];for(const Z of I.glyphs)if(M>Z.xTopLeft&&M<Z.xBottomRight&&N>-Z.yBottomRight&&N<-Z.yTopLeft){this._earlyReturn=!0;break}}}_hitTestFill(I){let M=null;if(q.isExtent(I))M=[[[I.xmin,I.ymin],[I.xmin,I.ymax],[I.xmax,I.ymax],[I.xmax,I.ymin],[I.xmin,I.ymin]]];else if(q.isPolygon(I))M=I.rings;else if(q.isPolyline(I))M=I.paths;else return;I=
this.reverseTransformPt(this._searchPoint);let N=0;for(var R of M){const T=R.length;for(let W=1;W<T;W++){const Y=R[W-1],Z=R[W];Y[1]>I[1]!==Z[1]>I[1]&&(0<(Z[0]-Y[0])*(I[1]-Y[1])-(Z[1]-Y[1])*(I[0]-Y[0])?N++:N--)}}0!==N&&(this._earlyReturn=!0);this._earlyReturn||(R=this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint(),H(I,M,R)&&(this._earlyReturn=!0))}_getSvgPath(){if(null==this._svg||null==this._path)this._svg??(this._svg=F.createHiddenSvg()),this._path??(this._path=F.createSvgElement("path")),
this._svg.appendChild(this._path);return this._path}_getCanvasContext(I,M){this._canvas??(this._canvas=document.createElement("canvas"));this._canvas.width=I;this._canvas.height=M;return this._canvas.getContext("2d",{willReadFrequently:!0})}_hittestSvgPath(I,M,N,R=0){const T=this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint(),W=this.reverseTransformPt(this._searchPoint);var Y=b.create();f.getBoundsXY(Y,I);I=Y[0];var Z=Y[1],da=Y[2]-Y[0];Y=Y[3]-Y[1];var ca=this._getSvgPath();
ca.setAttribute("d",M);ca=ca.getBBox();let ja=Math.max(ca.width/da,ca.height/Y),ha=1;var ka=2*T*ja;1>ka&&(ha=2/ka,ja*=ha,ca.x*=ha,ca.y*=ha,ca.width*=ha,ca.height*=ha);ka=1+R*ja/2;const ia=this._getCanvasContext(ca.width+2*ka,ca.height+2*ka);ia.setTransform(ha,0,0,ha,-ca.x+ka,-ca.y+ka);M=new Path2D(M);N?ia.fill(M):(ia.lineWidth=ja/ha*R,ia.stroke(M));N=ia.getImageData(Math.floor((W[0]-I-T)*ja-(da*ja-ca.width)/2+ka),Math.floor((Y-(W[1]-Z)-T)*ja+(Y*ja-ca.height)/2+ka),Math.ceil(2*T*ja),Math.ceil(2*T*
ja)).data;for(R=3;R<N.length;R+=4)if(127.5<N[R]){this._earlyReturn=!0;break}}_hitTestStroke(I,M){let N=null;if(q.isExtent(I))N=[[[I.xmin,I.ymin],[I.xmin,I.ymax],[I.xmax,I.ymax],[I.xmax,I.ymin],[I.xmin,I.ymin]]];else if(q.isPolygon(I))N=I.rings;else if(q.isPolyline(I))N=I.paths;else return;I=this.reverseTransformPt(this._searchPoint);M=v.getNumericValue(M,z.defaultCIMValues.CIMSolidStroke.width)*this.geomUnitsPerPoint();const R=this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint();
H(I,N,M/2+R)&&(this._earlyReturn=!0)}}class aa extends S{constructor(I,M,N,R){super(M,N);this._applyAdditionalRenderProps=R;this._colorSubstitutionHelper=new h;this._ctx=I}drawSolidFill(I,M){if(I){if(q.isPolygon(I))this._buildPath(I.rings,!0);else if(q.isPolyline(I))this._buildPath(I.paths,!0);else if(q.isExtent(I))this._buildPath(ba(I).rings,!0);else if(q.isMultipoint(I))console.log("CanvasDrawHelper.drawSolidFill - No implementation!");else return;I=this._ctx;I.fillStyle="string"===typeof M?M:"rgba("+
Math.round(M[0])+","+Math.round(M[1])+","+Math.round(M[2])+","+(M[3]??255)/255+")";I.fill("evenodd")}}drawSolidStroke(I,M,N,R,T,W){if(I&&M&&0!==N){if(q.isPolygon(I))this._buildPath(I.rings,!0);else if(q.isPolyline(I))this._buildPath(I.paths,!1);else if(q.isExtent(I))this._buildPath(ba(I).rings,!0);else{console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");return}I=this._ctx;I.strokeStyle="string"===typeof M?M:"rgba("+Math.round(M[0])+","+Math.round(M[1])+","+Math.round(M[2])+","+(M[3]??
255)/255+")";I.lineWidth=Math.max(this.transformSize(N),.5);this._setCapStyle(R);this._setJoinStyle(T);I.miterLimit=W;I.stroke()}}pushClipPath(I){this._ctx.save();if(q.isPolygon(I))this._buildPath(I.rings,!0);else if(q.isPolyline(I))this._buildPath(I.paths,!0);else if(q.isExtent(I))this._buildPath(ba(I).rings,!0);else return;this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}drawImage(I,M){const {colorSubstitutions:N,url:R,tintColor:T}=I;I=v.getNumericValue(I.scaleX,1);var W=this._resourceManager.getResource(R);
if(null!=W){var Y=W.width/W.height*M,Z=M;M||(Y=W.width,Z=W.height);var da=v.isSVGImage(R)||"src"in W&&v.isSVGImage(W.src);M="getFrame"in W?w.getFirstFrame(W):W;N&&(M=this._colorSubstitutionHelper.applyColorSubstitution(M,N));this._applyAdditionalRenderProps&&!da&&T&&(M=this._colorSubstitutionHelper.tintImageData(M,T));W=this.transformPt([0,0]);var [ca,ja]=this.getTransformAngle();da=this.transformSize(1);var ha=this._ctx;ha.save();ha.setTransform({m11:I*da*ca,m12:I*da*ja,m21:-da*ja,m22:da*ca,m41:W[0],
m42:W[1]});ha.drawImage(M,-Y/2,-Z/2,Y,Z);ha.restore()}}drawText(I,M){if(M&&0!==M.length&&(this._textRasterizer||(this._textRasterizer=new y),I=K(I,this.transformSize(d.px2pt(1))),M=this._textRasterizer.rasterizeText(M,I))){var {size:N,anchorX:R,anchorY:T,canvas:W}=M;M=N[0]*(R+.5);I=N[1]*(T-.5);var Y=this._ctx,Z=this.transformPt([0,0]),[da,ca]=this.getTransformAngle();Y.save();Y.setTransform({m11:1*da,m12:1*ca,m21:-1*ca,m22:1*da,m41:Z[0]-1*M,m42:Z[1]+1*I});Y.drawImage(W,0,0);Y.restore()}}drawPictureFill(I,
M){if(I){var {colorSubstitutions:N,height:R,offsetX:T,offsetY:W,rotation:Y,scaleX:Z,tintColor:da,url:ca}=M;M=this._resourceManager.getResource(ca);if(null!=M){if(q.isPolygon(I))this._buildPath(I.rings,!0);else if(q.isPolyline(I))this._buildPath(I.paths,!0);else if(q.isExtent(I))this._buildPath(ba(I).rings,!0);else if(q.isMultipoint(I))console.log("CanvasDrawHelper.drawPictureFill - No implementation!");else return;I=this._ctx;var ja=v.isSVGImage(ca)||"src"in M&&v.isSVGImage(M.src),ha="getFrame"in
M?w.getFirstFrame(M):M;N&&(ha=this._colorSubstitutionHelper.applyColorSubstitution(ha,N));if(this._applyAdditionalRenderProps){if(ja||da&&(ha=this._colorSubstitutionHelper.tintImageData(ha,da)),ja=I.createPattern(ha,"repeat"),ha=this.transformSize(1),Y||=0,T=T?ha*T:0,W=W?ha*W:0,R&&=ha*R,ha=R?R/M.height:1,M=Z&&R?Z*R/M.width:1,0!==Y||1!==ha||1!==M||0!==T||0!==W){const ka=new DOMMatrix;ka.rotateSelf(0,0,-Y).translateSelf(T,W).scaleSelf(M,ha,1);ja.setTransform(ka)}}else ja=I.createPattern(ha,"repeat");
I.save();I.fillStyle=ja;I.fill("evenodd");I.restore()}}}drawPictureStroke(I,M){if(I){var {colorSubstitutions:N,capStyle:R,joinStyle:T,miterLimit:W,tintColor:Y,url:Z,width:da}=M;M=this._resourceManager.getResource(Z);if(null!=M){if(q.isPolygon(I))var ca=I.rings;else if(q.isPolyline(I))ca=I.paths;else if(q.isExtent(I))ca=ba(I).rings;else{q.isMultipoint(I)&&console.log("CanvasDrawHelper.drawPictureStroke - No implementation!");return}da||(da=M.width);I=v.isSVGImage(Z)||"src"in M&&v.isSVGImage(M.src);
var ja="getFrame"in M?w.getFirstFrame(M):M;N&&(ja=this._colorSubstitutionHelper.applyColorSubstitution(ja,N));this._applyAdditionalRenderProps&&(I||Y&&(ja=this._colorSubstitutionHelper.tintImageData(ja,Y)));M=Math.max(this.transformSize(d.pt2px(da)),.5);I=M/ja.width;var ha=this._ctx;ja=ha.createPattern(ja,"repeat-y");ha.save();this._setCapStyle(R);this._setJoinStyle(T);void 0!==W&&(ha.miterLimit=W);ha.lineWidth=M;for(let ia of ca)if(ia=e.clone(ia),J(ia),ia&&!(1>=ia.length)){ca=this.transformPt(ia[0]);
for(let na=1;na<ia.length;na++){var ka=this.transformPt(ia[na]);const ma=180/Math.PI*Math.atan2(ka[1]-ca[1],ka[0]-ca[0]),qa=new DOMMatrix;qa.translateSelf(0,ca[1]-M/2).scaleSelf(I,I,1).rotateSelf(0,0,90-ma);ja.setTransform(qa);ha.strokeStyle=ja;ha.beginPath();ha.moveTo(ca[0],ca[1]);ha.lineTo(ka[0],ka[1]);ha.stroke();ca=ka}}ha.restore()}}}drawGradientFill(I,M){if(I){if(q.isPolygon(I))var N=I.rings;else if(q.isPolyline(I))N=I.paths;else if(q.isExtent(I))N=ba(I).rings;else{P().error("Unable to draw gradient fill");
return}this._buildPath(N,!0);var {angle:R,gradientMethod:T,gradientSize:W,gradientSizeUnits:Y}=M,Z=z.defaultCIMValues.CIMGradientFill,da=M.gradientType??Z.gradientType,ca=-m.deg2rad(R??0),ja=b.empty();for(var ha of N)if(N=ha?ha.length:0,1<N)for(var ka=0;ka<N;ka++){var ia=this.transformPt(ha[ka]);if("Linear"===T||"Rectangular"===T)ia=x.rotate(ia,-ca);b.expandPointInPlace(ja,ia)}var [na,ma,qa,ra]=ja,ta=this._ctx;ta.save();switch(T){case "Buffered":P().error(`Gradient method "${T}" currently unsupported.`);
break;case "Linear":ja=(ma+ra)/2;Z="Absolute"===Y?this.transformSize(d.pt2px(W)):v.getRelativeGradientSize(W,Z.gradientSize)*(qa-na);const [Ha,xa]="Discrete"===da?[qa,qa-Z]:[na+Z,na];da=x.rotate([Ha,ja],ca);Z=x.rotate([xa,ja],ca);da=ta.createLinearGradient(da[0],da[1],Z[0],Z[1]);B.addColorStops(da,M);ta.fillStyle=da;ta.fill("evenodd");break;case "Circular":ha=b.center(ja);ja=b.diagonal(ja)/2;Z="Absolute"===Y?this.transformSize(d.pt2px(W)):v.getRelativeGradientSize(W,Z.gradientSize)*ja;const [O,V]=
"Discrete"===da?[ja,ja-Z]:[Z,0];da=ta.createRadialGradient(ha[0],ha[1],O,ha[0],ha[1],V);B.addColorStops(da,M);ta.fillStyle=da;ta.fill("evenodd");break;case "Rectangular":ka=b.center(ja);ha=ka[0];N=ka[1];const ea=x.rotate(ka,ca);ka=(Ka,Ra,Ia,ab,Sa,yb,La,Ca)=>{ta.save();this.pushClipPath(I);Sa=x.rotate([Sa,yb],ca);La=x.rotate([La,Ca],ca);ta.beginPath();ta.moveTo(ea[0],ea[1]);ta.lineTo(Sa[0],Sa[1]);ta.lineTo(La[0],La[1]);ta.lineTo(ea[0],ea[1]);ta.clip();Ka=x.rotate([Ka,Ra],ca);Ia=x.rotate([Ia,ab],ca);
Ia=ta.createLinearGradient(Ka[0],Ka[1],Ia[0],Ia[1]);B.addColorStops(Ia,M);ta.fillStyle=Ia;ta.fill("evenodd");ta.restore()};ia="Absolute"===Y?this.transformSize(d.pt2px(W)):v.getRelativeGradientSize(W,Z.gradientSize)*(b.width(ja)/2);let [la,pa]="Discrete"===da?[qa,qa-ia]:[ha+ia,ha];ka(la,N,pa,N,qa,ma,qa,ra);[la,pa]="Discrete"===da?[na,na+ia]:[ha-ia,ha];ka(la,N,pa,N,na,ra,na,ma);ia="Absolute"===Y?this.transformSize(d.pt2px(W)):v.getRelativeGradientSize(W,Z.gradientSize)*(b.height(ja)/2);let [va,Ga]=
"Discrete"===da?[ra,ra-ia]:[N+ia,N];ka(ha,va,ha,Ga,qa,ra,na,ra);[va,Ga]="Discrete"===da?[ma,ma+ia]:[N-ia,N];ka(ha,va,ha,Ga,na,ma,qa,ma)}ta.restore()}}drawGradientStroke(I,M){const {capStyle:N,gradientMethod:R,gradientSize:T,gradientSizeUnits:W,joinStyle:Y,miterLimit:Z,width:da}=M;if(I&&0!==da){if(q.isPolygon(I))var ca=I.rings;else if(q.isPolyline(I))ca=I.paths;else if(q.isExtent(I))ca=ba(I).rings;else{P().error("Unable to draw gradient stroke");return}I=M.gradientType??z.defaultCIMValues.CIMGradientStroke.gradientType;
var ja=Math.max(this.transformSize(d.pt2px(da)),.5),ha=this._ctx;ha.save();this._setCapStyle(N);this._setJoinStyle(Y);void 0!==Z&&(ha.miterLimit=Z);ha.lineWidth=ja;for(let ra of ca){ra=e.clone(ra);J(ra);if(!ra||1>=ra.length)continue;let ta=0;var ka=this.transformPt(ra[0]);for(var ia=1;ia<ra.length;ia++){ca=this.transformPt(ra[ia]);var na=ca[0]-ka[0];ka=ca[1]-ka[1];ta+=Math.sqrt(na*na+ka*ka);ka=ca}ia="Absolute"===W?this.transformSize(d.pt2px(T)):v.getRelativeGradientSize(T,z.defaultCIMValues.CIMGradientStroke.gradientSize)*
("AcrossLine"===R?ja:ta);na=0;ka=this.transformPt(ra[0]);for(let Ha=1;Ha<ra.length;Ha++){ca=this.transformPt(ra[Ha]);var ma=ca[0]-ka[0],qa=ca[1]-ka[1];const xa=Math.sqrt(ma*ma+qa*qa);let O,V,ea;switch(R){case "AcrossLine":const [la,pa]=x.rotate([ma/xa,qa/xa],-Math.PI/2);qa=ja/2;ma="Discrete"===I?qa:ia-qa;qa=(ka[0]+ca[0])/2+la*ma;O=(ka[1]+ca[1])/2+pa*ma;V=qa-la*ia;ea=O-pa*ia;break;case "AlongLine":ma/=xa;const va=qa/xa;"Discrete"===I?(qa=ka[0]-ma*na,O=ka[1]-va*na,V=qa+ma*ia,ea=O+va*ia):(V=ka[0]+ma*
(ta-na),ea=ka[1]+va*(ta-na),qa=V-ma*ia,O=ea-va*ia);break;default:P().error("Unrecognized gradient method:",R);ha.restore();return}qa=ha.createLinearGradient(qa,O,V,ea);B.addColorStops(qa,M);ha.strokeStyle=qa;ha.beginPath();ha.moveTo(ka[0],ka[1]);ha.lineTo(ca[0],ca[1]);ha.stroke();na+=xa;ka=ca}}ha.restore()}}_buildPath(I,M){const N=this._ctx;N.beginPath();if(I)for(const R of I)if(I=R?R.length:0,1<I){let T=this.transformPt(R[0]);N.moveTo(T[0],T[1]);for(let W=1;W<I;W++)T=this.transformPt(R[W]),N.lineTo(T[0],
T[1]);M&&N.closePath()}}_setCapStyle(I){switch(I){case t.LineCapStyle.Butt:this._ctx.lineCap="butt";break;case t.LineCapStyle.Round:this._ctx.lineCap="round";break;case t.LineCapStyle.Square:this._ctx.lineCap="square"}}_setJoinStyle(I){switch(I){case t.LineJoinStyle.Bevel:this._ctx.lineJoin="bevel";break;case t.LineJoinStyle.Round:this._ctx.lineJoin="round";break;case t.LineJoinStyle.Miter:this._ctx.lineJoin="miter"}}}const ba=I=>I?{spatialReference:I.spatialReference,rings:[[[I.xmin,I.ymin],[I.xmin,
I.ymax],[I.xmax,I.ymax],[I.xmax,I.ymin],[I.xmin,I.ymin]]]}:null,fa=(I,M,N)=>{switch(I){case "ExtraLeading":return 1+M/N;case "Multiple":return M;case "Exact":return M/N}};k.CIMSymbolDrawHelper=S;k.CanvasDrawHelper=aa;k.EnvDrawHelper=U;k.HittestDrawHelper=X;k.Transformation=Q;k.cDegToRad=L;k.lineGapType2LineHeight=fa;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/GeometryCursor":function(){define(["exports","../core/lang","./geometryCursorCollectUtils","./support/jsonUtils",
"../layers/graphics/OptimizedGeometry"],function(k,r,p,e,n){function m(g){if(e.isPolygon(g))g=[g.rings,"esriGeometryPolygon"];else if(e.isPolyline(g))g=[g.paths,"esriGeometryPolyline"];else if(e.isMultipoint(g))g=[[g.points],"esriGeometryMultipoint"];else if(e.isExtent(g))g=[[[[g.xmin,g.ymin],[g.xmin,g.ymax],[g.xmax,g.ymax],[g.xmax,g.ymin],[g.xmin,g.ymin]]],"esriGeometryEnvelope"];else if(e.isPoint(g)){const q=[g.x,g.y];g.z&&q.push(g.z);g.m&&q.push(g.m);g=[[[q]],"esriGeometryPoint"]}else g=[[],"esriGeometryPolyline"];
return g}class l{static fromOptimized(g,q,c=!1,h=!1,u=1){return(new d).initialize(g,q,c,h,u)}static fromJSON(g,q=!1,c=!1){const [h,u]=m(g);return(new a).initialize(h,u,q,c,1)}static fromOptimizedCIM(g,q,c=!1,h=!1,u=1){return(new b).initialize(g,q,c,h,u)}static fromJSONCIM(g,q=!1,c=!1,h=1){const [u,A]=m(g);return(new f).initialize(u,A,q,c,h)}static fromFeatureSetReader(g){const q=g.readGeometryForDisplay();g=g.geometryType;return q&&g?this.fromOptimized(q,g):null}static fromFeatureSetReaderCIM(g){const q=
g.readGeometryForDisplay();g=g.geometryType;return q&&g?this.fromOptimizedCIM(q,g):null}static createEmptyOptimized(g,q=!1,c=!1,h=1){return(new d).initialize(new n,g,q,c,h)}static createEmptyJSON(g,q=!1,c=!1){return(new a).initialize([],g,q,c,1)}static createEmptyOptimizedCIM(g,q=!1,c=!1,h=1){return(new b).initialize(new n,g,q,c,h)}static createEmptyJSONCIM(g,q=!1,c=!1,h=1){return(new f).initialize([],g,q,c,h)}asJSON(){const g=p.collectMultipath(this);return"esriGeometryEnvelope"===this.geometryType?
{xmin:g[0][0][0],ymin:g[0][0][1],xmax:g[0][2][0],ymax:g[0][2][1]}:"esriGeometryMultipoint"===this.geometryType?{points:g.flat()}:"esriGeometryPoint"===this.geometryType?{x:g[0][0][0],y:g[0][0][1]}:"esriGeometryPolygon"===this.geometryType?{rings:g}:{paths:g}}getCurrentRingArea(){if(3>this.pathSize)return 0;let g=0,q,c;this.seekPathStart();if(!this.nextPoint())return 0;q=this.x;c=this.y;const h=q,u=c;for(;this.nextPoint();)g+=(q-this.x)*(c+this.y),q=this.x,c=this.y;return-.5*(g+(q-h)*(c+u))}invertY(){this.yFactor*=
-1}}class d extends l{constructor(){super(...arguments);this._end=-1}initialize(g,q,c,h,u){this.hasZ=c;this.hasM=h;this.geometryType=q;this._stride=2+Number(c)+Number(h);this._geometry=g;this._pathIndex=-1;this._pathOffset=0;this._pointOffset=-this._stride;this._end=-1;this.yFactor=u;return this}reset(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)}seekPath(g){if(0<=g&&g<this.totalSize){if(this._pathIndex<g)for(;this._pathIndex<g&&this.nextPath(););else if(this._pathIndex>
g)for(;this._pathIndex>g&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-this._stride}seekPathEnd(){this._pointOffset=this._end}seekInPath(g){g=this._pathOffset+g*this._stride;return 0<=g&&g<this._end?(this._pointOffset=g,!0):!1}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=this._stride)>=this._pathOffset}nextPath(){if(this.pathIndex>=this.totalSize-1)return!1;0<=this._pathIndex&&(this._pathOffset+=this._stride*
this.pathSize);this._pathIndex++;this._pointOffset=this._pathOffset-this._stride;this._end=this._pointOffset+this._stride+this._stride*this.pathSize;return!0}prevPath(){if(0>=this.pathIndex)return!1;this._pathIndex--;this._end=this._pathOffset;this._pathOffset-=this._stride*this.pathSize;this._pointOffset=this._pathOffset-this._stride;return!0}getCurrentPath(){const g=this._end,q=this._geometry.coords,c=this._pathOffset;return(new d).initialize(new n([this.pathSize],q.slice(c,g)),this.geometryType,
this.hasZ,this.hasM,this.yFactor)}pathLength(){const g=this._end,q=this._stride,c=this._geometry.coords;let h=0;for(let u=this._pathOffset+q;u<g;u+=q){const A=c[u]-c[u-q],z=c[u+1]-c[u-q+1];h+=Math.sqrt(A*A+z*z)}return h}startPath(){this._geometry.lengths.push(0)}pushPath(g){this.startPath();this.pushPoints(g)}pushPoint(g){for(let q=0;q<this._stride;++q)this._geometry.coords.push(g[q]);this._geometry.lengths[this.totalSize-1]++}pushXY(g,q){this._geometry.coords.push(g,q);this._geometry.lengths[this.totalSize-
1]++}pushPoints(g){for(const q of g)for(let c=0;c<this._stride;++c)this._geometry.coords.push(q[c]);this._geometry.lengths[this.totalSize-1]+=g.length}pushCursor(g){g=g.asOptimized();this._geometry.coords.push(...g.coords);this._geometry.lengths.push(...g.lengths)}asOptimized(){const g=this._geometry.clone();if(1!==this.yFactor)for(let q=1;q<g.coords.length;q+=this._stride)g.coords[q]*=this.yFactor;"esriGeometryPoint"===this.geometryType&&(g.lengths.length=0);return g}isClosed(){const g=this._geometry.coords,
q=this._pathOffset,c=this._end-this._stride;for(let h=0;h<this._stride;h++)if(g[q+h]!==g[c+h])return!1;return!0}clone(){return(new d).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._geometry.isPoint?1:this._geometry.lengths.reduce((g,q)=>g+q)}get pathSize(){const {lengths:g}=this._geometry;return this._geometry.isPoint?1:0>this._pathIndex||this._pathIndex>g.length-1?0:g[this._pathIndex]}get totalSize(){return this._geometry.isPoint?
1:this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(g){this._geometry.coords[this._pointOffset]=g}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+1]}set y(g){this._geometry.coords[this._pointOffset+1]=this.yFactor*g}get z(){return this._geometry.coords[this._pointOffset+2]}set z(g){this._geometry.coords[this._pointOffset+2]=g}get m(){return this._geometry.coords[this._pointOffset+(this.hasZ?3:2)]}set m(g){this._geometry.coords[this._pointOffset+
3]=g}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}}class a extends l{initialize(g,q,c,h,u){this._paths=g;this.geometryType=q;this.hasZ=c;this.hasM=h;this._pathIndex=this._pointIndex=-1;this.yFactor=u;this._mIndex=this.hasZ?3:2;return this}reset(){this._pathIndex=this._pointIndex=-1}seekPath(g){this._pathIndex=g;this._pointIndex=-1;return 0<=g&&g<this.totalSize?(this._currentPath=this._paths[g],!0):!1}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=
this._currentPath.length}seekInPath(g){return 0<=g&&g<this._currentPath.length?(this._pointIndex=g,this._currentPoint=this._currentPath[this._pointIndex],!0):!1}nextPoint(){this._currentPoint=this._currentPath[++this._pointIndex];return this._pointIndex<this._currentPath.length}prevPoint(){this._currentPoint=this._currentPath[--this._pointIndex];return 0<=this._pointIndex}nextPath(){this._pointIndex=-1;this._currentPath=this._paths[++this._pathIndex];return this._pathIndex<this.totalSize}prevPath(){return 0<
this.pathIndex?(this._pointIndex=-1,this._pathIndex--,this._currentPath=this._paths[this._pathIndex],!0):!1}pathLength(){const g=this._currentPath.length,q=this._currentPath;let c=0;for(let u=1;u<g;u++){var h=q[u-1];const A=q[u],z=A[0]-h[0];h=A[1]-h[1];c+=Math.sqrt(z*z+h*h)}return c}startPath(){this._paths.push([])}getCurrentPath(){return(new a).initialize([this._currentPath],this.geometryType,this.hasZ,this.hasM,this.yFactor)}pushPath(g){this._paths.push(g)}pushPoint(g){this._paths[this.totalSize-
1].push(g)}pushXY(g,q){this._paths[this.totalSize-1].push([g,q])}pushPoints(g){this._paths[this.totalSize-1].push(...g)}pushCursor(g){g=p.collectMultipath(g);for(const q of g)this.pushPath(q)}asOptimized(){const g=new n;if("esriGeometryPoint"===this.geometryType)g.coords.push(...this._paths[0][0]),g.lengths.length=0;else for(const q of this._paths){for(const c of q)g.coords.push(c[0]),g.coords.push(c[1]*this.yFactor),this.hasZ&&g.coords.push(c[2]),this.hasM&&g.coords.push(c[this._mIndex]);g.lengths.push(q.length)}return g}isClosed(){const g=
this._currentPath[0],q=this._currentPath[this._currentPath.length-1];for(let c=0;c<g.length;c++)if(g[c]!==q[c])return!1;return!0}clone(){return(new a).initialize(r.clone(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map(g=>g.length).reduce((g,q)=>g+q)}get pathSize(){return 0>this._pathIndex||this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(g){this._currentPoint[0]=
g}get y(){return this.yFactor*this._currentPoint[1]}set y(g){this._currentPoint[1]=this.yFactor*g}get z(){return this._currentPoint[2]}set z(g){this._currentPoint[2]=g}get m(){return this._currentPoint[this._mIndex]}set m(g){this._currentPoint[this._mIndex]=g}get pathIndex(){return this._pathIndex}}class b extends d{initialize(g,q,c,h,u){super.initialize(g,q,c,h,u);this._controlPoints||(this._controlPoints=this._controlPoints=Array(this.totalSize).fill(void 0).map(A=>new Set));return this}startPath(){super.startPath();
this._controlPoints.push(new Set)}clone(){const g=(new b).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);g._controlPoints=this._controlPoints;return g}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(g){this._controlPoints[this.pathIndex].add(g)}getControlPointAt(g){return this._controlPoints[this.pathIndex].has(g)}}class f extends a{initialize(g,
q,c,h,u){return super.initialize(g,q,c,h,u)}clone(){return(new f).initialize(r.clone(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][4]=1}getControlPoint(){return 1===this._paths[this.pathIndex][this._pointIndex][4]}setControlPointAt(g){this._paths[this.pathIndex][g][4]=1}getControlPointAt(g){return 1===this._paths[this.pathIndex][g][4]}}k.GeometryCursor=l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},
"esri/symbols/cim/CIMEffects":function(){define(["exports","../../geometry/GeometryCursor","../../geometry/support/TileClipper"],function(k,r,p){let e;class n{constructor(m){this._geometry=m}next(){const m=this._geometry;this._geometry=null;return m}}k.SimpleEffectCursor=n;k.clipCursorToTileExtent=function(m,l){e||=new p.TileClipper(0,0,0,1);var d="esriGeometryPolygon"===m.geometryType;const a=d?3:2;e.reset(d?p.GeometryType.Polygon:p.GeometryType.LineString);e.setPixelMargin(l+1);e.setExtent(512);
let b;for(;m.nextPath();)if(!(m.pathSize<a)){m.nextPoint();l=m.x;b=-m.y;for(e.moveTo(l,b);m.nextPoint();)l=m.x,b=-m.y,e.lineTo(l,b);d&&e.close()}if(d=e.result(!1)){m=r.GeometryCursor.createEmptyOptimizedCIM(m.geometryType);for(const f of d){m.startPath();for(const g of f)m.pushXY(g.x,-g.y)}m.reset();return m}return null};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/TileClipper":function(){define(["exports"],function(k){k.GeometryType=void 0;(function(a){a[a.Unknown=
0]="Unknown";a[a.Point=1]="Point";a[a.LineString=2]="LineString";a[a.Polygon=3]="Polygon"})(k.GeometryType||(k.GeometryType={}));class r{constructor(a,b){this.x=a;this.y=b}clone(){return new r(this.x,this.y)}equals(a,b){return a===this.x&&b===this.y}isEqual(a){return a.x===this.x&&a.y===this.y}setCoords(a,b){this.x=a;this.y=b;return this}normalize(){var a=this.x;const b=this.y;a=Math.sqrt(a*a+b*b);this.x/=a;this.y/=a;return this}rightPerpendicular(){const a=this.x;this.x=this.y;this.y=-a;return this}leftPerpendicular(){const a=
this.x;this.x=-this.y;this.y=a;return this}move(a,b){this.x+=a;this.y+=b;return this}assign(a){this.x=a.x;this.y=a.y;return this}assignAdd(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this}assignSub(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this}rotate(a,b){const f=this.x,g=this.y;this.x=f*a-g*b;this.y=f*b+g*a;return this}scale(a){this.x*=a;this.y*=a;return this}length(){const a=this.x,b=this.y;return Math.sqrt(a*a+b*b)}sub(a){this.x-=a.x;this.y-=a.y;return this}add(a){this.x+=a.x;this.y+=a.y;return this}static distance(a,
b){const f=b.x-a.x;a=b.y-a.y;return Math.sqrt(f*f+a*a)}static add(a,b){return new r(a.x+b.x,a.y+b.y)}static sub(a,b){return new r(a.x-b.x,a.y-b.y)}}class p{constructor(a,b,f){this.ratio=a;this.x=b;this.y=f}}class e{constructor(a,b,f,g=8,q=8){this._lines=[];this._starts=[];this.validateTessellation=!0;this._pixelRatio=g;this._pixelMargin=q;this._tileSize=512*g;this._dz=a;this._yPos=b;this._xPos=f}setPixelMargin(a){a!==this._pixelMargin&&(this._pixelMargin=a,this.setExtent(this._extent))}setExtent(a){this._extent=
a;this._finalRatio=this._tileSize/a*(1<<this._dz);let b=this._pixelRatio*this._pixelMargin;b/=this._finalRatio;a>>=this._dz;b>a&&(b=a);this._margin=b;this._xmin=a*this._xPos-b;this._ymin=a*this._yPos-b;this._xmax=this._xmin+a+2*b;this._ymax=this._ymin+a+2*b}reset(a){this._type=a;this._lines=[];this._starts=[];this._line=null;this._start=0}moveTo(a,b){this._pushLine();this._prevIsIn=this._isIn(a,b);this._moveTo(a,b,this._prevIsIn);this._prevPt=new r(a,b);this._firstPt=new r(a,b);this._dist=0}lineTo(a,
b){const f=this._isIn(a,b),g=new r(a,b),q=r.distance(this._prevPt,g);if(f)if(this._prevIsIn)this._lineTo(a,b,!0);else{var c=this._prevPt;var h=g;a=this._intersect(h,c);this._start=this._dist+q*(1-this._r);this._lineTo(a.x,a.y,!0);this._lineTo(h.x,h.y,!0)}else if(this._prevIsIn)h=this._prevPt,c=g,a=this._intersect(h,c),this._lineTo(a.x,a.y,!0),this._lineTo(c.x,c.y,!1);else{const A=this._prevPt;if(!(A.x<=this._xmin&&g.x<=this._xmin||A.x>=this._xmax&&g.x>=this._xmax||A.y<=this._ymin&&g.y<=this._ymin||
A.y>=this._ymax&&g.y>=this._ymax)){a=[];if(A.x<this._xmin&&g.x>this._xmin||A.x>this._xmin&&g.x<this._xmin){b=(this._xmin-A.x)/(g.x-A.x);var u=A.y+b*(g.y-A.y);u<=this._ymin?h=!1:u>=this._ymax?h=!0:a.push(new p(b,this._xmin,u))}if(A.x<this._xmax&&g.x>this._xmax||A.x>this._xmax&&g.x<this._xmax)b=(this._xmax-A.x)/(g.x-A.x),u=A.y+b*(g.y-A.y),u<=this._ymin?h=!1:u>=this._ymax?h=!0:a.push(new p(b,this._xmax,u));if(A.y<this._ymin&&g.y>this._ymin||A.y>this._ymin&&g.y<this._ymin)b=(this._ymin-A.y)/(g.y-A.y),
u=A.x+b*(g.x-A.x),u<=this._xmin?c=!1:u>=this._xmax?c=!0:a.push(new p(b,u,this._ymin));if(A.y<this._ymax&&g.y>this._ymax||A.y>this._ymax&&g.y<this._ymax)b=(this._ymax-A.y)/(g.y-A.y),u=A.x+b*(g.x-A.x),u<=this._xmin?c=!1:u>=this._xmax?c=!0:a.push(new p(b,u,this._ymax));if(0===a.length)c?h?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):h?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(1<a.length&&a[0].ratio>a[1].ratio)this._start=this._dist+
q*a[1].ratio,this._lineTo(a[1].x,a[1].y,!0),this._lineTo(a[0].x,a[0].y,!0);else for(this._start=this._dist+q*a[0].ratio,c=0;c<a.length;c++)this._lineTo(a[c].x,a[c].y,!0)}this._lineTo(g.x,g.y,!1)}this._dist+=q;this._prevIsIn=f;this._prevPt=g}close(){if(2<this._line.length){var a=this._firstPt,b=this._prevPt;a.x===b.x&&a.y===b.y||this.lineTo(a.x,a.y);a=this._line;for(b=a.length;4<=b;)if(a[0].x===a[1].x&&a[0].x===a[b-2].x||a[0].y===a[1].y&&a[0].y===a[b-2].y)a.pop(),a[0].x=a[b-2].x,a[0].y=a[b-2].y,--b;
else break}}result(a=!0){this._pushLine();if(0===this._lines.length)return null;this._type===k.GeometryType.Polygon&&a&&l.simplify(this._tileSize,this._margin*this._finalRatio,this._lines);return this._lines}resultWithStarts(){if(this._type!==k.GeometryType.LineString)throw Error("Only valid for lines");this._pushLine();const a=this._lines,b=a.length;if(0===b)return null;const f=[];for(let g=0;g<b;g++)f.push({line:a[g],start:this._starts[g]||0});return f}_isIn(a,b){return a>=this._xmin&&a<=this._xmax&&
b>=this._ymin&&b<=this._ymax}_intersect(a,b){let f,g,q;if(b.x>=this._xmin&&b.x<=this._xmax)g=b.y<=this._ymin?this._ymin:this._ymax,q=(g-a.y)/(b.y-a.y),f=a.x+q*(b.x-a.x);else if(b.y>=this._ymin&&b.y<=this._ymax)f=b.x<=this._xmin?this._xmin:this._xmax,q=(f-a.x)/(b.x-a.x),g=a.y+q*(b.y-a.y);else{g=b.y<=this._ymin?this._ymin:this._ymax;f=b.x<=this._xmin?this._xmin:this._xmax;const c=(f-a.x)/(b.x-a.x),h=(g-a.y)/(b.y-a.y);c<h?(q=c,g=a.y+c*(b.y-a.y)):(q=h,f=a.x+h*(b.x-a.x))}this._r=q;return new r(f,g)}_pushLine(){this._line&&
(this._type===k.GeometryType.Point?0<this._line.length&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===k.GeometryType.LineString?1<this._line.length&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===k.GeometryType.Polygon&&3<this._line.length&&(this._lines.push(this._line),this._starts.push(this._start)));this._line=[];this._start=0}_moveTo(a,b,f){this._type!==k.GeometryType.Polygon?f&&(a=Math.round((a-(this._xmin+this._margin))*this._finalRatio),
b=Math.round((b-(this._ymin+this._margin))*this._finalRatio),this._line.push(new r(a,b))):(f||(a<this._xmin&&(a=this._xmin),a>this._xmax&&(a=this._xmax),b<this._ymin&&(b=this._ymin),b>this._ymax&&(b=this._ymax)),a=Math.round((a-(this._xmin+this._margin))*this._finalRatio),b=Math.round((b-(this._ymin+this._margin))*this._finalRatio),this._line.push(new r(a,b)),this._isV=this._isH=!1)}_lineTo(a,b,f){if(this._type!==k.GeometryType.Polygon)if(f){a=Math.round((a-(this._xmin+this._margin))*this._finalRatio);
b=Math.round((b-(this._ymin+this._margin))*this._finalRatio);if(0<this._line.length&&(f=this._line[this._line.length-1],f.equals(a,b)))return;this._line.push(new r(a,b))}else this._line&&0<this._line.length&&this._pushLine();else if(f||(a<this._xmin&&(a=this._xmin),a>this._xmax&&(a=this._xmax),b<this._ymin&&(b=this._ymin),b>this._ymax&&(b=this._ymax)),a=Math.round((a-(this._xmin+this._margin))*this._finalRatio),b=Math.round((b-(this._ymin+this._margin))*this._finalRatio),this._line&&0<this._line.length){f=
this._line[this._line.length-1];const g=f.x===a,q=f.y===b;g&&q||(this._isH&&g?(f.x=a,f.y=b,f=this._line[this._line.length-2],f.x===a&&f.y===b?(this._line.pop(),1>=this._line.length?this._isV=this._isH=!1:(f=this._line[this._line.length-2],this._isH=f.x===a,this._isV=f.y===b)):(this._isH=f.x===a,this._isV=f.y===b)):this._isV&&q?(f.x=a,f.y=b,f=this._line[this._line.length-2],f.x===a&&f.y===b?(this._line.pop(),1>=this._line.length?this._isV=this._isH=!1:(f=this._line[this._line.length-2],this._isH=f.x===
a,this._isV=f.y===b)):(this._isH=f.x===a,this._isV=f.y===b)):(this._line.push(new r(a,b)),this._isH=g,this._isV=q))}else this._line.push(new r(a,b))}}class n{setExtent(a){this._ratio=4096===a?1:4096/a}get validateTessellation(){return 1>this._ratio}reset(a){this._lines=[];this._line=null}moveTo(a,b){this._line&&this._lines.push(this._line);this._line=[];const f=this._ratio;this._line.push(new r(a*f,b*f))}lineTo(a,b){const f=this._ratio;this._line.push(new r(a*f,b*f))}close(){const a=this._line;a&&
!a[0].isEqual(a[a.length-1])&&a.push(a[0])}result(){this._line&&this._lines.push(this._line);return 0===this._lines.length?null:this._lines}}var m;(function(a){a[a.sideLeft=0]="sideLeft";a[a.sideRight=1]="sideRight";a[a.sideTop=2]="sideTop";a[a.sideBottom=3]="sideBottom"})(m||={});class l{static simplify(a,b,f){if(f){var g=-b,q=a+b,c=-b,h=a+b;a=[];b=[];var u=f.length;for(let A=0;A<u;++A){const z=f[A];if(!z||2>z.length)continue;let t=z[0],w;const x=z.length;for(let B=1;B<x;++B)w=z[B],t.x===w.x&&(t.x<=
g&&(t.y>w.y?(a.push(A),a.push(B),a.push(m.sideLeft),a.push(-1)):(b.push(A),b.push(B),b.push(m.sideLeft),b.push(-1))),t.x>=q&&(t.y<w.y?(a.push(A),a.push(B),a.push(m.sideRight),a.push(-1)):(b.push(A),b.push(B),b.push(m.sideRight),b.push(-1)))),t.y===w.y&&(t.y<=c&&(t.x<w.x?(a.push(A),a.push(B),a.push(m.sideTop),a.push(-1)):(b.push(A),b.push(B),b.push(m.sideTop),b.push(-1))),t.y>=h&&(t.x>w.x?(a.push(A),a.push(B),a.push(m.sideBottom),a.push(-1)):(b.push(A),b.push(B),b.push(m.sideBottom),b.push(-1)))),
t=w}0!==a.length&&0!==b.length&&(l.fillParent(f,b,a),l.fillParent(f,a,b),g=[],l.calcDeltas(g,b,a),l.calcDeltas(g,a,b),l.addDeltas(g,f))}}static fillParent(a,b,f){const g=f.length,q=b.length;for(let z=0;z<q;z+=4){var c=b[z],h=b[z+1];const t=b[z+2],w=a[c][h-1];c=a[c][h];h=8092;let x=-1;for(let B=0;B<g;B+=4){if(f[B+2]!==t)continue;var u=f[B];const C=f[B+1];var A=a[u][C-1];u=a[u][C];switch(t){case m.sideLeft:case m.sideRight:d(w.y,A.y,u.y)&&d(c.y,A.y,u.y)&&(A=Math.abs(u.y-A.y),A<h&&(h=A,x=B));break;case m.sideTop:case m.sideBottom:d(w.x,
A.x,u.x)&&d(c.x,A.x,u.x)&&(A=Math.abs(u.x-A.x),A<h&&(h=A,x=B))}}b[z+3]=x}}static calcDeltas(a,b,f){const g=b.length;for(let q=0;q<g;q+=4){const c=l.calcDelta(q,b,f,[]);a.push(b[q]);a.push(b[q+1]);a.push(b[q+2]);a.push(c)}}static calcDelta(a,b,f,g){a=b[a+3];if(-1===a)return 0;const q=g.length;if(1<q&&g[q-2]===a)return 0;g.push(a);return l.calcDelta(a,f,b,g)+1}static addDeltas(a,b){const f=a.length;let g=0;for(var q=0;q<f;q+=4){var c=a[q+3];c>g&&(g=c)}for(q=0;q<f;q+=4){c=b[a[q]];const h=a[q+1],u=g-
a[q+3];switch(a[q+2]){case m.sideLeft:c[h-1].x-=u;c[h].x-=u;1===h&&(c[c.length-1].x-=u);h===c.length-1&&(c[0].x-=u);break;case m.sideRight:c[h-1].x+=u;c[h].x+=u;1===h&&(c[c.length-1].x+=u);h===c.length-1&&(c[0].x+=u);break;case m.sideTop:c[h-1].y-=u;c[h].y-=u;1===h&&(c[c.length-1].y-=u);h===c.length-1&&(c[0].y-=u);break;case m.sideBottom:c[h-1].y+=u,c[h].y+=u,1===h&&(c[c.length-1].y+=u),h===c.length-1&&(c[0].y+=u)}}}}const d=(a,b,f)=>a>=b&&a<=f||a>=f&&a<=b;k.Point=r;k.SimpleBuilder=n;k.TileClipper=
e;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMImageColorSubstitutionHelper":function(){define(function(){class k{applyColorSubstitution(r,p){if(!p)return r;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const {width:e,height:n}=r,m=this._rasterizationCanvas,l=m.getContext("2d",{willReadFrequently:!0});r!==m&&(m.width=e,m.height=n,l.drawImage(r,0,0,e,n));r=l.getImageData(0,0,e,n).data;if(p)for(var d of p)if(d&&d.oldColor&&
4===d.oldColor.length&&d.newColor&&4===d.newColor.length){const [a,b,f,g]=d.oldColor,[q,c,h,u]=d.newColor;if(a!==q||b!==c||f!==h||g!==u)for(p=0;p<r.length;p+=4)a===r[p]&&b===r[p+1]&&f===r[p+2]&&g===r[p+3]&&(r[p]=q,r[p+1]=c,r[p+2]=h,r[p+3]=u)}d=new ImageData(r,e,n);l.putImageData(d,0,0);return m}tintImageData(r,p){if(!p||4>p.length)return r;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const {width:e,height:n}=r,m=this._rasterizationCanvas,l=m.getContext("2d",
{willReadFrequently:!0});r!==m&&(m.width=e,m.height=n,l.drawImage(r,0,0,e,n));r=l.getImageData(0,0,e,n);r=new Uint8Array(r.data);p=[p[0]/255,p[1]/255,p[2]/255,p[3]/255];for(let d=0;d<r.length;d+=4)r[d]*=p[0],r[d+1]*=p[1],r[d+2]*=p[2],r[d+3]*=p[3];p=new ImageData(new Uint8ClampedArray(r.buffer),e,n);l.putImageData(p,0,0);return m}}return k})},"esri/symbols/cim/CIMOperators":function(){define("exports ./effects/EffectAddControlPoints ./effects/EffectArrow ./effects/EffectBuffer ./effects/EffectControlMeasureLine ./effects/EffectCut ./effects/EffectDashes ./effects/EffectDonut ./effects/EffectJog ./effects/EffectMove ./effects/EffectOffset ./effects/EffectReverse ./effects/EffectRotate ./effects/EffectScale ./effects/EffectWave ./placements/PlacementAlongLineSameSize ./placements/PlacementAtExtremities ./placements/PlacementAtRatioPositions ./placements/PlacementInsidePolygon ./placements/PlacementOnLine ./placements/PlacementOnVertices ./placements/PlacementPolygonCenter".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g,q,c,h,u,A,z,t,w,x,B){k.getEffectOperator=function(C){if(!C)return null;switch(C.type){case "CIMGeometricEffectAddControlPoints":return r.EffectAddControlPoints.local();case "CIMGeometricEffectArrow":return p.EffectArrow.local();case "CIMGeometricEffectBuffer":return e.EffectBuffer.local();case "CIMGeometricEffectControlMeasureLine":return n.EffectControlMeasureLine.local();case "CIMGeometricEffectCut":return m.EffectCut.local();case "CIMGeometricEffectDashes":return l.EffectDashes.local();
case "CIMGeometricEffectDonut":return d.EffectDonut.local();case "CIMGeometricEffectJog":return a.EffectJog.local();case "CIMGeometricEffectMove":return b.EffectMove.local();case "CIMGeometricEffectOffset":return f.EffectOffset.local();case "CIMGeometricEffectReverse":return g.EffectReverse.local();case "CIMGeometricEffectRotate":return q.EffectRotate.local();case "CIMGeometricEffectScale":return c.EffectScale.local();case "CIMGeometricEffectWave":return h.EffectWave.local()}return null};k.getPlacementOperator=
function(C){if(!C)return null;switch(C.type){case "CIMMarkerPlacementAlongLineSameSize":return u.PlacementAlongLineSameSize.local();case "CIMMarkerPlacementAtExtremities":return A.PlacementAtExtremities.local();case "CIMMarkerPlacementAtRatioPositions":return z.PlacementAtRatioPositions.local();case "CIMMarkerPlacementInsidePolygon":return t.PlacementInsidePolygon.local();case "CIMMarkerPlacementOnLine":return w.PlacementOnLine.local();case "CIMMarkerPlacementOnVertices":return x.PlacementOnVertices.local();
case "CIMMarkerPlacementPolygonCenter":return B.PlacementPolygonCenter.local()}return null};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectAddControlPoints":function(){define(["exports"],function(k){class r{static local(){null===r.instance&&(r.instance=new r);return r.instance}execute(e,n,m,l,d){return new p(e,n,m)}}r.instance=null;class p{constructor(e,n,m){this._inputGeometries=e;this._angleTolerance=void 0!==n.angleTolerance?n.angleTolerance:120;
this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let e=this._inputGeometries.next();for(;e;){if("esriGeometryPolygon"===e.geometryType)this._isClosed=!0;else if("esriGeometryPolyline"===e.geometryType)this._isClosed=!1;else if("esriGeometryEnvelope"===e.geometryType){if(this._maxCosAngle)return e;this._isClosed=!0}else{e=this._inputGeometries.next();continue}for(;e.nextPath();)this._processPath(e);e.reset();return e}return null}_processPath(e){if(e.nextPoint()){const n=
e.x,m=e.y;let l=n,d=m,a=e.pathSize,b=0,f=0,g=0,q=0,c=0,h=0;this._isClosed&&++a;for(let u=1;e.nextPoint()||u<a;++u){let A,z;this._isClosed&&u===a-1?(A=n,z=m):(A=e.x,z=e.y);const t=A-l,w=z-d,x=Math.sqrt(t*t+w*w);1<u&&0<x&&0<g&&(b*t+f*w)/x/g<=this._maxCosAngle&&e.setControlPointAt(u-1);1===u&&(q=t,c=w,h=x);0<x&&(l=A,d=z,b=t,f=w,g=x)}this._isClosed&&0<g&&0<h&&(b*q+f*c)/h/g<=this._maxCosAngle&&e.setControlPointAt(0)}}}k.EffectAddControlPoints=r;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},
"esri/symbols/cim/effects/EffectArrow":function(){define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMCursor ../CurveHelper ../enums".split(" "),function(k,r,p,e,n,m){const l=m.GeometricEffectArrowType.OpenEnded;class d{static local(){null===d.instance&&(d.instance=new d);return d.instance}execute(b,f,g,q,c){return new a(b,f,g)}}d.instance=null;class a extends e.PathEffectCursor{constructor(b,f,g){super(b,!1,!0);this._curveHelper=new n.CurveHelper;this._width=
(void 0!==f.width?f.width:5)*g;this._arrowType=void 0!==f.geometricEffectArrowType?f.geometricEffectArrowType:void 0!==f.arrowType?f.arrowType:l;this._offsetFlattenError=n.pixelTolerance*g}processPath(b){const f=r.GeometryCursor.createEmptyOptimizedCIM(b.geometryType);switch(this._arrowType){default:this._constructSimpleArrow(f,b,!0);break;case m.GeometricEffectArrowType.Block:this._constructSimpleArrow(f,b,!1);break;case m.GeometricEffectArrowType.Crossed:this._constructCrossedArrow(f,b)}return f}_constructSimpleArrow(b,
f,g){var q=f.pathLength(),c=this._width;q<2*c&&(c=q/2);var h=this._curveHelper.getSubCurve(f,0,q-c);if(h&&h.nextPath()&&(h.seekPathStart(),q=c/2,!this._curveHelper.isEmpty(h)&&(h=p.collectPath(h),c=this._constructOffset(h,-q)))&&(h=this._constructOffset(h,q))){var u=this._constructArrowBasePoint(c,-q/2);u&&(q=this._constructArrowBasePoint(h,q/2))&&(f.seekInPath(f.pathSize-1),f=[f.x,f.y],b.pushPath(h),b.nextPath(),b.nextPoint(),b.setControlPoint(),b.pushPoint(q),b.nextPoint(),b.setControlPoint(),b.pushPoint(f),
b.nextPoint(),b.setControlPoint(),b.pushPoint(u),b.nextPoint(),b.setControlPoint(),b.pushPoints(c.reverse()),b.setControlPoint(),g||(b.setControlPointAt(0),b.setControlPointAt(b.pathSize-1),b.pushPoint(h[0])),b.reset())}}_constructCrossedArrow(b,f){var g=f.pathLength(),q=this._width;g<3.732050807568877*q&&(q=g/3.732050807568877);f.seekPathStart();var c=this._curveHelper.getSubCurve(f,0,g-2.732050807568877*q);if(c){c.nextPath();var h=q/2;if(!this._curveHelper.isEmpty(c)){var u=p.collectPath(c);if(c=
this._constructOffset(u,h))if(u=this._constructOffset(u,-h))if(g=this._curveHelper.getSubCurve(f,0,g-q))if(g.nextPath(),!this._curveHelper.isEmpty(g)&&(g=p.collectPath(g),q=this._constructOffset(g,h))){var A=this._constructOffset(g,-h);if(A&&(g=q[q.length-1],q=this._constructArrowBasePoint(q,h/2))){var z=A[A.length-1];if(h=this._constructArrowBasePoint(A,-h/2))f.seekInPath(f.pathSize-1),f=[f.x,f.y],b.pushPath(c),b.nextPath(),b.nextPoint(),b.setControlPoint(),b.pushPoint(z),b.nextPoint(),b.setControlPoint(),
b.pushPoint(h),b.nextPoint(),b.setControlPoint(),b.pushPoint(f),b.nextPoint(),b.setControlPoint(),b.pushPoint(q),b.nextPoint(),b.setControlPoint(),b.pushPoint(g),b.nextPoint(),b.setControlPoint(),b.pushPoints(u.reverse()),b.nextPoint(),b.setControlPoint(),b.reset()}}}}}_constructOffset(b,f){return this._curveHelper.offset(b,f,m.GeometricEffectOffsetMethod.Rounded,4,this._offsetFlattenError)}_constructArrowBasePoint(b,f){if(!b||2>b.length)return null;var g=b[b.length-2];b=b[b.length-1];g=[b[0]-g[0],
b[1]-g[1]];this._curveHelper.normalize(g);return[b[0]+g[1]*f,b[1]-g[0]*f]}}k.EffectArrow=d;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMCursor":function(){define(["exports","./CIMPlacements"],function(k,r){class p{constructor(n,m=!0,l=!0,d=0){this.isClosed=!1;this.geometryCursor=null;this.geometryCursor=!m&&"esriGeometryPolygon"===n.geometryType||!l&&"esriGeometryPolyline"===n.geometryType?null:n;this.geomUnitsPerPoint=d;this.iteratePath=this.iterateMultiPath=
!1;this.internalPlacement=new r.Placement}next(){if(!this.geometryCursor)return null;const n=this.processMultiPath(this.geometryCursor);this.iterateMultiPath&&n||(this.geometryCursor=null);return n}processMultiPath(n){for(;this.iteratePath||n.pathIndex<n.totalSize-1;){this.iteratePath||n.nextPath();this.iterateMultiPath=!0;const m=this.processPath(n);if(m)return m}this.iterateMultiPath=!1;return null}}class e{constructor(n,m,l,d=0){this.isClosed=!1;this.inputGeometries=n;this.acceptPolygon=m;this.acceptPolyline=
l;this.geomUnitsPerPoint=d;this.iteratePath=!1;this.multiPathCursor=null}next(){for(;;){if(!this.multiPathCursor){for(var n=this.inputGeometries.next();n&&!(this.isClosed=this.acceptPolygon&&"esriGeometryPolygon"===n.geometryType||"esriGeometryEnvelope"===n.geometryType,this.multiPathCursor=n);)n=this.inputGeometries.next();if(!this.multiPathCursor)return null}for(;this.iteratePath||this.multiPathCursor.nextPath();)if(this.multiPathCursor.seekPathStart(),n=this.processPath(this.multiPathCursor))return n;
this.multiPathCursor=null}}}k.PathEffectCursor=e;k.PathTransformationCursor=p;k.setId=function(n,m){n[4]=m};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CurveHelper":function(){define(["exports","../../geometry/GeometryCursor","./enums"],function(k,r,p){class e{constructor(n,m){}isEmpty(n){if(!n.nextPoint())return!0;let m,l,d,a;m=n.x;for(l=n.y;n.nextPoint();m=l,l=a)if(d=n.x,a=n.y,d!==m||a!==l)return n.seekPathStart(),!1;n.seekPathStart();return!0}normalize(n){const m=
Math.sqrt(n[0]*n[0]+n[1]*n[1]);0!==m&&(n[0]/=m,n[1]/=m)}getLength(n,m,l,d){n=l-n;m=d-m;return Math.sqrt(n*n+m*m)}getSegLength(n){const [[m,l],[d,a]]=n;return this.getLength(m,l,d,a)}getCoord2D(n,m,l,d,a){return[n+(l-n)*a,m+(d-m)*a]}getSegCoord2D(n,m){const [[l,d],[a,b]]=n;return this.getCoord2D(l,d,a,b,m)}getAngle(n,m,l,d,a){return Math.atan2(d-m,l-n)}getAngleCS(n,m,l,d,a){n=l-n;m=d-m;d=Math.sqrt(n*n+m*m);return 0<d?[n/d,m/d]:[1,0]}getSegAngleCS(n,m){const [[l,d],[a,b]]=n;return this.getAngleCS(l,
d,a,b,m)}cut(n,m,l,d,a,b){a=0>=a?[n,m]:this.getCoord2D(n,m,l,d,a);n=1<=b?[l,d]:this.getCoord2D(n,m,l,d,b);return[a,n]}getSubCurve(n,m,l){const d=r.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(d,n,m,l)?d:null}appendSubCurve(n,m,l,d){n.startPath();m.seekPathStart();let a=0;var b=!0;if(!m.nextPoint())return!1;var f=m.x;let g=m.y;for(;m.nextPoint();){const q=this.getLength(f,g,m.x,m.y);if(0!==q){if(b){if(a+q>l){const c=(l-a)/q;let h=1;b=!1;a+q>=d&&(h=(d-a)/
q,b=!0);(f=this.cut(f,g,m.x,m.y,c,h))&&n.pushPoints(f);if(b)break;b=!1}}else{if(a+q>d){(m=this.cut(f,g,m.x,m.y,0,(d-a)/q))&&n.pushPoint(m[1]);break}n.pushXY(m.x,m.y)}a+=q}f=m.x;g=m.y}return!0}getCIMPointAlong(n,m){if(!n.nextPoint())return null;let l=0,d,a,b,f;d=n.x;for(a=n.y;n.nextPoint();d=b,a=f){b=n.x;f=n.y;const g=this.getLength(d,a,b,f);if(0!==g){if(l+g>m)return this.getCoord2D(d,a,b,f,(m-l)/g);l+=g}}return null}offset(n,m,l,d,a){if(!n||2>n.length)return null;var b=0,f=n[b++];for(a=b;b<n.length;){var g=
n[b];if(g[0]!==f[0]||g[1]!==f[1])b!==a&&(n[a]=n[b]),f=n[a++];b++}(b=n[0][0]===n[a-1][0]&&n[0][1]===n[a-1][1])&&--a;if(a<(b?3:2))return null;g=[];f=b?n[a-1]:null;let q=n[0];for(let z=0;z<a;z++){const t=z===a-1?b?n[0]:null:n[z+1];if(f)if(t){var c=[t[0]-q[0],t[1]-q[1]];this.normalize(c);var h=[q[0]-f[0],q[1]-f[1]];this.normalize(h);var u=h[0]*c[1]-h[1]*c[0],A=h[0]*c[0]+h[1]*c[1];if(0===u&&1===A){q=t;continue}if(0<=u===0>=m)1>A&&(c=[c[0]-h[0],c[1]-h[1]],this.normalize(c),h=Math.sqrt((1+A)/2),h>1/d&&(h=
-Math.abs(m)/h,g.push([q[0]-c[0]*h,q[1]-c[1]*h])));else switch(l){case p.GeometricEffectOffsetMethod.Mitered:if(f=Math.sqrt((1+A)/2),0<f&&1/f<d){c=[c[0]-h[0],c[1]-h[1]];this.normalize(c);h=Math.abs(m)/f;g.push([q[0]-c[0]*h,q[1]-c[1]*h]);break}case p.GeometricEffectOffsetMethod.Bevelled:g.push([q[0]+h[1]*m,q[1]-h[0]*m]);g.push([q[0]+c[1]*m,q[1]-c[0]*m]);break;case p.GeometricEffectOffsetMethod.Rounded:if(1>A){g.push([q[0]+h[1]*m,q[1]-h[0]*m]);f=Math.floor(2.5*(1-A));if(0<f){u=A=1/f;for(let w=1;w<f;w++,
u+=A){const x=[h[1]*(1-u)+c[1]*u,-h[0]*(1-u)-c[0]*u];this.normalize(x);g.push([q[0]+x[0]*m,q[1]+x[1]*m])}}g.push([q[0]+c[1]*m,q[1]-c[0]*m])}break;default:0>u?(g.push([q[0]+(h[1]+h[0])*m,q[1]+(h[1]-h[0])*m]),g.push([q[0]+(c[1]-c[0])*m,q[1]-(c[0]+c[1])*m])):(f=Math.sqrt((1+Math.abs(A))/2),c=[c[0]-h[0],c[1]-h[1]],this.normalize(c),h=m/f,g.push([q[0]-c[0]*h,q[1]-c[1]*h]))}}else c=[q[0]-f[0],q[1]-f[1]],this.normalize(c),g.push([q[0]+c[1]*m,q[1]-c[0]*m]);else c=[t[0]-q[0],t[1]-q[1]],this.normalize(c),g.push([q[0]+
c[1]*m,q[1]-c[0]*m]);f=q;q=t}if(g.length<(b?3:2))return null;b&&g.push([g[0][0],g[0][1]]);return g}}k.CurveHelper=e;k.pixelTolerance=.03;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectBuffer":function(){define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../../../geometry/SpatialReference ../CIMEffects ../CurveHelper ../enums".split(" "),function(k,r,p,e,n,m,l){class d{static local(){null===d.instance&&(d.instance=
new d);return d.instance}execute(b,f,g,q,c,h,u){return new a(b,f,g,q,c,h,u)}}d.instance=null;class a{constructor(b,f,g,q,c,h,u){this._preventClipping=u;this._inputGeometries=b;this._tileKey=q;this._geometryEngine=c;this._curveHelper=new m.CurveHelper;this._size=(void 0!==f.size?f.size:1)*g;this._maxInflateSize=h*g;this._offsetFlattenError=m.pixelTolerance*g}next(){for(var b;b=this._inputGeometries.next();){if(0===this._size)return b;if("esriGeometryEnvelope"===b.geometryType)if(0<this._size){var f=
r.GeometryCursor.createEmptyOptimizedCIM(b.geometryType),g=p.collectMultipath(b)[0];if(g=this._curveHelper.offset(g,this._size,l.GeometricEffectOffsetMethod.Rounded,4,this._offsetFlattenError))return f.pushPath(g),f}else if(0>this._size&&(f=b.asJSON(),0<Math.min(f.xmax-f.xmin,f.ymax-f.ymin)+2*this._size))return r.GeometryCursor.fromJSONCIM({xmin:f.xmin-this._size,xmax:f.xmax+this._size,ymin:f.ymin-this._size,ymax:f.ymax+this._size});f=this._geometryEngine;if(null==f)break;if(b=!this._preventClipping&&
this._tileKey?n.clipCursorToTileExtent(b,this._maxInflateSize):b)return(b=f.buffer(e.WebMercator,b.asJSON(),this._size,1))?r.GeometryCursor.fromJSONCIM(b):null}return null}}k.EffectBuffer=d;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectControlMeasureLine":function(){define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../../../geometry/support/coordsUtils ../CIMCursor ../enums".split(" "),function(k,r,p,e,n,
m){class l{static local(){null===l.instance&&(l.instance=new l);return l.instance}execute(a,b,f,g,q){return new d(a,b,f)}}l.instance=null;class d{constructor(a,b,f){this._defaultPointSize=20;this._inputGeometries=a;this._geomUnitsPerPoint=f;this._rule=b.rule??m.GeometricEffectControlMeasureLineRule.FullGeometry;this._defaultSize=this._defaultPointSize*f}next(){for(var a;a=this._inputGeometries.next();)if(a=this._processGeom(p.collectMultipath(a)),a?.length)return r.GeometryCursor.fromJSONCIM({paths:a});
return null}_clone(a){return[a[0],a[1]]}_mid(a,b){return[(a[0]+b[0])/2,(a[1]+b[1])/2]}_mix(a,b,f,g){return[a[0]*b+f[0]*g,a[1]*b+f[1]*g]}_add(a,b){return[a[0]+b[0],a[1]+b[1]]}_add2(a,b,f){return[a[0]+b,a[1]+f]}_sub(a,b){return[a[0]-b[0],a[1]-b[1]]}_dist(a,b){return Math.sqrt((a[0]-b[0])*(a[0]-b[0])+(a[1]-b[1])*(a[1]-b[1]))}_norm(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}_normalize(a,b=1){b/=this._norm(a);a[0]*=b;a[1]*=b}_leftPerpendicular(a){const b=a[0];a[0]=-a[1];a[1]=b}_leftPerp(a){return[-a[1],
a[0]]}_rightPerpendicular(a){const b=-a[0];a[0]=a[1];a[1]=b}_rightPerp(a){return[a[1],-a[0]]}_dotProduct(a,b){return a[0]*b[0]+a[1]*b[1]}_crossProduct(a,b){return a[0]*b[1]-a[1]*b[0]}_rotateDirect(a,b,f){const g=a[0]*f+a[1]*b;a[0]=a[0]*b-a[1]*f;a[1]=g}_makeCtrlPt(a){a=[a[0],a[1]];n.setId(a,1);return a}_addAngledTicks(a,b,f,g){const q=this._sub(f,b);this._normalize(q);var c=this._crossProduct(q,this._sub(g,b));g=0<c?this._rightPerp(q):this._leftPerp(q);c=Math.abs(c)/2;const h=[];h.push([b[0]+(g[0]-
q[0])*c,b[1]+(g[1]-q[1])*c]);h.push(b);h.push(f);h.push([f[0]+(g[0]+q[0])*c,f[1]+(g[1]+q[1])*c]);a.push(h)}_addBezier2(a,b,f,g,q){if(0===q--)a.push(g);else{var c=this._mid(b,f);f=this._mid(f,g);var h=this._mid(c,f);this._addBezier2(a,b,c,h,q);this._addBezier2(a,h,f,g,q)}}_addBezier3(a,b,f,g,q,c){if(0===c--)a.push(q);else{var h=this._mid(b,f),u=this._mid(f,g);g=this._mid(g,q);f=this._mid(h,u);u=this._mid(u,g);var A=this._mid(f,u);this._addBezier3(a,b,h,f,A,c);this._addBezier3(a,A,u,g,q,c)}}_add90DegArc(a,
b,f,g,q){g=q??0<this._crossProduct(this._sub(f,b),this._sub(g,b));q=this._mid(b,f);const c=this._sub(q,b);g?this._leftPerpendicular(c):this._rightPerpendicular(c);q[0]+=c[0];q[1]+=c[1];this._addBezier3(a,b,this._mix(b,.33333,q,.66667),this._mix(f,.33333,q,.66667),f,4)}_addArrow(a,b,f){var g=b[0],q=b[1],c=b[b.length-1],h=this._sub(g,q),u=this._norm(h);this._normalize(h);const A=Math.abs(this._crossProduct(h,this._sub(c,q)));c=this._dotProduct(h,this._sub(c,q));c<.05*u?c=.05*u:c>.95*u&&(c=.95*u);u=
.5*A;var z=this._leftPerp(h);c=[q[0]+h[0]*c,q[1]+h[1]*c];var t=b.length-1;q=[];q.push(f?[-z[0],-z[1]]:z);var w=[-h[0],-h[1]];for(f=1;f<t-1;f++){h=this._sub(b[f+1],b[f]);this._normalize(h);var x=this._dotProduct(h,w);z=this._crossProduct(h,w);x=Math.sqrt((1+x)/2);w=this._sub(h,w);this._normalize(w);w[0]/=x;w[1]/=x;q.push(0>z?[-w[0],-w[1]]:w);w=h}q.push(this._rightPerp(w));for(t=q.length-1;0<t;t--)a.push([b[t][0]+q[t][0]*u,b[t][1]+q[t][1]*u]);a.push([c[0]+q[0][0]*u,c[1]+q[0][1]*u]);a.push([c[0]+q[0][0]*
A,c[1]+q[0][1]*A]);a.push(g);a.push([c[0]-q[0][0]*A,c[1]-q[0][1]*A]);a.push([c[0]-q[0][0]*u,c[1]-q[0][1]*u]);for(g=1;g<q.length;g++)a.push([b[g][0]-q[g][0]*u,b[g][1]-q[g][1]*u])}_addDash(a,b,f){const g=this._norm(f)/7;this._normalize(f);let q=[];for(let c=0;7>=c;c++)q.push([b[0]+f[0]*c*g,b[1]+f[1]*c*g]),c&1&&(a.push(q),q=[])}_cp2(a,b,f){return 2<=a.length?a[1]:this._add2(a[0],b*this._defaultSize,f*this._defaultSize)}_cp3(a,b,f,g){if(3<=a.length)return a[2];f=this._mix(a[0],1-f,b,f);a=this._sub(b,
a[0]);this._normalize(a);this._rightPerpendicular(a);return[f[0]+a[0]*g*this._defaultSize,f[1]+a[1]*g*this._defaultSize]}_arrowPath(a){if(2<a.length)return a;const b=a[0];a=this._cp2(a,-4,0);const f=this._sub(b,a);this._normalize(f);const g=this._rightPerp(f);return[b,a,[b[0]+(g[0]-f[0])*this._defaultSize,b[1]+(g[1]-f[1])*this._defaultSize]]}_arrowLastSeg(a){var b=a[0];const f=this._cp2(a,-4,0);if(3<=a.length)b=a[a.length-1];else{a=this._sub(b,f);this._normalize(a);const g=this._rightPerp(a);b=[b[0]+
(g[0]-a[0])*this._defaultSize,b[1]+(g[1]-a[1])*this._defaultSize]}return[f,b]}_processGeom(a){if(!a)return null;const b=[];for(const f of a){const g=1<f.length&&e.getPathLength(f)<this._defaultSize;if(!f||0===f.length||g)continue;const q=f.length;let c=f[0];switch(this._rule){case m.GeometricEffectControlMeasureLineRule.PerpendicularFromFirstSegment:const h=this._cp2(f,0,-1),u=this._cp3(f,h,.5,4),A=[];A.push(u);A.push(this._mid(c,h));b.push(A);break;case m.GeometricEffectControlMeasureLineRule.ReversedFirstSegment:const z=
this._cp2(f,0,-1);b.push([z,c]);break;case m.GeometricEffectControlMeasureLineRule.PerpendicularToSecondSegment:if(3>f.length)return[];const t=this._cp2(f,-4,1),w=this._cp3(f,t,.882353,-1.94),x=[];x.push(this._mid(t,w));x.push(c);b.push(x);break;case m.GeometricEffectControlMeasureLineRule.SecondSegmentWithTicks:if(3>f.length)return[];const B=this._cp2(f,-4,1),C=this._cp3(f,B,.882353,-1.94),y=this._sub(C,B);let v;v=0<this._crossProduct(y,this._sub(c,B))?this._rightPerp(y):this._leftPerp(y);const F=
[];F.push([B[0]+(v[0]-y[0])/3,B[1]+(v[1]-y[1])/3]);F.push(B);F.push(C);F.push([C[0]+(v[0]+y[0])/3,C[1]+(v[1]+y[1])/3]);b.push(F);break;case m.GeometricEffectControlMeasureLineRule.DoublePerpendicular:const D=this._cp2(f,0,-1),G=this._cp3(f,D,.5,3),E=this._mid(c,D),H=this._sub(E,G);this._normalize(H);const K=this._crossProduct(H,this._sub(c,G));this._leftPerpendicular(H);const J=[];J.push(c);J.push([G[0]+H[0]*K,G[1]+H[1]*K]);b.push(J);const L=[];L.push([G[0]-H[0]*K,G[1]-H[1]*K]);L.push(D);b.push(L);
break;case m.GeometricEffectControlMeasureLineRule.OppositeToFirstSegment:const P=this._cp2(f,0,-1),Q=this._cp3(f,P,.5,3),S=this._mid(c,P),U=this._sub(S,Q);this._normalize(U);const X=this._crossProduct(U,this._sub(c,Q));this._leftPerpendicular(U);const aa=[];aa.push([Q[0]+U[0]*X,Q[1]+U[1]*X]);aa.push([Q[0]-U[0]*X,Q[1]-U[1]*X]);b.push(aa);break;case m.GeometricEffectControlMeasureLineRule.TriplePerpendicular:const ba=this._cp2(f,0,-1),fa=this._cp3(f,ba,.5,4),I=this._mid(c,ba),M=this._sub(I,fa);this._normalize(M);
const N=this._crossProduct(M,this._sub(c,fa));this._leftPerpendicular(M);const R=[];R.push([fa[0]+M[0]*N*.8,fa[1]+M[1]*N*.8]);R.push([I[0]+.8*(c[0]-I[0]),I[1]+.8*(c[1]-I[1])]);b.push(R);b.push([fa,I]);const T=[];T.push([fa[0]-M[0]*N*.8,fa[1]-M[1]*N*.8]);T.push([I[0]+.8*(ba[0]-I[0]),I[1]+.8*(ba[1]-I[1])]);b.push(T);break;case m.GeometricEffectControlMeasureLineRule.HalfCircleFirstSegment:const W=this._cp2(f,0,-1),Y=this._cp3(f,W,.5,4),Z=this._mid(c,W);let da=this._sub(W,c);const ca=Math.cos(Math.PI/
18),ja=Math.sin(Math.PI/18),ha=Math.sqrt((1+ca)/2),ka=Math.sqrt((1-ca)/2),ia=[];let na;0<this._crossProduct(da,this._sub(Y,c))?(ia.push(c),da=this._sub(c,Z),na=W):(ia.push(W),da=this._sub(W,Z),na=c);this._rotateDirect(da,ha,ka);da[0]/=ha;da[1]/=ha;for(let oa=1;18>=oa;oa++)ia.push(this._add(Z,da)),this._rotateDirect(da,ca,ja);ia.push(na);b.push(ia);break;case m.GeometricEffectControlMeasureLineRule.HalfCircleSecondSegment:const ma=this._cp2(f,0,-1),qa=this._cp3(f,ma,1,-1);let ra=this._sub(c,ma);this._normalize(ra);
const ta=this._crossProduct(ra,this._sub(qa,ma))/2;this._leftPerpendicular(ra);const Ha=[ma[0]+ra[0]*ta,ma[1]+ra[1]*ta];ra=this._sub(ma,Ha);const xa=Math.cos(Math.PI/18);let O=Math.sin(Math.PI/18);0<ta&&(O=-O);const V=[ma];for(let oa=1;18>=oa;oa++)this._rotateDirect(ra,xa,O),V.push(this._add(Ha,ra));b.push(V);break;case m.GeometricEffectControlMeasureLineRule.HalfCircleExtended:const ea=this._cp2(f,0,-2),la=this._cp3(f,ea,1,-1);let pa;if(4<=q)pa=f[3];else{const oa=this._sub(c,ea);pa=this._add(la,
oa)}const va=this._dist(ea,la)/2/.75,Ga=this._sub(ea,c);this._normalize(Ga,va);const Ka=this._sub(la,pa);this._normalize(Ka,va);b.push([pa,la]);const Ra=[this._clone(la)];this._addBezier3(Ra,la,this._add(la,Ka),this._add(ea,Ga),ea,4);Ra.push(c);b.push(Ra);break;case m.GeometricEffectControlMeasureLineRule.OpenCircle:const Ia=this._cp2(f,-2,0),ab=this._sub(Ia,c),Sa=Math.cos(Math.PI/18),yb=-Math.sin(Math.PI/18),La=[Ia];for(let oa=1;33>=oa;oa++)this._rotateDirect(ab,Sa,yb),La.push(this._add(c,ab));b.push(La);
break;case m.GeometricEffectControlMeasureLineRule.CoverageEdgesWithTicks:const Ca=this._cp2(f,0,-1);let Qa;if(3<=q)Qa=f[2];else{const oa=this._sub(Ca,c),ua=this._leftPerp(oa);Qa=[c[0]+ua[0]-.25*oa[0],c[1]+ua[1]-.25*oa[1]]}let zb;if(4<=q)zb=f[3];else{const oa=this._mid(c,Ca),ua=this._sub(c,Ca);this._normalize(ua);this._leftPerpendicular(ua);const ya=this._crossProduct(ua,this._sub(Qa,oa));this._rightPerpendicular(ua);zb=[Qa[0]+ua[0]*ya*2,Qa[1]+ua[1]*ya*2]}const bb=this._sub(Ca,c);let Mb,cb;Mb=0<this._crossProduct(bb,
this._sub(Qa,c))?this._rightPerp(bb):this._leftPerp(bb);cb=[];cb.push(Qa);cb.push(c);cb.push([c[0]+(Mb[0]-bb[0])/3,c[1]+(Mb[1]-bb[1])/3]);b.push(cb);Mb=0<this._crossProduct(bb,this._sub(zb,Ca))?this._rightPerp(bb):this._leftPerp(bb);cb=[];cb.push([Ca[0]+(Mb[0]+bb[0])/3,Ca[1]+(Mb[1]+bb[1])/3]);cb.push(Ca);cb.push(zb);b.push(cb);break;case m.GeometricEffectControlMeasureLineRule.GapExtentWithDoubleTicks:const tc=this._cp2(f,0,2),Xc=this._cp3(f,tc,0,1);let uc;if(4<=q)uc=f[3];else{const oa=this._sub(tc,
c);uc=this._add(Xc,oa)}this._addAngledTicks(b,c,tc,this._mid(Xc,uc));this._addAngledTicks(b,Xc,uc,this._mid(c,tc));break;case m.GeometricEffectControlMeasureLineRule.GapExtentMidline:const Yc=this._cp2(f,2,0),yd=this._cp3(f,Yc,0,1);let Zc;if(4<=q)Zc=f[3];else{const oa=this._sub(Yc,c);Zc=this._add(yd,oa)}const $c=[];$c.push(this._mid(c,yd));$c.push(this._mid(Yc,Zc));b.push($c);break;case m.GeometricEffectControlMeasureLineRule.Chevron:const zd=this._cp2(f,-1,-1);let ad;if(3<=q)ad=f[2];else{const oa=
this._sub(zd,c);this._leftPerpendicular(oa);ad=this._add(c,oa)}b.push([zd,this._makeCtrlPt(c),ad]);break;case m.GeometricEffectControlMeasureLineRule.PerpendicularWithArc:const Nb=this._cp2(f,0,-2),Ad=this._cp3(f,Nb,.5,-1),Ja=this._sub(Nb,c),db=this._norm(Ja);Ja[0]/=db;Ja[1]/=db;const Ab=this._crossProduct(Ja,this._sub(Ad,c));let Ob=this._dotProduct(Ja,this._sub(Ad,c));Ob<.05*db?Ob=.05*db:Ob>.95*db&&(Ob=.95*db);const vc=[c[0]+Ja[0]*Ob,c[1]+Ja[1]*Ob];let Ma=this._leftPerp(Ja),Pb=[];Pb.push([vc[0]-
Ma[0]*Ab,vc[1]-Ma[1]*Ab]);Pb.push([vc[0]+Ma[0]*Ab,vc[1]+Ma[1]*Ab]);b.push(Pb);if(4<=q){const oa=f[3];let ua=this._dotProduct(Ja,this._sub(oa,c));ua<.1*db?ua=.1*db:ua>.9*db&&(ua=.9*db);const ya=[c[0]+Ja[0]*ua,c[1]+Ja[1]*ua],Na=this._crossProduct(Ja,this._sub(oa,c)),bd=[];bd.push([ya[0]-Ma[0]*Na,ya[1]-Ma[1]*Na]);bd.push([ya[0]+Ma[0]*Na,ya[1]+Ma[1]*Na]);b.push(bd)}const Bd=[Nb[0]+Ma[0]*Ab,Nb[1]+Ma[1]*Ab];Ma=this._sub(Nb,Bd);const ge=Math.cos(Math.PI/18);let cd=Math.sin(Math.PI/18);0>Ab&&(cd=-cd);Pb=
[c,Nb];for(let oa=1;9>=oa;oa++)this._rotateDirect(Ma,ge,cd),Pb.push(this._add(Bd,Ma));b.push(Pb);break;case m.GeometricEffectControlMeasureLineRule.ClosedHalfCircle:const dd=this._cp2(f,2,0),Cd=this._mid(c,dd),Dd=this._sub(dd,Cd),he=Math.cos(Math.PI/18),ie=Math.sin(Math.PI/18),Ed=[c,dd];for(let oa=1;18>=oa;oa++)this._rotateDirect(Dd,he,ie),Ed.push(this._add(Cd,Dd));b.push(Ed);break;case m.GeometricEffectControlMeasureLineRule.TripleParallelExtended:const Bb=this._cp2(f,0,-2),ed=this._cp3(f,Bb,1,-2),
Cb=this._mid(c,Bb),eb=this._sub(ed,Bb);this._normalize(eb);const Fd=Math.abs(this._crossProduct(eb,this._sub(Cb,Bb)))/2,Qb=this._dist(Bb,ed),Gd=[Bb,c];Gd.push([c[0]+eb[0]*Qb*.5,c[1]+eb[1]*Qb*.5]);b.push(Gd);const Rb=[];Rb.push([Cb[0]-eb[0]*Fd,Cb[1]-eb[1]*Fd]);Rb.push([Cb[0]+eb[0]*Qb*.375,Cb[1]+eb[1]*Qb*.375]);n.setId(Rb[Rb.length-1],1);Rb.push([Cb[0]+eb[0]*Qb*.75,Cb[1]+eb[1]*Qb*.75]);b.push(Rb);b.push([Bb,ed]);break;case m.GeometricEffectControlMeasureLineRule.ParallelWithTicks:const cc=this._cp2(f,
3,0),fd=this._cp3(f,cc,.5,-1),dc=this._sub(fd,cc);this._normalize(dc);const Hd=this._crossProduct(dc,this._sub(fd,c));this._leftPerpendicular(dc);this._addAngledTicks(b,c,cc,fd);this._addAngledTicks(b,this._mix(c,1,dc,Hd),this._mix(cc,1,dc,Hd),this._mid(c,cc));break;case m.GeometricEffectControlMeasureLineRule.Parallel:const ec=this._cp2(f,3,0),je=this._cp3(f,ec,.5,-1),gd=this._sub(ec,c);this._normalize(gd);const wc=this._leftPerp(gd),xc=this._crossProduct(gd,this._sub(je,c));let fc=[c,ec];b.push(fc);
fc=[];fc.push([c[0]+wc[0]*xc,c[1]+wc[1]*xc]);fc.push([ec[0]+wc[0]*xc,ec[1]+wc[1]*xc]);b.push(fc);break;case m.GeometricEffectControlMeasureLineRule.PerpendicularToFirstSegment:const hd=this._cp2(f,3,0),ke=this._cp3(f,hd,.5,-1),yc=this._mid(c,hd),Db=this._sub(hd,c);this._normalize(Db);const zc=this._crossProduct(Db,this._sub(ke,c));this._leftPerpendicular(Db);const id=[];id.push([yc[0]-Db[0]*zc*.25,yc[1]-Db[1]*zc*.25]);id.push([yc[0]+Db[0]*zc*1.25,yc[1]+Db[1]*zc*1.25]);b.push(id);break;case m.GeometricEffectControlMeasureLineRule.ParallelOffset:const Sb=
this._cp2(f,3,0),le=this._cp3(f,Sb,.5,-1),Ta=this._sub(Sb,c);this._normalize(Ta);const ob=this._crossProduct(Ta,this._sub(le,c));this._leftPerpendicular(Ta);const jd=[];jd.push([c[0]-Ta[0]*ob,c[1]-Ta[1]*ob]);jd.push([Sb[0]-Ta[0]*ob,Sb[1]-Ta[1]*ob]);b.push(jd);const kd=[];kd.push([c[0]+Ta[0]*ob,c[1]+Ta[1]*ob]);kd.push([Sb[0]+Ta[0]*ob,Sb[1]+Ta[1]*ob]);b.push(kd);break;case m.GeometricEffectControlMeasureLineRule.OffsetOpposite:const Ac=this._cp2(f,3,0),me=this._cp3(f,Ac,.5,-1),Eb=this._sub(Ac,c);this._normalize(Eb);
const Bc=this._crossProduct(Eb,this._sub(me,c));this._leftPerpendicular(Eb);const ld=[];ld.push([c[0]-Eb[0]*Bc,c[1]-Eb[1]*Bc]);ld.push([Ac[0]-Eb[0]*Bc,Ac[1]-Eb[1]*Bc]);b.push(ld);break;case m.GeometricEffectControlMeasureLineRule.OffsetSame:const Cc=this._cp2(f,3,0),ne=this._cp3(f,Cc,.5,-1),Fb=this._sub(Cc,c);this._normalize(Fb);const Dc=this._crossProduct(Fb,this._sub(ne,c));this._leftPerpendicular(Fb);const md=[];md.push([c[0]+Fb[0]*Dc,c[1]+Fb[1]*Dc]);md.push([Cc[0]+Fb[0]*Dc,Cc[1]+Fb[1]*Dc]);b.push(md);
break;case m.GeometricEffectControlMeasureLineRule.CircleWithArc:let pb=this._cp2(f,3,0);const nd=this._cp3(f,pb,.5,-1);let Tb,Ec;if(4<=q)Tb=f[3],Ec=0<this._crossProduct(this._sub(Tb,pb),this._sub(nd,pb));else{Tb=pb;Ec=0<this._crossProduct(this._sub(Tb,c),this._sub(nd,c));const oa=24*this._geomUnitsPerPoint,ua=this._sub(Tb,c);this._normalize(ua,oa);const ya=Math.sqrt(2)/2;this._rotateDirect(ua,ya,Ec?ya:-ya);pb=this._add(c,ua)}const Id=this._sub(pb,c),oe=Math.cos(Math.PI/18),pe=Math.sin(Math.PI/18),
gc=[pb];for(let oa=1;36>=oa;oa++)this._rotateDirect(Id,oe,pe),gc.push(this._add(c,Id));this._add90DegArc(gc,pb,Tb,nd,Ec);n.setId(gc[gc.length-8],1);b.push(gc);break;case m.GeometricEffectControlMeasureLineRule.DoubleJog:let qb=this._cp2(f,-3,1),Gb=this._cp3(f,qb,-1,-.5),jb;if(4<=q)jb=f[3];else{const oa=c;c=qb;jb=Gb;const ua=this._dist(c,oa),ya=this._dist(jb,oa);let Na=30*this._geomUnitsPerPoint;.5*ua<Na&&(Na=.5*ua);.5*ya<Na&&(Na=.5*ya);qb=this._mix(c,Na/ua,oa,(ua-Na)/ua);Gb=this._mix(jb,Na/ya,oa,
(ya-Na)/ya)}const Jd=this._mid(c,qb),Kd=this._mid(jb,Gb),qe=this._dist(c,qb),re=this._dist(Gb,jb);let Fc=Math.min(qe,re)/8;Fc=Math.min(Fc,24*this._geomUnitsPerPoint);const rb=Math.cos(Math.PI/4);let Oa=this._sub(c,qb);this._normalize(Oa,Fc);0<this._crossProduct(Oa,this._sub(jb,qb))?this._rotateDirect(Oa,rb,-rb):this._rotateDirect(Oa,rb,rb);let Ua=[];Ua.push(qb);Ua.push(this._add(Jd,Oa));Ua.push(this._sub(Jd,Oa));Ua.push(c);b.push(Ua);Oa=this._sub(jb,Gb);this._normalize(Oa,Fc);0>this._crossProduct(Oa,
this._sub(c,Gb))?this._rotateDirect(Oa,rb,rb):this._rotateDirect(Oa,rb,-rb);Ua=[];Ua.push(Gb);Ua.push(this._add(Kd,Oa));Ua.push(this._sub(Kd,Oa));Ua.push(jb);b.push(Ua);break;case m.GeometricEffectControlMeasureLineRule.PerpendicularOffset:const Gc=this._cp2(f,-4,1),Ld=this._cp3(f,Gc,.882353,-1.94),hc=this._sub(Ld,Gc);0<this._crossProduct(hc,this._sub(c,Gc))?this._rightPerpendicular(hc):this._leftPerpendicular(hc);const se=[hc[0]/8,hc[1]/8],te=this._sub(this._mid(Gc,Ld),se);b.push([te,c]);break;case m.GeometricEffectControlMeasureLineRule.LineExcludingLastSegment:const Md=
this._arrowPath(f),Nd=[];let Od=Md.length-2;for(;Od--;)Nd.push(Md[Od]);b.push(Nd);break;case m.GeometricEffectControlMeasureLineRule.MultivertexArrow:const ue=this._arrowPath(f),Pd=[];this._addArrow(Pd,ue,!1);b.push(Pd);break;case m.GeometricEffectControlMeasureLineRule.CrossedArrow:const ve=this._arrowPath(f),Qd=[];this._addArrow(Qd,ve,!0);b.push(Qd);break;case m.GeometricEffectControlMeasureLineRule.ChevronArrow:const [ic,Rd]=this._arrowLastSeg(f),Ub=10*this._geomUnitsPerPoint,Va=this._sub(c,ic),
Hc=this._norm(Va);this._normalize(Va);const Ic=this._crossProduct(Va,this._sub(Rd,ic));let Vb=this._dotProduct(Va,this._sub(Rd,ic));Vb<.05*Hc?Vb=.05*Hc:Vb>.95*Hc-Ub&&(Vb=.95*Hc-Ub);const Jc=[ic[0]+Va[0]*Vb,ic[1]+Va[1]*Vb],Kc=this._leftPerp(Va),Lc=[];Lc.push([Jc[0]+Kc[0]*Ic+Va[0]*Ub,Jc[1]+Kc[1]*Ic+Va[1]*Ub]);Lc.push(c);Lc.push([Jc[0]-Kc[0]*Ic+Va[0]*Ub,Jc[1]-Kc[1]*Ic+Va[1]*Ub]);b.push(Lc);break;case m.GeometricEffectControlMeasureLineRule.ChevronArrowOffset:const [jc,Sd]=this._arrowLastSeg(f),Wa=this._sub(c,
jc),Mc=this._norm(Wa);this._normalize(Wa);const Nc=this._crossProduct(Wa,this._sub(Sd,jc));let Wb=this._dotProduct(Wa,this._sub(Sd,jc));Wb<.05*Mc?Wb=.05*Mc:Wb>.95*Mc&&(Wb=.95*Mc);const kc=[jc[0]+Wa[0]*Wb,jc[1]+Wa[1]*Wb];this._leftPerpendicular(Wa);const Oc=[];Oc.push([kc[0]+Wa[0]*Nc*.5,kc[1]+Wa[1]*Nc*.5]);Oc.push(this._mid(kc,c));Oc.push([kc[0]-Wa[0]*Nc*.5,kc[1]-Wa[1]*Nc*.5]);b.push(Oc);break;case m.GeometricEffectControlMeasureLineRule.PartialFirstSegment:const [lc,we]=this._arrowLastSeg(f),mc=this._sub(c,
lc),Pc=this._norm(mc);this._normalize(mc);let Xb=this._dotProduct(mc,this._sub(we,lc));Xb<.05*Pc?Xb=.05*Pc:Xb>.95*Pc&&(Xb=.95*Pc);b.push([lc,[lc[0]+mc[0]*Xb,lc[1]+mc[1]*Xb]]);break;case m.GeometricEffectControlMeasureLineRule.Arch:const od=this._cp2(f,0,-1),Qc=this._cp3(f,od,.5,1),Td=this._sub(c,od),xe=this._mix(Qc,1,Td,.55),ye=this._mix(Qc,1,Td,-.55),pd=[c];this._addBezier2(pd,c,xe,Qc,4);this._addBezier2(pd,Qc,ye,od,4);b.push(pd);break;case m.GeometricEffectControlMeasureLineRule.CurvedParallelTicks:const sb=
this._cp2(f,-4,1),nc=this._cp3(f,sb,.882353,-1.94),Hb=this._sub(nc,sb);0<this._crossProduct(Hb,this._sub(c,sb))?this._rightPerpendicular(Hb):this._leftPerpendicular(Hb);const qd=[Hb[0]/8,Hb[1]/8],Ud=this._sub(this._mid(sb,nc),qd),ze=this._sub(this._mix(sb,.75,nc,.25),qd),Ae=this._sub(this._mix(sb,.25,nc,.75),qd),Rc=[sb];this._addBezier2(Rc,sb,ze,Ud,3);this._addBezier2(Rc,Ud,Ae,nc,3);b.push(Rc);for(let oa=0;8>oa;oa++){const ua=Rc[2*oa+1],ya=[this._clone(ua)];ya.push(this._add(ua,[Hb[0]/4,Hb[1]/4]));
b.push(ya)}break;case m.GeometricEffectControlMeasureLineRule.Arc90Degrees:const rd=this._cp2(f,0,-1),Be=this._cp3(f,rd,.5,1),Vd=[rd];this._add90DegArc(Vd,rd,c,Be);b.push(Vd);break;case m.GeometricEffectControlMeasureLineRule.TipWithPerpendicularAndTicks:const [sd,Wd]=this._arrowLastSeg(f),Yb=10*this._geomUnitsPerPoint,Xa=this._sub(c,sd),oc=this._norm(Xa);this._normalize(Xa);let fb=this._crossProduct(Xa,this._sub(Wd,sd)),pc=this._dotProduct(Xa,this._sub(Wd,sd));pc<.05*oc?pc=.05*oc:pc>.95*oc-Yb&&(pc=
.95*oc-Yb);const tb=this._leftPerp(Xa),kb=[c[0]-Xa[0]*Yb,c[1]-Xa[1]*Yb],ub=.5*Math.max(oc-pc-Yb,Yb);fb=Math.abs(fb);const qc=[];qc.push([kb[0]+tb[0]*(fb+ub)-Xa[0]*ub,kb[1]+tb[1]*(fb+ub)-Xa[1]*ub]);qc.push([kb[0]+tb[0]*fb,kb[1]+tb[1]*fb]);qc.push([kb[0]-tb[0]*fb,kb[1]-tb[1]*fb]);qc.push([kb[0]-tb[0]*(fb+ub)-Xa[0]*ub,kb[1]-tb[1]*(fb+ub)-Xa[1]*ub]);b.push(qc);b.push([kb,c]);break;case m.GeometricEffectControlMeasureLineRule.ConcentricCircles:const Xd=this._cp2(f,1,0),Ce=this._cp3(f,Xd,2,0),td=Math.cos(Math.PI/
18),ud=Math.sin(Math.PI/18);let rc=this._dist(Xd,c),lb=[rc,0],gb=[];for(let oa=0;36>=oa;oa++)gb.push(this._add(c,lb)),this._rotateDirect(lb,td,ud);b.push(gb);if(4<=q){gb=[];rc=this._dist(f[3],c);lb=[rc,0];for(let oa=0;36>=oa;oa++)gb.push(this._add(c,lb)),0===oa&&(gb.push(this._add(c,lb)),n.setId(gb[1],1)),this._rotateDirect(lb,td,ud);b.push(gb)}gb=[];rc=this._dist(Ce,c);lb=[rc,0];for(let oa=0;36>=oa;oa++)gb.push(this._add(c,lb)),this._rotateDirect(lb,td,ud);b.push(gb);break;case m.GeometricEffectControlMeasureLineRule.DoubleJogArrow:c=
this._arrowPath(f)[0];const [De,Yd]=this._arrowLastSeg(f),Aa=this._sub(c,De),Sc=this._norm(Aa);this._normalize(Aa);const sc=Math.abs(this._crossProduct(Aa,this._sub(Yd,c)));let mb=Math.abs(this._dotProduct(Aa,this._sub(Yd,c)));mb<.05*Sc?mb=.05*Sc:mb>.95*Sc&&(mb=.95*Sc);const za=Math.max(sc,mb),Da=this._leftPerp(Aa);let Ya=[];const sa=[c[0]-Aa[0]*mb*.5+Da[0]*sc*.5,c[1]-Aa[1]*mb*.5+Da[1]*sc*.5];Ya.push([sa[0],sa[1]]);sa[0]+=Aa[0]*za*.5+Da[0]*za*.4;sa[1]+=Aa[1]*za*.5+Da[1]*za*.4;Ya.push([sa[0],sa[1]]);
sa[0]-=Da[0]*za*.25;sa[1]-=Da[1]*za*.25;Ya.push([sa[0],sa[1]]);sa[0]+=Aa[0]*za*.5+Da[0]*za*.4;sa[1]+=Aa[1]*za*.5+Da[1]*za*.4;Ya.push([sa[0],sa[1]]);b.push(Ya);Ya=[];sa[0]=c[0]-Aa[0]*mb*.5-Da[0]*sc*.5;sa[1]=c[1]-Aa[1]*mb*.5-Da[1]*sc*.5;Ya.push([sa[0],sa[1]]);sa[0]+=Aa[0]*za*.5-Da[0]*za*.4;sa[1]+=Aa[1]*za*.5-Da[1]*za*.4;Ya.push([sa[0],sa[1]]);sa[0]+=Da[0]*za*.25;sa[1]+=Da[1]*za*.25;Ya.push([sa[0],sa[1]]);sa[0]+=Aa[0]*za*.5-Da[0]*za*.4;sa[1]+=Aa[1]*za*.5-Da[1]*za*.4;Ya.push([sa[0],sa[1]]);b.push(Ya);
break;case m.GeometricEffectControlMeasureLineRule.LinkedChevrons:const Zb=this._cp2(f,-5,0),Ee=this._cp3(f,Zb,-.2,1),Za=this._sub(c,Zb);this._normalize(Za);const vb=this._leftPerp(Za),Ea=Math.abs(this._crossProduct(Za,this._sub(Ee,Zb)));b.push([Zb,c]);const Tc=[];Tc.push([c[0]-Za[0]*Ea+vb[0]*Ea,c[1]-Za[1]*Ea+vb[1]*Ea]);Tc.push(c);Tc.push([c[0]-Za[0]*Ea-vb[0]*Ea,c[1]-Za[1]*Ea-vb[1]*Ea]);b.push(Tc);this._addDash(b,Zb,[-Za[0]*Ea+vb[0]*Ea,-Za[1]*Ea+vb[1]*Ea]);this._addDash(b,Zb,[-Za[0]*Ea-vb[0]*Ea,-Za[1]*
Ea-vb[1]*Ea]);break;case m.GeometricEffectControlMeasureLineRule.SegmentThenHalfCircle:const $b=this._cp2(f,2,0),Fe=this._cp3(f,$b,1.5,0);let Zd;Zd=4<=q?f[3]:this._cp3(f,$b,1.25,-.5);const Pa=this._sub($b,c);this._normalize(Pa);const $d=.5*this._dist($b,Fe),Ge=0<this._crossProduct(Pa,this._sub(Zd,c)),He=Math.cos(Math.PI/18);let vd=Math.sin(Math.PI/18);Ge&&(vd=-vd);const ae=[c,$b];Pa[0]*=$d;Pa[1]*=$d;const Ie=this._add($b,Pa);Pa[0]=-Pa[0];Pa[1]=-Pa[1];for(let oa=1;18>=oa;oa++)this._rotateDirect(Pa,
He,vd),ae.push(this._add(Ie,Pa));b.push(ae);break;case m.GeometricEffectControlMeasureLineRule.LineWithStraightTicks:const Uc=this._cp2(f,-2,1),wd=this._cp3(f,Uc,-1,-.5),Ib=this._sub(wd,Uc);this._normalize(Ib);const be=this._dotProduct(Ib,this._sub(Uc,c)),ce=this._dotProduct(Ib,this._sub(wd,c));let Jb=[c];Jb.push([c[0]+Ib[0]*be,c[1]+Ib[1]*be]);Jb.push(Uc);b.push(Jb);Jb=[c];Jb.push([c[0]+Ib[0]*ce,c[1]+Ib[1]*ce]);Jb.push(wd);b.push(Jb);break;case m.GeometricEffectControlMeasureLineRule.DoubleCurve:const Kb=
this._cp2(f,-5,-1),Lb=this._cp3(f,Kb,2,0),de=Math.atan2(1,5),ee=Math.cos(de),fe=Math.sin(de),wb=this._sub(Kb,c),ac=this._dist(c,Kb);this._normalize(wb);this._rotateDirect(wb,ee,-fe);const xb=[c];xb.push([c[0]+wb[0]*ac*.5,c[1]+wb[1]*ac*.5]);n.setId(xb[1],1);xb.push([c[0]+wb[0]*ac*.8,c[1]+wb[1]*ac*.8]);this._addBezier2(xb,xb[2],[c[0]+wb[0]*ac,c[1]+wb[1]*ac],Kb,3);const bc=this._sub(Lb,Kb),Vc=this._dist(Kb,Lb);this._normalize(bc);this._rotateDirect(bc,ee,-fe);this._addBezier2(xb,Kb,[Lb[0]-bc[0]*Vc,Lb[1]-
bc[1]*Vc],[Lb[0]-bc[0]*Vc*.8,Lb[1]-bc[1]*Vc*.8],3);xb.push(Lb);b.push(xb);break;case m.GeometricEffectControlMeasureLineRule.ParallelWithTicksByWidth:const hb=this._cp2(f,0,-1),Je=this._cp3(f,hb,.5,3),$a=this._sub(hb,c);this._normalize($a);const nb=this._crossProduct($a,this._sub(Je,c));this._leftPerpendicular($a);0<nb?(this._addAngledTicks(b,c,[c[0]+$a[0]*nb,c[1]+$a[1]*nb],hb),this._addAngledTicks(b,hb,[hb[0]+$a[0]*nb,hb[1]+$a[1]*nb],c)):(this._addAngledTicks(b,[c[0]+$a[0]*nb,c[1]+$a[1]*nb],c,hb),
this._addAngledTicks(b,[hb[0]+$a[0]*nb,hb[1]+$a[1]*nb],c,hb));break;case m.GeometricEffectControlMeasureLineRule.EnclosingRoundedRectangle:const Wc=this._cp2(f,3,-2),wa=[Math.min(c[0],Wc[0]),Math.max(c[1],Wc[1])],Ba=[Math.max(c[0],Wc[0]),Math.min(c[1],Wc[1])],xd=Ba[0]-wa[0],Fa=Math.min(xd,wa[1]-Ba[1])/10,ib=[];ib.push([wa[0]+Fa+.75*(xd-2*Fa),wa[1]]);ib.push([Ba[0]-Fa,wa[1]]);this._add90DegArc(ib,[Ba[0]-Fa,wa[1]],[Ba[0],wa[1]-Fa],[Ba[0],wa[1]]);ib.push([Ba[0],Ba[1]+Fa]);this._add90DegArc(ib,[Ba[0],
Ba[1]+Fa],[Ba[0]-Fa,Ba[1]],Ba);ib.push([wa[0]+Fa,Ba[1]]);this._add90DegArc(ib,[wa[0]+Fa,Ba[1]],[wa[0],Ba[1]+Fa],[wa[0],Ba[1]]);ib.push([wa[0],wa[1]-Fa]);this._add90DegArc(ib,[wa[0],wa[1]-Fa],[wa[0]+Fa,wa[1]],wa);ib.push([wa[0]+Fa+.75*(xd-2*Fa),wa[1]]);break;default:b.push(f)}}return b}}k.EffectControlMeasureLine=l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectCut":function(){define(["exports","../../../geometry/GeometryCursor","../CIMCursor","../CurveHelper"],
function(k,r,p,e){class n{static local(){null===n.instance&&(n.instance=new n);return n.instance}execute(l,d,a,b,f){return new m(l,d,a)}}n.instance=null;class m extends p.PathEffectCursor{constructor(l,d,a){super(l,!0,!0);this._curveHelper=new e.CurveHelper;this._beginCut=(void 0!==d.beginCut?d.beginCut:1)*a;this._endCut=(void 0!==d.endCut?d.endCut:1)*a;this._middleCut=(void 0!==d.middleCut?d.middleCut:0)*a;this._invert=void 0!==d.invert?d.invert:!1;0>this._beginCut&&(this._beginCut=0);0>this._endCut&&
(this._endCut=0);0>this._middleCut&&(this._middleCut=0)}processPath(l){const {_beginCut:d,_endCut:a,_middleCut:b}=this,f=l.pathLength(),g=r.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");if(!this._invert)if(0===d&&0===a&&0===b)for(g.startPath();l.nextPoint();)g.pushXY(l.x,l.y);else d+a+b<f&&(0===b?this._curveHelper.appendSubCurve(g,l,d,f-a):(this._curveHelper.appendSubCurve(g,l,d,.5*(f-b)),this._curveHelper.appendSubCurve(g,l,.5*(f+b),f-a)));else if(0!==d||0!==a||0!==b)if(d+a+b>=f)for(g.startPath();l.nextPoint();)g.pushXY(l.x,
l.y);else this._curveHelper.appendSubCurve(g,l,0,d),this._curveHelper.appendSubCurve(g,l,.5*(f-b),.5*(f+b)),this._curveHelper.appendSubCurve(g,l,f-a,a);return 0===g.totalSize?null:g}}k.EffectCut=n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectDashes":function(){define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMCursor ../enums ../GeometryWalker ../utils".split(" "),function(k,r,p,e,n,m,l){class d{static local(){null===
d.instance&&(d.instance=new d);return d.instance}execute(b,f,g,q,c){return new a(b,f,g)}}d.instance=null;class a extends e.PathEffectCursor{constructor(b,f,g){super(b,!0,!0);this._firstCurve=null;this._walker=new m.GeometryWalker;this._walker.updateTolerance(g);this._endings=f.lineDashEnding;this._customDashPos=-(f.offsetAlongLine??0)*g;this._offsetAtEnd=(f.customEndingOffset??0)*g;b=l.normalizeDashEffectTemplate(f).dashTemplate;null==b&&(b=[]);b.length%2&&(b=[...b,...b]);this._pattern=new m.DashPattern;
this._pattern.init(b,!0);this._pattern.scale(g)}processPath(b){if(0===this._pattern.length())return this.iteratePath=!1,b=p.collectPath(b),r.GeometryCursor.fromJSONCIM({paths:[b]});if(!this.iteratePath){var f=!0;switch(this._endings){default:this._pattern.extPtGap=0;break;case n.LineDashEnding.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case n.LineDashEnding.FullGap:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case n.LineDashEnding.NoConstraint:this.isClosed||
(f=!1);break;case n.LineDashEnding.Custom:this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}var g=b.pathLength();if(this._pattern.isEmpty()||g<.1*this._pattern.length()||!this._walker.init(b,this._pattern,f))return b=p.collectPath(b),r.GeometryCursor.fromJSONCIM({paths:[b]})}if(this.iteratePath)b=this._pattern.nextValue();else{switch(this._endings){default:f=.5*this._pattern.firstValue();break;case n.LineDashEnding.HalfGap:f=.5*-this._pattern.lastValue();break;case n.LineDashEnding.FullGap:f=
-this._pattern.lastValue();break;case n.LineDashEnding.FullPattern:f=0;break;case n.LineDashEnding.NoConstraint:case n.LineDashEnding.Custom:f=-this._customDashPos}b=f/this._pattern.length();b-=Math.floor(b);f=b*this._pattern.length();this._pattern.reset();b=this._pattern.nextValue();for(g=!1;f>=b;)f-=b,b=this._pattern.nextValue(),g=!g;b-=f;g?(this._walker.nextPosition(b),b=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(b),b=this._pattern.nextValue(),this._walker.nextPosition(b),
b=this._pattern.nextValue())}if(f=this._walker.nextCurve(b))if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)f.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else b=this._pattern.nextValue(),!this._walker.nextPosition(b)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(f.pushCursor(this._firstCurve),this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,f=this._firstCurve,
this._firstCurve=null;f?.reset();return f}}k.EffectDashes=d;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/GeometryWalker":function(){define(["exports","../../geometry/GeometryCursor","./CurveHelper"],function(k,r,p){class e{constructor(){this._values=[];this._currentValue=this._length=this.ctrlPtGap=this.extPtGap=0}isEmpty(){return 0===this._values.length}size(){return this._values.length}init(d,a,b=!0){this._setEmpty();if(!d||0===d.length)return!1;for(let f=0;f<
d.length;f++){let g=Math.abs(d[f]);b&&1E-7>g&&(g=1E-7);this._values.push(g);this._length+=g}a&&d.length&1&&(this._length*=2);if(0===this._length)return!1;this.ctrlPtGap=this.extPtGap=0;this._currentValue=-1;return!0}scale(d){const a=this._values?this._values.length:0;for(let b=0;b<a;++b)this._values[b]*=d;this._length*=d;this.extPtGap*=d;this.ctrlPtGap*=d}addValue(d){this._length+=d;this._values.push(d)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){this._currentValue++;
this._currentValue===this._values.length&&(this._currentValue=0);return this._values[this._currentValue]}reset(){this._currentValue=-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=this._length=0;this._currentValue=-1;this._values.length=0}}class n{constructor(){this.pt=null;this.sa=this.ca=0}}k.EndType=void 0;(function(d){d[d.FAIL=0]="FAIL";d[d.END=1]="END";d[d.CONTINUE=2]="CONTINUE"})(k.EndType||(k.EndType={}));class m{constructor(){this.reset()}reset(){this.segment=null;
this.abscissa=this.segmentLength=0;this.isPartEnd=this.isPathEnd=!1}isValid(){return null!==this.segment}copyTo(d){d.segment=this.segment;d.segmentLength=this.segmentLength;d.abscissa=this.abscissa;d.isPathEnd=this.isPathEnd;d.isPartEnd=this.isPartEnd}}class l extends p.CurveHelper{constructor(d=0,a=!1){super(d,a);this._tolerance=p.pixelTolerance;this._currentPosition=new m}updateTolerance(d){this._tolerance=p.pixelTolerance*d}init(d,a,b=!0){b?(this._patternLength=a.length(),this._partExtPtGap=a.extPtGap,
this._partCtrlPtGap=a.ctrlPtGap):this._partCtrlPtGap=this._partExtPtGap=this._patternLength=0;this._currentPosition.reset();this._partSegCount=0;this._pathCursor=d;this._seg=-1;return this._setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(d,a=k.EndType.FAIL){const b=new m;if(!this._nextPosition(d,b,null,a))return!1;b.copyTo(this._currentPosition);return!0}curPointAndAngle(d){d.pt=this._getPoint(this._currentPosition);const [a,b]=this._getAngleCS(this._currentPosition);
d.ca=a;d.sa=b}nextPointAndAngle(d,a,b=k.EndType.FAIL){const f=new m;if(!this._nextPosition(d,f,null,b))return!1;f.copyTo(this._currentPosition);a.pt=this._getPoint(f);const [g,q]=this._getAngleCS(f);a.ca=g;a.sa=q;return!0}nextCurve(d){if(0===d)return null;const a=r.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");a.startPath();a.nextPath();const b=new m;if(!this._nextPosition(d,b,a,k.EndType.END))return null;b.copyTo(this._currentPosition);return a}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){return this._currentPosition.segment[1]}getPt(d){this._pathCursor.seekInPath(d);
return[this._pathCursor.x,this._pathCursor.y]}getSeg(d){const a=this.getPt(d);d=this.getPt(d+1);return[a,d]}_nextPosition(d,a,b,f){if(this._currentPosition.isPathEnd)return!1;var g=this._currentPosition.abscissa;0<this._currentPosition.segmentLength&&(g/=this._currentPosition.segmentLength);for(this._currentPosition.copyTo(a);a.abscissa+d*this._partLengthRatio>a.segmentLength+this._tolerance;)if(b&&(0===b.pathSize&&(0===g?(g=a.segment[0],b.pushXY(g[0],g[1])):b.pushPoint(this.getSegCoord2D(a.segment,
g))),g=a.segment[1],b.pushXY(g[0],g[1])),g=0,d-=(a.segmentLength-a.abscissa)/this._partLengthRatio,this._partSegCount)a.segment=this._nextSegment(),a.segmentLength=this.getSegLength(a.segment),a.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart()){if(f===k.EndType.FAIL)return!1;a.segmentLength=this.getSegLength(a.segment);a.isPartEnd=!0;f===k.EndType.END?(a.abscissa=a.segmentLength,a.isPathEnd=!0):a.abscissa=a.segmentLength+d;return!0}this._currentPosition.copyTo(a)}a.abscissa+=d*this._partLengthRatio;
b&&(0===b.pathSize&&(0===g?b.pushPoint(a.segment[0]):b.pushPoint(this.getSegCoord2D(a.segment,g))),d=a.abscissa/a.segmentLength,1===d?b.pushPoint(a.segment[1]):b.pushPoint(this.getSegCoord2D(a.segment,d)));!this._partSegCount&&Math.abs(a.abscissa-a.segmentLength)<this._tolerance&&(a.isPathEnd=this._partIsLast,a.isPartEnd=!0);return!0}_getPoint(d){return this.getSegCoord2D(this._currentPosition.segment,0>=d.segmentLength?0:d.abscissa/d.segmentLength)}_getAngleCS(d){return this.getSegAngleCS(this._currentPosition.segment,
0>=d.segmentLength?0:d.abscissa/d.segmentLength)}_setPosAtNextPart(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;this._partLength=0;this._partIsLast=!0;for(this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}for(var d=this._partSegCount;d;)this._previousSegment(),
--d;this._currentPosition.segment=this._nextSegment();this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment);this._currentPosition.abscissa=0;this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1;--this._partSegCount;d=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(d);d=d+this._partSegCount+1;d>=this._pathCursor.pathSize&&(d=0);this._ctrlPtEnd=this._pathCursor.getControlPointAt(d);if(0<this._patternLength){d=this._ctrlPtBegin?
this._partCtrlPtGap:this._partExtPtGap;const a=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let b=Math.round((this._partLength-(d+a))/this._patternLength);0>=b&&(b=0<d+a?0:1);this._partLengthRatio=this._partLength/(d+a+b*this._patternLength);.01>this._partLengthRatio&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}_hasNextSegment(){return this._seg<this._pathCursor.pathSize-2}_previousSegment(){return this.getSeg(--this._seg)}_nextSegment(){return this.getSeg(++this._seg)}_getStartPointIndex(){return this._seg}_getEndPointIndex(){return this._seg+
1}}k.DashPattern=e;k.GeometryWalker=l;k.Pos=n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectDonut":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/SpatialReference","../CIMEffects","../enums"],function(k,r,p,e,n){class m{static local(){null===m.instance&&(m.instance=new m);return m.instance}execute(d,a,b,f,g,q,c){return new l(d,a,b,f,g,q,c)}}m.instance=null;class l{constructor(d,a,b,f,g,q,c){this._preventClipping=
c;this._inputGeometries=d;this._tileKey=f;this._geometryEngine=g;this._maxInflateSize=q*b;this._width=(void 0!==a.width?a.width:2)*b;this._option=a.option}next(){for(var d;d=this._inputGeometries.next();){if("esriGeometryEnvelope"===d.geometryType&&0<this._width){var a=d.asJSON();return 0>Math.min(a.xmax-a.xmin,a.ymax-a.ymin)-2*this._width?d:r.GeometryCursor.fromJSONCIM({paths:[[[a.xmin+this._width,a.ymin+this._width],[a.xmax-this._width,a.ymin+this._width],[a.xmax-this._width,a.ymax-this._width],
[a.xmin+this._width,a.ymax-this._width],[a.xmin+this._width,a.ymin+this._width]],[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]]})}if("esriGeometryPolygon"===d.geometryType){if(0===this._width)return d.clone();var b=this._geometryEngine;if(null==b)break;if(d=!this._preventClipping&&this._tileKey?e.clipCursorToTileExtent(d,this._maxInflateSize):d.clone()){if(b=b.buffer(p.WebMercator,d.asJSON(),-this._width,1))for(a of b.rings)if(a){d.startPath();for(const f of a.reverse())d.pushXY(f[0],
d.yFactor*f[1])}return d}}}return null}}k.EffectDonut=m;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectJog":function(){define(["exports","../../../geometry/GeometryCursor","../CIMCursor","../CurveHelper"],function(k,r,p,e){class n{static local(){null===n.instance&&(n.instance=new n);return n.instance}execute(l,d,a,b,f){return new m(l,d,a)}}n.instance=null;class m extends p.PathEffectCursor{constructor(l,d,a){super(l,!1,!0);this._curveHelper=new e.CurveHelper;
this._length=(void 0!==d.length?d.length:20)*a;this._angle=void 0!==d.angle?d.angle:225;this._position=void 0!==d.position?d.position:50;0>this._length&&(this._length=-this._length);20>this._position&&(this._position=20);80<this._position&&(this._position=80);this._mirror=!1}processPath(l){const d=r.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._curveHelper.isEmpty(l))return null;l.seekInPath(0);const a=l.x,b=l.y;l.seekInPath(l.pathSize-1);const f=l.x;l=l.y;this._curveHelper.normalize([f-
a,l-b]);const g=a+(f-a)*this._position/100,q=b+(l-b)*this._position/100,c=Math.cos((90-this._angle)/180*Math.PI);let h=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(h=-h);this._mirror=!this._mirror;d.pushPath([[a,b],[g-this._length/2*c,q-this._length/2*h],[g+this._length/2*c,q+this._length/2*h],[f,l]]);return d}}k.EffectJog=n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectMove":function(){define(["exports"],function(k){class r{static local(){null===
r.instance&&(r.instance=new r);return r.instance}execute(e,n,m,l,d){return new p(e,n,m)}}r.instance=null;class p{constructor(e,n,m){this._inputGeometries=e;this._offsetX=void 0!==n.offsetX?n.offsetX*m:0;this._offsetY=void 0!==n.offsetY?n.offsetY*m:0}next(){let e=this._inputGeometries.next();for(;e;){if(0<e.totalSize)return this._move(e.clone(),this._offsetX,this._offsetY);e=this._inputGeometries.next()}return null}_move(e,n,m){for(;e.nextPath();)for(;e.nextPoint();)e.x+=n,e.y+=m;e.reset();return e}}
k.EffectMove=r;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectOffset":function(){define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../../../geometry/SpatialReference ../../../geometry/support/jsonUtils ../CIMEffects ../CurveHelper ../enums".split(" "),function(k,r,p,e,n,m,l,d){class a{static local(){null===a.instance&&(a.instance=new a);return a.instance}execute(f,g,q,c,h,u,A){return new b(f,g,q,c,h,u,A)}}
a.instance=null;class b{constructor(f,g,q,c,h,u,A){this._preventClipping=A;this._inputGeometries=f;this._tileKey=c;this._geometryEngine=h;this._curveHelper=new l.CurveHelper;this._offset=(g.offset??1)*q;this._method=g.method;this._maxInflateSize=Math.max(Math.abs(u*q),10);this._option=g.option;this._offsetFlattenError=l.pixelTolerance*q}next(){for(var f;f=this._inputGeometries.next();){if(0===this._offset)return f.clone();if("esriGeometryEnvelope"===f.geometryType){if(this._method===d.GeometricEffectOffsetMethod.Rounded&&
0<this._offset){var g=p.collectPath(f);if(g=this._curveHelper.offset(g,-this._offset,this._method,4,this._offsetFlattenError))return f=r.GeometryCursor.createEmptyOptimizedCIM(f.geometryType),f.pushPath(g),f;break}g=f.asJSON();if(n.isExtent(g)&&0<Math.min(g.xmax-g.xmin,g.ymax-g.ymin)+2*this._offset)return r.GeometryCursor.fromJSONCIM({xmin:g.xmin-this._offset,xmax:g.xmax+this._offset,ymin:g.ymin-this._offset,ymax:g.ymax+this._offset})}g=this._geometryEngine;if(null!=g&&(f=!this._preventClipping&&
this._tileKey?m.clipCursorToTileExtent(f,this._maxInflateSize):f.clone()))return(f=g.offset(e.WebMercator,f.asJSON(),-this._offset,1,this._method,4,this._offsetFlattenError))?r.GeometryCursor.fromJSONCIM(f):null}return null}}k.EffectOffset=a;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectReverse":function(){define(["exports"],function(k){class r{static local(){null===r.instance&&(r.instance=new r);return r.instance}execute(e,n,m,l,d){return new p(e,
n,m)}}r.instance=null;class p{constructor(e,n,m){this._inputGeometries=e;this._reverse=void 0!==n.reverse?n.reverse:!0}next(){for(var e=this._inputGeometries.next();e;){if(!this._reverse)return e;if("esriGeometryPolyline"===e.geometryType){for(e=e.clone();e.nextPath();)for(let n=0;n<e.pathSize/2;n++){e.seekInPath(n);const m=e.x,l=e.y;e.seekInPath(e.pathSize-n-1);const d=e.x,a=e.y;e.x=m;e.y=l;e.seekInPath(n);e.x=d;e.y=a}e.reset();return e}e=this._inputGeometries.next()}return null}}k.EffectReverse=
r;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectRotate":function(){define(["exports","../../../geometry/support/boundsUtils"],function(k,r){class p{static local(){null===p.instance&&(p.instance=new p);return p.instance}execute(n,m,l,d,a){return new e(n,m,l)}}p.instance=null;class e{constructor(n,m,l){this._inputGeometries=n;this._rotateAngle=void 0!==m.angle?m.angle*Math.PI/180:0}next(){let n=this._inputGeometries.next();for(;n;){if(0===this._rotateAngle||
"esriGeometryPoint"===n.geometryType)return n;if(0<n.totalSize){var m=r.getCursorBoundsXY(n);const l=(m[2]+m[0])/2;m=(m[3]+m[1])/2;n.reset();return this._rotate(n.clone(),l,m)}n=this._inputGeometries.next()}return null}_rotate(n,m,l){const d=Math.cos(this._rotateAngle),a=Math.sin(this._rotateAngle);for(;n.nextPath();)for(;n.nextPoint();){const b=n.x-m,f=n.y-l;n.x=m+b*d-f*a;n.y=l+b*a+f*d}n.reset();return n}}k.EffectRotate=p;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectScale":function(){define(["exports",
"../../../geometry/support/boundsUtils"],function(k,r){class p{static local(){null===p.instance&&(p.instance=new p);return p.instance}execute(n,m,l,d,a){return new e(n,m,l)}}p.instance=null;class e{constructor(n,m,l){this._inputGeometries=n;this._xFactor=void 0!==m.xScaleFactor?m.xScaleFactor:1.15;this._yFactor=void 0!==m.yScaleFactor?m.yScaleFactor:1.15}next(){const n=this._inputGeometries.next();if(n){if(1===this._xFactor&&1===this._yFactor||"esriGeometryPoint"===n.geometryType)return n;if(0<n.totalSize){var m=
r.getCursorBoundsXY(n);const l=(m[2]+m[0])/2;m=(m[3]+m[1])/2;n.reset();return this._scaleCursor(n.clone(),l,m)}}return null}_scaleCursor(n,m,l){for(;n.nextPath();)for(;n.nextPoint();)n.x=m+(n.x-m)*this._xFactor,n.y=l+(n.y-l)*this._yFactor;n.reset();return n}}k.EffectScale=p;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectWave":function(){define(["exports","../../../geometry/GeometryCursor","../enums","../GeometryWalker"],function(k,r,p,e){class n{static local(){null===
n.instance&&(n.instance=new n);return n.instance}execute(l,d,a,b,f){return new m(l,d,a)}}n.instance=null;class m{constructor(l,d,a){this._inputGeometries=l;this._height=(void 0!==d.amplitude?d.amplitude:2)*a;this._period=(void 0!==d.period?d.period:3)*a;this._style=d.waveform;0>=this._height&&(this._height=Math.abs(this._height));0>=this._period&&(this._period=Math.abs(this._period));this._pattern=new e.DashPattern;this._pattern.addValue(this._period);this._pattern.addValue(this._period);this._walker=
new e.GeometryWalker;this._walker.updateTolerance(a)}next(){for(var l=this._inputGeometries.next();l;){if(0===this._height||0===this._period||(l=this._processGeom(l)))return l;l=this._inputGeometries.next()}return null}_processGeom(l){const d=r.GeometryCursor.createEmptyOptimizedCIM(l.geometryType);for(;l.nextPath();){d.startPath();const a=l.pathLength();if(this._walker.init(l,this._pattern))switch(this._style){default:this._constructCurve(d,a,!1);break;case p.GeometricEffectWaveform.Square:this._constructSquare(d,
a);break;case p.GeometricEffectWaveform.Triangle:this._constructTriangle(d,a);break;case p.GeometricEffectWaveform.Random:this._constructCurve(d,a,!0)}else for(;l.nextPoint();)d.pushXY(l.x,l.y)}return d}_constructCurve(l,d,a){var b=Math.round(d/this._period);0===b&&(b=1);const f=this._period/16,g=1/(16*b+1);d=2*Math.PI*d/(d/b);b=2*Math.PI*Math.random();const q=2*Math.PI*Math.random(),c=2*Math.PI*Math.random(),h=.75-Math.random()/2,u=.75-Math.random()/2,A=new e.Pos;this._walker.curPointAndAngle(A);
l.pushPoint(A.pt);let z=0;for(;;)if(this._walker.nextPointAndAngle(f,A)){const t=z;z+=g;let w;if(a){const x=this._height/2*(1+.3*Math.sin(h*d*t+b));w=x*Math.sin(d*t+q);w+=x*Math.sin(u*d*t+c);w/=2}else w=.5*this._height*Math.sin(.5*d*t);l.pushXY(A.pt[0]-w*A.sa,A.pt[1]+w*A.ca)}else{l.pushPoint(this._walker.getPathEnd());break}}_constructSquare(l,d){Math.round(d/this._period);for(d=!0;;){let a=!1;if(this._walker.curPositionIsValid()){const b=new e.Pos;this._walker.curPointAndAngle(b);const f=new e.Pos;
if(this._walker.nextPointAndAngle(this._period,f)){const g=new e.Pos;this._walker.nextPointAndAngle(this._period,g)&&(d?(l.pushPoint(b.pt),d=!1):l.pushPoint(b.pt),l.pushXY(b.pt[0]-this._height/2*b.sa,b.pt[1]+this._height/2*b.ca),l.pushXY(f.pt[0]-this._height/2*f.sa,f.pt[1]+this._height/2*f.ca),l.pushXY(f.pt[0]+this._height/2*f.sa,f.pt[1]-this._height/2*f.ca),l.pushXY(g.pt[0]+this._height/2*g.sa,g.pt[1]-this._height/2*g.ca),a=!0)}}if(!a){l.pushPoint(this._walker.getPathEnd());break}}}_constructTriangle(l,
d){Math.round(d/this._period);for(d=!0;;){let a=!1;if(this._walker.curPositionIsValid()){const b=new e.Pos;this._walker.curPointAndAngle(b);const f=new e.Pos;if(this._walker.nextPointAndAngle(this._period/2,f)){const g=new e.Pos;this._walker.nextPointAndAngle(this._period,g)&&(this._walker.nextPosition(this._period/2)&&(d?(l.pushPoint(b.pt),d=!1):l.pushPoint(b.pt),l.pushXY(f.pt[0]-this._height/2*f.sa,f.pt[1]+this._height/2*f.ca),l.pushXY(g.pt[0]+this._height/2*g.sa,g.pt[1]-this._height/2*g.ca)),a=
!0)}}if(!a){l.pushPoint(this._walker.getPathEnd());break}}}}k.EffectWave=n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAlongLineSameSize":function(){define(["exports","../CIMCursor","../enums","../GeometryWalker"],function(k,r,p,e){class n{static local(){null===n.instance&&(n.instance=new n);return n.instance}execute(l,d,a,b,f){return new m(l,d,a)}}n.instance=null;class m extends r.PathTransformationCursor{constructor(l,d,a){super(l);this._geometryWalker=
new e.GeometryWalker;this._geometryWalker.updateTolerance(a);this._angleToLine=d.angleToLine??!0;this._offset=(d.offset?d.offset:0)*a;this._originalEndings=d.endings;this._offsetAtEnd=(d.customEndingOffset?d.customEndingOffset:0)*a;this._position=-(d.offsetAlongLine?d.offsetAlongLine:0)*a;this._pattern=new e.DashPattern;this._pattern.init(d.placementTemplate,!1);this._pattern.scale(a);this._endings=this._originalEndings}processPath(l){if(this._pattern.isEmpty())return null;if(this.iteratePath)var d=
this._pattern.nextValue();else{this._endings=this._originalEndings===p.PlacementEndings.WithFullGap&&this.isClosed?p.PlacementEndings.WithMarkers:this._originalEndings;this._pattern.extPtGap=0;let a=!0;switch(this._endings){case p.PlacementEndings.NoConstraint:d=-this._position;d=this._adjustPosition(d);a=!1;break;default:d=-this._pattern.lastValue()/2;break;case p.PlacementEndings.WithFullGap:d=-this._pattern.lastValue();this._pattern.extPtGap=this._pattern.lastValue();break;case p.PlacementEndings.WithMarkers:d=
0;break;case p.PlacementEndings.Custom:d=-this._position,d=this._adjustPosition(d),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(l,this._pattern,a))return null;this._pattern.reset();for(l=0;d>l;)d-=l,l=this._pattern.nextValue();d=l-d;this.iteratePath=!0}l=new e.Pos;if(!this._geometryWalker.nextPointAndAngle(d,l)||this._endings===p.PlacementEndings.WithFullGap&&this._geometryWalker.isPathEnd())return this.iteratePath=!1,null;if(this._endings===p.PlacementEndings.WithMarkers&&
this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed))return null;this.internalPlacement.setTranslate(l.pt[0]-this._offset*l.sa,l.pt[1]+this._offset*l.ca);this._angleToLine&&this.internalPlacement.setRotateCS(l.ca,l.sa);return this.internalPlacement}_adjustPosition(l){l/=this._pattern.length();l-=Math.floor(l);return l*this._pattern.length()}}k.PlacementAlongLineSameSize=n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAtExtremities":function(){define(["exports",
"../CIMCursor","../CurveHelper","../enums"],function(k,r,p,e){class n{static local(){null===n.instance&&(n.instance=new n);return n.instance}execute(l,d,a,b,f){return new m(l,d,a)}}n.instance=null;class m extends r.PathTransformationCursor{constructor(l,d,a){super(l,!1,!0);this._curveHelper=new p.CurveHelper;this._placePerPart=d.placePerPart??!1;this._angleToLine=void 0!==d.angleToLine?d.angleToLine:!0;this._offset=void 0!==d.offset?d.offset*a:0;this._type=d.extremityPlacement;this._position=void 0!==
d.offsetAlongLine?d.offsetAlongLine*a:0;this._beginProcessed=!1}processMultiPath(l){return this._placePerPart?super.processMultiPath(l):this.processPath(l)}processPath(l){let d;switch(this._type){default:this._beginProcessed?(d=this._atExtremities(l,this._position,!1),this.iteratePath=this.iterateMultiPath=this._beginProcessed=!1):(d=this._atExtremities(l,this._position,!0),this.iteratePath=this.iterateMultiPath=this._beginProcessed=!0);break;case e.ExtremityPlacement.JustBegin:d=this._atExtremities(l,
this._position,!0);break;case e.ExtremityPlacement.JustEnd:d=this._atExtremities(l,this._position,!1);case e.ExtremityPlacement.None:}return d}_atExtremities(l,d,a){this._placePerPart||(a?l.seekPath(0):l.seekPath(l.totalSize-1));a||l.seekPathEnd();if(a?l.nextPoint():l.prevPoint()){let b=0,[f,g]=[0,0],[q,c]=[l.x,l.y];for(;a?l.nextPoint():l.prevPoint();){f=q;g=c;q=l.x;c=l.y;const h=this._curveHelper.getLength(f,g,q,c);if(b+h>d){l=(d-b)/h;const [u,A]=this._curveHelper.getAngleCS(f,g,q,c,l);l=this._curveHelper.getCoord2D(f,
g,q,c,l);this.internalPlacement.setTranslate(l[0]-this._offset*A,l[1]+this._offset*u);this._angleToLine&&this.internalPlacement.setRotateCS(-u,-A);return this.internalPlacement}b+=h}}return null}}k.PlacementAtExtremities=n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAtRatioPositions":function(){define(["exports","../CIMCursor","../GeometryWalker"],function(k,r,p){class e{static local(){null===e.instance&&(e.instance=new e);return e.instance}execute(m,
l,d,a,b){return new n(m,l,d)}}e.instance=null;class n extends r.PathTransformationCursor{constructor(m,l,d){super(m);this._walker=new p.GeometryWalker;this._walker.updateTolerance(d);this._angleToLine=void 0!==l.angleToLine?l.angleToLine:!0;this._offset=void 0!==l.offset?l.offset*d:0;this._beginGap=void 0!==l.beginPosition?l.beginPosition*d:0;this._endGap=void 0!==l.endPosition?l.endPosition*d:0;this._flipFirst=void 0!==l.flipFirst?l.flipFirst:!0;this._pattern=new p.DashPattern;this._pattern.init(l.positionArray,
!1,!1);this._subPathLen=0;this._posCount=this._pattern.size();this._isFirst=!0;this._prevPos=0}processPath(m){if(this._pattern.isEmpty())return null;if(this.iteratePath){m=this._pattern.nextValue()*this._subPathLen;var l=this._beginGap+m;m=l-this._prevPos;this._prevPos=l}else{this._posCount=this._pattern.size();this._isFirst=!0;this._prevPos=0;this._subPathLen=m.pathLength()-this._beginGap-this._endGap;if(0>this._subPathLen)return this.iteratePath=!1,null;if(!this._walker.init(m,this._pattern,!1))return null;
this._pattern.reset();m=this._pattern.nextValue()*this._subPathLen;l=this._beginGap+m;m=l-this._prevPos;this._prevPos=l;this.iteratePath=!0}l=new p.Pos;if(!this._walker.nextPointAndAngle(m,l,p.EndType.END))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(l.pt[0]-this._offset*l.sa,l.pt[1]+this._offset*l.ca);m=this._isFirst&&this._flipFirst;let d;this._angleToLine?(d=l.ca,l=l.sa):(d=1,l=0);m&&(d=-d,l=-l);this.internalPlacement.setRotateCS(d,l);this._isFirst=!1;this._posCount--;0===
this._posCount&&(this.iteratePath=!1);return this.internalPlacement}}k.PlacementAtRatioPositions=e;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementInsidePolygon":function(){define(["exports","../../../core/RandomLCG","../CIMPlacements","../enums"],function(k,r,p,e){class n{static local(){null===n.instance&&(n.instance=new n);return n.instance}execute(l,d,a,b,f){return new m(l,d,a,b,f)}}n.instance=null;class m{constructor(l,d,a,b,f){this._currentY=
this._currentX=this._yMax=this._yMin=this._xMax=this._xMin=0;this._accelerationMap=null;this._testInsidePolygon=!1;this._verticalSubdivision=!0;this._stepX=Math.abs(d.stepX??16)*a;this._stepY=Math.abs(d.stepY??16)*a;this._stepX=Math.round(128*this._stepX)/128;this._stepY=Math.round(128*this._stepY)/128;if(0!==this._stepX&&0!==this._stepY){this._gridType=d.gridType??e.PlacementGridType.Fixed;if(this._gridType===e.PlacementGridType.Random)this._randomLCG=new r(1*(d.seed??13)),this._randomness=(d.randomness??
100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._offsetY=this._offsetX=this._sinAngle=0,this._buildRandomValues();else{this._randomness=0;this._gridAngle=d.gridAngle??0;this._shiftOddRows=d.shiftOddRows??!1;this._offsetX=(d.offsetX??0)*a;this._offsetY=(d.offsetY??0)*a;this._cosAngle=Math.cos(this._gridAngle/180*Math.PI);this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI);if(this._stepX)if(0>this._offsetX)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=
.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(0>this._offsetY)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}this._graphicOriginY=this._graphicOriginX=0;if(null!=b){const [g,q,c,h]=b.split("/");d=parseFloat(g);a=parseFloat(q);b=parseFloat(c);this._graphicOriginX=512*-(parseFloat(h)*2**d+b);this._graphicOriginY=512*a;this._testInsidePolygon=!0}this._internalPlacement=new p.Placement;this._calculateMinMax(l);
this._geometryCursor=l}}next(){return this._geometryCursor?this._nextInside():null}_buildRandomValues(){if(!m._randValues){m._randValues=[];for(let l=0;24>l;l++)for(let d=0;24>d;d++)m._randValues.push(this._randomLCG.getFloat()),m._randValues.push(this._randomLCG.getFloat())}}_calculateMinMax(l){this._yMax=this._yMin=this._xMax=this._xMin=0;let d,a,b,f,g,q,c,h;d=a=c=g=Number.MAX_VALUE;b=f=h=q=-Number.MAX_VALUE;var u=1!==this._cosAngle;for(l.reset();l.nextPath();)for(;l.nextPoint();){var A=l.x;var z=
l.y;var t=A-this._graphicOriginX-this._offsetX;var w=z-this._graphicOriginY-this._offsetY;if(u){var x=this._cosAngle*t-this._sinAngle*w;t=this._sinAngle*t+this._cosAngle*w}else x=t,t=w;d=Math.min(d,x);b=Math.max(b,x);a=Math.min(a,t);f=Math.max(f,t);g=Math.min(g,z);q=Math.max(q,z);c=Math.min(c,A);h=Math.max(h,A)}g=g!==Number.MAX_VALUE?g:-512-this._stepY;q=q!==-Number.MAX_VALUE?q:this._stepY;c=c!==Number.MAX_VALUE?c:-this._stepX;h=h!==-Number.MAX_VALUE?h:512+this._stepX;this._polygonMin=(this._verticalSubdivision=
q-g>=h-c)?g:c;if(this._testInsidePolygon){x=0-this._graphicOriginX-this._offsetX-this._stepX;z=512-this._graphicOriginX-this._offsetX+this._stepX;A=-512-this._graphicOriginY-this._offsetY-this._stepY;t=0-this._graphicOriginY-this._offsetY+this._stepY;if(u){u=[[x,A],[x,t],[z,A],[z,t]];x=A=Number.MAX_VALUE;z=t=-Number.MAX_VALUE;for(const B of u)u=this._cosAngle*B[0]-this._sinAngle*B[1],w=this._sinAngle*B[0]+this._cosAngle*B[1],x=Math.min(x,u),z=Math.max(z,u),A=Math.min(A,w),t=Math.max(t,w)}d=d!==Number.MAX_VALUE?
Math.max(d,x):x;a=a!==Number.MAX_VALUE?Math.max(a,A):A;b=b!==-Number.MAX_VALUE?Math.min(b,z):z;f=f!==-Number.MAX_VALUE?Math.min(f,t):t}this._xMin=Math.round(d/this._stepX);this._xMax=Math.round(b/this._stepX);this._yMin=Math.round(a/this._stepY);this._yMax=Math.round(f/this._stepY);this._currentX=this._xMax+1;this._currentY=this._yMin-1;this._buildAccelerationMap(l,c,h,g,q)}_buildAccelerationMap(l,d,a,b,f){l.reset();const g=new Map,q=this._verticalSubdivision;a=q?f-b:a-d;f=Math.ceil(a/10);if(!(1>=
f)){a=Math.floor(a/f);f++;this._delta=a;var c,h;if(q){f=-512-2*this._stepY;var u=2*this._stepY;var A=b}else f=-2*this._stepX,u=512+2*this._stepX,A=d;for(;l.nextPath();)if(!(2>l.pathSize)&&l.nextPoint()){var z=l.x;for(c=l.y;l.nextPoint();z=d,c=b){d=l.x;b=l.y;if(q){if(c===b||c<f&&b<f||c>u&&b>u)continue;var t=Math.min(c,b);var w=Math.max(c,b)}else{if(z===d||z<f&&d<f||z>u&&d>u)continue;t=Math.min(z,d);w=Math.max(z,d)}for(;t<w;){var x=h=Math.floor((t-A)/a),B=z,C=c,y=d,v=b,F=g;let D=F.get(x);D||(D=[],F.set(x,
D));D.push([[B,C],[y,v]]);t+=a}t=Math.floor((w-A)/a);t>h&&(w=d,x=b,B=g,C=B.get(t),C||(C=[],B.set(t,C)),C.push([[z,c],[w,x]]))}}this._accelerationMap=g}}_nextInside(){for(;;){if(this._currentX>this._xMax){this._currentY++;if(this._currentY>this._yMax)return null;this._currentX=this._xMin;this._shiftOddRows&&this._currentY%2&&this._currentX--}var l=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(l+=.5*this._stepX);const d=this._currentY*this._stepY+this._offsetY;this._currentX++;
let a;if(this._gridType===e.PlacementGridType.Random){const b=(this._currentX%24+24)%24,f=(this._currentY%24+24)%24;a=this._graphicOriginX+l+this._stepX*this._randomness*(.5-m._randValues[24*f+b])*2/3;l=this._graphicOriginY+d+this._stepY*this._randomness*(.5-m._randValues[24*f+b+1])*2/3}else a=this._graphicOriginX+this._cosAngle*l+this._sinAngle*d,l=this._graphicOriginY-this._sinAngle*l+this._cosAngle*d;if(!this._testInsidePolygon||this._isInsidePolygon(a,l,this._geometryCursor))return this._internalPlacement.setTranslate(a,
l),this._internalPlacement}}_isInsidePolygon(l,d,a){if(null==this._accelerationMap){var b=0,f;let c;l+=1E-6;d+=1E-6;for(a.reset();a.nextPath();)if(a.nextPoint()){var g=a.x;for(f=a.y;a.nextPoint();g=q,f=c){var q=a.x;c=a.y;f>d!==c>d&&(0<(q-g)*(d-f)-(c-f)*(l-g)?b++:b--)}}return 0!==b}l+=1E-6;d+=1E-6;a=this._verticalSubdivision;f=this._accelerationMap.get(Math.floor(((a?d:l)-this._polygonMin)/this._delta));if(!f)return!1;g=0;for(b of f){f=b[0];q=b[1];if(a){if(f[1]>d===q[1]>d)continue;f=(q[0]-f[0])*(d-
f[1])-(q[1]-f[1])*(l-f[0])}else{if(f[0]>l===q[0]>l)continue;f=(q[1]-f[1])*(l-f[0])-(q[0]-f[0])*(d-f[1])}0<f?g++:g--}return 0!==g}}k.PlacementInsidePolygon=n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementOnLine":function(){define(["exports","../CIMCursor","../CurveHelper","../enums"],function(k,r,p,e){class n{static local(){null===n.instance&&(n.instance=new n);return n.instance}execute(l,d,a,b,f){return new m(l,d,a)}}n.instance=null;class m extends r.PathTransformationCursor{constructor(l,
d,a){super(l);this._curveHelper=new p.CurveHelper;this._angleToLine=void 0!==d.angleToLine?d.angleToLine:!0;this._offset=void 0!==d.offset?d.offset*a:0;this._relativeTo=d.relativeTo;this._position=void 0!==d.startPointOffset?d.startPointOffset*a:0;this._epsilon=.001*a}processPath(l){var d=this._position;if(this._relativeTo===e.PlacementOnLineRelativeTo.SegmentMidpoint){this.iteratePath||(this.iteratePath=!0);if(l.nextPoint()){let [a,b]=[l.x,l.y],[f,g]=[0,0];for(;l.nextPoint();){f=l.x;g=l.y;d=this._curveHelper.getLength(a,
b,f,g);if(d<this._epsilon){a=f;b=g;continue}l=.5+this._position/d;const [q,c]=this._curveHelper.getAngleCS(a,b,f,g,l);l=this._curveHelper.getCoord2D(a,b,f,g,l);this.internalPlacement.setTranslate(l[0]-this._offset*c,l[1]+this._offset*q);this._angleToLine&&this.internalPlacement.setRotateCS(q,c);return this.internalPlacement}}this.iteratePath=!1;return null}return this.onLine(l,d,this._relativeTo===e.PlacementOnLineRelativeTo.LineEnd)}onLine(l,d,a){let b=!1;switch(this._relativeTo){default:l.seekPathStart();
d=l.pathLength()/2+d;break;case e.PlacementOnLineRelativeTo.LineBeginning:break;case e.PlacementOnLineRelativeTo.LineEnd:b=!0}a?l.seekPathEnd():l.seekPathStart();let f=0;if(a?l.prevPoint():l.nextPoint()){let [g,q]=[l.x,l.y],[c,h]=[0,0];for(;a?l.prevPoint():l.nextPoint();){c=l.x;h=l.y;const u=this._curveHelper.getLength(g,q,c,h);if(f+u>d){l=(d-f)/u;const [A,z]=this._curveHelper.getAngleCS(g,q,c,h,l);l=this._curveHelper.getCoord2D(g,q,c,h,l);a=b?-this._offset:this._offset;this.internalPlacement.setTranslate(l[0]-
a*z,l[1]+a*A);this._angleToLine&&(b?this.internalPlacement.setRotateCS(-A,-z):this.internalPlacement.setRotateCS(A,z));return this.internalPlacement}g=c;q=h;f+=u}}return null}}k.PlacementOnLine=n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementOnVertices":function(){define(["exports","../CIMCursor","../CurveHelper"],function(k,r,p){function e(l,d){const a=Math.PI;for(;Math.abs(d-l)>a+2E-15;)d=d-l>a?d-2*a:d+2*a;return(l+d)/2}class n{static local(){null===
n.instance&&(n.instance=new n);return n.instance}execute(l,d,a,b,f){return new m(l,d,a)}}n.instance=null;class m extends r.PathTransformationCursor{constructor(l,d,a){super(l);this._curveHelper=new p.CurveHelper;this._angleToLine=void 0!==d.angleToLine?d.angleToLine:!0;this._offset=void 0!==d.offset?d.offset*a:0;this._endPoints=void 0!==d.placeOnEndPoints?d.placeOnEndPoints:!0;this._controlPoints=void 0!==d.placeOnControlPoints?d.placeOnControlPoints:!0;this._regularVertices=void 0!==d.placeOnRegularVertices?
d.placeOnRegularVertices:!0;this._tags=[];this._tagIterator=0}processPath(l){this.iteratePath||(this._preparePath(l),this.iteratePath=!0);if(this._tagIterator>=this._tags.length)return this._tagIterator=this._tags.length=0,this.iteratePath=!1,null;l=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(l[2]);let d=l[0],a=l[1];if(0!==this._offset){const b=Math.cos(l[2]);d-=this._offset*Math.sin(l[2]);a+=this._offset*b}this.internalPlacement.setTranslate(d,a);this._tagIterator++;
return this.internalPlacement}_preparePath(l){this._tagIterator=this._tags.length=0;l.seekPathStart();const d=l.isClosed();let a=0,b=!1,f=0,g=0;l.seekPathStart();if(l.nextPoint()){let q=l.x,c=l.y,h=l.getControlPoint(),u=!0,A=l.nextPoint();for(;A;){const z=l.x,t=l.y,w=l.getControlPoint();if(this._angleToLine||0!==this._offset)f=this._curveHelper.getAngle(q,c,z,t,0);u?(u=!1,d?(a=f,b=h):(this._endPoints||this._controlPoints&&h)&&this._tags.push([q,c,f])):h?this._controlPoints&&this._tags.push([q,c,e(g,
f)]):this._regularVertices&&this._tags.push([q,c,e(g,f)]);if(this._angleToLine||0!==this._offset)g=this._curveHelper.getAngle(q,c,z,t,1);(A=l.nextPoint())||(d?w||b?this._controlPoints&&this._tags.push([z,t,e(g,a)]):this._regularVertices&&this._tags.push([z,t,e(g,a)]):(this._endPoints||this._controlPoints&&w)&&this._tags.push([z,t,g]));q=z;c=t;h=w}}this._tagIterator=0}}k.PlacementOnVertices=n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementPolygonCenter":function(){define("exports ../../../geometry/support/boundsUtils ../../../geometry/support/centroid ../../../geometry/support/labelPoint ../CIMPlacements ../enums".split(" "),
function(k,r,p,e,n,m){class l{static local(){null===l.instance&&(l.instance=new l);return l.instance}execute(a,b,f,g,q){return new d(a,b,f)}}l.instance=null;class d{constructor(a,b,f){this._geometryCursor=a;this._offsetX=void 0!==b.offsetX?b.offsetX*f:0;this._offsetY=void 0!==b.offsetY?b.offsetY*f:0;this._method=void 0!==b.method?b.method:m.PlacementPolygonCenterMethod.OnPolygon;this._placementPerPart=void 0!==b.placePerPart?b.placePerPart:!1;this._internalPlacement=new n.Placement}next(){const a=
this._geometryCursor;if(!a)return null;if(this._placementPerPart){for(;a.nextPath();)if(!(0>a.getCurrentRingArea()))return this._polygonCenter(a.getCurrentPath());this._geometryCursor=null}else return this._geometryCursor=null,this._polygonCenter(a);return null}_polygonCenter(a){let b=!1;switch(this._method){case m.PlacementPolygonCenterMethod.CenterOfMass:if(a=p.weightedAreaCentroid(a))this._internalPlacement.setTranslate(a[0]+this._offsetX,a[1]+this._offsetY),b=!0;break;case m.PlacementPolygonCenterMethod.BoundingBoxCenter:if(a=
r.getCursorBoundsXY(a))this._internalPlacement.setTranslate((a[2]+a[0])/2+this._offsetX,(a[3]+a[1])/2+this._offsetY),b=!0;break;default:a=e.getLabelPoint(a),null!==a&&(this._internalPlacement.setTranslate(a[0]+this._offsetX,a[1]+this._offsetY),b=!0)}return b?this._internalPlacement:null}}k.PlacementPolygonCenter=l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/labelPoint":function(){define("exports ../../core/PriorityQueue ./aaBoundingRect ./boundsUtils ./centroid ./coordsUtils ./intersectsBase".split(" "),
function(k,r,p,e,n,m,l){function d(h,u){let A=0,z,t,w,x;for(u.reset();u.nextPath()&&u.nextPoint();)for(z=u.x,t=u.y;u.nextPoint();z=w,t=x)w=u.x,x=u.y,t>h[1]!==x>h[1]&&(0<(w-z)*(h[1]-t)-(x-t)*(h[0]-z)?A++:A--);return 0!==A}function a(h,u,A){if(A&&d(h,u))return{coord:h,distance:0};A=Infinity;let z=0,t=0;var w=[0,0];let x=[0,0];const B=[0,0];for(u.reset();u.nextPath()&&u.nextPoint();)if(!(2>u.pathSize))for(w[0]=u.x,w[1]=u.y;u.nextPoint();w=x)x=[u.x,u.y],m.projectPointOnLineSeg(B,h,w,x),w=g(h,B),w<A&&
(A=w,z=B[0],t=B[1]);return{coord:[z,t],distance:Math.sqrt(A)}}function b(h,u,A,z){A=[u,0];let t=Infinity,w=Infinity,x=!1,B=!1;u=[[u,z[1]-1],[u,z[3]+1]];z=[0,0];const C=[0,0],y=[0,0],v=[[0,0],[0,0]],F=p.create();for(h.reset();h.nextPath()&&h.nextPoint();)if(!(2>h.pathSize))for(v[0][0]=h.x,v[0][1]=h.y;h.nextPoint();v[0][0]=v[1][0],v[0][1]=v[1][1]){v[1][0]=h.x;v[1][1]=h.y;a:{var D=F;var G=v;if(2>G.length){D=null;break a}D||=p.create();const [H,K]=G[0],[J,L]=G[1];D[0]=Math.min(H,J);D[1]=Math.min(K,L);
D[2]=Math.max(H,J);D[3]=Math.max(K,L)}if(null!==D){C[0]=u[0][0];C[1]=u[0][1];y[0]=u[1][0];y[1]=u[1][1];a:{D=F;G=C;var E=y;let H=f(G,D),K=f(E,D);const J=D[0],L=D[1],P=D[2],Q=D[3];if(H&K){D=0;break a}if(!(H|K)){D=4;break a}const S=(H?1:0)|(K?2:0);do{const U=E[0]-G[0],X=E[1]-G[1];if(U>X)H&3?(H&1?(G[1]+=X*(J-G[0])/U,G[0]=J):(G[1]+=X*(P-G[0])/U,G[0]=P),H=f(G,D)):K&3?(K&1?(E[1]+=X*(J-E[0])/U,E[0]=J):(E[1]+=X*(P-E[0])/U,E[0]=P),K=f(E,D)):H?(H&4?(G[0]+=U*(L-G[1])/X,G[1]=L):(G[0]+=U*(Q-G[1])/X,G[1]=Q),H=f(G,
D)):(K&4?(E[0]+=U*(L-E[1])/X,E[1]=L):(E[0]+=U*(Q-E[1])/X,E[1]=Q),K=f(E,D));else if(H&12?(H&4?(G[0]+=U*(L-G[1])/X,G[1]=L):(G[0]+=U*(Q-G[1])/X,G[1]=Q),H=f(G,D)):K&12?(K&4?(E[0]+=U*(L-E[1])/X,E[1]=L):(E[0]+=U*(Q-E[1])/X,E[1]=Q),K=f(E,D)):H?(H&1?(G[1]+=X*(J-G[0])/U,G[0]=J):(G[1]+=X*(P-G[0])/U,G[0]=P),H=f(G,D)):(K&1?(E[1]+=X*(J-E[0])/U,E[0]=J):(E[1]+=X*(P-E[0])/U,E[0]=P),K=f(E,D)),H&K){D=0;break a}}while(H|K);D=S}0!==D&&l.segmentIntersects(u[0],u[1],v[0],v[1],z)&&(D=z[1],t>w?D<t&&(t=D,x=!0):D<w&&(w=D,
B=!0))}}x&&B?A[1]=(t+w)/2:A[0]=A[1]=NaN;return A}function f(h,u){return(h[0]<u[0]?1:0)|(h[0]>u[2]?1:0)<<1|(h[1]<u[1]?1:0)<<2|(h[1]>u[3]?1:0)<<3}function g(h,u){return(h[0]-u[0])*(h[0]-u[0])+(h[1]-u[1])*(h[1]-u[1])}function q(h,u){if(h<u)return-1;if(h>u)return 1;if(h===u)return 0;h=isNaN(h);u=isNaN(u);return h<u?-1:h>u?1:0}class c{constructor(h,u,A,z){this.x=h;this.y=u;this.cellSize=A;this.distancefromCellCenter=m.distanceFromPointToPolygon(h,u,z);this.maxDistanceToPolygon=this.distancefromCellCenter+
this.cellSize*Math.SQRT2}}k.getLabelPoint=function(h){if(0===h.totalSize)return null;var u=e.getCursorBoundsXY(h);if(!u)return null;var A=8.8818E-14*(Math.abs(u[0])+Math.abs(u[2])+Math.abs(u[1])+Math.abs(u[3])+1),z=0,t=0;h.reset();for(var w=0;h.nextPath();w++){var x=h.getCurrentRingArea();x>t&&(t=x,z=w)}h.seekPath(z);if(0===h.pathSize)return null;h.seekPathStart();x=e.getCursorPathBounds(h);if(Math.abs(t)<=2*A*A)return[(x[0]+x[2])/2,(x[1]+x[3])/2];h.seekPathStart();var B=n.ringCentroidCursorXY(h,
p.create());if(null===B)return null;if(4>h.totalPoints)return B;t=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]];z=[NaN,NaN,NaN,NaN];w=[NaN,NaN,NaN,NaN];var C=!1,y=a(B,h,!0);0===y.distance&&(C=!0,t[0][0]=B[0],t[0][1]=B[1],y=a(B,h,!1));z[0]=y.distance;w[0]=0;var v=[NaN,NaN];let F=!1,D=.25,G=-1;y=NaN;do{y=NaN;var E=x[0];t[1]=b(h,E+(x[2]-E)*D,A,u);isNaN(t[1][0])||isNaN(t[1][1])||(y=a(t[1],h,!1),y=y.distance);if(!isNaN(y)&&y>A&&d(t[1],h))F=!0,z[1]=y,w[1]=g(t[1],B);else if(!isNaN(y)&&y>G&&(G=y,v[0]=t[1][0],
v[1]=t[1][1]),D-=.01,.1>D)if(0<=G)F=!0,z[1]=G,t[1][0]=v[0],t[1][1]=v[1],w[1]=g(t[1],B);else break}while(!F);F=!1;D=.5;G=-1;E=.01;let H=1;do{y=NaN;var K=x[0];t[2]=b(h,K+(x[2]-K)*D,A,u);isNaN(t[2][0])||isNaN(t[2][1])||(y=a(t[2],h,!1),y=y.distance);if(!isNaN(y)&&y>A&&d(t[2],h))F=!0,z[2]=y,w[2]=g(t[2],B);else if(!isNaN(y)&&y>G)G=y,v[0]=t[2][0],v[1]=t[2][1];else if(y>G&&(G=y,v[0]=t[2][0],v[1]=t[2][1]),D=.5+E*H,E+=.01,H*=-1,.3>D||.7<D)if(0<=G)F=!0,z[2]=G,t[2][0]=v[0],t[2][1]=v[1],w[2]=g(t[2],B);else break}while(!F);
F=!1;D=.75;G=-1;do if(y=NaN,E=x[0],t[3]=b(h,E+(x[2]-E)*D,A,u),isNaN(t[3][0])||isNaN(t[3][1])||(y=a(t[3],h,!1),y=y.distance),!isNaN(y)&&y>A&&d(t[3],h))F=!0,z[3]=y,w[3]=g(t[3],B);else if(y>G&&(G=y,v[0]=t[3][0],v[1]=t[3][1]),D+=.01,.9<D)if(0<=G)F=!0,z[3]=G,t[3][0]=v[0],t[3][1]=v[1],w[3]=g(t[3],B);else break;while(!F);h=[0,1,2,3];u=C?0:1;for(x=u;4>x;x++)for(C=u;3>C;C++)B=w[C],v=w[C+1],0<q(B,v)&&(A=h[C],h[C]=h[C+1],h[C+1]=A,w[C]=v,w[C+1]=B);w=u;for(x=A=0;4>u;u++){switch(u){case 0:x=2*z[h[u]];break;case 1:x=
1.66666666*z[h[u]];break;case 2:x=1.33333333*z[h[u]];break;case 3:x=z[h[u]]}x>A&&(A=x,w=h[u])}return t[w]};k.getPolylabelPoint=function(h){if(!h.nextPath()||!h.pathSize)return null;var u=e.getCursorPathBounds(h),A=u[2]-u[0],z=u[3]-u[1];if(0===A||0===z)return[u[0]+A/2,u[1]+z/2];const t=Math.max(Math.min(A,z)/100,1),w=new r((C,y)=>y.maxDistanceToPolygon-C.maxDistanceToPolygon);z=Math.min(A,z);A=z/2;let x=0,B=0;for(x=u[0];x<u[2];x+=z)for(B=u[1];B<u[3];B+=z)w.enqueue(new c(x+A,B+A,A,h));h.reset();h.nextPath();
u=n.ringsCentroidCursor(h);if(null===u)return null;for(u=new c(u[0],u[1],0,h);0<w.size;)z=w.dequeue(),z.distancefromCellCenter>u.distancefromCellCenter&&(u=z),z.maxDistanceToPolygon-u.distancefromCellCenter<=t||(A=z.cellSize/2,w.enqueue(new c(z.x-A,z.y-A,A,h)),w.enqueue(new c(z.x+A,z.y-A,A,h)),w.enqueue(new c(z.x-A,z.y+A,A,h)),w.enqueue(new c(z.x+A,z.y+A,A,h)));return[u.x,u.y]};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/core/PriorityQueue":function(){define(function(){class k{constructor(p=
r){this._data=[];this._compare=p}get size(){return this._data.length}enqueue(p){if(null!=p){var {_data:e,_compare:n}=this;e.push(p);p=e.length-1>>>0;for(var m=e[p];0<p;){const l=p-1>>1,d=e[l];if(0>=n(d,m))e[l]=m,e[p]=d,p=l;else break}}}dequeue(){const {_data:p,_compare:e}=this,n=p[0];var m=p.pop();if(0===p.length)return n;p[0]=m;m=0;const l=p.length,d=p[0];let a;let b=null;for(;;){var f=2*m+1;const g=2*m+2;b=null;f<l&&(a=p[f],0<e(a,d)&&(b=f));g<l&&(f=p[g],null===b&&0>=e(f,d)||null!==b&&0>=e(f,a))&&
(b=g);if(null===b)break;p[m]=p[b];p[b]=d;m=b}return n}}const r=(p,e)=>p<e?-1:p>e?1:0;return k})},"esri/symbols/cim/imageUtils":function(){define(["exports"],function(k){k.getFirstFrame=function(r){const p=r.getFrame(0);if(p instanceof HTMLImageElement||p instanceof HTMLCanvasElement)return p;const e=document.createElement("canvas");e.width=r.width;e.height=r.height;r=e.getContext("2d");p instanceof ImageData?r.putImageData(p,0,0):r.drawImage(p,0,0);return e};Object.defineProperty(k,Symbol.toStringTag,
{value:"Module"})})},"esri/symbols/cim/mathUtils":function(){define(["exports"],function(k){k.rotate=function(r,p=0){if(0===p)return r;const e=Math.cos(p);p=Math.sin(p);const [n,m]=r;return[n*e+m*-p,n*p+m*e]};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/rasterizingUtils":function(){define("exports ../../core/floatRGBA ../../core/Logger ../../core/mathUtils ./constants ./defaultCIMValues ../../views/2d/engine/webgl/definitions".split(" "),function(k,r,p,e,n,m,l){function d(c){const h=
[];switch(c.type){case "CIMPolarContinuousColorRamp":case "CIMLinearContinuousColorRamp":"CIMPolarContinuousColorRamp"===c.type&&g().warnOnce("CIMPolarContinuousColorRamp is currently unsupported. Falling back to CIMLinearContinuousColorRamp.");h.push({offset:0,color:[c.fromColor[0],c.fromColor[1],c.fromColor[2],c.fromColor[3]/255]});h.push({offset:1,color:[c.toColor[0],c.toColor[1],c.toColor[2],c.toColor[3]/255]});break;case "CIMFixedColorRamp":var u=1/(c.colors.length-1),A=0;for(var z of c.colors)h.push({offset:A,
color:[z[0],z[1],z[2],z[3]/255]}),A+=u;break;case "CIMMultipartColorRamp":z=c.weights.reduce((t,w)=>t+w,0);A=0;for(let t=0;t<c.colorRamps.length;t++){const w=c.weights[t],x=d(c.colorRamps[t]);for(u of x)h.push({offset:(A+u.offset*w)/z,color:u.color});A+=w}break;default:g().error(`Color ramp "${c.type}" currently unsupported.`)}return h}function a(c,h){const u=[],A=(c.length-1)/(h-1);for(let z=0;z<h;z++){const t=c[Math.round(z*A)].color;u.push({offset:z/h,color:t});u.push({offset:(z+1)/h,color:t})}return u}
function b(c,h,u=0){for(const {offset:A,color:z}of h)c.addColorStop(Math.min(Math.max(A,u),1-u),`rgba(${z[0]}, ${z[1]}, ${z[2]}, ${z[3]})`)}function f(c,h,u,A,z){u+=2*z;c.width=u;c.height=A;z=(z+1)/u;c=c.getContext("2d",{willReadFrequently:!0});if(0<h.length){const t=c.createLinearGradient(0,0,u,A);b(t,h,z);c.fillStyle=t}else c.fillStyle="rgba(128, 128, 128, 1)";c.fillRect(0,0,u,A)}const g=()=>p.getLogger("esri.symbols.cim.rasterizingUtils");let q;k.addColorStops=function(c,h){const {colorRamp:u,
gradientType:A}=h;var z=d(u),t="CIMFixedColorRamp"===u.type;if("Continuous"===A&&!t)return b(c,z);h=h.interval??m.defaultCIMValues.CIMGradientFill.interval;if(t)return h=a(z,h),b(c,h);t=[];q??=document.createElement("canvas");f(q,z,h,1,0);z=q.getContext("2d").getImageData(0,0,h,1).data;for(let w=0,x=0;w<h;w++,x=4*w){const B=[z[x+0],z[x+1],z[x+2],z[x+3]];t.push({offset:w/h,color:B});t.push({offset:(w+1)/h,color:B})}return b(c,t)};k.rasterizeDash=function(c,h){null==c&&(c=[]);var u="Butt"===h,A="Square"===
h;h=!u&&!A;1===c.length%2&&(c=[...c,...c]);const z=n.dashRadius,t=2*z;var w=0;for(var x of c)w+=x;x=Math.round(w*z);w=new Float32Array(x*t);const B=.5*z;let C=0,y=0,v=.5,F=!0;for(var D of c){C=y;for(y+=D*z;v<=y;){for(c=.5;c<t;){const G=h?(c-z)*(c-z):Math.abs(c-z);w[(c-.5)*x+v-.5]=F?u?Math.max(Math.max(C+B-v,G),Math.max(v-y+B,G)):G:h?Math.min((v-C)*(v-C)+G,(v-y)*(v-y)+G):A?Math.min(Math.max(v-C,G),Math.max(y-v,G)):Math.min(Math.max(v-C+B,G),Math.max(y+B-v,G));c++}v++}F=!F}u=w.length;D=new Uint8Array(4*
u);for(A=0;A<u;++A)r.packFloatRGBA((h?Math.sqrt(w[A]):w[A])/z,D,4*A);return[D,x,t]};k.rasterizeDash1D=function(c){1===c.length%2&&(c=[...c,...c]);var h=c.reduce((B,C)=>B+C,0);h=Math.round(h*n.dashSdfRasterizationScale);const u=new Float32Array(1*h);var A=0;let z=0,t=.5,w=!0;for(var x of c){A=z;for(z+=x*n.dashSdfRasterizationScale;t<=z;)c=Math.min(Math.abs(t-A),Math.abs(t-z)),u[t-.5]=w?-c:c,t++;w=!w}x=u.length;c=new Uint8Array(4*x);for(A=0;A<x;++A)r.packFloatRGBA(u[A]/n.dashSdfRasterizationScale/n.dashSdfDistanceNormalization*
.5+.5,c,4*A);return[c,h,1]};k.rasterizeFillStyle=function(c,h,u){h=h.style;u=e.nextPowerOfTwo(Math.ceil(u));var A="vertical"===h||"horizontal"===h||"cross"===h||"esriSFSCross"===h||"esriSFSVertical"===h||"esriSFSHorizontal"===h?8*u:16*u,z=2*u;c.width=A;c.height=A;const t=c.getContext("2d");t.strokeStyle="#ffffff";t.lineWidth=u;t.beginPath();if("vertical"===h||"cross"===h||"esriSFSCross"===h||"esriSFSVertical"===h)t.moveTo(A/2,-z),t.lineTo(A/2,A+z);if("horizontal"===h||"cross"===h||"esriSFSCross"===
h||"esriSFSHorizontal"===h)t.moveTo(-z,A/2),t.lineTo(A+z,A/2);if("backward-diagonal"===h||"diagonal-cross"===h||"esriSFSDiagonalCross"===h||"esriSFSBackwardDiagonal"===h)t.moveTo(-z,-z),t.lineTo(A+z,A+z),t.moveTo(A-z,-z),t.lineTo(A+z,z),t.moveTo(-z,A-z),t.lineTo(z,A+z);if("forward-diagonal"===h||"diagonal-cross"===h||"esriSFSForwardDiagonal"===h||"esriSFSDiagonalCross"===h)t.moveTo(A+z,-z),t.lineTo(-z,A+z),t.moveTo(z,-z),t.lineTo(-z,z),t.moveTo(A+z,A-z),t.lineTo(A-z,A+z);t.stroke();h=t.getImageData(0,
0,c.width,c.height);h=new Uint8Array(h.data);for(z=0;z<h.length;z+=4)A=h[z+3]/255,h[z]*=A,h[z+1]*=A,h[z+2]*=A;return[h,c.width,c.height,u]};k.rasterizeGradient=function(c,h){const {colorRamp:u,gradientType:A}=h;var z="CIMFixedColorRamp"===u.type;h=h.interval||m.defaultCIMValues.CIMGradientFill.interval;let t=d(u);z&&(t=a(t,h));"Discrete"===A||z?f(c,t,h,1,l.gradientTextureExternalPadding):f(c,t,32,1,l.gradientTextureExternalPadding);const {width:w,height:x}=c;c=c.getContext("2d").getImageData(0,0,
w,x);c=new Uint8Array(c.data);for(z=0;z<c.length;z+=4)h=c[z+3]/255,c[z]*=h,c[z+1]*=h,c[z+2]*=h;return[c,w,x]};k.scale=function(c,h){var u=c[0]?.[0]?.[0]??0,A=c[0]?.[0]?.[1]??0,z=A,t=u,w=0,x=0;for(x=0;x<c.length;x++){w=c[x];for(var B=0;B<w.length;B++){var C=w[B][0],y=w[B][1];C<t&&(t=C);C>u&&(u=C);y<z&&(z=y);y>A&&(A=y)}}w=Math.abs(u-t);x=Math.abs(A-z);A=0===w?1:w;u=0===x?1:x;x=[];for(w=0;w<c.length;w++){B=c[w];C=[];for(y=0;y<B.length;y++){let v=Math.round(B[y][0]-t),F=Math.round(B[y][1]-z);v=h.xmin+
v*h.width/A;F=h.ymin+F*h.height/u;if(isNaN(v)||isNaN(F))throw Error("Scaled shape has NaN values");C.push([v,F])}x.push(C)}return x};k.translate=function(c,h,u){const A=[];for(let z=0;z<c.length;z++){const t=c[z],w=[];for(let x=0;x<t.length;x++){const B=t[x][0]+h,C=t[x][1]+u;if(isNaN(B)||isNaN(C))throw Error("Scaled shape has NaN values");w.push([B,C])}A.push(w)}return A};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/constants":function(){define(["exports"],function(k){k.dashRadius=
15.5;k.dashSdfDistanceNormalization=64;k.dashSdfRasterizationScale=4;k.maxTileCoordValue=1024;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/TextRasterizer":function(){define(["../../core/screenUtils","../support/textUtils"],function(k,r){function p(m){return`rgba(${m.slice(0,3).toString()},${m[3]})`}function e(m,l){var d=l.font;d=`${d.style} ${d.weight} ${k.pt2px(Math.max(l.size,.5)).toFixed(1)}px ${d.family}, sans-serif`;m.font=d;m.textBaseline="top";switch(l.horizontalAlignment){case "left":l=
"left";break;case "right":l="right";break;case "center":l="center";break;default:l="left"}m.textAlign=l}class n{constructor(m){m&&(this._textRasterizationCanvas=m)}rasterizeText(m,l){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const d=this._textRasterizationCanvas;var a=d.getContext("2d",{willReadFrequently:!0});e(a,l);this._parameters=l;this._textLines=m.split(/\r?\n/);this._lineHeight=this._computeLineHeight();const {decoration:b,weight:f}=l.font;
this._lineThroughWidthOffset=b&&"line-through"===b?.1*this._lineHeight:0;var g=(m=null!=l.backgroundColor||null!=l.borderLine)?r.backgroundPadding:0,q=this._computeTextWidth(a,l)+2*g,c=this._lineHeight*this._textLines.length+2*g;d.width=q+2*this._lineThroughWidthOffset;d.height=c;if(0===d.width||0===d.height)return d.width=d.height=1,{size:[0,0],image:new Uint32Array(0),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:d};this._renderedLineHeight=Math.round(this._lineHeight);this._renderedOutlineSize=
(l.outline.size||0)*l.pixelRatio;this._renderedHaloSize=(l.halo.size||0)*l.pixelRatio;this._renderedWidth=q;this._renderedHeight=c;this._lineThroughWidthOffset*=l.pixelRatio;q=(l.outline&&l.outline.color)??[0,0,0,0];c=l.halo&&l.halo.color?l.halo.color:[0,0,0,0];this._fillStyle=p(l.color??[0,0,0,0]);this._outlineStyle=p(q);this._haloStyle=`rgb(${c.slice(0,3).toString()})`;q=this._renderedLineHeight;c=this._renderedOutlineSize;var h=this._renderedHaloSize;a.save();a.clearRect(0,0,d.width,d.height);
e(a,l);var u=g*l.pixelRatio;g=a.textAlign;var A=this._renderedWidth-2*u,z=this._renderedHaloSize+this._renderedOutlineSize;g=("center"===g?.5*A:"right"===g?A-z:z)+u;u=h+c+u;h=0<h;A=this._lineThroughWidthOffset;z=0;if(m){a.save();m=l.borderLine?.color??[0,0,0,0];const w=2*(l.borderLine?.size??0);a.fillStyle=p(l.backgroundColor??[0,0,0,0]);a.strokeStyle=p(m);a.lineWidth=w;a.fillRect(0,0,d.width,d.height);a.strokeRect(0,0,d.width,d.height);a.restore()}h&&this._renderHalo(a,g,u,A,z,l);0<c&&this._renderOutline(a,
g,u,A,z,l);z+=u;A+=g;for(var t of this._textLines)h&&(a.globalCompositeOperation="destination-out",a.fillStyle="rgb(0, 0, 0)",a.fillText(t,A,z),a.globalCompositeOperation="source-over"),a.fillStyle=this._fillStyle,a.fillText(t,A,z),b&&"none"!==b&&this._renderDecoration(a,A,z,b,f),z+=q;a.restore();t=this._renderedWidth+2*this._lineThroughWidthOffset;m=this._renderedHeight;a=a.getImageData(0,0,t,m);a=new Uint8Array(a.data);if(l.premultiplyColors)for(c=0;c<a.length;c+=4)q=a[c+3]/255,a[c]*=q,a[c+1]*=
q,a[c+2]*=q;switch(l.horizontalAlignment){case "left":q=-.5;break;case "right":q=.5;break;default:q=0}switch(l.verticalAlignment){case "bottom":l=-.5;break;case "top":l=.5;break;case "baseline":l=-1/6;break;default:l=0}return{size:[t,m],image:new Uint32Array(a.buffer),sdf:!1,simplePattern:!1,anchorX:q,anchorY:l,canvas:d}}_renderHalo(m,l,d,a,b,f){const g=this._renderedWidth,q=this._renderedHeight;this._outlineRasterizationCanvas||(this._outlineRasterizationCanvas=document.createElement("canvas"));
this._outlineRasterizationCanvas.width=g;this._outlineRasterizationCanvas.height=q;const c=this._outlineRasterizationCanvas,h=c.getContext("2d");h.clearRect(0,0,g,q);e(h,f);const {decoration:u,weight:A}=f.font;h.fillStyle=this._haloStyle;h.strokeStyle=this._haloStyle;h.lineJoin="round";this._renderOutlineNative(h,l,d,u,A,this._renderedHaloSize+this._renderedOutlineSize);m.globalAlpha=this._parameters.halo.color[3];m.drawImage(c,0,0,g,q,a,b,g,q);m.globalAlpha=1}_renderOutline(m,l,d,a,b,f){const g=
this._renderedWidth,q=this._renderedHeight;this._outlineRasterizationCanvas||(this._outlineRasterizationCanvas=document.createElement("canvas"));this._outlineRasterizationCanvas.width=g;this._outlineRasterizationCanvas.height=q;const c=this._outlineRasterizationCanvas,h=c.getContext("2d");h.clearRect(0,0,g,q);e(h,f);const {decoration:u,weight:A}=f.font;h.fillStyle=this._outlineStyle;h.strokeStyle=this._outlineStyle;h.lineJoin="round";this._renderOutlineNative(h,l,d,u,A,this._renderedOutlineSize);
m.globalAlpha=this._parameters.outline.color[3];m.drawImage(c,0,0,g,q,a,b,g,q);m.globalAlpha=1}_renderOutlineNative(m,l,d,a,b,f){const g=this._renderedLineHeight;for(const q of this._textLines){const c=2*f;for(let h=0;5>h;h++){const u=(.6+.1*h)*c;m.lineWidth=u;m.strokeText(q,l,d);a&&"none"!==a&&this._renderDecoration(m,l,d,a,b,u)}d+=g}}computeTextSize(m,l){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const d=this._textRasterizationCanvas;var a=d.getContext("2d");
e(a,l);this._parameters=l;this._textLines=m.split(/\r?\n/);this._lineHeight=this._computeLineHeight();m=this._computeTextWidth(a,l);a=this._lineHeight*this._textLines.length;d.width=m;d.height=a;return[m*l.pixelRatio,a*l.pixelRatio]}_computeTextWidth(m,l){let d=0;for(const a of this._textLines)d=Math.max(d,m.measureText(a).width);l=l.font;if("italic"===l.style||"oblique"===l.style||"string"===typeof l.weight&&("bold"===l.weight||"bolder"===l.weight)||"number"===typeof l.weight&&600<l.weight)d+=.3*
m.measureText("w").width;d+=2*k.pt2px(this._parameters.halo.size);return Math.round(d)}_computeLineHeightBase(){return 1.275*this._parameters.size}_computeLineHeight(){let m=this._computeLineHeightBase();const l=this._parameters.font.decoration;l&&"underline"===l&&(m*=1.3);return Math.round(m+2*k.pt2px(this._parameters.halo.size))}_renderDecoration(m,l,d,a,b,f){let g=.9*this._lineHeight;b="bold"===b?.06:"bolder"===b?.09:.04;switch(m.textAlign){case "center":l-=this._renderedWidth/2;break;case "right":l-=
this._renderedWidth}const q=m.textBaseline;if("underline"===a)switch(g=.9*this._computeLineHeightBase(),q){case "top":d+=g;break;case "middle":d+=g/2}else if("line-through"===a)switch(q){case "top":d+=g/1.5;break;case "middle":d+=g/3}a=f?1.5*f:Math.ceil(g*b);m.save();m.beginPath();m.strokeStyle=m.fillStyle;m.lineWidth=a;m.moveTo(l-this._lineThroughWidthOffset,d);m.lineTo(l+this._renderedWidth+2*this._lineThroughWidthOffset,d);m.stroke();m.restore()}}return n})},"esri/views/2d/engine/svgUtils":function(){define(["exports"],
function(k){function r(p){return document.createElementNS("http://www.w3.org/2000/svg",p)}k.createHiddenSvg=function(){const p=r("svg");p.setAttribute("style","position: absolute;");p.setAttribute("width","0");p.setAttribute("height","0");p.setAttribute("aria-hidden","true");p.setAttribute("role","presentation");document.body.appendChild(p);return p};k.createSvgElement=r;k.destroyHiddenSvg=function(p){null!=p&&document.body.removeChild(p);return null};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/mesh/templates/shapingUtils":function(){define("exports ../../../../../../core/libs/gl-matrix-2/math/mat2d ../../../../../../core/libs/gl-matrix-2/factories/mat2df32 ../../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../alignmentUtils ../../Rect ../../collisions/BoundingBox".split(" "),function(k,r,p,e,n,m,l,d){function a(c,h){c.forEach(u=>e.transformMat2d(u,u,h));return{topLeft:c[0],topRight:c[1],bottomLeft:c[2],
bottomRight:c[3]}}const b=Math.PI/180;class f{constructor(c,h,u,A){this._rotationT=p.create();this.minZoom=this._yBounds=this._xBounds=0;this.maxZoom=255;this._bounds=null;const z=u.rect,t=new Float32Array(8);c*=A;h*=A;const w=u.code?z.width*A:u.metrics.width,x=u.code?z.height*A:u.metrics.height;this.width=w;this.height=x;t[0]=c;t[1]=h;t[2]=c+w;t[3]=h;t[4]=c;t[5]=h+x;t[6]=c+w;t[7]=h+x;this._data=t;this._setTextureCoords(z);this._scale=A;this._mosaic=u;this.x=c;this.y=h;this.maxOffset=Math.max(c+w,
h+x)}get mosaic(){return this._mosaic}set angle(c){this._angle=c;r.fromRotation(this._rotationT,-c);this._setOffsets()}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){this._offsets||this._setOffsets();return this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){if(!this._bounds){const {height:z,
width:t}=this._mosaic.metrics;var c=t*this._scale,h=Math.abs(z)*this._scale,u=new Float32Array(8);u[0]=this.x;u[1]=this.y;u[2]=this.x+c;u[3]=this.y;u[4]=this.x;u[5]=this.y+h;u[6]=this.x+c;u[7]=this.y+h;c=r.multiply(p.create(),this._rotationT,this._transform);p.transformMany(u,u,c);h=c=Infinity;let w=-Infinity;var A=-Infinity;for(let x=0;4>x;x++){const B=u[2*x],C=u[2*x+1];c=Math.min(c,B);h=Math.min(h,C);w=Math.max(w,B);A=Math.max(A,C)}u=w-c;A-=h;this._bounds=new d(c+u/2,h+A/2,u,A)}return this._bounds}setTransform(c){this._transform=
c;this._offsets=null}_setOffsets(){this._offsets||(this._offsets={topLeft:[0,0],topRight:[0,0],bottomLeft:[0,0],bottomRight:[0,0]});const c=r.multiply(p.create(),this._rotationT,this._transform);this._offsets.topLeft[0]=this._data[0];this._offsets.topLeft[1]=this._data[1];this._offsets.topRight[0]=this._data[2];this._offsets.topRight[1]=this._data[3];this._offsets.bottomLeft[0]=this._data[4];this._offsets.bottomLeft[1]=this._data[5];this._offsets.bottomRight[0]=this._data[6];this._offsets.bottomRight[1]=
this._data[7];e.transformMat2d(this._offsets.topLeft,this._offsets.topLeft,c);e.transformMat2d(this._offsets.topRight,this._offsets.topRight,c);e.transformMat2d(this._offsets.bottomLeft,this._offsets.bottomLeft,c);e.transformMat2d(this._offsets.bottomRight,this._offsets.bottomRight,c)}_setTextureCoords({x:c,y:h,width:u,height:A}){this._texcoords={topLeft:[c,h],topRight:[c+u,h],bottomLeft:[c,h+A],bottomRight:[c+u,h+A]}}}class g{constructor(c,h,u){this._rotation=0;this._decorate(c,h,u);this.glyphs=
c;this.bounds=this._createBounds(c);this.isMultiline=1<h.length;this._hasRotation=0!==u.angle;this._transform=this._createGlyphTransform(this.bounds,u);if((this._borderLineSizePx=u.borderLineSizePx)||u.hasBackground)[this.bounds,this.textBox]=this.shapeBackground(this._transform);for(const A of c)A.setTransform(this._transform)}setRotation(c){if(0!==c||0!==this._rotation){this._rotation=c;var h=this._transform;c=r.fromRotation(p.create(),c);r.multiply(h,c,h);for(const u of this.glyphs)u.setTransform(this._transform)}}_decorate(c,
h,u){if(u.decoration&&"none"!==u.decoration&&c.length){var A=u.scale;u="underline"===u.decoration?26:16;var z=c[0].textureBinding;for(const B of h){const C=B.startX*A,y=B.startY*A;h=c;var t=h.push;var w=(B.width+B.glyphWidthEnd)*A;var x=z;w={code:0,page:0,sdf:!0,rect:new l(0,0,11,8),textureBinding:x,metrics:{advance:0,height:4,width:w,left:0,top:0}};t.call(h,new f(C,y+u*A,w,1))}}}shapeBackground(c){const h=(1.5+(this._borderLineSizePx||0))/2;var u=this._borderLineSizePx?h:0;const {xmin:A,ymin:z,xmax:t,
ymax:w,x,y:B,width:C,height:y}=this.bounds,v=[A-8,z-8],F=[t+8,z-8],D=[A-8,w+8],G=[t+8,w+8],E=a([[v[0]-h,v[1]-h],[F[0]+h,F[1]-h],[v[0]+u,v[1]+u],[F[0]-u,F[1]+u]],c),H=a([[D[0]+u,D[1]-u],[G[0]-u,G[1]-u],[D[0]-h,D[1]+h],[G[0]+h,G[1]+h]],c),K=a([[v[0]-h,v[1]-h],[v[0]+u,v[1]+u],[D[0]-h,D[1]+h],[D[0]+u,D[1]-u]],c);u=a([[F[0]-u,F[1]+u],[F[0]+h,F[1]-h],[G[0]-u,G[1]-u],[G[0]+h,G[1]+h]],c);c={main:a([v,F,D,G],c),top:E,bot:H,left:K,right:u};return[new d(x,B,C+2*h,y+2*h),c]}get boundsT(){var c=this.bounds;const h=
e.set(n.create(),c.x,c.y);e.transformMat2d(h,h,this._transform);return this._hasRotation?(c=Math.max(c.width,c.height),new d(h[0],h[1],c,c)):new d(h[0],h[1],c.width,c.height)}_createBounds(c){let h=Infinity,u=Infinity,A=0;var z=0;for(const t of c)h=Math.min(h,t.xTopLeft),u=Math.min(u,t.yTopLeft),A=Math.max(A,t.xBottomRight),z=Math.max(z,t.yBottomRight);c=A-h;z-=u;return new d(h+c/2,u+z/2,c,z)}_createGlyphTransform(c,h){const u=b*h.angle,A=p.create(),z=n.create();r.translate(A,A,e.set(z,h.xOffset,
-h.yOffset));h.useCIMAngleBehavior?r.rotate(A,A,u):(r.translate(A,A,e.set(z,c.x,c.y)),r.rotate(A,A,u),r.translate(A,A,e.set(z,-c.x,-c.y)));return A}}class q{constructor(c,h,u,A,z,t){this.startY=this.startX=this.glyphWidthEnd=0;this.start=Math.max(0,Math.min(h,u));this.end=Math.max(0,Math.max(h,u));this.end<c.length&&(this.glyphWidthEnd=c[this.end].metrics.width);this.width=A;this.yMin=z;this.yMax=t}}k.ShapedGlyph=f;k.ShapingInfo=g;k.shapeGlyphs=function(c,h){const u=h.scale,A=[],{glyphs:z,isRightToLeft:t}=
c,w=[];var x=1/h.scale*h.maxLineWidth,B=t?z.length-1:0,C=t?-1:z.length,y=t?-1:1,v=B,F=0,D=0,G=v;let E=G,H=0,K=Infinity,J=0;for(;v!==C;){const {code:P,metrics:Q}=z[v];var L=Math.abs(Q.top);10!==P&&32!==P&&(K=Math.min(K,L),J=Math.max(J,L+Q.height));10===P?(v!==B&&(w.push(new q(z,G,v-y,F,Infinity===K?0:K,J)),K=Infinity,J=0),F=0,G=v+y,E=v+y,D=0):32===P?(E=v+y,D=0,H=Q.advance,F+=Q.advance):(F>x&&(E!==G?(L=E-2*y,F-=H,w.push(new q(z,G,L,F-D,K,J)),K=Infinity,J=0,G=E,F=D):(w.push(new q(z,G,v-y,F,K,J)),K=Infinity,
J=0,E=G=v,F=0)),F+=Q.advance,D+=Q.advance);v+=y}x=new q(z,G,v-y,F,K,J);0<=x.start&&x.end<z.length&&w.push(x);if(w.length){x=0;for(B=0;B<w.length;B++)({width:C}=w[B]),x=Math.max(C,x);B=w[0].yMin;x={x:0,y:B,height:w[w.length-1].yMax+h.lineHeight*(w.length-1)+("underline"===h.decoration?4:0)-B,width:x}}else x={x:0,y:0,height:0,width:0};B=x;x=m.getXAnchorDirection(h.horizontalAlignment);C=m.getYAnchorDirection(h.verticalAlignment);y=C===m.VAlign.Baseline?1:0;B=(1-y)*-B.y+B.height/2*(y?0:C-1)+-22*(y?1:
0);for(C=0;C<w.length;C++){const {start:P,end:Q,width:S}=w[C];y=S/2*(x+1)*-1-3;v=(c.isRightToLeft?w.length-1-C:C)*h.lineHeight+B-3;w[C].startX=y;w[C].startY=v;for(F=P;F<=Q;F++)D=z[F],10!==D.code&&(G=new f(y+D.metrics.left,v-D.metrics.top,D,u),y+=D.metrics.advance,A.push(G))}return new g(A,w,h)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/alignmentUtils":function(){define(["exports","../../../../core/Logger"],function(k,r){k.HAlign=void 0;(function(p){p[p.Left=
-1]="Left";p[p.Center=0]="Center";p[p.Right=1]="Right"})(k.HAlign||(k.HAlign={}));k.VAlign=void 0;(function(p){p[p.Top=1]="Top";p[p.Center=0]="Center";p[p.Bottom=-1]="Bottom";p[p.Baseline=2]="Baseline"})(k.VAlign||(k.VAlign={}));k.getAlignmentFromPlacement=function(p){switch(p){case "above-left":case "esriServerPointLabelPlacementAboveLeft":return["right","bottom"];case "above-center":case "above-along":case "esriServerPointLabelPlacementAboveCenter":case "esriServerLinePlacementAboveAlong":return["center",
"bottom"];case "above-right":case "esriServerPointLabelPlacementAboveRight":return["left","bottom"];case "center-left":case "esriServerPointLabelPlacementCenterLeft":return["right","middle"];case "center-center":case "center-along":case "esriServerPointLabelPlacementCenterCenter":case "esriServerLinePlacementCenterAlong":return["center","middle"];case "center-right":case "esriServerPointLabelPlacementCenterRight":return["left","middle"];case "below-left":case "esriServerPointLabelPlacementBelowLeft":return["right",
"top"];case "below-center":case "below-along":case "esriServerPointLabelPlacementBelowCenter":case "esriServerLinePlacementBelowAlong":return["center","top"];case "below-right":case "esriServerPointLabelPlacementBelowRight":return["left","top"];case "always-horizontal":case "esriServerPolygonPlacementAlwaysHorizontal":return["center","middle"];default:return console.debug(`Found invalid placement type ${p}`),["center","middle"]}};k.getXAnchorDirection=function(p){if(!p)return k.HAlign.Center;switch(p){case "Left":case "left":return k.HAlign.Left;
case "Right":case "right":return k.HAlign.Right;case "Justify":return r.getLogger("esri.views.2d.engine.webgl.alignmentUtils").warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),k.HAlign.Center;case "Center":case "center":return k.HAlign.Center}};k.getXDirection=function(p){switch(p){case k.HAlign.Right:case "right":return-1;case k.HAlign.Center:case "center":return 0;case k.HAlign.Left:case "left":return 1;default:return console.debug(`Found invalid horizontal alignment ${p}`),
0}};k.getYAnchorDirection=function(p){if(!p)return k.VAlign.Center;switch(p){case "Top":case "top":return k.VAlign.Top;case "Center":case "middle":return k.VAlign.Center;case "Baseline":case "baseline":return k.VAlign.Baseline;case "Bottom":case "bottom":return k.VAlign.Bottom}};k.getYDirection=function(p){switch(p){case k.VAlign.Top:case "top":return 1;case k.VAlign.Center:case "middle":return 0;case k.VAlign.Bottom:case k.VAlign.Baseline:case "baseline":case "bottom":return-1;default:return console.debug(`Found invalid vertical alignment ${p}`),
0}};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/Rect":function(){define(function(){class k{constructor(r=0,p=0,e=0,n=0){this.x=r;this.y=p;this.width=e;this.height=n}get isEmpty(){return 0>=this.width||0>=this.height}union(r){this.x=Math.min(this.x,r.x);this.y=Math.min(this.y,r.y);this.width=Math.max(this.width,r.width);this.height=Math.max(this.height,r.height)}}return k})},"esri/views/2d/engine/webgl/collisions/BoundingBox":function(){define(["../../../../../core/libs/gl-matrix-2/factories/vec2f32"],
function(k){class r{constructor(p,e,n,m){this.transformedY=this.transformedX=0;this.center=k.fromValues(p,e);this.centerT=k.create();this.halfWidth=n/2;this.halfHeight=m/2;this.width=n;this.height=m}get x(){return this.center[0]}get y(){return this.center[1]}get blX(){return this.center[0]+this.halfWidth}get blY(){return this.center[1]+this.halfHeight}get trX(){return this.center[0]-this.halfWidth}get trY(){return this.center[1]-this.halfHeight}get xmin(){return this.x-this.halfWidth}get xmax(){return this.x+
this.halfWidth}get ymin(){return this.y-this.halfHeight}get ymax(){return this.y+this.halfHeight}set x(p){this.center[0]=p}set y(p){this.center[1]=p}clone(){return new r(this.x,this.y,this.width,this.height)}serialize(p){p.writeF32(this.center[0]);p.writeF32(this.center[1]);p.push(this.width);p.push(this.height);return p}findCollisionDelta(p,e=4){return Math.log2(Math.min((p.halfWidth+this.halfWidth+e)/Math.abs(p.centerT[0]-this.centerT[0]),(p.halfHeight+this.halfHeight+e)/Math.abs(p.centerT[1]-this.centerT[1])))}extend(p){const e=
Math.min(this.xmin,p.xmin),n=Math.min(this.ymin,p.ymin),m=Math.max(this.xmax,p.xmax)-e;p=Math.max(this.ymax,p.ymax)-n;this.width=m;this.height=p;this.halfWidth=m/2;this.halfHeight=p/2;this.x=e+m/2;this.y=n+p/2}static deserialize(p){const e=p.readF32(),n=p.readF32(),m=p.readInt32();p=p.readInt32();return new r(e,n,m,p)}}return r})},"esri/views/2d/layers/graphics/graphicsUtils":function(){define(["exports","../../../../core/screenUtils","../../../../geometry/Polygon","../../engine/webgl/definitions"],
function(k,r,p,e){k.getLineWidth=function(n){const m=r.px2pt(e.minTextLineWidth),l=r.px2pt(e.maxTextLineWidth);return Math.max(m,Math.min(n||l,l))};k.pixelBuffer=50;k.polygonFromExtent=function(n){if(!n)return null;const {xmin:m,ymin:l,xmax:d,ymax:a,spatialReference:b}=n;return new p({rings:[[[m,l],[m,a],[d,a],[d,l],[m,l]]],spatialReference:b})};k.roundPtToWholePixel=function(n){return r.px2pt(Math.round(r.pt2px(n)))};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/GeometryUtils":function(){define(["exports",
"../../../../geometry/support/coordsUtils","../../../../geometry/support/TileClipper"],function(k,r,p){function e(b,f){b%=f;return 0<=b?b:b+f}const n=Number.POSITIVE_INFINITY,m=Math.PI,l=128/m,d=256/360,a=1/Math.LN2;k.between=function(b,f,g){return b>=f&&b<=g||b>=g&&b<=f};k.c2pi=2*m;k.cDegTo256=d;k.cDegToRad=m/180;k.cInfinity=n;k.cPi=m;k.cRadTo256=l;k.degToByte=function(b){return e(b*d,256)};k.distanceFromToPolylineWithinThreshold=function(b,f,g,q){let c,h,u;q*=q;for(const A of g){const z=A.length;
if(!(2>z)){g=A[0].x;c=A[0].y;for(let t=1;t<z;++t){h=A[t].x;u=A[t].y;if(r.distanceToSegmentSquared(b,f,g,c,h,u)<q)return!0;g=h;c=u}}}return!1};k.getTileMargins=function(b){return 8+Math.max(16*(b-14),0)};k.interpolate=function(b,f,g){return b*(1-g)+f*g};k.isCircleOverlapingRect=function(b,f,g,q,c,h,u){f=Math.max(q,Math.min(f,h))-f;g=Math.max(c,Math.min(g,u))-g;return f*f+g*g<=b*b};k.log2=function(b){return Math.log(b)*a};k.offsetLine=function(b,f){if(0===f||Number.isNaN(f))return b;const g=[],q=new p.Point(0,
0),c=new p.Point(0,0),h=new p.Point(0,0);for(let A=0;A<b.length;A++){const z=b[A],t=[];for(let w=0;w<z.length;w++){var u=z[w-1];const x=z[w],B=z[w+1];0===w?q.setCoords(0,0):q.assignSub(x,u).normalize().rightPerpendicular();w===z.length-1?c.setCoords(0,0):c.assignSub(B,x).normalize().rightPerpendicular();h.assignAdd(q,c).normalize();u=h.x*c.x+h.y*c.y;0!==u&&h.scale(1/u);t.push(p.Point.add(x,h.scale(f)))}g.push(t)}return g};k.pointInPolygon=function(b,f,g){let q=0,c,h;for(const u of g){g=u.length;for(let A=
1;A<g;++A)c=u[A-1],h=u[A],c.y>f!==h.y>f&&(0<(h.x-c.x)*(f-c.y)-(h.y-c.y)*(b-c.x)?q++:q--)}return 0!==q};k.positiveMod=e;k.radToByte=function(b){return e(b*l,256)};k.sqr=function(b){return b*b};k.translateAnchor=function(b,f,g,q){b=new p.Point(b[0],b[1]);b.scale(q);"viewport"===f&&(f=Math.PI/180*-g,b.rotate(Math.cos(f),Math.sin(f)));return b};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/fitVectorMarker":function(){define(["exports","../../core/lang","./SDFHelper",
"./effects/CIMEffectHelper"],function(k,r,p,e){k.fitVectorMarker=function(n,m){if(!n.frame)return n;var {markerGraphics:l}=n;if(!l||0===l.length)return n;var d=0;let a=0,b=0,f=0;for(var g of l){const {geometry:z,symbol:t}=g;if(z&&t&&"symbolLayers"in t&&({symbolLayers:l}=t,l))for(var q of l)if({effects:l}=q,l=e.CIMEffectHelper.applyEffects(l,z,m),l=p.getExtent(l))d=Math.min(d,l[0]),a=Math.min(a,l[1]),b=Math.max(b,l[2]),f=Math.max(f,l[3])}const {xmin:c,ymin:h,xmax:u,ymax:A}=n.frame;q=(u-c)/2;l=(A-h)/
2;m=(u+c)/2;g=(A+h)/2;if(0>=q||0>=l)return n;d=Math.max(Math.max((m-d)/q,(b-m)/q),Math.max((g-a)/l,(f-g)/l));if(1.01>=d)return n;n=r.clone(n);if(!n.frame)return n;n.frame.xmin=(n.frame.xmin-m)*d+m;n.frame.ymin=(n.frame.ymin-g)*d+g;n.frame.xmax=(n.frame.xmax-m)*d+m;n.frame.ymax=(n.frame.ymax-g)*d+g;!1!==n.respectFrame&&(n.size*=d);return n};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/CIMEffectHelper":function(){define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMEffects ../CIMOperators ../CIMSymbolHelper".split(" "),
function(k,r,p,e,n,m){const l=96/72;class d{static executeEffects(a,b,f,g,q){const c=m.getEffectsInflateSize(a);b=new e.SimpleEffectCursor(b);for(const h of a)(a=n.getEffectOperator(h))&&(b=a.execute(b,h,l,f,g,c,q));return b}static applyEffects(a,b,f){if(!a)return b;var g=m.getEffectsInflateSize(a);b=new e.SimpleEffectCursor(r.GeometryCursor.fromJSONCIM(b));for(var q of a)(a=n.getEffectOperator(q))&&(b=a.execute(b,q,1,null,f,g,!1));g=[];for(q=null;f=b.next();)g.push(...p.collectMultipath(f)),q=f.geometryType;
return 0===g.length||null===q?null:"esriGeometryPolygon"===q?{rings:g}:{paths:g}}}k.CIMEffectHelper=d;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/OverrideHelper":function(){define("exports ../../Color ../../core/colorUtils ../../core/lang ../../support/arcadeOnDemand ./utils ../../views/2d/arcade/callExpressionWithFeature".split(" "),function(k,r,p,e,n,m,l){class d{static findApplicableOverrides(a,b,f){if(a&&b){if(a.primitiveName){let g=!1;for(const q of f)if(q.primitiveName===
a.primitiveName){g=!0;break}if(!g)for(const q of b)q.primitiveName===a.primitiveName&&f.push(q)}switch(a.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(a.effects)for(const g of a.effects)d.findApplicableOverrides(g,b,f);if(a.symbolLayers)for(const g of a.symbolLayers)d.findApplicableOverrides(g,b,f);break;case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":case "CIMSolidFill":case "CIMPictureFill":case "CIMHatchFill":case "CIMGradientFill":case "CIMVectorMarker":case "CIMCharacterMarker":case "CIMPictureMarker":if(a.effects)for(const g of a.effects)d.findApplicableOverrides(g,
b,f);a.markerPlacement&&d.findApplicableOverrides(a.markerPlacement,b,f);if("CIMVectorMarker"===a.type){if(a.markerGraphics)for(const g of a.markerGraphics)d.findApplicableOverrides(g,b,f),d.findApplicableOverrides(g.symbol,b,f)}else"CIMCharacterMarker"===a.type?d.findApplicableOverrides(a.symbol,b,f):"CIMHatchFill"===a.type?d.findApplicableOverrides(a.lineSymbol,b,f):"CIMPictureMarker"===a.type&&d.findApplicableOverrides(a.animatedSymbolProperties,b,f)}}}static findEffectOverrides(a,b){if(!a)return null;
"CIMGeometricEffectDashes"===a.type&&m.normalizeDashEffectTemplate(a);if(!b||!a.primitiveName)return{type:"cim-effect-param",effect:a,overrides:[]};const f=m.toLowerCaseProps(a);a=a.primitiveName;const g=[];for(const q of b)q.primitiveName===a&&g.push(m.toLowerCaseProps(q));return{type:"cim-effect-param",effect:f,overrides:m.normalizePrimitiveOverrideProps(g)}}static async resolveSymbolOverrides(a,b,f,g,q,c,h){if(!a?.symbol)return null;let {symbol:u,primitiveOverrides:A}=a;a=!!A;if(!a&&!g)return u;
u=e.clone(u);A=e.clone(A);let z=!0;b||(b={attributes:{}},z=!1);a&&(z||(A=A.filter(t=>!t.valueExpressionInfo?.expression.includes("$feature"))),h||(A=A.filter(t=>!t.valueExpressionInfo?.expression.includes("$view"))),0<A.length&&(a=m.attributesToFields(b.attributes),await d.createRenderExpressions(A,{spatialReference:f,fields:a,geometryType:q}),d.evaluateOverrides(A,b,q??"esriGeometryPoint",c,h)),d.applyOverrides(u,A));g&&d.applyDictionaryTextOverrides(u,b,g,null);return u}static async createRenderExpressions(a,
b){const f=[];for(const g of a){const q=g.valueExpressionInfo;q&&!d._expressionToRenderExpression.has(q.expression)&&(a=n.createRendererExpression(q.expression,b.spatialReference,b.fields),f.push(a),a.then(c=>d._expressionToRenderExpression.set(q.expression,c)))}0<f.length&&await Promise.all(f)}static evaluateOverrides(a,b,f,g,q){q={$view:{scale:q?.scale}};for(const c of a){if(c.value&&"object"===typeof c.value&&p.isRGB(c.value)&&("Color"===c.propertyName||"StrokeColor"===c.propertyName)){a:{a=c.value;
if(!a){a=[0,0,0,0];break a}const {r:h,g:u,b:A,a:z}=a;a=[h,u,A,255*z]}c.value=a}if(a=c.valueExpressionInfo)if(a=d._expressionToRenderExpression.get(a.expression))c.value=l(a,b,q,f,g)}}static applyDictionaryTextOverrides(a,b,f,g,q="Normal"){if(a?.type)switch(a.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":case "CIMTextSymbol":var c=a.symbolLayers;if(!c)break;for(var h of c)h&&"CIMVectorMarker"===h.type&&d.applyDictionaryTextOverrides(h,b,f,g,"CIMTextSymbol"===a.type?a.textCase:
q);break;case "CIMVectorMarker":a=a.markerGraphics;if(!a)break;for(c of a)c&&d.applyDictionaryTextOverrides(c,b,f,g);break;case "CIMMarkerGraphic":(h=a.textString)&&h.includes("[")&&(f=m.analyzeTextParts(h,f),a.textString=m.assignTextValuesFromFeature(b,f,g,q))}}static applyOverrides(a,b,f,g){if(a.primitiveName)for(const q of b)if(q.primitiveName===a.primitiveName){const c=m.uncapitalize(q.propertyName);g&&g.push({cim:a,nocapPropertyName:c,value:a[c]});if(f){let h=!1;for(const u of f)u.primitiveName===
a.primitiveName&&(h=!0);h||f.push(q)}null!=q.value&&(a[c]=q.value)}switch(a.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(a.effects)for(const q of a.effects)d.applyOverrides(q,b,f,g);if(a.symbolLayers)for(const q of a.symbolLayers)d.applyOverrides(q,b,f,g);break;case "CIMSolidStroke":case "CIMSolidFill":case "CIMVectorMarker":if(a.effects)for(const q of a.effects)d.applyOverrides(q,b,f,g);if("CIMVectorMarker"===a.type&&a.markerGraphics)for(const q of a.markerGraphics)d.applyOverrides(q,
b,f,g),d.applyOverrides(q.symbol,b,f,g)}}static restoreOverrides(a){for(const b of a)b.cim[b.nocapPropertyName]=b.value}static buildOverrideKey(a){let b="";for(const f of a)void 0!==f.value&&(b+=`${f.primitiveName}${f.propertyName}${JSON.stringify(f.value)}`);return b}static toValue(a,b){return"DashTemplate"===a?b.split(" ").map(f=>Number(f)):"Color"===a?(a=(new r(b)).toRgba(),a[3]*=255,a):b}}d._expressionToRenderExpression=new Map;k.OverrideHelper=d;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/arcade/callExpressionWithFeature":function(){define(["../../../core/Error","../../../core/Logger","../../../geometry/support/quantizationUtils"],function(k,r,p){function e(m){const l={};switch(m){case "esriGeometryPoint":return(d,a,b,f)=>p.unquantizePoint(a,l,d,b,f);case "esriGeometryPolygon":return(d,a,b,f)=>p.unquantizePolygon(a,l,d,b,f);case "esriGeometryPolyline":return(d,a,b,f)=>p.unquantizePolyline(a,l,d,b,f);case "esriGeometryMultipoint":return(d,a,b,f)=>p.unquantizeMultipoint(a,
l,d,b,f);default:return r.getLogger("esri.views.2d.support.arcadeOnDemand").error(new k("mapview-arcade",`Unable to handle geometryType: ${m}`)),d=>d}}const n=new Map;return function(m,l,d,a,b){if(null==m)return null;if(m.references("geometry")&&b){const {transform:f,hasZ:g,hasM:q}=b;n.has(a)||n.set(a,e(a));a=n.get(a)(l.geometry,f,g,q);l={...l,geometry:a}}l=m.repurposeFeature(l);try{return m.evaluate({...d,$feature:l},m.services)}catch(f){return r.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",
f),null}}})},"esri/geometry/support/quantizationUtils":function(){define(["exports","./jsonUtils"],function(k,r){function p(H){if("lowerLeft"===H.originPosition&&4===H.scale.length&&4===H.translate.length)return H;const {originPosition:K,scale:J,translate:L}=H;H=J[1]??1;return{originPosition:"lowerLeft",scale:[J[0]??1,"lowerLeft"===K?H:-H,J[2]??1,J[3]??1],translate:[L[0]??0,L[1]??0,L[2]??0,L[3]??0]}}function e({scale:H,translate:K},J){return Math.round((J-K[0])/H[0])}function n({scale:H,translate:K},
J){return Math.round((J-K[1])/H[1])}function m({scale:H,translate:K},J){return Math.round(((J??0)-K[2])/H[2])}function l({scale:H,translate:K},J){return J?Math.round((J-K[3])/H[3]):0}function d(H,K){return H&&K?v:H&&!K?C:!H&&K?y:B}function a({scale:H,translate:K},J){return J*H[0]+K[0]}function b({scale:H,translate:K},J){return J*H[1]+K[1]}function f({scale:H,translate:K},J){return(J??0)*H[2]+K[2]}function g({scale:H,translate:K},J){return J?J*H[3]+K[3]:0}function q(H,K){return H&&K?E:H&&!K?D:!H&&
K?G:F}function c(H,K,J){const L=Array(J.length);for(let P=0;P<J.length;P++)L[P]=K(H,J[P]);return L}function h(H,K,J){let [L,P]=J[0],Q=Math.min(L,K[0]),S=Math.min(P,K[1]),U=Math.max(L,K[2]);K=Math.max(P,K[3]);for(let X=1;X<J.length;X++){const [aa,ba]=J[X];L+=aa;P+=ba;0>aa&&(Q=Math.min(Q,L));0<aa&&(U=Math.max(U,L));0>ba?S=Math.min(S,P):0<ba&&(K=Math.max(K,P))}H[0]=Q;H[1]=S;H[2]=U;H[3]=K;return H}function u(H,K){if(!K.length)return null;H[0]=H[1]=Number.POSITIVE_INFINITY;H[2]=H[3]=Number.NEGATIVE_INFINITY;
for(let J=0;J<K.length;J++)h(H,H,K[J]);return H}function A(H,K,J){H=p(H);K.xmin=e(H,J.xmin);K.ymin=n(H,J.ymin);K.xmax=e(H,J.xmax);K.ymax=n(H,J.ymax);J.hasZ&&(K.zmin=m(H,J.zmin),K.zmax=m(H,J.zmax));J.hasM&&(K.mmin=l(H,J.mmin),K.mmax=l(H,J.mmax));K.hasZ=J.hasZ??!1;K.hasM=J.hasM??!1;return K}function z(H,K,J){H=p(H);K.points=d(J.hasZ,J.hasM)(H,J.points)??[];K.hasZ=J.hasZ??!1;K.hasM=J.hasM??!1;return K}function t(H,K,J){H=p(H);K.x=e(H,J.x);K.y=n(H,J.y);null!=J.z&&(K.z=m(H,J.z));null!=J.m&&(K.m=l(H,J.m));
return K}function w(H,K,J){{H=p(H);var L=J.rings;const P=[],Q=d(J.hasZ,J.hasM);for(let S=0;S<L.length;S++){const U=Q(H,L[S]);U&&3<=U.length&&P.push(U)}H=P.length?P:null}if(!H)return null;K.rings=H;K.hasZ=J.hasZ??!1;K.hasM=J.hasM??!1;return K}function x(H,K,J){{H=p(H);var L=J.paths;const P=[],Q=d(J.hasZ,J.hasM);for(let S=0;S<L.length;S++){const U=Q(H,L[S]);U&&2<=U.length&&P.push(U)}H=P.length?P:null}if(!H)return null;K.paths=H;K.hasZ=J.hasZ??!1;K.hasM=J.hasM??!1;return K}const B=(H,K)=>{const J=[];
if(!K.length)return null;var L=K[0];let P=e(H,L[0]);L=n(H,L[1]);J.push([P,L]);for(let Q=1;Q<K.length;Q++){const [S,U]=K[Q],X=e(H,S),aa=n(H,U);X===P&&aa===L||J.push([X-P,aa-L]);P=X;L=aa}return J},C=(H,K)=>{const J=[];if(!K.length)return null;var L=K[0];let P=e(H,L[0]),Q=n(H,L[1]);L=m(H,L[2]);J.push([P,Q,L]);for(let S=1;S<K.length;S++){const [U,X,aa]=K[S],ba=e(H,U),fa=n(H,X),I=m(H,aa);ba===P&&fa===Q&&I===L||J.push([ba-P,fa-Q,I]);P=ba;Q=fa;L=I}return J},y=(H,K)=>{const J=[];if(!K.length)return null;
var L=K[0];let P=e(H,L[0]),Q=n(H,L[1]);L=l(H,L[2]);J.push([P,Q,L]);for(let S=1;S<K.length;S++){const [U,X,aa]=K[S],ba=e(H,U),fa=n(H,X),I=l(H,aa);ba===P&&fa===Q&&I===L||J.push([ba-P,fa-Q,I]);P=ba;Q=fa;L=I}return J},v=(H,K)=>{const J=[];if(!K.length)return null;var L=K[0];let P=e(H,L[0]),Q=n(H,L[1]),S=m(H,L[2]);L=l(H,L[3]);J.push([P,Q,S,L]);for(let U=1;U<K.length;U++){const [X,aa,ba,fa]=K[U],I=e(H,X),M=n(H,aa),N=m(H,ba),R=l(H,fa);I===P&&M===Q&&N===S&&R===L||J.push([I-P,M-Q,N,R]);P=I;Q=M;S=N;L=R}return J},
F=(H,K)=>{const J=Array(K.length);if(!K.length)return J;var L=K[0];let P=a(H,L[0]);L=b(H,L[1]);J[0]=[P,L];const {scale:Q,originPosition:S}=H;H=Q[0];const U="lowerLeft"===S?Q[1]:-Q[1];for(let X=1;X<K.length;X++){const [aa,ba]=K[X];P+=H*aa;L+=U*ba;J[X]=[P,L]}return J},D=(H,K)=>{const J=Array(K.length);if(!K.length)return J;var L=K[0];let P=a(H,L[0]),Q=b(H,L[1]);J[0]=[P,Q,f(H,L[2])];const {scale:S,originPosition:U}=H;L=S[0];const X="lowerLeft"===U?S[1]:-S[1];for(let aa=1;aa<K.length;aa++){const [ba,
fa,I]=K[aa];P+=L*ba;Q+=X*fa;J[aa]=[P,Q,f(H,I)]}return J},G=(H,K)=>{const J=Array(K.length);if(!K.length)return J;var L=K[0];let P=a(H,L[0]),Q=b(H,L[1]);J[0]=[P,Q,g(H,L[2])];const {scale:S,originPosition:U}=H;L=S[0];const X="lowerLeft"===U?S[1]:-S[1];for(let aa=1;aa<K.length;aa++){const [ba,fa,I]=K[aa];P+=L*ba;Q+=X*fa;J[aa]=[P,Q,g(H,I)]}return J},E=(H,K)=>{const J=Array(K.length);if(!K.length)return J;var L=K[0];let P=a(H,L[0]),Q=b(H,L[1]);J[0]=[P,Q,f(H,L[2]),g(H,L[3])];const {scale:S,originPosition:U}=
H;L=S[0];const X="lowerLeft"===U?S[1]:-S[1];for(let aa=1;aa<K.length;aa++){const [ba,fa,I,M]=K[aa];P+=L*ba;Q+=X*fa;J[aa]=[P,Q,f(H,I),g(H,M)]}return J};k.getQuantizedBoundsCoordsArray=h;k.getQuantizedBoundsCoordsArrayArray=u;k.getQuantizedBoundsPaths=function(H){return u([0,0,0,0],H)};k.getQuantizedBoundsPoints=function(H){const K=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return h(K,K,H)};k.getQuantizedBoundsRings=function(H){return u([0,
0,0,0],H)};k.normalizeTransform=p;k.quantizeBounds=function(H,K,J){H=p(H);K[0]=e(H,J[0]);K[3]=n(H,J[1]);K[2]=e(H,J[2]);K[1]=n(H,J[3]);return K};k.quantizeCoordsArrayXY=B;k.quantizeCoordsArrayXYM=y;k.quantizeCoordsArrayXYZ=C;k.quantizeCoordsArrayXYZM=v;k.quantizeExtent=A;k.quantizeGeometry=function(H,K){return H&&K?r.isPoint(K)?t(H,{},K):r.isPolyline(K)?x(H,{},K):r.isPolygon(K)?w(H,{},K):r.isMultipoint(K)?z(H,{},K):r.isExtent(K)?A(H,{},K):null:null};k.quantizeM=l;k.quantizeMultipoint=z;k.quantizePoint=
t;k.quantizePolygon=w;k.quantizePolyline=x;k.quantizeX=e;k.quantizeY=n;k.quantizeZ=m;k.toQuantizationTransform=function(H){return H?{originPosition:"upper-left"===H.originPosition?"upperLeft":"lower-left"===H.originPosition?"lowerLeft":H.originPosition,scale:H.tolerance?[H.tolerance,H.tolerance,1,1]:[1,1,1,1],translate:null!=H.extent?[H.extent.xmin,H.extent.ymax,H.extent.zmin??0,H.extent.mmin??0]:[0,0,0,0]}:null};k.unquantizeBounds=function(H,K,J){H=p(H);return J?(K[0]=a(H,J[0]),K[1]=b(H,J[3]),K[2]=
a(H,J[2]),K[3]=b(H,J[1]),K):[a(H,K[0]),b(H,K[3]),a(H,K[2]),b(H,K[1])]};k.unquantizeCoordsArrayArray=c;k.unquantizeCoordsArrayXY=F;k.unquantizeCoordsArrayXYM=G;k.unquantizeCoordsArrayXYZ=D;k.unquantizeCoordsArrayXYZM=E;k.unquantizeExtent=function(H,K,J,L=J.hasZ??!1,P=J.hasM??!1){H=p(H);K.xmin=a(H,J.xmin);K.xmax=a(H,J.xmax);K.ymin=b(H,J.ymin);K.ymax=b(H,J.ymax);L&&(K.zmin=f(H,J.zmin),K.zmax=f(H,J.zmax));P&&(K.mmin=g(H,J.mmin),K.mmax=g(H,J.mmax));K.hasZ=L;K.hasM=P;return K};k.unquantizeM=g;k.unquantizeMultipoint=
function(H,K,J,L=J?.hasZ??!1,P=J?.hasM??!1){null!=J&&(H=p(H),K.points=q(L,P)(H,J.points),K.hasZ=L,K.hasM=P);return K};k.unquantizePoint=function(H,K,J,L=null!=J?.z,P=null!=J?.m){if(null==J)return K;H=p(H);K.x=a(H,J.x);K.y=b(H,J.y);L&&(K.z=f(H,J.z));P&&(K.m=g(H,J.m));return K};k.unquantizePolygon=function(H,K,J,L=J?.hasZ??!1,P=J?.hasM??!1){null!=J&&(H=p(H),K.rings=c(H,q(L,P),J.rings),K.hasZ=L,K.hasM=P);return K};k.unquantizePolyline=function(H,K,J,L=J?.hasZ??!1,P=J?.hasM??!1){null!=J&&(H=p(H),K.paths=
c(H,q(L,P),J.paths),K.hasZ=L,K.hasM=P);return K};k.unquantizeX=a;k.unquantizeY=b;k.unquantizeZ=f;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/Container":function(){define("exports ../../../core/accessorSupport/tracking ../../../core/accessorSupport/tracking/SimpleObservable ../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../layers/effects/EffectView ./DisplayObject".split(" "),function(k,r,p,e,n,m){class l extends m.DisplayObject{constructor(){super(...arguments);
this._childrenSet=new Set;this._needsSort=!1;this._children=[];this._childrenObservable=new p.SimpleObservable;this._highlightGradient=this._effectView=null}get blendMode(){return this._blendMode}set blendMode(d){this._blendMode=d;this.requestRender()}get children(){r.trackAccess(this._childrenObservable);return this._children}get clips(){return this._clips}set clips(d){this._clips=d;this.children.forEach(a=>a.clips=d)}get computedEffects(){return this._effectView?.effects??null}get effect(){return this._effectView?.effect??
""}set effect(d){if(this._effectView||d)this._effectView||(this._effectView=new n.EffectView,this.addTransitionable(this._effectView)),this._effectView.effect=d,this.requestRender()}get highlightGradient(){return this._highlightGradient}set highlightGradient(d){this._highlightGradient=d;this.requestRender()}get hasBlending(){return!!this.blendMode}get hasHighlight(){return this.children.some(d=>d.hasHighlight)}get hasLabels(){return this.children.some(d=>d.hasLabels)}get requiresDedicatedFBO(){return this.children.some(d=>
"blendMode"in d&&d.blendMode&&"normal"!==d.blendMode)}get isReady(){return this.children.every(d=>d.isReady)}get sortFunction(){return this._sortFunction}set sortFunction(d){if(this._sortFunction=d)this._needsSort=!0}doRender(d){d=this.createRenderParams(d);const {painter:a}=d;a.beforeRenderLayer(d,this._clips?.length?255:0,this.computedOpacity);this.renderChildren(d);a.afterRenderLayer(d,this.computedOpacity)}addChild(d){return this.addChildAt(d,this.children.length)}addChildAt(d,a=this.children.length){if(!d||
this.contains(d))return d;this._needsSort=!0;const b=d.parent;b&&b!==this&&b.removeChild(d);a>=this.children.length?this.children.push(d):this.children.splice(a,0,d);this._childrenSet.add(d);d.parent=this;d.stage=this.stage;this!==this.stage&&(d.clips=this.clips);this.requestRender();this._childrenObservable.notify();return d}contains(d){r.trackAccess(this._childrenObservable);return this._childrenSet.has(d)}removeAllChildren(){this._childrenSet.clear();this._needsSort=!0;for(const d of this.children)this!==
this.stage&&(d.clips=null),d.stage=null,d.parent=null;this.children.length=0;this._childrenObservable.notify()}removeChild(d){return this.contains(d)?this.removeChildAt(this.children.indexOf(d)):d}removeChildAt(d){if(0>d||d>=this.children.length)return null;this._needsSort=!0;d=this.children.splice(d,1)[0];this._childrenSet.delete(d);this!==this.stage&&(d.clips=null);d.stage=null;d.parent=null;this._childrenObservable.notify();return d}beforeRender(d){super.beforeRender(d);this.sortFunction&&this._needsSort&&
(this.children.sort(this.sortFunction),this._needsSort=!1,this._childrenObservable.notify());for(const a of this.children)a.beforeRender(d)}afterRender(d){super.afterRender(d);for(const a of this.children)a.afterRender(d)}_createTransforms(){return{displayViewScreenMat3:e.create()}}onAttach(){super.onAttach();const d=this.stage;for(const a of this.children)a.stage=d}onDetach(){super.onDetach();for(const d of this.children)d.stage=null}renderChildren(d){for(const a of this.children)a.processRender(d)}createRenderParams(d){return{...d,
requireFBO:this.requiresDedicatedFBO,blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:d.globalOpacity*this.computedOpacity,inFadeTransition:this.inFadeTransition,highlightGradient:this._highlightGradient||d.highlightGradient}}isTransitioning(){return super.isTransitioning()||this.children.some(d=>d.transitioning)}}k.Container=l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/layers/effects/EffectView":function(){define("exports ../../chunks/tslib.es6 ../../core/Accessor ../../core/has ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/subclass ./parser ./utils".split(" "),
function(k,r,p,e,n,m,l,d,a,b){function f(c){c=a.parse(c)||[];var h=(h=c[0])?"type"in h:!1;return h?[{scale:-1,effects:c}]:c}function g(c,h,u){return c[0]?.effects&&h[0]?.effects?(-1===c[0]?.scale||-1===h[0]?.scale)&&(1<c.length||1<h.length)&&0>=u?!1:b.canInterpolateEffects(c[0].effects,h[0].effects):!0}function q(c,h,u){const A=c.length>h.length?c:h;c=c.length>h.length?h:c;var z=c[c.length-1];h=z?.scale??u;z=z?.effects??[];for(let t=c.length;t<A.length;t++)c.push({scale:h,effects:[...z]});for(h=0;h<
A.length;h++)c[h].scale=-1===c[h].scale?u:c[h].scale,A[h].scale=-1===A[h].scale?u:A[h].scale,b.normalizeEffects(c[h].effects,A[h].effects)}k.EffectView=class extends p{constructor(c){super(c);this._final=this._to=this._from=null;this._current=[];this._time=0;this.duration=e("mapview-transitions-duration");this.effects=[]}set effect(c){const h=this._get("effect");c=c||"";if(h!==c){this._set("effect",c);try{this._transitionTo(f(c))}catch(u){this._transitionTo([]),m.getLogger(this).warn("Invalid Effect",
{effect:c,error:u})}}}get final(){return this._final}get hasEffects(){return this.transitioning||!!this.effects.length}set scale(c){this._updateForScale(c)}get transitioning(){return null!==this._to}canTransitionTo(c){try{return 0<this.scale&&g(this._current,f(c),this.scale)}catch{return!1}}transitionStep(c,h){this._applyTimeTransition(c);this._updateForScale(h)}endTransition(){this._applyTimeTransition(this.duration)}_transitionTo(c){0<this.scale&&g(this._current,c,this.scale)?(this._final=c,this._to=
n.clone(c),q(this._current,this._to,this.scale),this._from=n.clone(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=c);this._set("effects",this._current[0]?n.clone(this._current[0].effects):[])}_applyTimeTransition(c){if(this._to&&this._from&&this._current&&this._final){this._time+=c;c=Math.min(1,this._time/this.duration);for(let u=0;u<this._current.length;u++){const A=this._current[u],z=this._from[u],t=this._to[u];var h=z.scale;A.scale=h+(t.scale-h)*c;for(h=0;h<A.effects.length;h++)A.effects[h].interpolate(z.effects[h],
t.effects[h],c)}1===c&&(this._current=this._final,this._set("effects",this._current[0]?n.clone(this._current[0].effects):[]),this._from=this._to=this._final=null)}}_updateForScale(c){this._set("scale",c);if(0!==this._current.length){var h=this._current,u=this._current.length-1,A,z=1;if(1===h.length||c>=h[0].scale)var t=A=h[0].effects;else if(c<=h[u].scale)t=A=h[u].effects;else for(let w=0;w<u;w++){const x=h[w],B=h[w+1];if(x.scale>=c&&B.scale<=c){z=(c-x.scale)/(B.scale-x.scale);A=x.effects;t=B.effects;
break}}for(c=0;c<this.effects.length;c++)this.effects[c].interpolate(A[c],t[c],z)}}};r.__decorate([l.property()],k.EffectView.prototype,"_to",void 0);r.__decorate([l.property()],k.EffectView.prototype,"duration",void 0);r.__decorate([l.property({value:""})],k.EffectView.prototype,"effect",null);r.__decorate([l.property({readOnly:!0})],k.EffectView.prototype,"effects",void 0);r.__decorate([l.property({readOnly:!0})],k.EffectView.prototype,"final",null);r.__decorate([l.property({readOnly:!0})],k.EffectView.prototype,
"hasEffects",null);r.__decorate([l.property({value:0})],k.EffectView.prototype,"scale",null);r.__decorate([l.property({readOnly:!0})],k.EffectView.prototype,"transitioning",null);k.EffectView=r.__decorate([d.subclass("esri.layers.effects.EffectView")],k.EffectView);k.canInterpolateEffectStops=g;k.convertEffectToStops=f;k.normalizeEffectStops=q;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/DisplayObject":function(){define(["exports","../../../core/arrayUtils",
"../../../core/Evented","./transitions/FadeTransition"],function(k,r,p,e){class n extends p{constructor(){super(...arguments);this._fadeTransition=this._clips=this._transitionables=null;this._isReady=!1;this._opacity=1;this._stage=this.parent=null;this._visible=!0}get computedOpacity(){return this._fadeTransition?.computedOpacity??this.opacity}get clips(){return this._clips}set clips(m){this._clips=m;this.requestRender()}get fadeTransitionEnabled(){return null!==this._fadeTransition}set fadeTransitionEnabled(m){!this._fadeTransition&&
m?(this._fadeTransition=new e.FadeTransition({opacity:this.opacity,visible:this.visible}),this.addTransitionable(this._fadeTransition)):this._fadeTransition&&!m&&(this.removeTransitionable(this._fadeTransition),this._fadeTransition=null)}get inFadeTransition(){return this._fadeTransition?.transitioning??!1}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(m){this._opacity!==m&&(this._opacity=Math.min(1,Math.max(m,0)),this._fadeTransition&&(this._fadeTransition.opacity=
this._opacity),this.requestRender())}get stage(){return this._stage}set stage(m){if(this._stage!==m){var l=this._stage;(this._stage=m)?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):l?.trashDisplayObject(this)}}get transforms(){null==this._transforms&&(this._transforms=this._createTransforms());return this._transforms}get transitioning(){return this.isTransitioning()}get visible(){return this._visible}set visible(m){this._visible!==m&&(this._visible=m,this._fadeTransition&&
(this._fadeTransition.visible=this._visible),this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}addTransitionable(m){this._transitionables??(this._transitionables=[]);this._transitionables.push(m);this.requestRender()}removeTransitionable(m){m.endTransition();this._transitionables&&r.remove(this._transitionables,m);this.requestRender()}fadeIn(){this.fadeTransitionEnabled=!0;const m=this._fadeTransition.fadeIn();this.opacity=1;this.requestRender();
return m}fadeOut(){this.fadeTransitionEnabled=!0;const m=this._fadeTransition.fadeOut();this.opacity=0;this.requestRender();return m}endTransitions(){if(this._transitionables){for(const m of this._transitionables)m.endTransition();this.requestRender()}}beforeRender(m){this.transitionStep(m.deltaTime,m.state.scale);this.setTransform(m.state)}afterRender(m){this.transitioning&&this.requestRender()}remove(){this.parent?.removeChild(this)}setTransform(m){}processRender(m){this.stage&&(this._fadeTransition?.computedVisible??
this.visible)&&this.doRender(m)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this.endTransitions();this.onDetach();this.emit("detach")}isTransitioning(){return this._transitionables?.some(m=>m.transitioning)??!1}transitionStep(m,l){if(this._transitionables)for(const d of this._transitionables)d.transitionStep(m,l)}onAttach(){}onDetach(){}doRender(m){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}k.DisplayObject=n;Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/transitions/FadeTransition":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass".split(" "),function(k,r,p,e,n,m,l,d,a){k.FadeTransition=class extends p{constructor(b){super(b);this.computedOpacity=1;this.computedVisible=
!0;this.opacity=1;this.visible=!0;this._fadeInResolver=this._fadeOutResolver=null}get transitioning(){return(this._fadeOutResolver||!this.visible?0:this.opacity)!==this.computedOpacity}endTransition(){this._fadeInResolver?.();this._fadeOutResolver?.();this._fadeInResolver=this._fadeOutResolver=null;this.computedOpacity=this.visible?this.opacity:0}fadeIn(){if(this._fadeInResolver)return this._fadeInResolver.promise;this.opacity=1;this.computedOpacity=0;this._fadeOutResolver?.();this._fadeOutResolver=
null;this._fadeInResolver=n.createResolver();return this._fadeInResolver.promise}fadeOut(){if(this._fadeOutResolver)return this._fadeOutResolver.promise;this.opacity=0;this._fadeInResolver?.();this._fadeInResolver=null;this._fadeOutResolver=n.createResolver();return this._fadeOutResolver.promise}transitionStep(b,f){const g=(f=e("mapview-transitions-duration"))?1/f:0;if(0===g)this.computedOpacity=this.opacity,this.computedVisible=this.visible;else{f=this._fadeOutResolver||!this.visible?0:this.opacity;
const q=this.computedOpacity;q===f?this.computedVisible=this.visible:(b*=g,this.computedOpacity=q>f?Math.max(f,q-b):Math.min(f,q+b),this.computedVisible=0<this.computedOpacity)}this.transitioning||(this._fadeInResolver?.(),this._fadeOutResolver?.(),this._fadeOutResolver=this._fadeInResolver=null)}};r.__decorate([m.property()],k.FadeTransition.prototype,"computedOpacity",void 0);r.__decorate([m.property()],k.FadeTransition.prototype,"computedVisible",void 0);r.__decorate([m.property()],k.FadeTransition.prototype,
"opacity",void 0);r.__decorate([m.property()],k.FadeTransition.prototype,"visible",void 0);r.__decorate([m.property()],k.FadeTransition.prototype,"transitioning",null);r.__decorate([m.property()],k.FadeTransition.prototype,"_fadeOutResolver",void 0);r.__decorate([m.property()],k.FadeTransition.prototype,"_fadeInResolver",void 0);k.FadeTransition=r.__decorate([a.subclass("esri.views.2d.engine.transitions.FadeTransition")],k.FadeTransition);Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/ManagedCanvas":function(){define("exports ../../../core/Evented ../../../core/events ../../../core/handleUtils ../../../core/has ../../../core/mathUtils ../../../core/libs/gl-matrix-2/math/mat2d ../../../core/libs/gl-matrix-2/factories/mat2df64".split(" "),function(k,r,p,e,n,m,l,d){class a{constructor(b){this.events=new r;this._hasMajorPerformanceCaveat=!1;this._lastRenderFrameCounter=0;this._canvas=document.createElement("canvas");this._canvas.setAttribute("style","width: 100%; height:100%; display:block; willChange:transform");
const f={failIfMajorPerformanceCaveat:!0,alpha:!0,antialias:!1,depth:!0,stencil:!0,powerPreference:"high-performance"};b.appendChild(this._canvas);b=this._canvas.getContext("webgl2",f);b||(b=this._canvas.getContext("webgl2",{...f,failIfMajorPerformanceCaveat:!1}),this._hasMajorPerformanceCaveat=!0);this._gl=b;this._handles=e.handlesGroup([p.on(this._canvas,"webglcontextlost",g=>this.events.emit("webgl-context-lost",g))])}destroy(){this._canvas.parentNode?.removeChild(this._canvas);this._canvas=null;
this._handles.remove();this._gl=null}get gl(){return this._gl}render(b,f){if(this._hasMajorPerformanceCaveat||n("esri-force-performance-mode")){if(++this._lastRenderFrameCounter>=n("esri-performance-mode-frames-between-render")&&(f(),this._lastRenderViewState=b.state.clone(),this._lastRenderFrameCounter=0),this._lastRenderViewState){const [g,q,c,h,u,A]=this._computeViewTransform(this._lastRenderViewState,b.state);this._canvas.style.transform=`matrix(${g}, ${q}, ${c}, ${h}, ${u}, ${A})`}}else f()}resize(b){const f=
this._canvas,g=f.style,{state:{size:q},pixelRatio:c}=b;b=q[0];const h=q[1],u=Math.round(b*c),A=Math.round(h*c);if(f.width!==u||f.height!==A)f.width=u,f.height=A;g.width=b+"px";g.height=h+"px"}_computeViewTransform(b,f){const [g,q]=b.center,[c,h]=f.center,[u,A]=b.toScreen([0,0],c,h),[z,t]=b.toScreen([0,0],g,q),w=z-u,x=t-A,B=b.scale/f.scale;b=f.rotation-b.rotation;f=d.create();l.identity(f);l.scale(f,f,[B,B]);l.rotate(f,f,m.deg2rad(b));l.translate(f,f,[w,x]);return f}}k.ManagedCanvas=a;Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/Painter":function(){define("../../../../core/has ../../../../core/maybe ../brushes ../vectorTiles/shaders/VTLMaterialManager ./BitBlitRenderer ./definitions ./enums ./MaterialManager ./TextureManager ./TextureUploadManager ./WorldExtentClipRenderer ./effects/BlendEffect ./effects/FeatureEffect ./effects/HighlightEffect ./effects/HittestEffect ./effects/post-processing/EffectManager ./meshing/SimpleMesh ./painter/RenderPass ./shaderGraph/techniques/TechniqueProgramCache ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Renderbuffer ../../../webgl/RenderbufferDescriptor ../../../webgl/TextureDescriptor".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g,q,c,h,u,A,z,t,w,x,B,C,y){function v(D,G,E,H){return D!==l.WGLDrawPhase.LABEL_ALPHA&&D!==l.WGLDrawPhase.LABEL&&D!==l.WGLDrawPhase.HIGHLIGHT&&(1!==H||null!=G&&"normal"!==G||null!=E&&0<E.length)}class F{constructor(D,G){this.context=D;this._currentPipelineStateNeedsUpdate=!1;this._blitRenderer=new n.BitBlitRenderer;this._worldExtentRenderer=new f.WorldExtentRenderer;this._brushCache=new Map;this._lastHeight=this._lastWidth=null;this._vtlMaterialManager=new e;this._blendEffect=
new g.BlendEffect;this._stencilBuf=null;this._prevBeforeLayerFBOStack=[];this._fboPool=[];this.effects={highlight:new c,hittest:new h.HittestEffect,insideEffect:new q.FeatureEffect("inside"),outsideEffect:new q.FeatureEffect("outside")};this._programCache=new t.TechniqueProgramCache;this._shaderState={shader:null,uniforms:null,defines:null,optionalAttributes:null,useComputeBuffer:!1};this.materialManager=new d(D);this.textureManager=new a(G);this.textureUploadManager=new b.TextureUploadManager(G);
this._effectsManager=new u.EffectManager;this._quadMesh=A.SimpleMesh.fromVertexStream(D,[0,0,1,0,0,1,1,1])}dispose(){this._programCache.destroy();this.materialManager.dispose();this.textureManager.dispose();this.textureUploadManager.destroy();this._blitRenderer=r.disposeMaybe(this._blitRenderer);this._worldExtentRenderer=r.disposeMaybe(this._worldExtentRenderer);this._quadMesh=r.destroyMaybe(this._quadMesh);this._brushCache&&(this._brushCache.forEach(D=>D.dispose()),this._brushCache.clear(),this._brushCache=
null);if(this._fbos){let D;for(D in this._fbos)this._fbos[D]&&this._fbos[D].dispose()}for(const D of this._fboPool)D.dispose();this._fboPool.length=0;if(this.effects){let D;for(D in this.effects)this.effects[D]&&this.effects[D].dispose()}this._effectsManager.dispose();this._blendEffect.dispose(this.context);this._vtlMaterialManager=r.disposeMaybe(this._vtlMaterialManager)}clearShaderCache(){this._programCache.destroy();this._programCache=new t.TechniqueProgramCache}get blitRenderer(){return this._blitRenderer}get vectorTilesMaterialManager(){return this._vtlMaterialManager}get quadMesh(){return this._quadMesh}getFbos(){if(!this._fbos)throw Error("InternalError: Painter FBOs not initialized");
return this._fbos}acquireFbo(D,G){if(0<this._fboPool.length)var E=this._fboPool.pop();else E=new y.TextureDescriptor(D,G),E.samplingMode=w.TextureSamplingMode.NEAREST,E.wrapMode=w.TextureWrapMode.CLAMP_TO_EDGE,E=new x.FramebufferObject(this.context,E,this._stencilBuf);E.width===D&&E.height===G||E.resize(D,G);return E}releaseFbo(D){this._fboPool.push(D)}getSharedStencilBuffer(){return this._stencilBuf}beforeRenderPhases(D,G,E){const {context:H}=D;this._worldExtentRenderer.render(D,G,E);const {width:K,
height:J}=H.getViewport();this.updateFBOs(K,J);this._prevFBO=H.getBoundFramebufferObject();H.bindFramebuffer(this.getFbos().output);H.setColorMask(!0,!0,!0,!0);if(null!=G){const {r:L,g:P,b:Q,a:S}=G;H.setClearColor(S*L/255,S*P/255,S*Q/255,S)}else H.setClearColor(0,0,0,0);H.setDepthWriteEnabled(!0);H.setClearDepth(1);H.clear(H.gl.COLOR_BUFFER_BIT|H.gl.DEPTH_BUFFER_BIT);H.setDepthWriteEnabled(!1)}afterRenderPhases(D){({context:D}=D);D.bindFramebuffer(this._prevFBO);D.setStencilFunction(w.CompareFunction.EQUAL,
m.backbufferStencilVisible,255);D.setStencilTestEnabled(!0);D.setDepthTestEnabled(!1);this.blitTexture(D,this.getFbos().output.colorTexture,w.TextureSamplingMode.NEAREST)}beforeRenderLayer(D,G,E){const {context:H,blendMode:K,effects:J,drawPhase:L,requireFBO:P}=D;if(P||v(L,K,J,E)){D=H.getBoundFramebufferObject();this._prevBeforeLayerFBOStack.push(D);const {width:Q,height:S}=H.getViewport();D=this.acquireFbo(Q,S);H.bindFramebuffer(D);H.setColorMask(!0,!0,!0,!0);H.setClearColor(0,0,0,0);H.setDepthWriteEnabled(!0);
H.setClearDepth(1);H.clear(H.gl.COLOR_BUFFER_BIT|H.gl.DEPTH_BUFFER_BIT);H.setDepthWriteEnabled(!1)}H.setDepthWriteEnabled(!1);H.setDepthTestEnabled(!1);H.setStencilTestEnabled(!0);H.setClearStencil(G);H.setStencilWriteMask(255);H.clear(H.gl.STENCIL_BUFFER_BIT)}afterRenderLayer(D,G){const {context:E,blendMode:H,effects:K,requireFBO:J,drawPhase:L}=D;if(J||v(L,H,K,G)){const P=E.getBoundFramebufferObject();null!=K&&0<K.length&&L===l.WGLDrawPhase.MAP&&(E.setColorMask(!0,!0,!0,!0),this._applyEffects(D,
K,P));E.bindFramebuffer(this._prevBeforeLayerFBOStack.pop());E.setStencilTestEnabled(!1);E.setStencilWriteMask(0);E.setBlendingEnabled(!0);E.setBlendFunctionSeparate(w.BlendFactor.ONE,w.BlendFactor.ONE_MINUS_SRC_ALPHA,w.BlendFactor.ONE,w.BlendFactor.ONE_MINUS_SRC_ALPHA);E.setColorMask(!0,!0,!0,!0);this._blendEffect.draw(D,P.colorTexture,w.TextureSamplingMode.NEAREST,null==H||L===l.WGLDrawPhase.HIGHLIGHT||L===l.WGLDrawPhase.LABEL?"normal":H,G);this.releaseFbo(P)}}renderObject(D,G,E,H){if(E=p.brushes[E]){var K=
this._brushCache.get(E);void 0===K&&(K=new E,this._brushCache.set(E,K));K.prepareState(D);K.draw(D,G,H)}}renderObjects(D,G,E,H){if(E=p.brushes[E]){var K=this._brushCache.get(E);void 0===K&&(K=new E,this._brushCache.set(E,K));K.drawMany(D,G,H)}}registerRenderPass(D){const G=D.brushes.map(E=>{this._brushCache.has(E)||this._brushCache.set(E,new E);return this._brushCache.get(E)});return new z(G,D)}blitTexture(D,G,E,H=1){D.setBlendingEnabled(!0);D.setBlendFunctionSeparate(w.BlendFactor.ONE,w.BlendFactor.ONE_MINUS_SRC_ALPHA,
w.BlendFactor.ONE,w.BlendFactor.ONE_MINUS_SRC_ALPHA);D.setColorMask(!0,!0,!0,!0);this._blitRenderer.render(D,G,E,H);this._currentPipelineStateNeedsUpdate=!0}getPostProcessingEffects(D){return this._effectsManager.getPostProcessingEffects(D)}updateFBOs(D,G){if(D!==this._lastWidth||G!==this._lastHeight)if(this._lastWidth=D,this._lastHeight=G,this._fbos)for(var E in this._fbos)this._fbos[E].resize(D,G);else E=new y.TextureDescriptor(D,G),E.samplingMode=w.TextureSamplingMode.NEAREST,E.wrapMode=w.TextureWrapMode.CLAMP_TO_EDGE,
D=new C.RenderbufferDescriptor(w.RenderbufferFormat.DEPTH_STENCIL,D,G),this._stencilBuf=new B.Renderbuffer(this.context,D),this._fbos={output:new x.FramebufferObject(this.context,E,this._stencilBuf),effect0:new x.FramebufferObject(this.context,E,this._stencilBuf)}}_applyEffects(D,G,E){const {context:H}=D;G=this._effectsManager.getPostProcessingEffects(G);for(const {postProcessingEffect:K,effect:J}of G)H.bindFramebuffer(E),K.draw(D,E,J);this._currentPipelineStateNeedsUpdate=!0}setShader(D){this._shaderState.shader=
D.shader;this._shaderState.uniforms=D.uniforms;this._shaderState.defines=D.defines;this._shaderState.optionalAttributes=D.optionalAttributes;this._shaderState.useComputeBuffer=D.useComputeBuffer??!1}setPipelineState(D){D!==this._currentPipelineState&&(this._currentPipelineState=D,this._currentPipelineStateNeedsUpdate=!0)}submitDraw(D,G){const {shader:E,uniforms:H,defines:K,optionalAttributes:J}=this._shaderState,L=D.context;var P=G.getAttributePrecisionPackFactors();P=this._programCache.getProgram(E,
P,H,K??{},J??{});P.setUniforms(H);P.bind(L);this.updatePipelineState(L);this.setStencilRef(L,G);G.draw(D,E.locationInfo);P.cleanupTemporaryTextures();return{vertexShader:P.vertexShader,fragmentShader:P.fragmentShader}}submitDrawMesh(D,G,E,H){this.submitDrawMeshUntyped(D,G,E,H)}submitDrawMeshUntyped(D,G,E,H){this.setShader(G);const {shader:K,uniforms:J,defines:L,optionalAttributes:P}=this._shaderState,Q=this._programCache.getProgram(K,{},J,L??{},P??{});Q.setUniforms(J);Q.bind(D);this.updatePipelineState(D);
if(H)for(const S of H)E.bind(D,G.shader.locationInfo,S),E.draw(D);else for(H=0;H<E.parts.length;H++)E.bind(D,G.shader.locationInfo,H),E.draw(D);E.unbind(D);Q.cleanupTemporaryTextures()}updatePipelineState(D){this._currentPipelineStateNeedsUpdate&&(this._currentPipelineStateNeedsUpdate=!1,this._updatePipelineState(D))}_updatePipelineState(D){if(null==this._currentPipelineState)throw Error("Pipeline state not defined. Call setPipelineState before calling submitDraw ");const {color:G,depth:E,stencil:H}=
this._currentPipelineState;if(G){const {blendMode:J,write:L}=G;D.setColorMask(...L);D.setBlendingEnabled(!0);D.setBlendEquation(w.BlendOperation.ADD);switch(J){case "composite":D.setBlendFunctionSeparate(w.BlendFactor.ONE,w.BlendFactor.ONE_MINUS_SRC_ALPHA,w.BlendFactor.ONE,w.BlendFactor.ONE_MINUS_SRC_ALPHA);break;case "additive":D.setBlendFunctionSeparate(w.BlendFactor.ONE,w.BlendFactor.ONE,w.BlendFactor.ONE,w.BlendFactor.ONE);break;case "custom":var {blendParameters:K}=G;const {dstAlpha:P,dstRGB:Q,
srcAlpha:S,srcRGB:U}=K;D.setBlendFunctionSeparate(U,Q,S,P);break;case "delete":D.setBlendEquation(w.BlendOperation.REVERSE_SUBTRACT),D.setBlendFunctionSeparate(w.BlendFactor.ONE,w.BlendFactor.ONE_MINUS_SRC_ALPHA,w.BlendFactor.ONE,w.BlendFactor.ONE_MINUS_SRC_ALPHA)}}else D.setColorMask(!1,!1,!1,!1);if(E){const {test:J,write:L}=E;L?(D.setDepthWriteEnabled(!0),D.setDepthRange(L.zNear,L.zFar)):D.setDepthWriteEnabled(!1);J?(D.setDepthTestEnabled(!0),D.setDepthFunction(J)):D.setDepthTestEnabled(!1)}else D.setDepthTestEnabled(!1),
D.setDepthWriteEnabled(!1);if(H){const {test:J,write:L}=H;if(J){const {compare:P,mask:Q,op:S,ref:U}=J;D.setStencilTestEnabled(!0);"function"!==typeof U&&D.setStencilFunctionSeparate(w.Face.FRONT_AND_BACK,P,U,Q);D.setStencilOpSeparate(w.Face.FRONT_AND_BACK,S.fail,S.zFail,S.zPass)}else D.setStencilTestEnabled(!1);L?({mask:K}=L,D.setStencilWriteMask(K)):D.setStencilWriteMask(0)}else D.setStencilTestEnabled(!1),D.setStencilWriteMask(0)}setStencilRef(D,G){if(null==this._currentPipelineState)throw Error("Pipeline state not defined. Call setPipelineState before calling submitDraw ");
var {stencil:E}=this._currentPipelineState;if(E&&({test:E}=E,E)){const {compare:H,mask:K,ref:J}=E;if("function"===typeof J){G=G.getStencilReference();if(null===G)throw Error("InternalError: Stencil reference expected for target but not defined");D.setStencilFunctionSeparate(w.Face.FRONT_AND_BACK,H,G,K)}}}}return F})},"esri/views/2d/engine/brushes":function(){define("exports ./webgl/brushes/BrushClip ./webgl/brushes/WGLBrushStencil ./webgl/brushes/WGLBrushTileDebugInfo ./webgl/brushes/WGLBrushVTLBackground ./webgl/brushes/WGLBrushVTLCircle ./webgl/brushes/WGLBrushVTLFill ./webgl/brushes/WGLBrushVTLLine ./webgl/brushes/WGLBrushVTLSymbol".split(" "),
function(k,r,p,e,n,m,l,d,a){k.brushes={clip:r,stencil:p,tileDebugInfo:e,vtlBackground:n.WGLBrushVTLBackground,vtlFill:l.WGLBrushVTLFill,vtlLine:d.WGLBrushVTLLine,vtlCircle:m.WGLBrushVTLCircle,vtlSymbol:a.WGLBrushVTLSymbol};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/BrushClip":function(){define("../../../../../core/libs/gl-matrix-2/factories/vec4f32 ../Utils ./WGLBrush ../shaders/BackgroundPrograms ../../../../webgl/enums ../../../../webgl/ProgramTemplate".split(" "),
function(k,r,p,e,n,m){class l extends p{constructor(){super(...arguments);this._color=k.fromValues(0,1,0,1)}dispose(){this._program&&this._program.dispose()}prepareState({context:d}){d.setStencilTestEnabled(!0);d.setBlendingEnabled(!1);d.setFaceCullingEnabled(!1);d.setColorMask(!1,!1,!1,!1);d.setStencilOp(n.StencilOperation.KEEP,n.StencilOperation.KEEP,n.StencilOperation.REPLACE);d.setStencilWriteMask(255);d.setStencilFunction(n.CompareFunction.ALWAYS,0,255)}draw(d,a){const {context:b,state:f,requestRender:g,
allowDelayedRender:q}=d;d=r.createProgramDescriptor("clip",{geometry:[{location:0,name:"a_pos",count:2,type:n.DataType.SHORT}]});a=a.getVAO(b,f,d.attributes,d.bufferLayouts);null!=a.indexBuffer&&(this._program||(this._program=m.createProgram(b,e.background)),q&&null!=g&&!this._program.compiled?g():(b.useProgram(this._program),this._program.setUniform2fv("u_coord_range",[1,1]),this._program.setUniform4fv("u_color",this._color),this._program.setUniformMatrix3fv("u_dvsMat3",f.displayMat3),b.bindVAO(a),
b.drawElements(n.PrimitiveType.TRIANGLES,a.indexBuffer.size,n.DataType.UNSIGNED_INT,0),b.bindVAO()))}}return l})},"esri/core/libs/gl-matrix-2/factories/vec4f32":function(){define(["exports"],function(k){function r(){return new Float32Array(4)}function p(t){const w=new Float32Array(4);w[0]=t[0];w[1]=t[1];w[2]=t[2];w[3]=t[3];return w}function e(t,w,x,B){const C=new Float32Array(4);C[0]=t;C[1]=w;C[2]=x;C[3]=B;return C}function n(t,w){return new Float32Array(t,w,4)}function m(){return r()}function l(){return e(1,
1,1,1)}function d(){return e(1,0,0,0)}function a(){return e(0,1,0,0)}function b(){return e(0,0,1,0)}function f(){return e(0,0,0,1)}const g=r(),q=l(),c=d(),h=a(),u=b(),A=f(),z=Object.freeze(Object.defineProperty({__proto__:null,ONES:q,UNIT_W:A,UNIT_X:c,UNIT_Y:h,UNIT_Z:u,ZEROS:g,clone:p,create:r,createView:n,fromValues:e,ones:l,unitW:f,unitX:d,unitY:a,unitZ:b,zeros:m},Symbol.toStringTag,{value:"Module"}));k.ONES=q;k.UNIT_W=A;k.UNIT_X=c;k.UNIT_Y=h;k.UNIT_Z=u;k.ZEROS=g;k.clone=p;k.create=r;k.createView=
n;k.fromValues=e;k.ones=l;k.unitW=f;k.unitX=d;k.unitY=a;k.unitZ=b;k.vec4f32=z;k.zeros=m;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/Utils":function(){define("exports ../../../../core/Error ../../../../core/Logger ../../../webgl/enums ../../../webgl/getDataTypeBytes ../../../webgl/VertexElementDescriptor".split(" "),function(k,r,p,e,n,m){function l(f){const g=new Map;for(const q in f){let c=0;g.set(q,f[q].map(h=>{const u=new m.VertexElementDescriptor(h.name,
h.count,h.type,c,0,h.normalized||!1);c+=h.count*n.getDataTypeBytes(h.type);return u}));g.get(q).forEach(h=>h.stride=c)}return g}const d=()=>p.getLogger("esri.views.2d.engine.webgl.Utils"),a=f=>{const g={};f.forEach((q,c)=>g[c]=q?.length?q[0].stride:0);return g},b=new Map;k.charCodes=function(f){const g=[];for(let q=0;q<f.length;q++)g.push(f.charCodeAt(q));return g};k.createAttributeLayout=l;k.createProgramDescriptor=(f,g)=>{if(!b.has(f)){const q=l(g),c=a(q),h=new Map;for(const u in g)for(const A of g[u])h.set(A.name,
A.location);b.set(f,{strides:c,bufferLayouts:q,attributes:h})}return b.get(f)};k.getCIMMarkerPlacementHash=function(f){if(null==f)return"";const {type:g}=f;switch(g){case "CIMMarkerPlacementAlongLineRandomSize":return`${g}-${f.seed}-${f.randomization}`;case "CIMMarkerPlacementAlongLineVariableSize":return`${g}-${f.maxRandomOffset}-${f.numberOfSizes}-${f.seed}-${f.variationMethod}`;case "CIMMarkerPlacementAtExtremities":return`${g}-${f.extremityPlacement}-${f.offsetAlongLine}`;case "CIMMarkerPlacementAtRatioPositions":return`${g}-${f.beginPosition}-${f.endPosition}-${f.flipFirst}-${JSON.stringify(f.positionArray)}`;
case "CIMMarkerPlacementAtMeasuredUnits":return`${g}-${f.interval}-${f.skipMarkerRate}-${f.placeAtExtremities}`;case "CIMMarkerPlacementInsidePolygon":return`${g}-${f.stepX}-${f.stepY}-${f.randomness}-${f.gridType}-${f.seed}-${f.shiftOddRows}`;case "CIMMarkerPlacementOnLine":return`${g}-${f.relativeTo}-${f.startPointOffset}`;case "CIMMarkerPlacementOnVertices":return`${g}-${f.placeOnControlPoints}-${f.placeOnEndPoints}-${f.placeOnRegularVertices}`;case "CIMMarkerPlacementPolygonCenter":return`${g}-${f.method}`;
default:return`${g}`}};k.getPixelArrayCtor=function(f){switch(f){case e.PixelType.UNSIGNED_BYTE:return Uint8Array;case e.PixelType.UNSIGNED_SHORT_4_4_4_4:return Uint16Array;case e.PixelType.FLOAT:return Float32Array;default:d().error(new r("webgl-utils",`Unable to handle type ${f}`))}};k.getPixelBytes=function(f){switch(f){case e.PixelType.UNSIGNED_BYTE:return 1;case e.PixelType.UNSIGNED_SHORT_4_4_4_4:return 2;case e.PixelType.FLOAT:return 4;default:d().error(new r("webgl-utils",`Unable to handle type ${f}`))}};
k.isSVGImage=f=>f.includes("data:image/svg+xml");k.isValidSVG=f=>{if(!f)return!1;f=f.trim();return/^[mzlhvcsqta]\s*[-+.0-9][^mlhvzcsqta]+/i.test(f)&&/[\dz]$/i.test(f)&&4<f.length?!0:!1};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/VertexElementDescriptor":function(){define(["exports"],function(k){class r{constructor(p,e,n,m,l,d=!1,a=0){this.name=p;this.count=e;this.type=n;this.offset=m;this.stride=l;this.normalized=d;this.divisor=a}}k.VertexElementDescriptor=r;
Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrush":function(){define(function(){class k{constructor(){this.name=this.constructor.name||"UnnamedBrush";this.brushEffect=null}prepareState(r,p){}draw(r,p,e){}drawMany(r,p,e){for(const n of p)n.visible&&this.draw(r,n,e)}}return k})},"esri/views/2d/engine/webgl/shaders/BackgroundPrograms":function(){define(["exports","./sources/resolver"],function(k,r){r={shaders:{vertexShader:r.resolveIncludes("background/background.vert"),
fragmentShader:r.resolveIncludes("background/background.frag")},attributes:new Map([["a_pos",0]])};k.background=r;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaders/sources/resolver":function(){define(["exports","./shaderRepository","../../../../../webgl/ShaderCompiler"],function(k,r,p){const e=new p.ShaderCompiler(function(n){return function(m){let l=n;m.split("/").forEach(d=>{l&&=l[d]});return l}}(r));k.resolveIncludes=function(n){return e.resolveIncludes(n)};
Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaders/sources/shaderRepository":function(){define(function(){return{background:{"background.frag":"uniform lowp vec4 u_color;\nvoid main() {\ngl_FragColor \x3d u_color;\n}","background.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump vec2 u_coord_range;\nuniform mediump float u_depth;\nvoid main() {\nvec3 v_pos \x3d u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0);\ngl_Position \x3d vec4(v_pos.xy, 0.0, 1.0);\n}"},
bitBlit:{"bitBlit.frag":"uniform lowp sampler2D u_tex;\nuniform lowp float u_opacity;\nvarying mediump vec2 v_uv;\nvoid main() {\nlowp vec4 color \x3d texture2D(u_tex, v_uv);\ngl_FragColor \x3d color * u_opacity;\n}","bitBlit.vert":"attribute vec2 a_pos;\nattribute vec2 a_tex;\nvarying mediump vec2 v_uv;\nvoid main(void) {\ngl_Position \x3d vec4(a_pos , 0.0, 1.0);\nv_uv \x3d a_tex;\n}"},debug:{overlay:{"overlay.frag":"precision mediump float;\nvarying vec4 v_color;\nvoid main(void) {\ngl_FragColor \x3d v_color;\n}",
"overlay.vert":"attribute vec3 a_PositionAndFlags;\nuniform mat3 u_dvsMat3;\nuniform vec4 u_colors[4];\nuniform float u_opacities[4];\nvarying vec4 v_color;\nvoid main(void) {\nvec2 position \x3d a_PositionAndFlags.xy;\nfloat flags \x3d a_PositionAndFlags.z;\nint colorIndex \x3d int(mod(flags, 4.0));\nvec4 color;\nfor (int i \x3d 0; i \x3c 4; i++) {\ncolor \x3d u_colors[i];\nif (i \x3d\x3d colorIndex) {\nbreak;\n}\n}\nint opacityIndex \x3d int(mod(floor(flags / 4.0), 4.0));\nfloat opacity;\nfor (int i \x3d 0; i \x3c 4; i++) {\nopacity \x3d u_opacities[i];\nif (i \x3d\x3d opacityIndex) {\nbreak;\n}\n}\nv_color \x3d color * opacity;\ngl_Position \x3d vec4((u_dvsMat3 * vec3(position, 1.0)).xy, 0.0, 1.0);\n}"}},
dot:{dot:{"dot.frag":"precision mediump float;\nvarying vec4 v_color;\nvarying float v_dotRatio;\nvarying float v_invEdgeRatio;\nuniform highp float u_tileZoomFactor;\nvoid main()\n{\nfloat dist \x3d length(gl_PointCoord - vec2(.5, .5)) * 2.;\nfloat alpha \x3d smoothstep(0., 1., v_invEdgeRatio * (dist - v_dotRatio) + 1.);\ngl_FragColor \x3d v_color * alpha;\n}","dot.vert":"precision highp float;\nattribute vec2 a_pos;\nuniform sampler2D u_texture;\nuniform highp mat3 u_dvsMat3;\nuniform highp float u_tileZoomFactor;\nuniform highp float u_dotSize;\nuniform highp float u_pixelRatio;\nvarying vec2 v_pos;\nvarying vec4 v_color;\nvarying float v_dotRatio;\nvarying float v_invEdgeRatio;\nconst float EPSILON \x3d 0.000001;\nvoid main()\n{\nmat3 tileToTileTexture \x3d mat3(  1., 0., 0.,\n0., -1., 0.,\n0., 1., 1.  );\nvec3 texCoords \x3d tileToTileTexture * vec3(a_pos.xy / 512., 1.);\nv_color \x3d texture2D(u_texture, texCoords.xy);\nfloat smoothEdgeWidth \x3d max(u_dotSize / 2., 1.) ;\nfloat z \x3d 0.;\nz +\x3d 2.0 * step(v_color.a, EPSILON);\ngl_PointSize \x3d (smoothEdgeWidth + u_dotSize);\ngl_Position \x3d vec4((u_dvsMat3 * vec3(a_pos + .5, 1.)).xy, z, 1.);\nv_dotRatio \x3d u_dotSize / gl_PointSize;\nv_invEdgeRatio \x3d -1. / ( smoothEdgeWidth / gl_PointSize );\ngl_PointSize  *\x3d (u_pixelRatio * u_tileZoomFactor);\n}"}},
filtering:{"bicubic.glsl":"vec4 computeWeights(float v) {\nfloat b \x3d 1.0 / 6.0;\nfloat v2 \x3d v * v;\nfloat v3 \x3d v2 * v;\nfloat w0 \x3d b * (-v3 + 3.0 * v2 - 3.0 * v + 1.0);\nfloat w1 \x3d b * (3.0 * v3  - 6.0 * v2 + 4.0);\nfloat w2 \x3d b * (-3.0 * v3 + 3.0 * v2 + 3.0 * v + 1.0);\nfloat w3 \x3d b * v3;\nreturn vec4(w0, w1, w2, w3);\n}\nvec4 bicubicOffsetsAndWeights(float v) {\nvec4 w \x3d computeWeights(v);\nfloat g0 \x3d w.x + w.y;\nfloat g1 \x3d w.z + w.w;\nfloat h0 \x3d 1.0 - (w.y / g0) + v;\nfloat h1 \x3d 1.0 + (w.w / g1) - v;\nreturn vec4(h0, h1, g0, g1);\n}\nvec4 sampleBicubicBSpline(sampler2D sampler, vec2 coords, vec2 texSize) {\nvec2 eX \x3d vec2(1.0 / texSize.x, 0.0);\nvec2 eY \x3d vec2(0.0, 1.0 / texSize.y);\nvec2 texel \x3d coords * texSize - 0.5;\nvec3 hgX \x3d bicubicOffsetsAndWeights(fract(texel).x).xyz;\nvec3 hgY \x3d bicubicOffsetsAndWeights(fract(texel).y).xyz;\nvec2 coords10 \x3d coords + hgX.x * eX;\nvec2 coords00 \x3d coords - hgX.y * eX;\nvec2 coords11 \x3d coords10 + hgY.x * eY;\nvec2 coords01 \x3d coords00 + hgY.x * eY;\ncoords10 \x3d coords10 - hgY.y * eY;\ncoords00 \x3d coords00 - hgY.y * eY;\nvec4 color00 \x3d texture2D(sampler, coords00);\nvec4 color10 \x3d texture2D(sampler, coords10);\nvec4 color01 \x3d texture2D(sampler, coords01);\nvec4 color11 \x3d texture2D(sampler, coords11);\ncolor00 \x3d mix(color00, color01, hgY.z);\ncolor10 \x3d mix(color10, color11, hgY.z);\ncolor00 \x3d mix(color00, color10, hgX.z);\nreturn color00;\n}",
"bilinear.glsl":"vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {\nvec2 texelStart \x3d floor(coords * texSize);\nvec2 coord0 \x3d texelStart / texSize;\nvec2 coord1 \x3d (texelStart +  vec2(1.0, 0.0)) / texSize;\nvec2 coord2 \x3d (texelStart +  vec2(0.0, 1.0)) / texSize;\nvec2 coord3 \x3d (texelStart +  vec2(1.0, 1.0)) / texSize;\nvec4 color0 \x3d texture2D(sampler, coord0);\nvec4 color1 \x3d texture2D(sampler, coord1);\nvec4 color2 \x3d texture2D(sampler, coord2);\nvec4 color3 \x3d texture2D(sampler, coord3);\nvec2 blend \x3d fract(coords * texSize);\nvec4 color01 \x3d mix(color0, color1, blend.x);\nvec4 color23 \x3d mix(color2, color3, blend.x);\nvec4 color \x3d mix(color01, color23, blend.y);\n#ifdef NNEDGE\nfloat alpha \x3d floor(color0.a * color1.a * color2.a * color3.a + 0.5);\ncolor \x3d color * alpha + (1.0 - alpha) * texture2D(sampler, coords);\n#endif\nreturn color;\n}",
"epx.glsl":"vec4 sampleEPX(sampler2D sampler, float size, vec2 coords, vec2 texSize) {\nvec2 invSize \x3d 1.0 / texSize;\nvec2 texel \x3d coords * texSize;\nvec2 texel_i \x3d floor(texel);\nvec2 texel_frac \x3d fract(texel);\nvec4 colorP \x3d texture2D(sampler, texel_i * invSize);\nvec4 colorP1 \x3d vec4(colorP);\nvec4 colorP2 \x3d vec4(colorP);\nvec4 colorP3 \x3d vec4(colorP);\nvec4 colorP4 \x3d vec4(colorP);\nvec4 colorA \x3d texture2D(sampler, (texel_i - vec2(0.0, 1.0)) * invSize);\nvec4 colorB \x3d texture2D(sampler, (texel_i + vec2(1.0, 0.0)) * invSize);\nvec4 colorC \x3d texture2D(sampler, (texel_i - vec2(1.0, 0.0)) * invSize);\nvec4 colorD \x3d texture2D(sampler, (texel_i + vec2(0.0, 1.0)) * invSize);\nif (colorC \x3d\x3d colorA \x26\x26 colorC !\x3d colorD \x26\x26 colorA !\x3d colorB) {\ncolorP1 \x3d colorA;\n}\nif (colorA \x3d\x3d colorB \x26\x26 colorA !\x3d colorC \x26\x26 colorB !\x3d colorD) {\ncolorP2 \x3d colorB;\n}\nif (colorD \x3d\x3d colorC \x26\x26 colorD !\x3d colorB \x26\x26 colorC !\x3d colorA) {\ncolorP3 \x3d colorC;\n}\nif (colorB \x3d\x3d colorD \x26\x26 colorB !\x3d colorA \x26\x26 colorD !\x3d colorC) {\ncolorP4 \x3d colorD;\n}\nvec4 colorP12 \x3d mix(colorP1, colorP2, texel_frac.x);\nvec4 colorP34 \x3d mix(colorP1, colorP2, texel_frac.x);\nreturn mix(colorP12, colorP34, texel_frac.y);\n}"},
heatmap:{heatmapResolve:{"heatmapResolve.frag":"precision highp float;\n#ifdef HEATMAP_PRECISION_HALF_FLOAT\n#define COMPRESSION_FACTOR 4.0\n#else\n#define COMPRESSION_FACTOR 1.0\n#endif\nuniform sampler2D u_texture;\nuniform sampler2D u_gradient;\nuniform vec2 u_densityMinAndInvRange;\nuniform float u_densityNormalization;\nvarying vec2 v_uv;\nvoid main() {\nvec4 data \x3d texture2D(u_texture, v_uv);\nfloat density \x3d data.r * COMPRESSION_FACTOR;\ndensity *\x3d u_densityNormalization;\ndensity \x3d (density - u_densityMinAndInvRange.x) * u_densityMinAndInvRange.y;\nvec4 color \x3d texture2D(u_gradient, vec2(density, 0.5));\ngl_FragColor \x3d vec4(color.rgb * color.a, color.a);\n}",
"heatmapResolve.vert":"precision highp float;\nattribute vec2 a_pos;\nvarying vec2 v_uv;\nvoid main() {\nv_uv \x3d a_pos;\ngl_Position \x3d vec4(a_pos * 2.0 - 1.0, 1., 1.);\n}"}},highlight:{"blur.frag":"varying mediump vec2 v_texcoord;\nuniform mediump vec4 u_direction;\nuniform mediump mat4 u_channelSelector;\nuniform mediump float u_sigma;\nuniform sampler2D u_texture;\nmediump float gauss1(mediump vec2 dir) {\nreturn exp(-dot(dir, dir) / (2.0 * u_sigma * u_sigma));\n}\nmediump vec4 selectChannel(mediump vec4 sample) {\nreturn u_channelSelector * sample;\n}\nvoid accumGauss1(mediump float i, inout mediump float tot, inout mediump float weight) {\nmediump float w \x3d gauss1(i * u_direction.xy);\ntot +\x3d selectChannel(texture2D(u_texture, v_texcoord + i * u_direction.zw))[3] * w;\nweight +\x3d w;\n}\nvoid main(void) {\nmediump float tot \x3d 0.0;\nmediump float weight \x3d 0.0;\naccumGauss1(-5.0, tot, weight);\naccumGauss1(-4.0, tot, weight);\naccumGauss1(-3.0, tot, weight);\naccumGauss1(-2.0, tot, weight);\naccumGauss1(-1.0, tot, weight);\naccumGauss1(0.0, tot, weight);\naccumGauss1(1.0, tot, weight);\naccumGauss1(2.0, tot, weight);\naccumGauss1(3.0, tot, weight);\naccumGauss1(4.0, tot, weight);\naccumGauss1(5.0, tot, weight);\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, tot / weight);\n}",
"highlight.frag":"varying mediump vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform mediump float u_sigma;\nuniform sampler2D u_shade;\nuniform mediump vec2 u_minMaxDistance;\nmediump float estimateDistance() {\nmediump float y \x3d texture2D(u_texture, v_texcoord)[3];\nconst mediump float y0 \x3d 0.5;\nmediump float m0 \x3d 1.0 / (sqrt(2.0 * 3.1415) * u_sigma);\nmediump float d \x3d (y - y0) / m0;\nreturn d;\n}\nmediump vec4 shade(mediump float d) {\nmediump float mappedDistance \x3d (d - u_minMaxDistance.x) / (u_minMaxDistance.y - u_minMaxDistance.x);\nmappedDistance \x3d clamp(mappedDistance, 0.0, 1.0);\nreturn texture2D(u_shade, vec2(mappedDistance, 0.5));\n}\nvoid main(void) {\nmediump float d \x3d estimateDistance();\ngl_FragColor \x3d shade(d);\n}",
"textured.vert":"attribute mediump vec2 a_position;\nattribute mediump vec2 a_texcoord;\nvarying mediump vec2 v_texcoord;\nvoid main(void) {\ngl_Position \x3d vec4(a_position, 0.0, 1.0);\nv_texcoord \x3d a_texcoord;\n}"},materials:{"attributeData.glsl":"uniform highp sampler2D filterFlags;\nuniform highp sampler2D animation;\nuniform highp sampler2D gpgpu;\nuniform highp sampler2D visualVariableData;\nuniform highp sampler2D dataDriven0;\nuniform highp sampler2D dataDriven1;\nuniform highp sampler2D dataDriven2;\nuniform float size;\nhighp vec2 getAttributeDataCoords(in highp vec3 id) {\nhighp vec3  texel \x3d unpackDisplayIdTexel(id);\nhighp float u32 \x3d float(int(texel.r) + int(texel.g) * 256 + int(texel.b) * 256 * 256);\nhighp float col \x3d mod(u32, size);\nhighp float row \x3d (u32 - col) / size;\nhighp float u \x3d col / size;\nhighp float v \x3d row / size;\nreturn vec2(u, v);\n}\nhighp vec2 getAttributeDataTextureCoords(in highp vec3 id) {\nreturn (getAttributeDataCoords(id) * 2.0) - 1.0 + (.5 / vec2(size));\n}\nhighp vec4 getFilterData(in highp vec3 id) {\nvec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(filterFlags, coords);\n}\nhighp vec4 getAnimation(in highp vec3 id) {\nhighp vec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(animation, coords);\n}\nhighp vec4 getVisualVariableData(in highp vec3 id) {\nhighp vec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(visualVariableData, coords);\n}\nhighp vec4 getDataDriven0(in highp vec3 id) {\nhighp vec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(dataDriven0, coords);\n}\nhighp vec4 getDataDriven1(in highp vec3 id) {\nhighp vec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(dataDriven1, coords);\n}\nhighp vec4 getGPGPU(in highp vec3 id) {\nhighp vec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(gpgpu, coords);\n}\nhighp vec4 getDataDriven2(in highp vec3 id) {\nhighp vec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(dataDriven2, coords);\n}\nfloat u88VVToFloat(in vec2 v) {\nbool isMagic \x3d v.x \x3d\x3d 255.0 \x26\x26 v.y \x3d\x3d 255.0;\nif (isMagic) {\nreturn NAN_MAGIC_NUMBER;\n}\nreturn (v.x + v.y * float(0x100)) - 32768.0;\n}",
"barycentric.glsl":"float inTriangle(vec3 bary) {\nvec3 absBary \x3d abs(bary);\nreturn step((absBary.x + absBary.y + absBary.z), 1.05);\n}\nvec3 xyToBarycentric(in vec2 pos, in vec2 v0,  in vec2 v1, in vec2 v2) {\nmat3 xyToBarycentricMat3 \x3d mat3(\nv1.x * v2.y - v2.x * v1.y, v2.x * v0.y - v0.x * v2.y, v0.x * v1.y - v1.x * v0.y,\nv1.y - v2.y, v2.y - v0.y, v0.y - v1.y,\nv2.x - v1.x, v0.x - v2.x, v1.x - v0.x\n);\nfloat A2 \x3d v0.x * (v1.y - v2.y) + v1.x * (v2.y - v0.y) + v2.x * (v0.y - v1.y);\nreturn (1. / A2) * xyToBarycentricMat3 * vec3(1., pos);\n}",
"constants.glsl":"const float C_DEG_TO_RAD \x3d 3.14159265359 / 180.0;\nconst float C_256_TO_RAD \x3d 3.14159265359 / 128.0;\nconst float C_RAD_TO_DEG \x3d 180.0 / 3.141592654;\nconst float POSITION_PRECISION \x3d 1.0 / 8.0;\nconst float FILL_POSITION_PRECISION \x3d 1.0 / 1.0;\nconst float SOFT_EDGE_RATIO \x3d 1.0;\nconst float THIN_LINE_WIDTH_FACTOR \x3d 1.1;\nconst float THIN_LINE_HALF_WIDTH \x3d 1.0;\nconst float EXTRUDE_SCALE_PLACEMENT_PADDING \x3d 1.0 / 4.0;\nconst float OFFSET_PRECISION \x3d 1.0 / 8.0;\nconst float OUTLINE_SCALE \x3d 1.0 / 5.0;\nconst float SDF_FONT_SIZE \x3d 24.0;\nconst float MAX_SDF_DISTANCE \x3d 8.0;\nconst float PLACEMENT_PADDING \x3d 8.0;\nconst float EPSILON \x3d 0.00001;\nconst float EPSILON_HITTEST \x3d 0.05;\nconst int MAX_FILTER_COUNT \x3d 2;\nconst int ATTR_VV_SIZE \x3d 0;\nconst int ATTR_VV_COLOR \x3d 1;\nconst int ATTR_VV_OPACITY \x3d 2;\nconst int ATTR_VV_ROTATION \x3d 3;\nconst highp float NAN_MAGIC_NUMBER \x3d 1e-30;\nconst int BITSET_GENERIC_LOCK_COLOR \x3d 1;\nconst int BITSET_GENERIC_CONSIDER_ALPHA_ONLY \x3d 4;\nconst int BITSET_MARKER_ALIGNMENT_MAP \x3d 0;\nconst int BITSET_MARKER_OUTLINE_ALLOW_COLOR_OVERRIDE \x3d 2;\nconst int BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY \x3d 3;\nconst int BITSET_TYPE_FILL_OUTLINE \x3d 0;\nconst int BITSET_FILL_RANDOM_PATTERN_OFFSET \x3d 2;\nconst int BITSET_FILL_HAS_UNRESOLVED_REPLACEMENT_COLOR \x3d 3;\nconst int BITSET_FILL_HAS_PATTERN_HEIGHT_PRECISION_FACTOR \x3d 5;\nconst int BITSET_FILL_HAS_PATTERN_WIDTH_PRECISION_FACTOR \x3d 6;\nconst int BITSET_LINE_SCALE_DASH \x3d 2;",
fill:{"common.glsl":"#include \x3cmaterials/symbologyTypeUtils.glsl\x3e\n#ifdef PATTERN\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_sampleAlphaOnly;\n#endif\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nuniform lowp vec4 u_isActive[ 2 ];\nuniform highp float u_dotValue;\nuniform highp float u_tileDotsOverArea;\nuniform highp float u_dotTextureDotCount;\nuniform mediump float u_tileZoomFactor;\n#endif\nvarying highp vec3 v_id;\nvarying lowp vec4 v_color;\nvarying lowp float v_opacity;\nvarying mediump vec4 v_aux1;\n#ifdef PATTERN\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nvarying lowp float v_isOutline;\n#endif\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nvarying highp vec2 v_dotTextureCoords;\nvarying highp vec4 v_dotThresholds[ 2 ];\n#endif",
"fill.frag":"precision highp float;\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/fill/common.glsl\x3e\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\n#endif\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nuniform mediump mat4 u_dotColors[ 2 ];\nuniform sampler2D u_dotTextures[ 2 ];\nuniform vec4 u_dotBackgroundColor;\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#include \x3cmaterials/shared/line/common.glsl\x3e\n#include \x3cmaterials/shared/line/line.frag\x3e\nlowp vec4 drawLine() {\nfloat v_lineWidth \x3d v_aux1.x;\nvec2  v_normal    \x3d v_aux1.yz;\nLineData inputs \x3d LineData(\nv_color,\nv_normal,\nv_lineWidth,\nv_opacity,\nv_id\n);\nreturn shadeLine(inputs);\n}\n#endif\nlowp vec4 drawFill() {\nlowp vec4 out_color \x3d vec4(0.);\n#ifdef HITTEST\nout_color \x3d v_color;\n#elif defined(PATTERN)\nmediump vec4 v_tlbr \x3d v_aux1;\nmediump vec2 normalizedTextureCoord \x3d mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos \x3d mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color \x3d texture2D(u_texture, samplePos);\nif (v_sampleAlphaOnly \x3e 0.5) {\ncolor.rgb \x3d vec3(color.a);\n}\nout_color \x3d v_opacity * v_color * color;\n#elif SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY \x26\x26 !defined(HIGHLIGHT)\nvec4 textureThresholds0 \x3d texture2D(u_dotTextures[0], v_dotTextureCoords);\nvec4 textureThresholds1 \x3d texture2D(u_dotTextures[1], v_dotTextureCoords);\nvec4 difference0 \x3d v_dotThresholds[0] - textureThresholds0;\nvec4 difference1 \x3d v_dotThresholds[1] - textureThresholds1;\n#ifdef DD_DOT_BLENDING\nvec4 isPositive0 \x3d step(0.0, difference0);\nvec4 isPositive1 \x3d step(0.0, difference1);\nfloat weightSum \x3d dot(isPositive0, difference0) + dot(isPositive1, difference1);\nfloat lessThanEqZero \x3d step(weightSum, 0.0);\nfloat greaterThanZero \x3d 1.0 - lessThanEqZero ;\nfloat divisor \x3d (weightSum + lessThanEqZero);\nvec4 weights0 \x3d difference0 * isPositive0 / divisor;\nvec4 weights1 \x3d difference1 * isPositive1 / divisor;\nvec4 dotColor \x3d u_dotColors[0] * weights0 + u_dotColors[1] * weights1;\nvec4 preEffectColor \x3d greaterThanZero * dotColor + lessThanEqZero * u_dotBackgroundColor;\n#else\nfloat diffMax \x3d max(max4(difference0), max4(difference1));\nfloat lessThanZero \x3d step(diffMax, 0.0);\nfloat greaterOrEqZero \x3d 1.0 - lessThanZero;\nvec4 isMax0 \x3d step(diffMax, difference0);\nvec4 isMax1 \x3d step(diffMax, difference1);\nvec4 dotColor \x3d u_dotColors[0] * isMax0 + u_dotColors[1] * isMax1;\nvec4 preEffectColor \x3d greaterOrEqZero * dotColor + lessThanZero * u_dotBackgroundColor;\n#endif\nout_color \x3d preEffectColor;\n#else\nout_color \x3d v_opacity * v_color;\n#endif\n#ifdef HIGHLIGHT\nout_color.a \x3d 1.0;\n#endif\nreturn out_color;\n}\nvoid main() {\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nif (v_isOutline \x3e 0.5) {\ngl_FragColor \x3d drawLine();\n} else {\ngl_FragColor \x3d drawFill();\n}\n#else\ngl_FragColor \x3d drawFill();\n#endif\n}",
"fill.vert":"#include \x3cmaterials/symbologyTypeUtils.glsl\x3e\n#define PACKED_LINE\nprecision highp float;\nattribute float a_bitset;\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nattribute float a_inverseArea;\nvec4 a_color \x3d vec4(0.0, 0.0, 0.0, 1.0);\nvec2 a_zoomRange \x3d vec2(0.0, 10000.0);\n#else\nattribute vec4 a_color;\nattribute vec4 a_aux2;\nattribute vec4 a_aux3;\n#ifndef SYMBOLOGY_TYPE_IS_SIMPLE_LIKE\nattribute vec4 a_aux1;\nattribute vec2 a_zoomRange;\n#else\nvec2 a_zoomRange \x3d vec2(0.0, 10000.0);\n#endif\n#endif\nuniform vec2 u_tileOffset;\nuniform vec2 u_maxIntNumOfCrossing;\n#include \x3cutil/encoding.glsl\x3e\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/fill/common.glsl\x3e\n#include \x3cmaterials/fill/hittest.glsl\x3e\nconst float INV_SCALE_COMPRESSION_FACTOR \x3d 1.0 / 128.0;\nconst float MAX_REPRESENTABLE_INT \x3d 16777216.0;\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nvec4 dotThreshold(vec4 featureAttrOverFeatureArea, float dotValue, float tileDotsOverArea) {\nreturn featureAttrOverFeatureArea * (1.0 / dotValue)  * (1.0 / tileDotsOverArea);\n}\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#include \x3cmaterials/shared/line/common.glsl\x3e\n#include \x3cmaterials/shared/line/line.vert\x3e\nvoid drawLine(out lowp vec4 out_color, out highp vec3 out_pos) {\nLineData outputs \x3d buildLine(\nout_pos,\na_id,\na_pos,\na_color,\n(a_aux3.xy - 128.) / 16.,\n(a_aux3.zw - 128.) / 16.,\n0.,\na_aux2.z / 16.,\na_bitset,\nvec4(0.),\nvec2(0.),\na_aux2.w / 16.\n);\nv_id      \x3d outputs.id;\nv_opacity \x3d outputs.opacity;\nv_aux1    \x3d vec4(outputs.lineHalfWidth, outputs.normal, 0.);\nout_color \x3d outputs.color;\n}\n#endif\nvoid drawFill(out lowp vec4 out_color, out highp vec3 out_pos) {\nfloat a_bitSet \x3d a_bitset;\nout_color \x3d getColor(a_color, a_bitSet, BITSET_GENERIC_LOCK_COLOR);\nv_opacity \x3d getOpacity();\nv_id      \x3d norm(a_id);\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nmat3 tileToTileNormalized \x3d mat3(  2. / 512.,  0.,  0.,\n0., -2. / 512.,  0.,\n-1.,  1.,  1.  );\nout_pos   \x3d tileToTileNormalized * vec3((a_pos * FILL_POSITION_PRECISION), 1.);\n#else\nout_pos   \x3d u_dvsMat3 * vec3(a_pos * FILL_POSITION_PRECISION, 1.);\n#endif\n#ifdef PATTERN\nvec4  a_tlbr   \x3d a_aux1;\nfloat a_width  \x3d a_aux2.x;\nfloat a_height \x3d a_aux2.y;\nvec2  a_offset \x3d a_aux2.zw;\nvec2  a_scale  \x3d a_aux3.xy;\nfloat a_angle  \x3d a_aux3.z;\nif (getBit(a_bitset, BITSET_FILL_HAS_PATTERN_WIDTH_PRECISION_FACTOR) \x3e 0.5) {\na_width *\x3d INV_SCALE_COMPRESSION_FACTOR;\n}\nif (getBit(a_bitset, BITSET_FILL_HAS_PATTERN_HEIGHT_PRECISION_FACTOR) \x3e 0.5) {\na_height *\x3d INV_SCALE_COMPRESSION_FACTOR;\n}\nvec2 scale \x3d INV_SCALE_COMPRESSION_FACTOR * a_scale;\nfloat width \x3d u_zoomFactor * a_width * scale.x;\nfloat height \x3d u_zoomFactor * a_height * scale.y;\nfloat angle \x3d C_256_TO_RAD * a_angle;\nfloat sinA \x3d sin(angle);\nfloat cosA \x3d cos(angle);\nfloat dx \x3d 0.0;\nfloat dy \x3d 0.0;\nif (getBit(a_bitset, BITSET_FILL_RANDOM_PATTERN_OFFSET) \x3e 0.5) {\nfloat id \x3d rgba2float(vec4(a_id, 0.0));\ndx \x3d rand(vec2(id, 0.0));\ndy \x3d rand(vec2(0.0, id));\n}\nmat3 patternMatrix \x3d mat3(cosA / width, sinA / height, 0,\n-sinA / width, cosA / height, 0,\ndx,            dy,           1);\nvec2 patternSize \x3d vec2(a_width, a_height);\nvec2 numPatternsPerMaxInt \x3d vec2(MAX_REPRESENTABLE_INT) / patternSize;\nvec2 maxIntCrossingOffsetCorrection \x3d patternSize * fract(u_maxIntNumOfCrossing * numPatternsPerMaxInt);\nvec2 tileOffset \x3d u_tileOffset + maxIntCrossingOffsetCorrection - 0.5 * patternSize;\ntileOffset \x3d vec2(tileOffset.x * cosA - tileOffset.y * sinA, tileOffset.x * sinA + tileOffset.y * cosA);\ntileOffset \x3d mod(tileOffset, patternSize);\nvec2 symbolOffset \x3d u_zoomFactor * scale * vec2(a_offset - tileOffset) / vec2(width, height);\nv_tileTextureCoord \x3d (patternMatrix * vec3(a_pos * FILL_POSITION_PRECISION, 1.0)).xy - symbolOffset;\nv_aux1 \x3d a_tlbr / u_mosaicSize.xyxy;\nv_sampleAlphaOnly \x3d getBit(a_bitset, BITSET_GENERIC_CONSIDER_ALPHA_ONLY);\nif (getBit(a_bitSet, BITSET_FILL_HAS_UNRESOLVED_REPLACEMENT_COLOR) \x3e 0.5) {\n#ifdef VV_COLOR\nv_sampleAlphaOnly *\x3d (1.0 - float(isNan(VV_ADATA[ATTR_VV_COLOR]))) * (1.0 - getBit(a_bitSet, BITSET_GENERIC_LOCK_COLOR));\n#else\nv_sampleAlphaOnly \x3d 0.0;\n#endif\n}\n#elif SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nvec4 ddAttributeData0 \x3d getAttributeData2(a_id) * u_isActive[0] * a_inverseArea;\nvec4 ddAttributeData1 \x3d getAttributeData3(a_id) * u_isActive[1] * a_inverseArea;\nfloat size \x3d u_tileZoomFactor * 512.0 * 1.0 / u_pixelRatio;\nv_dotThresholds[0] \x3d dotThreshold(ddAttributeData0, u_dotValue, u_tileDotsOverArea);\nv_dotThresholds[1] \x3d dotThreshold(ddAttributeData1, u_dotValue, u_tileDotsOverArea);\nv_dotTextureCoords \x3d (a_pos * FILL_POSITION_PRECISION + 0.5) / size;\n#endif\n}\n#ifdef HITTEST\nvoid draw(out lowp vec4 out_color, out highp vec3 out_pos) {\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nif (getBit(a_bitset, BITSET_TYPE_FILL_OUTLINE) \x3e 0.5) {\nout_pos \x3d vec3(0., 0., 2.);\nreturn;\n}\n#endif\nhittestFill(out_color, out_pos);\ngl_PointSize \x3d 1.0;\n}\n#elif defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nvoid draw(out lowp vec4 out_color, out highp vec3 out_pos) {\nv_isOutline \x3d getBit(a_bitset, BITSET_TYPE_FILL_OUTLINE);\nif (v_isOutline \x3e 0.5) {\ndrawLine(out_color, out_pos);\n} else {\ndrawFill(out_color, out_pos);\n}\n}\n#else\n#define draw drawFill\n#endif\nvoid main()\n{\nINIT;\nhighp vec3 pos  \x3d vec3(0.);\nhighp vec4 color  \x3d vec4(0.);\ndraw(color, pos);\nv_color \x3d color;\ngl_Position \x3d vec4(clip(v_color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}",
"hittest.glsl":"#ifdef HITTEST\n#include \x3cmaterials/hittest/common.glsl\x3e\nattribute vec2 a_pos1;\nattribute vec2 a_pos2;\nvoid hittestFill(\nout lowp vec4 out_color,\nout highp vec3 out_pos\n) {\nvec3 pos        \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos  * FILL_POSITION_PRECISION, 1.);\nvec3 pos1       \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos1 * FILL_POSITION_PRECISION, 1.);\nvec3 pos2       \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos2 * FILL_POSITION_PRECISION, 1.);\nfloat hittestDist \x3d u_hittestDist;\nfloat dist \x3d distPointTriangle(u_hittestPos, pos.xy, pos1.xy, pos2.xy);\nout_pos \x3d vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif (dist \x3c 0. || dist \x3e\x3d hittestDist) {\nout_pos.z +\x3d 2.0;\n}\nout_color \x3d vec4(1. / 255., 0, 0, dist \x3d\x3d 0. ? (1. / 255.) : 0.);\n}\n#endif"},
hittest:{"common.glsl":"#ifdef HITTEST\nuniform float hittestDist;\nuniform highp vec2 hittestPos;\nfloat projectScalar(vec2 a, vec2 b) {\nreturn dot(a, normalize(b));\n}\nfloat distPointSegment(vec2 p0, vec2 p1, vec2 p2) {\nvec2 L \x3d p2 - p1;\nvec2 A \x3d p0 - p1;\nfloat projAL \x3d projectScalar(A, L);\nfloat t \x3d clamp(projAL / length(L), 0., 1.);\nreturn distance(p0, p1 + t * (p2 - p1));\n}\nvoid hittestMarker(out lowp vec4 out_color, out highp vec3 out_pos, in highp vec3 pos, float size) {\nfloat dist \x3d distance(pos, vec3(hittestPos, 1.));\nout_pos \x3d vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif ((dist - size) \x3e hittestDist) {\nout_pos.z +\x3d 2.0;\n}\nout_color \x3d vec4(1. / 255., 0, 0, (dist - size) \x3c 0. ? (1. / 255.) : 0.);\n}\nfloat intersectPointTriangleBary(vec2 p, vec2 a, vec2 b, vec2 c) {\nreturn inTriangle(xyToBarycentric(p, a, b, c));\n}\nfloat distPointTriangle(vec2 p, vec2 a, vec2 b, vec2 c) {\nvec2 ba \x3d b - a;\nvec2 ca \x3d c - a;\nfloat crossProduct \x3d ba.x * ca.y - ca.x * ba.y;\nbool isParallel \x3d crossProduct \x3c EPSILON_HITTEST \x26\x26 crossProduct \x3e -EPSILON_HITTEST;\nif (isParallel) {\nreturn -1.;\n}\nif (intersectPointTriangleBary(p.xy, a, b, c) \x3d\x3d 1.) {\nreturn 0.;\n}\nfloat distAB \x3d distPointSegment(p, a, b);\nfloat distBC \x3d distPointSegment(p, b, c);\nfloat distCA \x3d distPointSegment(p, c, a);\nreturn min(min(distAB, distBC), distCA);\n}\n#endif"},
icon:{"common.glsl":"#include \x3cutil/encoding.glsl\x3e\nuniform lowp vec2 u_mosaicSize;\nvarying lowp vec4 v_color;\nvarying highp vec3 v_id;\nvarying highp vec4 v_sizeTex;\nvarying mediump vec3 v_pos;\nvarying lowp float v_opacity;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nvarying lowp vec4 v_outlineColor;\nvarying mediump float v_outlineWidth;\nvarying mediump float v_distRatio;\nvarying mediump float v_overridingOutlineColor;\nvarying mediump float v_isThin;\n#endif\n#ifdef SDF\nvec4 getColor(vec2 v_size, vec2 v_tex) {\n#ifdef HITTEST\nlowp vec4 fillPixelColor \x3d vec4(1.0);\n#else\nlowp vec4 fillPixelColor \x3d v_color;\n#endif\nfloat d \x3d 0.5 - rgba2float(texture2D(u_texture, v_tex));\nfloat size \x3d max(v_size.x, v_size.y);\nfloat dist \x3d d * size * SOFT_EDGE_RATIO * v_distRatio;\nfillPixelColor *\x3d clamp(0.5 - dist, 0.0, 1.0);\nfloat outlineWidth \x3d v_outlineWidth;\n#ifdef HIGHLIGHT\noutlineWidth \x3d max(outlineWidth, 4.0 * v_isThin);\n#endif\nif (outlineWidth \x3e 0.25) {\nlowp vec4 outlinePixelColor \x3d v_overridingOutlineColor * v_color + (1.0 - v_overridingOutlineColor) * v_outlineColor;\nfloat clampedOutlineSize \x3d min(outlineWidth, size);\noutlinePixelColor *\x3d clamp(0.5 - abs(dist) + clampedOutlineSize * 0.5, 0.0, 1.0);\nreturn v_opacity * ((1.0 - outlinePixelColor.a) * fillPixelColor + outlinePixelColor);\n}\nreturn v_opacity * fillPixelColor;\n}\n#else\nvec4 getColor(vec2 _v_size, vec2 v_tex) {\nlowp vec4 texColor \x3d texture2D(u_texture, v_tex);\nreturn v_opacity * texColor * v_color;\n}\n#endif",
heatmapAccumulate:{"common.glsl":"varying lowp vec4 v_hittestResult;\nvarying mediump vec2 v_offsetFromCenter;\nvarying highp float v_fieldValue;","heatmapAccumulate.frag":"precision mediump float;\n#include \x3cmaterials/icon/heatmapAccumulate/common.glsl\x3e\n#ifdef HEATMAP_PRECISION_HALF_FLOAT\n#define COMPRESSION_FACTOR 0.25\n#else\n#define COMPRESSION_FACTOR 1.0\n#endif\nuniform lowp sampler2D u_texture;\nvoid main() {\n#ifdef HITTEST\ngl_FragColor \x3d v_hittestResult;\n#else\nfloat radius \x3d length(v_offsetFromCenter);\nfloat shapeWeight \x3d step(radius, 1.0);\nfloat oneMinusRadiusSquared \x3d 1.0 - radius * radius;\nfloat kernelWeight \x3d oneMinusRadiusSquared * oneMinusRadiusSquared;\ngl_FragColor \x3d vec4(shapeWeight * kernelWeight * v_fieldValue * COMPRESSION_FACTOR);\n#endif\n}",
"heatmapAccumulate.vert":"precision highp float;\nattribute vec2 a_vertexOffset;\nvec4 a_color \x3d vec4(0.0);\nvec2 a_zoomRange \x3d vec2(0.0, 10000.0);\nuniform float u_radius;\nuniform float u_isFieldActive;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/hittest/common.glsl\x3e\n#include \x3cmaterials/icon/heatmapAccumulate/common.glsl\x3e\nvoid main() {\nfloat filterFlags \x3d getFilterFlags();\n#ifdef HITTEST\nhighp vec4 out_hittestResult \x3d vec4(0.);\nhighp vec3 out_pos \x3d vec3(0.);\nvec3 pos \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos * POSITION_PRECISION, 1.0);\nhittestMarker(out_hittestResult, out_pos, pos, u_radius);\nv_hittestResult \x3d out_hittestResult;\ngl_PointSize \x3d 1.;\ngl_Position \x3d vec4(clip(a_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\nv_offsetFromCenter \x3d sign(a_vertexOffset);\nv_fieldValue \x3d getAttributeData2(a_id).x * u_isFieldActive + 1.0 - u_isFieldActive;\nvec3 centerPos \x3d u_dvsMat3 * vec3(a_pos * POSITION_PRECISION, 1.0);\nvec3 vertexPos \x3d centerPos + u_displayViewMat3 * vec3(v_offsetFromCenter, 0.0) * u_radius;\ngl_Position \x3d vec4(clip(a_color, vertexPos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},
"hittest.glsl":"#ifdef HITTEST\n#include \x3cmaterials/hittest/common.glsl\x3e\nattribute vec2 a_vertexOffset1;\nattribute vec2 a_vertexOffset2;\nattribute vec2 a_texCoords1;\nattribute vec2 a_texCoords2;\nvec2 getTextureCoords(in vec3 bary, in vec2 texCoords0, in vec2 texCoords1, in vec2 texCoords2) {\nreturn texCoords0 * bary.x + texCoords1 * bary.y + texCoords2 * bary.z;\n}\nvoid hittestIcon(\ninout lowp vec4 out_color,\nout highp vec3 out_pos,\nin vec3 pos,\nin vec3 offset,\nin vec2 size,\nin float scaleFactor,\nin float isMapAligned\n) {\nout_pos \x3d vec3(getAttributeDataTextureCoords(a_id), 0.0);\nvec3 posBase \x3d u_viewMat3 * u_tileMat3  * pos;\nvec3 offset1 \x3d scaleFactor * vec3(a_vertexOffset1 / 16.0, 0.);\nvec3 offset2 \x3d scaleFactor * vec3(a_vertexOffset2 / 16.0, 0.);\nvec2 pos0    \x3d (posBase + getMatrixNoDisplay(isMapAligned) * offset).xy;\nvec2 pos1    \x3d (posBase + getMatrixNoDisplay(isMapAligned) * offset1).xy;\nvec2 pos2    \x3d (posBase + getMatrixNoDisplay(isMapAligned) * offset2).xy;\nvec3 bary0 \x3d xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, -u_hittestDist), pos0, pos1, pos2);\nvec3 bary1 \x3d xyToBarycentric(u_hittestPos + vec2(0., -u_hittestDist), pos0, pos1, pos2);\nvec3 bary2 \x3d xyToBarycentric(u_hittestPos + vec2(u_hittestDist, -u_hittestDist), pos0, pos1, pos2);\nvec3 bary3 \x3d xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, 0.), pos0, pos1, pos2);\nvec3 bary4 \x3d xyToBarycentric(u_hittestPos, pos0, pos1, pos2);\nvec3 bary5 \x3d xyToBarycentric(u_hittestPos + vec2(u_hittestDist, 0.), pos0, pos1, pos2);\nvec3 bary6 \x3d xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, u_hittestDist), pos0, pos1, pos2);\nvec3 bary7 \x3d xyToBarycentric(u_hittestPos + vec2(0., u_hittestDist), pos0, pos1, pos2);\nvec3 bary8 \x3d xyToBarycentric(u_hittestPos + vec2(u_hittestDist, u_hittestDist), pos0, pos1, pos2);\nvec2 tex0 \x3d a_texCoords  / u_mosaicSize;\nvec2 tex1 \x3d a_texCoords1 / u_mosaicSize;\nvec2 tex2 \x3d a_texCoords2 / u_mosaicSize;\nfloat alphaSum \x3d 0.;\nalphaSum +\x3d inTriangle(bary0) * getColor(size, getTextureCoords(bary0, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary1) * getColor(size, getTextureCoords(bary1, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary2) * getColor(size, getTextureCoords(bary2, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary3) * getColor(size, getTextureCoords(bary3, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary4) * getColor(size, getTextureCoords(bary4, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary5) * getColor(size, getTextureCoords(bary5, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary6) * getColor(size, getTextureCoords(bary6, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary7) * getColor(size, getTextureCoords(bary7, tex0, tex1, tex2)).a;\nout_pos.z +\x3d step(alphaSum, .05) * 2.0;\nout_color \x3d vec4(1. / 255., 0., 0., alphaSum / 255.);\n}\n#endif",
"icon.frag":"precision mediump float;\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/icon/common.glsl\x3e\nvoid main()\n{\n#ifdef HITTEST\nvec4 color \x3d v_color;\n#else\nvec4 color \x3d getColor(v_sizeTex.xy, v_sizeTex.zw);\n#endif\n#ifdef HIGHLIGHT\ncolor.a \x3d step(1.0 / 255.0, color.a);\n#endif\ngl_FragColor \x3d color;\n}","icon.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec4 a_outlineColor;\nattribute vec4 a_sizeAndOutlineWidth;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nattribute vec2 a_bitSetAndDistRatio;\nattribute vec2 a_zoomRange;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/icon/common.glsl\x3e\n#include \x3cmaterials/icon/hittest.glsl\x3e\nfloat getMarkerScaleFactor(inout vec2 size, in float referenceSize) {\n#ifdef VV_SIZE\nfloat f \x3d getSize(size.y) / size.y;\nfloat sizeFactor \x3d size.y / referenceSize;\nreturn getSize(referenceSize) / referenceSize;\n#else\nreturn 1.;\n#endif\n}\nvoid main()\n{\nINIT;\nfloat a_bitSet \x3d a_bitSetAndDistRatio.x;\nvec3  pos           \x3d vec3(a_pos * POSITION_PRECISION, 1.0);\nvec2  size          \x3d a_sizeAndOutlineWidth.xy * a_sizeAndOutlineWidth.xy / 128.0;\nvec3  offset        \x3d vec3(a_vertexOffset / 16.0, 0.);\nfloat outlineSize   \x3d a_sizeAndOutlineWidth.z * a_sizeAndOutlineWidth.z / 128.0;\nfloat isMapAligned  \x3d getBit(a_bitSet, BITSET_MARKER_ALIGNMENT_MAP);\nfloat referenceSize \x3d a_sizeAndOutlineWidth.w * a_sizeAndOutlineWidth.w / 128.0;\nfloat scaleSymbolProportionally \x3d getBit(a_bitSet, BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY);\nfloat scaleFactor               \x3d getMarkerScaleFactor(size, referenceSize);\nsize.xy     *\x3d scaleFactor;\noffset.xy   *\x3d scaleFactor;\noutlineSize *\x3d scaleSymbolProportionally * (scaleFactor - 1.0) + 1.0;\nvec2 v_tex   \x3d a_texCoords / u_mosaicSize;\nfloat filterFlags \x3d getFilterFlags();\nv_color    \x3d getColor(a_color, a_bitSet, BITSET_GENERIC_LOCK_COLOR);\nv_opacity  \x3d getOpacity();\nv_id       \x3d norm(a_id);\nv_pos      \x3d u_dvsMat3 * pos + getMatrix(isMapAligned) * getRotation()  * offset;\nv_sizeTex  \x3d vec4(size.xy, v_tex.xy);\n#ifdef SDF\nv_isThin   \x3d getBit(a_bitSet, BITSET_MARKER_OUTLINE_ALLOW_COLOR_OVERRIDE);\n#ifdef VV_COLOR\nv_overridingOutlineColor \x3d v_isThin;\n#else\nv_overridingOutlineColor \x3d 0.0;\n#endif\nv_outlineWidth \x3d min(outlineSize, max(max(size.x, size.y) - 0.99, 0.0));\nv_outlineColor \x3d a_outlineColor;\nv_distRatio \x3d a_bitSetAndDistRatio.y / 128.0;\n#endif\n#ifdef HITTEST\nhighp vec4 out_color \x3d vec4(0.);\nhighp vec3 out_pos   \x3d vec3(0.);\nhittestIcon(out_color, out_pos, pos, offset, size, scaleFactor, isMapAligned);\nv_color \x3d out_color;\ngl_PointSize \x3d 1.;\ngl_Position \x3d vec4(clip(v_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\ngl_Position \x3d vec4(clip(v_color, v_pos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},
label:{"common.glsl":"uniform mediump float u_zoomLevel;\nuniform mediump float u_mapRotation;\nuniform mediump float u_mapAligned;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying mediump vec2 v_tex;\nvarying mediump vec4 v_color;\nvarying lowp vec4 v_animation;","label.frag":"#include \x3cmaterials/text/text.frag\x3e","label.vert":"precision highp float;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/text/common.glsl\x3e\nattribute vec4 a_color;\nattribute vec4 a_haloColor;\nattribute vec4 a_texAndSize;\nattribute vec4 a_refSymbolAndPlacementOffset;\nattribute vec4 a_glyphData;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nuniform float u_isHaloPass;\nuniform float u_isBackgroundPass;\nuniform float u_mapRotation;\nuniform float u_mapAligned;\nfloat getZ(in float minZoom, in float maxZoom, in float angle) {\nfloat glyphAngle \x3d angle * 360.0 / 254.0;\nfloat mapAngle \x3d u_mapRotation * 360.0 / 254.0;\nfloat diffAngle \x3d min(360.0 - abs(mapAngle - glyphAngle), abs(mapAngle - glyphAngle));\nfloat z \x3d 0.0;\nz +\x3d u_mapAligned * (2.0 * (1.0 - step(minZoom, u_currentZoom)));\nz +\x3d u_mapAligned * 2.0 * step(90.0, diffAngle);\nz +\x3d 2.0 * (1.0 - step(u_currentZoom, maxZoom));\nreturn z;\n}\nvoid main()\n{\nINIT;\nfloat groupMinZoom    \x3d getMinZoom();\nfloat glyphMinZoom    \x3d a_glyphData.x;\nfloat glyphMaxZoom    \x3d a_glyphData.y;\nfloat glyphAngle      \x3d a_glyphData.z;\nfloat a_isBackground  \x3d a_glyphData.w;\nfloat a_minZoom          \x3d max(groupMinZoom, glyphMinZoom);\nfloat a_placementPadding \x3d a_refSymbolAndPlacementOffset.x * EXTRUDE_SCALE_PLACEMENT_PADDING;\nvec2  a_placementDir     \x3d unpack_u8_nf32(a_refSymbolAndPlacementOffset.zw);\nfloat a_refSymbolSize    \x3d a_refSymbolAndPlacementOffset.y;\nfloat fontSize           \x3d a_texAndSize.z;\nfloat haloSize           \x3d a_texAndSize.w * OUTLINE_SCALE;\nvec2  vertexOffset \x3d a_vertexOffset * OFFSET_PRECISION;\nvec3  pos          \x3d vec3(a_pos * POSITION_PRECISION, 1.0);\nfloat z            \x3d getZ(a_minZoom, glyphMaxZoom, glyphAngle);\nfloat fontScale    \x3d fontSize / SDF_FONT_SIZE;\nfloat halfSize     \x3d getSize(a_refSymbolSize) / 2.0;\nfloat animation    \x3d pow(getAnimationState(), vec4(2.0)).r;\nfloat isText \x3d 1.0 - a_isBackground;\nfloat isBackground \x3d u_isBackgroundPass * a_isBackground;\nvec4  nonHaloColor \x3d (isBackground + isText) * a_color;\nv_color     \x3d animation * ((1.0 - u_isHaloPass) * nonHaloColor + (u_isHaloPass * a_haloColor));\nv_opacity   \x3d 1.0;\nv_tex       \x3d a_texCoords / u_mosaicSize;\nv_edgeDistanceOffset \x3d u_isHaloPass * haloSize / fontScale / MAX_SDF_DISTANCE;\nv_antialiasingWidth  \x3d 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\nvec2 placementOffset \x3d a_placementDir * (halfSize + a_placementPadding);\nvec3 glyphOffset     \x3d u_displayMat3 * vec3(vertexOffset + placementOffset, 0.0);\nvec3 v_pos           \x3d vec3((u_dvsMat3 * pos + glyphOffset).xy, z);\nfloat isHidden \x3d u_isBackgroundPass * isText + (1.0 - u_isBackgroundPass) * a_isBackground;\nv_pos.z +\x3d 2.0 * isHidden;\ngl_Position \x3d vec4(v_pos, 1.0);\n#ifdef DEBUG\nv_color \x3d vec4(a_color.rgb, z \x3d\x3d 0.0 ? 1.0 : 0.645);\n#endif\n}"},
line:{"common.glsl":"varying lowp vec4 v_color;\nvarying highp vec3 v_id;\nvarying mediump vec2 v_normal;\nvarying mediump float v_lineHalfWidth;\nvarying lowp float v_opacity;\n#ifdef PATTERN\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\n#endif\n#if defined(PATTERN) || defined(SDF)\nvarying highp float v_accumulatedDistance;\n#endif\n#ifdef SDF\nvarying mediump float v_lineWidthRatio;\n#endif","hittest.glsl":"#include \x3cmaterials/hittest/common.glsl\x3e\n#ifdef HITTEST\nattribute vec2 a_pos1;\nattribute vec2 a_pos2;\nvoid hittestLine(out lowp vec4 out_color, out highp vec3 out_pos, float halfWidth) {\nvec3 pos        \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos  * POSITION_PRECISION, 1.);\nvec3 pos1       \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos1 * POSITION_PRECISION, 1.);\nvec3 pos2       \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos2 * POSITION_PRECISION, 1.);\nvec3 outTextureCoords \x3d vec3(getAttributeDataTextureCoords(a_id), 0.0);\nfloat dist \x3d min(distPointSegment(u_hittestPos, pos.xy, pos1.xy),\ndistPointSegment(u_hittestPos, pos.xy, pos2.xy)) - halfWidth;\nout_pos \x3d vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif (dist \x3e\x3d u_hittestDist) {\nout_pos.z +\x3d 2.0;\n}\nout_color \x3d vec4(1. / 255., 0, 0, dist \x3c\x3d 0. ? (1. / 255.) : 0.);\n}\n#endif",
"line.frag":"precision lowp float;\n#include \x3cutil/encoding.glsl\x3e\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/symbologyTypeUtils.glsl\x3e\n#include \x3cmaterials/line/common.glsl\x3e\n#include \x3cmaterials/shared/line/common.glsl\x3e\n#include \x3cmaterials/shared/line/line.frag\x3e\n#ifdef HITTEST\nvoid main() {\ngl_FragColor \x3d v_color;\n}\n#else\nvoid main() {\nLineData inputs \x3d LineData(\nv_color,\nv_normal,\nv_lineHalfWidth,\nv_opacity,\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nv_tlbr,\nv_patternSize,\n#endif\n#ifdef SDF\nv_lineWidthRatio,\n#endif\n#if defined(PATTERN) || defined(SDF)\nv_accumulatedDistance,\n#endif\n#endif\nv_id\n);\ngl_FragColor \x3d shadeLine(inputs);\n}\n#endif",
"line.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec4 a_offsetAndNormal;\nattribute vec2 a_accumulatedDistanceAndHalfWidth;\nattribute vec4 a_tlbr;\nattribute vec4 a_segmentDirection;\nattribute vec2 a_aux;\nattribute vec2 a_zoomRange;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/symbologyTypeUtils.glsl\x3e\n#include \x3cmaterials/line/common.glsl\x3e\n#include \x3cmaterials/line/hittest.glsl\x3e\n#include \x3cmaterials/shared/line/common.glsl\x3e\n#include \x3cmaterials/shared/line/line.vert\x3e\n#ifdef HITTEST\nvoid draw() {\nfloat aa        \x3d 0.5 * u_antialiasing;\nfloat a_halfWidth \x3d a_accumulatedDistanceAndHalfWidth.y / 16.;\nfloat a_cimHalfWidth \x3d a_aux.x / 16. ;\nvec2  a_offset \x3d a_offsetAndNormal.xy / 16.;\nfloat baseWidth \x3d getBaseLineHalfWidth(a_halfWidth, a_cimHalfWidth);\nfloat halfWidth \x3d getLineHalfWidth(baseWidth, aa);\nhighp vec3 pos  \x3d vec3(0.);\nv_color \x3d vec4(0.);\nhittestLine(v_color, pos, halfWidth);\ngl_PointSize \x3d 1.;\ngl_Position \x3d vec4(clip(v_color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}\n#else\nvoid draw()\n{\nhighp vec3 pos \x3d vec3(0.);\nLineData outputs \x3d buildLine(\npos,\na_id,\na_pos,\na_color,\na_offsetAndNormal.xy / 16.,\na_offsetAndNormal.zw / 16.,\na_accumulatedDistanceAndHalfWidth.x,\na_accumulatedDistanceAndHalfWidth.y / 16.,\na_segmentDirection.w,\na_tlbr,\na_segmentDirection.xy / 16.,\na_aux.x / 16.\n);\nv_id              \x3d outputs.id;\nv_color           \x3d outputs.color;\nv_normal          \x3d outputs.normal;\nv_lineHalfWidth   \x3d outputs.lineHalfWidth;\nv_opacity         \x3d outputs.opacity;\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nv_tlbr          \x3d outputs.tlbr;\nv_patternSize   \x3d outputs.patternSize;\n#endif\n#ifdef SDF\nv_lineWidthRatio \x3d outputs.lineWidthRatio;\n#endif\n#if defined(PATTERN) || defined(SDF)\nv_accumulatedDistance \x3d outputs.accumulatedDistance;\n#endif\n#endif\ngl_Position \x3d vec4(clip(outputs.color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}\n#endif\nvoid main() {\nINIT;\ndraw();\n}"},
pie:{"pie.common.glsl":"uniform float outlineWidth;\nuniform mediump float sectorThreshold;\nvarying vec3  v_id;\nvarying vec3  v_pos;\nvarying vec2  v_offset;\nvarying vec4  v_color;\nvarying float v_size;\nvarying float v_numOfEntries;\nvarying float v_maxSectorAngle;\nvarying vec2  v_filteredSectorToColorId[numberOfFields];\nvarying vec2  v_texCoords;\nvarying float v_outlineWidth;\nvarying float v_opacity;\nstruct FilteredChartInfo {\nfloat endSectorAngle;\nint colorId;\n};","pie.frag":"precision highp float;\n#include \x3cutil/atan2.glsl\x3e\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/pie/pie.common.glsl\x3e\nuniform lowp vec4 colors[numberOfFields];\nuniform lowp vec4 defaultColor;\nuniform lowp vec4 othersColor;\nuniform lowp vec4 outlineColor;\nuniform float donutRatio;\nlowp vec4 getSectorColor(in int index, in vec2 filteredSectorToColorId[numberOfFields]) {\nmediump int colorIndex \x3d int(filteredSectorToColorId[index].y);\nreturn colors[colorIndex];\n}\nconst int OTHER_SECTOR_ID \x3d 255;\n#ifdef HITTEST\nvec4 getColor() {\nfloat distanceSize \x3d length(v_offset) * v_size;\nfloat donutSize \x3d donutRatio * v_size;\nfloat alpha \x3d step(donutSize, distanceSize) * (1.0 - step(v_size, distanceSize));\nreturn v_color;\n}\n#else\nvec4 getColor() {\nfloat angle \x3d 90.0 - C_RAD_TO_DEG * atan2(v_offset.y, v_offset.x);\nif (angle \x3c 0.0) {\nangle +\x3d 360.0;\n} else if (angle \x3e 360.0) {\nangle \x3d mod(angle, 360.0);\n}\nint numOfEntries \x3d int(v_numOfEntries);\nfloat maxSectorAngle \x3d v_maxSectorAngle;\nlowp vec4 fillColor \x3d (maxSectorAngle \x3e 0.0 || sectorThreshold \x3e 0.0) ? othersColor : defaultColor;\nlowp vec4 prevColor \x3d vec4(0.0);\nlowp vec4 nextColor \x3d vec4(0.0);\nfloat startSectorAngle \x3d 0.0;\nfloat endSectorAngle \x3d 0.0;\nif (angle \x3c maxSectorAngle) {\nfor (int index \x3d 0; index \x3c numberOfFields; ++index) {\nstartSectorAngle \x3d endSectorAngle;\nendSectorAngle \x3d v_filteredSectorToColorId[index].x;\nif (endSectorAngle \x3e angle) {\nfillColor \x3d getSectorColor(index, v_filteredSectorToColorId);\nprevColor \x3d sectorThreshold !\x3d 0.0 \x26\x26 index \x3d\x3d 0 \x26\x26 abs(360.0 - maxSectorAngle) \x3c EPSILON ? othersColor :\ngetSectorColor(index \x3e 0 ? index - 1 : numOfEntries - 1, v_filteredSectorToColorId);\nnextColor \x3d sectorThreshold !\x3d 0.0 \x26\x26 abs(endSectorAngle - maxSectorAngle) \x3c EPSILON ? othersColor :\ngetSectorColor(index \x3c numOfEntries - 1 ? index + 1 : 0, v_filteredSectorToColorId);\nbreak;\n}\nif (index \x3d\x3d numOfEntries - 1) {\nbreak;\n}\n}\n} else {\nprevColor \x3d getSectorColor(numOfEntries - 1, v_filteredSectorToColorId);\nnextColor \x3d getSectorColor(0, v_filteredSectorToColorId);\nstartSectorAngle \x3d maxSectorAngle;\nendSectorAngle \x3d 360.0;\n}\nlowp vec4 outlineColor \x3d outlineColor;\nfloat offset \x3d length(v_offset);\nfloat distanceSize \x3d offset * v_size;\nif (startSectorAngle !\x3d 0.0 || endSectorAngle !\x3d 360.0) {\nfloat distanceToStartSector \x3d (angle - startSectorAngle);\nfloat distanceToEndSector \x3d (endSectorAngle - angle);\nfloat sectorThreshold \x3d 0.6;\nfloat beginSectorAlpha \x3d smoothstep(0.0, sectorThreshold, distanceToStartSector * offset);\nfloat endSectorAlpha \x3d smoothstep(0.0, sectorThreshold, distanceToEndSector * offset);\nif (endSectorAlpha \x3e 0.0) {\nfillColor \x3d mix(nextColor, fillColor, endSectorAlpha);\n} else if (beginSectorAlpha \x3e 0.0) {\nfillColor \x3d mix(prevColor, fillColor, beginSectorAlpha);\n}\n}\nfloat donutSize \x3d donutRatio * (v_size - v_outlineWidth);\nfloat endOfDonut \x3d donutSize - v_outlineWidth;\nfloat aaThreshold \x3d 0.75;\nfloat innerCircleAlpha \x3d endOfDonut - aaThreshold \x3e 0.0 ? smoothstep(endOfDonut - aaThreshold, endOfDonut + aaThreshold, distanceSize) : 1.0;\nfloat outerCircleAlpha \x3d 1.0 - smoothstep(v_size - aaThreshold, v_size + aaThreshold , distanceSize);\nfloat circleAlpha \x3d innerCircleAlpha * outerCircleAlpha;\nfloat startOfOutline \x3d v_size - v_outlineWidth;\nif (startOfOutline \x3e 0.0 \x26\x26 v_outlineWidth \x3e 0.25) {\nfloat outlineFactor \x3d smoothstep(startOfOutline - aaThreshold, startOfOutline + aaThreshold, distanceSize);\nfloat innerLineFactor \x3d donutSize - aaThreshold \x3e 0.0 ? 1.0 - smoothstep(donutSize - aaThreshold, donutSize + aaThreshold , distanceSize) : 0.0;\nfillColor \x3d mix(fillColor, outlineColor, innerLineFactor + outlineFactor);\n}\nreturn v_opacity * circleAlpha * fillColor;\n}\n#endif\nvoid main()\n{\nvec4 color \x3d getColor();\n#ifdef highlight\ncolor.a \x3d step(1.0 / 255.0, color.a);\n#endif\ngl_FragColor \x3d color;\n}",
"pie.vert":"#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/barycentric.glsl\x3e\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/vv.glsl\x3e\n#include \x3cmaterials/attributeData.glsl\x3e\n#include \x3cmaterials/pie/pie.common.glsl\x3e\n#include \x3cmaterials/hittest/common.glsl\x3e\nattribute float a_bitSet;\nattribute vec2  a_offset;\nattribute vec2  a_texCoords;\nattribute vec2  a_size;\nattribute float a_referenceSize;\nattribute vec2  a_zoomRange;\nint filterValue(in float sectorAngle,\nin int currentIndex,\ninout FilteredChartInfo filteredInfo,\ninout vec2 filteredSectorToColorId[numberOfFields]) {\nif (sectorAngle \x3e sectorThreshold * 360.0) {\nfilteredInfo.endSectorAngle +\x3d sectorAngle;\nfilteredSectorToColorId[filteredInfo.colorId] \x3d vec2(filteredInfo.endSectorAngle, currentIndex);\n++filteredInfo.colorId;\n}\nreturn 0;\n}\nint filterValues(inout vec2 filteredSectorToColorId[numberOfFields],\ninout FilteredChartInfo filteredInfo,\nin float sectorAngles[numberOfFields]) {\nfor (int index \x3d 0; index \x3c numberOfFields; ++index) {\nfloat sectorValue \x3d sectorAngles[index];\nfilterValue(sectorValue, index, filteredInfo, filteredSectorToColorId);\n}\nreturn filteredInfo.colorId;\n}\nvec2 getMarkerSize(inout vec2 offset, inout vec2 baseSize, inout float outlineSize, in float a_referenceSize, in float bitSet) {\nvec2 outSize \x3d baseSize;\n#ifdef VV_SIZE\nfloat r \x3d getSize(a_referenceSize, currentScale) / a_referenceSize;\noutSize.xy *\x3d r;\noffset.xy *\x3d r;\nfloat scaleSymbolProportionally \x3d getBit(bitSet, BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY);\noutlineSize *\x3d scaleSymbolProportionally * (r - 1.0) + 1.0;\n#endif\nreturn outSize;\n}\nvec3 getOffset(in vec2 in_offset, float a_bitSet) {\nfloat isMapAligned \x3d getBit(a_bitSet, BITSET_MARKER_ALIGNMENT_MAP);\nvec3  offset       \x3d vec3(in_offset, 0.0);\nreturn getMatrix(isMapAligned) * offset;\n}\nfloat filterNaNValues(in float value) {\nreturn value !\x3d NAN_MAGIC_NUMBER \x26\x26 value \x3e 0.0 ? value : 0.0;\n}\nvoid main()\n{\nINIT;\nvec2  a_size   \x3d a_size;\nvec2  a_offset \x3d a_offset / 16.0;\nfloat outlineSize \x3d outlineWidth;\nfloat a_bitSet \x3d a_bitSet;\nfloat a_referenceSize \x3d a_referenceSize;\nvec2 a_texCoords \x3d a_texCoords / 4.0;\nvec2 markerSize \x3d getMarkerSize(a_offset, a_size, outlineSize, a_referenceSize, a_bitSet);\nfloat filterFlags \x3d getFilterFlags();\nvec3  pos         \x3d vec3(a_pos / 10.0, 1.0);\nv_opacity      \x3d getOpacity();\nv_id           \x3d norm(a_id);\nv_pos          \x3d displayViewScreenMat3 * pos + getOffset(a_offset, a_bitSet);\nv_offset       \x3d sign(a_texCoords - 0.5);\nv_size         \x3d max(markerSize.x, markerSize.y);\nv_outlineWidth \x3d outlineSize;\nfloat attributeData[10];\nvec4 attributeData3 \x3d getDataDriven0(a_id);\nattributeData[0] \x3d filterNaNValues(attributeData3.x);\nattributeData[1] \x3d filterNaNValues(attributeData3.y);\nattributeData[2] \x3d filterNaNValues(attributeData3.z);\nattributeData[3] \x3d filterNaNValues(attributeData3.w);\n#if (numberOfFields \x3e 4)\nvec4 attributeData4 \x3d getDataDriven1(a_id);\nattributeData[4] \x3d filterNaNValues(attributeData4.x);\nattributeData[5] \x3d filterNaNValues(attributeData4.y);\nattributeData[6] \x3d filterNaNValues(attributeData4.z);\nattributeData[7] \x3d filterNaNValues(attributeData4.w);\n#endif\n#if (numberOfFields \x3e 8)\nvec4 attributeData5 \x3d getDataDriven2(a_id);\nattributeData[8] \x3d filterNaNValues(attributeData5.x);\nattributeData[9] \x3d filterNaNValues(attributeData5.y);\n#endif\nfloat sum \x3d 0.0;\nfor (int i \x3d 0; i \x3c numberOfFields; ++i) {\nsum +\x3d attributeData[i];\n}\nfloat sectorAngles[numberOfFields];\nfor (int i \x3d 0; i \x3c numberOfFields; ++i) {\nsectorAngles[i] \x3d 360.0 * attributeData[i] / sum;\n}\nvec2 filteredSectorToColorId[numberOfFields];\nFilteredChartInfo filteredInfo \x3d FilteredChartInfo(0.0, 0);\nint numOfEntries \x3d filterValues(filteredSectorToColorId, filteredInfo, sectorAngles);\nv_numOfEntries \x3d float(numOfEntries);\nv_maxSectorAngle \x3d filteredInfo.endSectorAngle;\nv_filteredSectorToColorId \x3d filteredSectorToColorId;\n#ifdef HITTEST\nhighp vec3 out_pos \x3d vec3(0.0);\nv_color            \x3d vec4(0.0);\nhittestMarker(v_color, out_pos, viewMat3 * tileMat3 *  pos, v_size);\ngl_PointSize \x3d 1.0;\ngl_Position \x3d vec4(clip(v_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\ngl_Position \x3d vec4(clip(v_color, v_pos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},
shared:{line:{"common.glsl":"#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) \x26\x26 defined(PATTERN)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_sampleAlphaOnly;\n#endif\nstruct LineData {\nlowp vec4 color;\nmediump vec2 normal;\nmediump float lineHalfWidth;\nlowp float opacity;\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nmediump vec4 tlbr;\nmediump vec2 patternSize;\n#endif\n#ifdef SDF\nmediump float lineWidthRatio;\n#endif\n#if defined(PATTERN) || defined(SDF)\nhighp float accumulatedDistance;\n#endif\n#endif\nhighp vec3 id;\n};",
"line.frag":"uniform lowp float u_blur;\n#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) \x26\x26 !defined(HIGHLIGHT)\n#if defined(PATTERN) || defined(SDF)\nuniform sampler2D u_texture;\nuniform highp float u_pixelRatio;\n#endif\n#endif\n#if defined(SDF) \x26\x26 !defined(HIGHLIGHT) \x26\x26 !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nlowp vec4 getLineColor(LineData line) {\nmediump float adjustedPatternWidth \x3d line.patternSize.x * 2.0 * line.lineWidthRatio;\nmediump float relativeTexX \x3d fract(line.accumulatedDistance / adjustedPatternWidth);\nmediump float relativeTexY \x3d 0.5 + 0.25 * line.normal.y;\nmediump vec2 texCoord \x3d mix(line.tlbr.xy, line.tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d \x3d rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist \x3d d * line.lineHalfWidth;\nreturn line.opacity * clamp(0.5 - dist, 0.0, 1.0) * line.color;\n}\n#elif defined(PATTERN) \x26\x26 !defined(HIGHLIGHT) \x26\x26 !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nlowp vec4 getLineColor(LineData line) {\nmediump float lineHalfWidth \x3d line.lineHalfWidth;\nmediump float adjustedPatternHeight \x3d line.patternSize.y * 2.0 * lineHalfWidth / line.patternSize.x;\nmediump float relativeTexY \x3d fract(line.accumulatedDistance / adjustedPatternHeight);\nmediump float relativeTexX \x3d 0.5 + 0.5 * line.normal.y;\nmediump vec2 texCoord \x3d mix(line.tlbr.xy, line.tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color \x3d texture2D(u_texture, texCoord);\n#ifdef VV_COLOR\nif (v_sampleAlphaOnly \x3e 0.5) {\ncolor.rgb \x3d vec3(color.a);\n}\n#endif\nreturn line.opacity * line.color * color;\n}\n#else\nlowp vec4 getLineColor(LineData line) {\nreturn line.opacity * line.color;\n}\n#endif\nvec4 shadeLine(LineData line)\n{\nmediump float thinLineFactor \x3d max(THIN_LINE_WIDTH_FACTOR * step(line.lineHalfWidth, THIN_LINE_HALF_WIDTH), 1.0);\nmediump float fragDist \x3d length(line.normal) * line.lineHalfWidth;\nlowp float alpha \x3d clamp(thinLineFactor * (line.lineHalfWidth - fragDist) / (u_blur + thinLineFactor - 1.0), 0.0, 1.0);\nlowp vec4 out_color \x3d getLineColor(line) * alpha;\n#ifdef HIGHLIGHT\nout_color.a \x3d step(1.0 / 255.0, out_color.a);\n#endif\n#ifdef ID\nif (out_color.a \x3c 1.0 / 255.0) {\ndiscard;\n}\nout_color \x3d vec4(line.id, 0.0);\n#endif\nreturn out_color;\n}",
"line.vert":"float getBaseLineHalfWidth(in float lineHalfWidth, in float referenceHalfWidth) {\n#ifdef VV_SIZE\nfloat refLineWidth \x3d 2.0 * referenceHalfWidth;\nreturn 0.5 * (lineHalfWidth / max(referenceHalfWidth, EPSILON)) * getSize(refLineWidth);\n#else\nreturn lineHalfWidth;\n#endif\n}\nfloat getLineHalfWidth(in float baseWidth, in float aa) {\nfloat halfWidth \x3d max(baseWidth + aa, 0.45) + 0.1 * aa;\n#ifdef HIGHLIGHT\nhalfWidth \x3d max(halfWidth, 2.0);\n#endif\nreturn halfWidth;\n}\nvec2 getDist(in vec2 offset, in float halfWidth) {\nfloat thinLineFactor \x3d max(THIN_LINE_WIDTH_FACTOR * step(halfWidth, THIN_LINE_HALF_WIDTH), 1.0);\nreturn thinLineFactor * halfWidth * offset;\n}\nLineData buildLine(\nout vec3 out_pos,\nin vec3 in_id,\nin vec2 in_pos,\nin vec4 in_color,\nin vec2 in_offset,\nin vec2 in_normal,\nin float in_accumulatedDist,\nin float in_lineHalfWidth,\nin float in_bitSet,\nin vec4 in_tlbr,\nin vec2 in_segmentDirection,\nin float in_referenceHalfWidth\n)\n{\nfloat aa        \x3d 0.5 * u_antialiasing;\nfloat baseWidth \x3d getBaseLineHalfWidth(in_lineHalfWidth, in_referenceHalfWidth);\nfloat halfWidth \x3d getLineHalfWidth(baseWidth, aa);\nfloat z         \x3d 2.0 * step(baseWidth, 0.0);\nvec2  dist      \x3d getDist(in_offset, halfWidth);\nvec3  offset    \x3d u_displayViewMat3 * vec3(dist, 0.0);\nvec3  pos       \x3d u_dvsMat3 * vec3(in_pos * POSITION_PRECISION, 1.0) + offset;\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nvec4  color     \x3d in_color;\nfloat opacity   \x3d 1.0;\n#else\nvec4  color     \x3d getColor(in_color, in_bitSet, BITSET_GENERIC_LOCK_COLOR);\nfloat opacity   \x3d getOpacity();\n#ifdef SDF\nconst float SDF_PATTERN_HALF_WIDTH \x3d 15.5;\nfloat scaleDash \x3d getBit(in_bitSet, BITSET_LINE_SCALE_DASH);\nfloat lineWidthRatio \x3d (scaleDash * max(halfWidth - 0.55 * u_antialiasing, 0.25) + (1.0 - scaleDash)) / SDF_PATTERN_HALF_WIDTH;\n#endif\n#endif\n#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) \x26\x26 defined(PATTERN)\nv_sampleAlphaOnly \x3d getBit(in_bitSet, BITSET_GENERIC_CONSIDER_ALPHA_ONLY);\n#endif\nout_pos \x3d vec3(pos.xy, z);\nreturn LineData(\ncolor,\nin_normal,\nhalfWidth,\nopacity,\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nin_tlbr / u_mosaicSize.xyxy,\nvec2(in_tlbr.z - in_tlbr.x, in_tlbr.w - in_tlbr.y),\n#endif\n#ifdef SDF\nlineWidthRatio,\n#endif\n#if defined(PATTERN) || defined(SDF)\nin_accumulatedDist * u_zoomFactor + dot(in_segmentDirection, dist),\n#endif\n#endif\nnorm(in_id)\n);\n}"}},
"symbologyTypeUtils.glsl":"#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_OUTLINE_FILL || SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_OUTLINE_FILL_SIMPLE\n#define SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#endif\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_SIMPLE || SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_OUTLINE_FILL_SIMPLE\n#define SYMBOLOGY_TYPE_IS_SIMPLE_LIKE\n#endif",text:{"common.glsl":"uniform highp vec2 u_mosaicSize;\nvarying highp vec3 v_id;\nvarying mediump vec3 v_pos;\nvarying lowp float v_opacity;\nvarying lowp vec4 v_color;\nvarying highp vec2 v_tex;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying lowp float v_transparency;",
"hittest.glsl":"#include \x3cmaterials/hittest/common.glsl\x3e","text.frag":"precision mediump float;\n#include \x3cmaterials/text/common.glsl\x3e\nuniform lowp sampler2D u_texture;\n#ifdef HITTEST\nvec4 getColor() {\nreturn v_color;\n}\n#else\nvec4 getColor()\n{\nfloat SDF_CUTOFF \x3d (2.0 / 8.0);\nfloat SDF_BASE_EDGE_DIST \x3d 1.0 - SDF_CUTOFF;\nlowp float dist \x3d texture2D(u_texture, v_tex).a;\nmediump float edge \x3d SDF_BASE_EDGE_DIST - v_edgeDistanceOffset;\n#ifdef HIGHLIGHT\nedge /\x3d 2.0;\n#endif\nlowp float aa \x3d v_antialiasingWidth;\nlowp float alpha \x3d smoothstep(edge - aa, edge + aa, dist);\nreturn alpha * v_color * v_opacity;\n}\n#endif\nvoid main()\n{\ngl_FragColor \x3d getColor();\n}",
"text.vert":"precision highp float;\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/text/common.glsl\x3e\n#include \x3cmaterials/text/hittest.glsl\x3e\nattribute vec4 a_color;\nattribute vec4 a_haloColor;\nattribute vec4 a_texFontSize;\nattribute vec4 a_aux;\nattribute vec2 a_zoomRange;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nuniform float u_isHaloPass;\nuniform float u_isBackgroundPass;\nfloat getTextSize(inout vec2 offset, inout float baseSize, in float referenceSize) {\n#ifdef VV_SIZE\nfloat r \x3d getSize(referenceSize) / referenceSize;\nbaseSize *\x3d r;\noffset.xy *\x3d r;\nreturn baseSize;\n#endif\nreturn baseSize;\n}\nvoid main()\n{\nINIT;\nfloat a_isBackground  \x3d a_aux.y;\nfloat a_referenceSize \x3d a_aux.z * a_aux.z / 256.0;\nfloat a_bitSet        \x3d a_aux.w;\nfloat a_fontSize      \x3d a_texFontSize.z;\nvec2  a_offset        \x3d a_vertexOffset * OFFSET_PRECISION;\nvec3  in_pos        \x3d vec3(a_pos * POSITION_PRECISION, 1.0);\nfloat fontSize      \x3d getTextSize(a_offset, a_fontSize, a_referenceSize);\nfloat fontScale     \x3d fontSize / SDF_FONT_SIZE;\nvec3  offset        \x3d getRotation() * vec3(a_offset, 0.0);\nmat3  extrudeMatrix \x3d getBit(a_bitSet, 0) \x3d\x3d 1.0 ? u_displayViewMat3 : u_displayMat3;\nfloat isText \x3d 1.0 - a_isBackground;\nfloat isBackground \x3d u_isBackgroundPass * a_isBackground;\nvec4  nonHaloColor  \x3d (isBackground * a_color) + (isText * getColor(a_color, a_bitSet, 1));\nv_color   \x3d u_isHaloPass * a_haloColor + (1.0 - u_isHaloPass) * nonHaloColor;\nv_opacity \x3d getOpacity();\nv_id      \x3d norm(a_id);\nv_tex     \x3d a_texCoords / u_mosaicSize;\nv_pos     \x3d u_dvsMat3 * in_pos + extrudeMatrix * offset;\nfloat isHidden \x3d u_isBackgroundPass * isText + (1.0 - u_isBackgroundPass) * a_isBackground;\nv_pos.z +\x3d 2.0 * isHidden;\nv_edgeDistanceOffset \x3d u_isHaloPass * OUTLINE_SCALE * a_texFontSize.w / fontScale / MAX_SDF_DISTANCE;\nv_antialiasingWidth  \x3d 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\n#ifdef HITTEST\nhighp vec3 out_pos  \x3d vec3(0.);\nv_color \x3d vec4(0.);\nhittestMarker(v_color, out_pos, u_viewMat3 * u_tileMat3 *  vec3(a_pos * POSITION_PRECISION, 1.0)\n+ u_tileMat3 * offset, fontSize / 2.);\ngl_PointSize \x3d 1.;\ngl_Position \x3d vec4(clip(v_color, out_pos, getFilterFlags(), a_zoomRange), 1.0);\n#else\ngl_Position \x3d  vec4(clip(v_color, v_pos, getFilterFlags(), a_zoomRange), 1.0);\n#endif\n}"},
"utils.glsl":"float rshift(in float u32, in int amount) {\nreturn floor(u32 / pow(2.0, float(amount)));\n}\nfloat getBit(in float bitset, in int bitIndex) {\nfloat offset \x3d pow(2.0, float(bitIndex));\nreturn mod(floor(bitset / offset), 2.0);\n}\nconst int maxHighlightReasons \x3d 6;\nfloat getFilterBit(in float bitset, in int bitIndex) {\nreturn getBit(bitset, bitIndex + maxHighlightReasons);\n}\nfloat getHighlightBit(in float bitset, in int bitIndex) {\nreturn getBit(bitset, bitIndex);\n}\nhighp vec3 unpackDisplayIdTexel(in highp vec3 bitset) {\nfloat isAggregate \x3d getBit(bitset.b, 7);\nreturn (1.0 - isAggregate) * bitset + isAggregate * (vec3(bitset.rgb) - vec3(0.0, 0.0, float(0x80)));\n}\nvec4 unpack(in float u32) {\nfloat r \x3d mod(rshift(u32, 0), 255.0);\nfloat g \x3d mod(rshift(u32, 8), 255.0);\nfloat b \x3d mod(rshift(u32, 16), 255.0);\nfloat a \x3d mod(rshift(u32, 24), 255.0);\nreturn vec4(r, g, b, a);\n}\nvec3 norm(in vec3 v) {\nreturn v /\x3d 255.0;\n}\nvec4 norm(in vec4 v) {\nreturn v /\x3d 255.0;\n}\nfloat max4(vec4 target) {\nreturn max(max(max(target.x, target.y), target.z), target.w);\n}\nvec2 unpack_u8_nf32(vec2 bytes) {\nreturn (bytes - 127.0) / 127.0;\n}\nhighp float rand(in vec2 co) {\nhighp float a \x3d 12.9898;\nhighp float b \x3d 78.233;\nhighp float c \x3d 43758.5453;\nhighp float dt \x3d dot(co, vec2(a,b));\nhighp float sn \x3d mod(dt, 3.14);\nreturn fract(sin(sn) * c);\n}",
"vcommon.glsl":"#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/attributeData.glsl\x3e\n#include \x3cmaterials/vv.glsl\x3e\n#include \x3cmaterials/barycentric.glsl\x3e\nattribute vec2 a_pos;\nattribute highp vec3 a_id;\nuniform highp mat3 displayViewScreenMat3;\nuniform highp mat3 displayViewMat3;\nuniform highp mat3 displayMat3;\nuniform highp mat3 tileMat3;\nuniform highp mat3 viewMat3;\nuniform highp float pixelRatio;\nuniform mediump float zoomFactor;\nuniform mediump float antialiasing;\nuniform mediump float currentScale;\nuniform mediump float currentZoom;\nuniform mediump float metersPerSRUnit;\nvec4 VV_ADATA \x3d vec4(0.0);\nvoid loadVisualVariableData(inout vec4 target) {\ntarget.rgba \x3d getVisualVariableData(a_id);\n}\n#ifdef VV\n#define INIT loadVisualVariableData(VV_ADATA)\n#else\n#define INIT\n#endif\nvec4 getColor(in vec4 a_color, in float a_bitSet, int index) {\n#ifdef VV_COLOR\nfloat isColorLocked   \x3d getBit(a_bitSet, index);\nreturn getVVColor(VV_ADATA[ATTR_VV_COLOR], a_color, isColorLocked);\n#else\nreturn a_color;\n#endif\n}\nfloat getOpacity() {\n#ifdef VV_OPACITY\nreturn getVVOpacity(VV_ADATA[ATTR_VV_OPACITY]);\n#else\nreturn 1.0;\n#endif\n}\nfloat getSize(in float in_size, in float currentScale) {\n#ifdef VV_SIZE\nreturn getVVSize(in_size, VV_ADATA[ATTR_VV_SIZE], currentScale);\n#else\nreturn in_size;\n#endif\n}\nmat3 getRotation() {\n#ifdef VV_ROTATION\nreturn getVVRotationMat3(mod(VV_ADATA[ATTR_VV_ROTATION], 360.0));\n#else\nreturn mat3(1.0);\n#endif\n}\nfloat getFilterFlags() {\n#ifdef IGNORES_SAMPLER_PRECISION\nreturn ceil(getFilterData(a_id).x * 255.0);\n#else\nreturn getFilterData(a_id).x * 255.0;\n#endif\n}\nvec4 getAnimationState() {\nreturn getAnimation(a_id);\n}\nfloat getMinZoom() {\nvec4 data0 \x3d getFilterData(a_id) * 255.0;\nreturn data0.g;\n}\nmat3 getMatrixNoDisplay(float isMapAligned) {\nreturn isMapAligned * viewMat3 * tileMat3 + (1.0 - isMapAligned) * tileMat3;\n}\nmat3 getMatrix(float isMapAligned) {\nreturn isMapAligned * displayViewMat3 + (1.0 - isMapAligned) * displayMat3;\n}\nfloat checkHighlightBit(float filterFlags, int index) {\nreturn getHighlightBit(filterFlags, index);\n}\nfloat checkHighlight(float filterFlags) {\nfloat result \x3d checkHighlightBit(filterFlags, 0);\nfor (int i \x3d 1; i \x3c maxHighlightReasons; i++) {\nresult \x3d result + checkHighlightBit(filterFlags, i);\n}\nreturn step(0.1, result);\n}\nvec3 clip(inout vec4 color, inout vec3 pos, in float filterFlags, in vec2 minMaxZoom) {\npos.z +\x3d 2.0 * (1.0 - getFilterBit(filterFlags, 0));\n#ifdef inside\npos.z +\x3d 2.0 * (1.0 - getFilterBit(filterFlags, 1));\n#elif defined(outside)\npos.z +\x3d 2.0 * getFilterBit(filterFlags, 1);\n#elif defined(highlight)\n#if !defined(highlight_all)\npos.z +\x3d 2.0 * (1.0 - checkHighlight(filterFlags));\n#endif\n#endif\npos.z +\x3d 2.0 * (step(minMaxZoom.y, currentZoom) + (1.0 - step(minMaxZoom.x, currentZoom)));\nreturn pos;\n}",
"vv.glsl":"#if defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\n#define VV_SIZE\n#endif\n#if defined(VV_COLOR) || defined(VV_SIZE) || defined(VV_OPACITY) || defined(VV_ROTATION)\n#define VV\n#endif\n#ifdef VV_COLOR\nuniform highp float colorValues[8];\nuniform vec4 colors[8];\n#endif\n#ifdef VV_SIZE_MIN_MAX_VALUE\nuniform highp vec4 minMaxValueAndSize;\n#endif\n#ifdef VV_SIZE_SCALE_STOPS\nuniform highp float values[8];\nuniform float sizes[8];\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nuniform highp float values[8];\nuniform float sizes[8];\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nuniform highp float unitMeterRatio;\n#endif\n#ifdef VV_OPACITY\nuniform highp float opacityValues[8];\nuniform float opacities[8];\n#endif\n#ifdef VV_ROTATION\nuniform lowp float rotationType;\n#endif\nbool isNan(float val) {\nreturn (val \x3d\x3d NAN_MAGIC_NUMBER);\n}\n#ifdef VV_SIZE_MIN_MAX_VALUE\nfloat getVVMinMaxSize(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nfloat interpolationRatio \x3d (sizeValue  - minMaxValueAndSize.x) / (minMaxValueAndSize.y - minMaxValueAndSize.x);\ninterpolationRatio \x3d clamp(interpolationRatio, 0.0, 1.0);\nreturn minMaxValueAndSize.z + interpolationRatio * (minMaxValueAndSize.w - minMaxValueAndSize.z);\n}\n#endif\n#ifdef VV_SIZE_SCALE_STOPS\nfloat getVVScaleStopsSize(float currentScale) {\nfloat outSize;\nif (currentScale \x3c\x3d values[0]) {\noutSize \x3d sizes[0];\n} else {\nif (currentScale \x3e\x3d values[7]) {\noutSize \x3d sizes[7];\n} else {\nint index;\nindex \x3d -1;\nfor (int i \x3d 0; i \x3c 8; i++) {\nif (values[i] \x3e currentScale) {\nindex \x3d i;\nbreak;\n}\n}\nint prevIndex \x3d index - 1;\nfloat a \x3d currentScale - values[prevIndex];\nfloat b \x3d values[index] - values[prevIndex];\noutSize \x3d mix(sizes[prevIndex], sizes[index], a / b);\n}\n}\nreturn outSize;\n}\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nconst int VV_SIZE_N \x3d 8;\nfloat getVVStopsSize(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nif (sizeValue \x3c\x3d values[0]) {\nreturn sizes[0];\n}\nif (sizeValue \x3e\x3d values[VV_SIZE_N - 1]) {\nreturn sizes[VV_SIZE_N - 1];\n}\nfor (int i \x3d 1; i \x3c VV_SIZE_N; ++i) {\nif (values[i] \x3e\x3d sizeValue) {\nfloat f \x3d (sizeValue - values[i-1]) / (values[i] - values[i-1]);\nreturn mix(sizes[i-1], sizes[i], f);\n}\n}\nreturn sizes[VV_SIZE_N - 1];\n}\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nfloat getVVUnitValue(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nreturn sizeValue * (metersPerSRUnit / unitMeterRatio);\n}\n#endif\n#ifdef VV_OPACITY\nconst int VV_OPACITY_N \x3d 8;\nfloat getVVOpacity(float opacityValue) {\nif (isNan(opacityValue)) {\nreturn 1.0;\n}\nif (opacityValue \x3c\x3d opacityValues[0]) {\nreturn opacities[0];\n}\nfor (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\nif (opacityValues[i] \x3e\x3d opacityValue) {\nfloat f \x3d (opacityValue - opacityValues[i-1]) / (opacityValues[i] - opacityValues[i-1]);\nreturn mix(opacities[i-1], opacities[i], f);\n}\n}\nreturn opacities[VV_OPACITY_N - 1];\n}\n#endif\n#ifdef VV_ROTATION\nmat4 getVVRotation(float rotationValue) {\nif (isNan(rotationValue)) {\nreturn mat4(1, 0, 0, 0,\n0, 1, 0, 0,\n0, 0, 1, 0,\n0, 0, 0, 1);\n}\nfloat rotation \x3d rotationValue;\nif (rotationType \x3d\x3d 1.0) {\nrotation \x3d 90.0 - rotation;\n}\nfloat angle \x3d C_DEG_TO_RAD * rotation;\nfloat sinA \x3d sin(angle);\nfloat cosA \x3d cos(angle);\nreturn mat4(cosA, sinA, 0, 0,\n-sinA,  cosA, 0, 0,\n0,     0, 1, 0,\n0,     0, 0, 1);\n}\nmat3 getVVRotationMat3(float rotationValue) {\nif (isNan(rotationValue)) {\nreturn mat3(1, 0, 0,\n0, 1, 0,\n0, 0, 1);\n}\nfloat rotation \x3d rotationValue;\nif (rotationType \x3d\x3d 1.0) {\nrotation \x3d 90.0 - rotation;\n}\nfloat angle \x3d C_DEG_TO_RAD * -rotation;\nfloat sinA \x3d sin(angle);\nfloat cosA \x3d cos(angle);\nreturn mat3(cosA, -sinA, 0,\nsinA, cosA, 0,\n0,    0,    1);\n}\n#endif\n#ifdef VV_COLOR\nconst int VV_COLOR_N \x3d 8;\nvec4 getVVColor(float colorValue, vec4 fallback, float isColorLocked) {\nif (isNan(colorValue) || isColorLocked \x3d\x3d 1.0) {\nreturn fallback;\n}\nif (colorValue \x3c\x3d colorValues[0]) {\nreturn colors[0];\n}\nfor (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\nif (colorValues[i] \x3e\x3d colorValue) {\nfloat f \x3d (colorValue - colorValues[i-1]) / (colorValues[i] - colorValues[i-1]);\nreturn mix(colors[i-1], colors[i], f);\n}\n}\nreturn colors[VV_COLOR_N - 1];\n}\n#endif\nfloat getVVSize(in float size, in float vvSize, in float currentScale)  {\n#ifdef VV_SIZE_MIN_MAX_VALUE\nreturn getVVMinMaxSize(vvSize, size);\n#elif defined(VV_SIZE_SCALE_STOPS)\nfloat outSize \x3d getVVScaleStopsSize(currentScale);\nreturn isNan(outSize) ? size : outSize;\n#elif defined(VV_SIZE_FIELD_STOPS)\nfloat outSize \x3d getVVStopsSize(vvSize, size);\nreturn isNan(outSize) ? size : outSize;\n#elif defined(VV_SIZE_UNIT_VALUE)\nreturn getVVUnitValue(vvSize, size);\n#else\nreturn size;\n#endif\n}"},
"post-processing":{blit:{"blit.frag":"precision mediump float;\nuniform sampler2D u_texture;\nvarying vec2 v_uv;\nvoid main() {\ngl_FragColor \x3d texture2D(u_texture, v_uv);\n}"},bloom:{composite:{"composite.frag":"precision mediump float;\nvarying vec2 v_uv;\nuniform sampler2D u_blurTexture1;\nuniform sampler2D u_blurTexture2;\nuniform sampler2D u_blurTexture3;\nuniform sampler2D u_blurTexture4;\nuniform sampler2D u_blurTexture5;\nuniform float u_bloomStrength;\nuniform float u_bloomRadius;\nuniform float u_bloomFactors[NUMMIPS];\nuniform vec3 u_bloomTintColors[NUMMIPS];\nfloat lerpBloomFactor(const in float factor) {\nfloat mirrorFactor \x3d 1.2 - factor;\nreturn mix(factor, mirrorFactor, u_bloomRadius);\n}\nvoid main() {\nvec4 color \x3d u_bloomStrength * (\nlerpBloomFactor(u_bloomFactors[0]) * vec4(u_bloomTintColors[0], 1.0) * texture2D(u_blurTexture1, v_uv) +\nlerpBloomFactor(u_bloomFactors[1]) * vec4(u_bloomTintColors[1], 1.0) * texture2D(u_blurTexture2, v_uv) +\nlerpBloomFactor(u_bloomFactors[2]) * vec4(u_bloomTintColors[2], 1.0) * texture2D(u_blurTexture3, v_uv) +\nlerpBloomFactor(u_bloomFactors[3]) * vec4(u_bloomTintColors[3], 1.0) * texture2D(u_blurTexture4, v_uv) +\nlerpBloomFactor(u_bloomFactors[4]) * vec4(u_bloomTintColors[4], 1.0) * texture2D(u_blurTexture5, v_uv)\n);\ngl_FragColor \x3d clamp(color, 0.0, 1.0);\n}"},
gaussianBlur:{"gaussianBlur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nuniform vec2 u_direction;\nvarying vec2 v_uv;\n#define KERNEL_RADIUS RADIUS\n#define SIGMA RADIUS\nfloat gaussianPdf(in float x, in float sigma) {\nreturn 0.39894 * exp(-0.5 * x * x / ( sigma * sigma)) / sigma;\n}\nvoid main() {\nvec2 invSize \x3d 1.0 / u_texSize;\nfloat fSigma \x3d float(SIGMA);\nfloat weightSum \x3d gaussianPdf(0.0, fSigma);\nvec4 pixelColorSum \x3d texture2D(u_colorTexture, v_uv) * weightSum;\nfor (int i \x3d 1; i \x3c KERNEL_RADIUS; i ++) {\nfloat x \x3d float(i);\nfloat w \x3d gaussianPdf(x, fSigma);\nvec2 uvOffset \x3d u_direction * invSize * x;\nvec4 sample1 \x3d texture2D(u_colorTexture, v_uv + uvOffset);\nvec4 sample2 \x3d texture2D(u_colorTexture, v_uv - uvOffset);\npixelColorSum +\x3d (sample1 + sample2) * w;\nweightSum +\x3d 2.0 * w;\n}\ngl_FragColor \x3d pixelColorSum /weightSum;\n}"},
luminosityHighPass:{"luminosityHighPass.frag":"precision mediump float;\nuniform sampler2D u_texture;\nuniform vec3 u_defaultColor;\nuniform float u_defaultOpacity;\nuniform float u_luminosityThreshold;\nuniform float u_smoothWidth;\nvarying vec2 v_uv;\nvoid main() {\nvec4 texel \x3d texture2D(u_texture, v_uv);\nvec3 luma \x3d vec3(0.299, 0.587, 0.114);\nfloat v \x3d dot(texel.xyz, luma);\nvec4 outputColor \x3d vec4(u_defaultColor.rgb, u_defaultOpacity);\nfloat alpha \x3d smoothstep(u_luminosityThreshold, u_luminosityThreshold + u_smoothWidth, v);\ngl_FragColor \x3d mix(outputColor, texel, alpha);\n}"}},
blur:{gaussianBlur:{"gaussianBlur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nuniform vec2 u_direction;\nuniform float u_sigma;\nvarying vec2 v_uv;\n#define KERNEL_RADIUS RADIUS\nfloat gaussianPdf(in float x, in float sigma) {\nreturn 0.39894 * exp(-0.5 * x * x / ( sigma * sigma)) / sigma;\n}\nvoid main() {\nvec2 invSize \x3d 1.0 / u_texSize;\nfloat fSigma \x3d u_sigma;\nfloat weightSum \x3d gaussianPdf(0.0, fSigma);\nvec4 pixelColorSum \x3d texture2D(u_colorTexture, v_uv) * weightSum;\nfor (int i \x3d 1; i \x3c KERNEL_RADIUS; i ++) {\nfloat x \x3d float(i);\nfloat w \x3d gaussianPdf(x, fSigma);\nvec2 uvOffset \x3d u_direction * invSize * x;\nvec4 sample1 \x3d texture2D(u_colorTexture, v_uv + uvOffset);\nvec4 sample2 \x3d texture2D(u_colorTexture, v_uv - uvOffset);\npixelColorSum +\x3d (sample1 + sample2) * w;\nweightSum +\x3d 2.0 * w;\n}\ngl_FragColor \x3d pixelColorSum /weightSum;\n}"},
"radial-blur":{"radial-blur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nconst float sampleDist \x3d 1.0;\nconst float sampleStrength \x3d 2.2;\nvoid main(void) {\nfloat samples[10];\nsamples[0] \x3d -0.08;\nsamples[1] \x3d -0.05;\nsamples[2] \x3d -0.03;\nsamples[3] \x3d -0.02;\nsamples[4] \x3d -0.01;\nsamples[5] \x3d  0.01;\nsamples[6] \x3d  0.02;\nsamples[7] \x3d  0.03;\nsamples[8] \x3d  0.05;\nsamples[9] \x3d  0.08;\nvec2 dir \x3d 0.5 - v_uv;\nfloat dist \x3d sqrt(dir.x * dir.x + dir.y * dir.y);\ndir \x3d dir / dist;\nvec4 color \x3d texture2D(u_colorTexture,v_uv);\nvec4 sum \x3d color;\nfor (int i \x3d 0; i \x3c 10; i++) {\nsum +\x3d texture2D(u_colorTexture, v_uv + dir * samples[i] * sampleDist);\n}\nsum *\x3d 1.0 / 11.0;\nfloat t \x3d dist * sampleStrength;\nt \x3d clamp(t, 0.0, 1.0);\ngl_FragColor \x3d mix(color, sum, t);\n}"}},
dra:{"dra.frag":"precision mediump float;\nuniform sampler2D u_minColor;\nuniform sampler2D u_maxColor;\nuniform sampler2D u_texture;\nvarying vec2 v_uv;\nvoid main() {\nvec4 minColor \x3d texture2D(u_minColor, vec2(0.5));\nvec4 maxColor \x3d texture2D(u_maxColor, vec2(0.5));\nvec4 color \x3d texture2D(u_texture, v_uv);\nvec3 minColorUnpremultiply \x3d minColor.rgb / minColor.a;\nvec3 maxColorUnpremultiply \x3d maxColor.rgb / maxColor.a;\nvec3 colorUnpremultiply \x3d color.rgb / color.a;\nvec3 range \x3d maxColorUnpremultiply - minColorUnpremultiply;\ngl_FragColor \x3d vec4(color.a * (colorUnpremultiply - minColorUnpremultiply) / range, color.a);\n}",
"min-max":{"min-max.frag":"#extension GL_EXT_draw_buffers : require\nprecision mediump float;\n#define CELL_SIZE 2\nuniform sampler2D u_minTexture;\nuniform sampler2D u_maxTexture;\nuniform vec2 u_srcResolution;\nuniform vec2 u_dstResolution;\nvarying vec2 v_uv;\nvoid main() {\nvec2 srcPixel \x3d floor(gl_FragCoord.xy) * float(CELL_SIZE);\nvec2 onePixel \x3d vec2(1.0) / u_srcResolution;\nvec2 uv \x3d (srcPixel + 0.5) / u_srcResolution;\nvec4 minColor \x3d vec4(1.0);\nvec4 maxColor \x3d vec4(0.0);\nfor (int y \x3d 0; y \x3c CELL_SIZE; ++y) {\nfor (int x \x3d 0; x \x3c CELL_SIZE; ++x) {\nvec2 offset \x3d uv + vec2(x, y) * onePixel;\nminColor \x3d min(minColor, texture2D(u_minTexture, offset));\nmaxColor \x3d max(maxColor, texture2D(u_maxTexture, offset));\n}\n}\ngl_FragData[0] \x3d minColor;\ngl_FragData[1] \x3d maxColor;\n}"}},
"drop-shadow":{composite:{"composite.frag":"precision mediump float;\nuniform sampler2D u_layerFBOTexture;\nuniform sampler2D u_blurTexture;\nuniform vec4 u_shadowColor;\nuniform vec2 u_shadowOffset;\nuniform highp mat3 u_displayViewMat3;\nvarying vec2 v_uv;\nvoid main() {\nvec3 offset \x3d u_displayViewMat3 * vec3(u_shadowOffset, 0.0);\nvec4 layerColor \x3d texture2D(u_layerFBOTexture, v_uv);\nvec4 blurColor \x3d texture2D(u_blurTexture, v_uv - offset.xy / 2.0);\ngl_FragColor \x3d ((1.0 - layerColor.a) * blurColor.a * u_shadowColor + layerColor);\n}"}},
"edge-detect":{"frei-chen":{"frei-chen.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nvarying vec2 v_uv;\nvec2 texel \x3d vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[9];\nconst mat3 g0 \x3d mat3( 0.3535533845424652, 0, -0.3535533845424652, 0.5, 0, -0.5, 0.3535533845424652, 0, -0.3535533845424652 );\nconst mat3 g1 \x3d mat3( 0.3535533845424652, 0.5, 0.3535533845424652, 0, 0, 0, -0.3535533845424652, -0.5, -0.3535533845424652 );\nconst mat3 g2 \x3d mat3( 0, 0.3535533845424652, -0.5, -0.3535533845424652, 0, 0.3535533845424652, 0.5, -0.3535533845424652, 0 );\nconst mat3 g3 \x3d mat3( 0.5, -0.3535533845424652, 0, -0.3535533845424652, 0, 0.3535533845424652, 0, 0.3535533845424652, -0.5 );\nconst mat3 g4 \x3d mat3( 0, -0.5, 0, 0.5, 0, 0.5, 0, -0.5, 0 );\nconst mat3 g5 \x3d mat3( -0.5, 0, 0.5, 0, 0, 0, 0.5, 0, -0.5 );\nconst mat3 g6 \x3d mat3( 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.6666666865348816, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204 );\nconst mat3 g7 \x3d mat3( -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, 0.6666666865348816, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408 );\nconst mat3 g8 \x3d mat3( 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408 );\nvoid main() {\nG[0] \x3d g0,\nG[1] \x3d g1,\nG[2] \x3d g2,\nG[3] \x3d g3,\nG[4] \x3d g4,\nG[5] \x3d g5,\nG[6] \x3d g6,\nG[7] \x3d g7,\nG[8] \x3d g8;\nmat3 I;\nfloat cnv[9];\nvec3 sample;\nfor (float i \x3d 0.0; i \x3c 3.0; i++) {\nfor (float j \x3d 0.0; j \x3c 3.0; j++) {\nsample \x3d texture2D(u_colorTexture, v_uv + texel * vec2(i - 1.0,j - 1.0)).rgb;\nI[int(i)][int(j)] \x3d length(sample);\n}\n}\nfor (int i \x3d 0; i \x3c 9; i++) {\nfloat dp3 \x3d dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] \x3d dp3 * dp3;\n}\nfloat M \x3d (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]);\nfloat S \x3d (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + (cnv[8] + M);\ngl_FragColor \x3d vec4(vec3(sqrt(M / S)), texture2D(u_colorTexture, v_uv).a);\n}"},
sobel:{"sobel.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nuniform vec2 u_texSize;\nvec2 texel \x3d vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[2];\nconst mat3 g0 \x3d mat3( 1.0, 2.0, 1.0, 0.0, 0.0, 0.0, -1.0, -2.0, -1.0 );\nconst mat3 g1 \x3d mat3( 1.0, 0.0, -1.0, 2.0, 0.0, -2.0, 1.0, 0.0, -1.0 );\nvoid main() {\nmat3 I;\nfloat cnv[2];\nvec3 sample;\nG[0] \x3d g0;\nG[1] \x3d g1;\nfor (float i \x3d 0.0; i \x3c 3.0; i++) {\nfor (float j \x3d 0.0; j \x3c 3.0; j++) {\nsample \x3d texture2D( u_colorTexture, v_uv + texel * vec2(i-1.0,j-1.0) ).rgb;\nI[int(i)][int(j)] \x3d length(sample);\n}\n}\nfor (int i \x3d 0; i \x3c 2; i++) {\nfloat dp3 \x3d dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] \x3d dp3 * dp3;\n}\ngl_FragColor \x3d vec4(vec3(0.5 * sqrt(cnv[0] * cnv[0] + cnv[1] * cnv[1])), texture2D(u_colorTexture, v_uv).a);\n}"}},
"edge-enhance":{"edge-enhance.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nuniform vec2 u_texSize;\nvec2 texel \x3d vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[2];\nconst mat3 g0 \x3d mat3( 1.0, 0.0, -1.0, 1.0, 0.0, -1.0, 1.0, 0.0, -1.0 );\nconst mat3 g1 \x3d mat3( 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, -1.0, -1.0, -1.0 );\nvoid main() {\nmat3 I;\nfloat cnv[2];\nvec3 sample;\nG[0] \x3d g0;\nG[1] \x3d g1;\nfor (float i \x3d 0.0; i \x3c 3.0; i++) {\nfor (float j \x3d 0.0; j \x3c 3.0; j++) {\nsample \x3d texture2D( u_colorTexture, v_uv + texel * vec2(i-1.0,j-1.0) ).rgb;\nI[int(i)][int(j)] \x3d length(sample);\n}\n}\nfor (int i \x3d 0; i \x3c 2; i++) {\nfloat dp3 \x3d dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] \x3d dp3 * dp3;\n}\nvec4 color \x3d texture2D(u_colorTexture, v_uv);\ngl_FragColor \x3d vec4(0.5 * sqrt(cnv[0] * cnv[0] + cnv[1] * cnv[1]) * color);\n}"},
filterEffect:{"filterEffect.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform mat4 u_coefficients;\nvarying vec2 v_uv;\nvoid main() {\nvec4 color \x3d texture2D(u_colorTexture, v_uv);\nvec4 rgbw \x3d u_coefficients * vec4(color.a \x3e 0.0 ? color.rgb / color.a : vec3(0.0), 1.0);\nfloat a \x3d color.a;\ngl_FragColor \x3d vec4(a * rgbw.rgb, a);\n}"},pp:{"pp.vert":"precision mediump float;\nattribute vec2 a_position;\nvarying vec2 v_uv;\nvoid main() {\ngl_Position \x3d vec4(a_position, 0.0, 1.0);\nv_uv \x3d (a_position + 1.0) / 2.0;\n}"}},
raster:{common:{"common.glsl":"uniform sampler2D u_image;\nuniform int u_bandCount;\nuniform bool u_flipY;\nuniform float u_opacity;\nuniform int u_resampling;\nuniform vec2 u_srcImageSize;\n#ifdef APPLY_PROJECTION\n#include \x3craster/common/projection.glsl\x3e\n#endif\n#ifdef BICUBIC\n#include \x3cfiltering/bicubic.glsl\x3e\n#endif\n#ifdef BILINEAR\n#include \x3cfiltering/bilinear.glsl\x3e\n#endif\nvec2 getPixelLocation(vec2 coords) {\nvec2 targetLocation \x3d u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;\n#ifdef APPLY_PROJECTION\ntargetLocation \x3d projectPixelLocation(targetLocation);\n#endif\nreturn targetLocation;\n}\nbool isOutside(vec2 coords){\nif (coords.t\x3e1.00001 ||coords.t\x3c-0.00001 || coords.s\x3e1.00001 ||coords.s\x3c-0.00001) {\nreturn true;\n} else {\nreturn false;\n}\n}\nvec4 getPixel(vec2 pixelLocation) {\n#ifdef BICUBIC\nvec4 color \x3d sampleBicubicBSpline(u_image, pixelLocation, u_srcImageSize);\n#elif defined(BILINEAR)\nvec4 color \x3d sampleBilinear(u_image, pixelLocation, u_srcImageSize);\n#else\nvec4 color \x3d texture2D(u_image, pixelLocation);\n#endif\nreturn color;\n}",
"common.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform highp float u_scale;\nuniform highp vec2 u_offset;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord \x3d a_pos * u_scale + u_offset;\ngl_Position \x3d vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}","contrastBrightness.glsl":"uniform float u_contrastOffset;\nuniform float u_brightnessOffset;\nvec4 adjustContrastBrightness(vec4 currentPixel, bool isFloat) {\nvec4 pixelValue \x3d isFloat ? currentPixel * 255.0 : currentPixel;\nfloat maxI \x3d 255.0;\nfloat mid \x3d 128.0;\nfloat c \x3d u_contrastOffset;\nfloat b \x3d u_brightnessOffset;\nvec4 v;\nif (c \x3e 0.0 \x26\x26 c \x3c 100.0) {\nv \x3d (200.0 * pixelValue - 100.0 * maxI + 2.0 * maxI * b) / (2.0 * (100.0 - c)) + mid;\n} else if (c \x3c\x3d 0.0 \x26\x26 c \x3e -100.0) {\nv \x3d (200.0 * pixelValue - 100.0 * maxI + 2.0 * maxI * b) * (100.0 + c) / 20000.0 + mid;\n} else if (c \x3d\x3d 100.0) {\nv \x3d (200.0 * pixelValue - 100.0 * maxI + (maxI + 1.0) * (100.0 - c) + 2.0 * maxI * b);\nv \x3d (sign(v) + 1.0) / 2.0;\n} else if (c \x3d\x3d -100.0) {\nv \x3d vec4(mid, mid, mid, currentPixel.a);\n}\nvec3 rgb \x3d clamp(v.rgb / 255.0, 0.0, 1.0);\nreturn vec4(rgb, currentPixel.a);\n}",
"getSurfaceValues.glsl":"#include \x3craster/common/mirror.glsl\x3e\nvoid getSurfaceValues(sampler2D imageTexture, vec2 texCoord, vec2 srcImageSize, inout float values[10]) {\nvec2 onePixel \x3d 1.0 / srcImageSize;\nvec4 va \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(-1.0, -1.0)));\nvec4 vb \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(0.0, -1.0)));\nvec4 vc \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(1.0, -1.0)));\nvec4 vd \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(-1.0, 0.0)));\nvec4 ve \x3d texture2D(imageTexture, mirror(texCoord));\nvec4 vf \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(1.0, 0.0)));\nvec4 vg \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(-1.0, 1.0)));\nvec4 vh \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(0.0, 1.0)));\nvec4 vi \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(1.0, 1.0)));\nfloat alpha \x3d va.a * vb.a * vc.a * vd.a * ve.a * vf.a * vg.a * vh.a * vi.a;\nvalues[0] \x3d va.r;\nvalues[1] \x3d vb.r;\nvalues[2] \x3d vc.r;\nvalues[3] \x3d vd.r;\nvalues[4] \x3d ve.r;\nvalues[5] \x3d vf.r;\nvalues[6] \x3d vg.r;\nvalues[7] \x3d vh.r;\nvalues[8] \x3d vi.r;\nvalues[9] \x3d alpha;\n}",
"inverse.glsl":"float invertValue(float value) {\nfloat s \x3d sign(value);\nreturn (s * s) / (value + abs(s) - 1.0);\n}","mirror.glsl":"vec2 mirror(vec2 pos) {\nvec2 pos1 \x3d abs(pos);\nreturn step(pos1, vec2(1.0, 1.0)) * pos1 + step(1.0, pos1) * (2.0 - pos1);\n}","projection.glsl":"uniform sampler2D u_transformGrid;\nuniform vec2 u_transformSpacing;\nuniform vec2 u_transformGridSize;\nuniform vec2 u_targetImageSize;\nvec2 projectPixelLocation(vec2 coords) {\n#ifdef LOOKUP_PROJECTION\nvec4 pv \x3d texture2D(u_transformGrid, coords);\nreturn vec2(pv.r, pv.g);\n#endif\nvec2 index_image \x3d floor(coords * u_targetImageSize);\nvec2 oneTransformPixel \x3d vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);\nvec2 index_transform \x3d floor(index_image / u_transformSpacing) / u_transformGridSize;\nvec2 pos \x3d fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);\nvec2 srcLocation;\nvec2 transform_location \x3d index_transform + oneTransformPixel * 0.5;\nif (pos.s \x3c\x3d pos.t) {\nvec4 ll_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));\nvec4 ll_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));\nsrcLocation.s \x3d dot(ll_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t \x3d dot(ll_def.rgb, vec3(pos, 1.0));\n} else {\nvec4 ur_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));\nvec4 ur_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));\nsrcLocation.s \x3d dot(ur_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t \x3d dot(ur_def.rgb, vec3(pos, 1.0));\n}\nreturn srcLocation;\n}"},
flow:{"getFadeOpacity.glsl":"uniform float u_decayRate;\nuniform float u_fadeToZero;\nfloat getFadeOpacity(float x) {\nfloat cutOff \x3d mix(0.0, exp(-u_decayRate), u_fadeToZero);\nreturn (exp(-u_decayRate * x) - cutOff) / (1.0 - cutOff);\n}","getFragmentColor.glsl":"vec4 getFragmentColor(vec4 color, float dist, float size, float featheringSize) {\nfloat featheringStart \x3d clamp(0.5 - featheringSize / size, 0.0, 0.5);\nif (dist \x3e featheringStart) {\ncolor *\x3d 1.0 - (dist - featheringStart) / (0.5 - featheringStart);\n}\nreturn color;\n}",
imagery:{"imagery.frag":"precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform float u_Min;\nuniform float u_Max;\nuniform float u_featheringSize;\n#include \x3craster/flow/vv.glsl\x3e\nfloat getIntensity(float v) {\nreturn u_Min + v * (u_Max - u_Min);\n}\nvoid main(void) {\nvec4 sampled \x3d texture2D(u_texture, v_texcoord);\nfloat intensity \x3d getIntensity(sampled.r);\ngl_FragColor \x3d getColor(intensity);\ngl_FragColor.a *\x3d getOpacity(sampled.r);\ngl_FragColor.a *\x3d sampled.a;\ngl_FragColor.rgb *\x3d gl_FragColor.a;\n}",
"imagery.vert":"attribute vec2 a_position;\nattribute vec2 a_texcoord;\nuniform mat3 u_dvsMat3;\nvarying vec2 v_texcoord;\nvoid main(void) {\nvec2 xy \x3d (u_dvsMat3 * vec3(a_position, 1.0)).xy;\ngl_Position \x3d vec4(xy, 0.0, 1.0);\nv_texcoord \x3d a_texcoord;\n}"},particles:{"particles.frag":"precision highp float;\nvarying vec4 v_color;\nvarying vec2 v_texcoord;\nvarying float v_size;\nuniform float u_featheringSize;\n#include \x3craster/flow/getFragmentColor.glsl\x3e\nvoid main(void) {\ngl_FragColor \x3d getFragmentColor(v_color, length(v_texcoord - 0.5), v_size, u_featheringSize);\n}",
"particles.vert":"attribute vec4 a_xyts0;\nattribute vec4 a_xyts1;\nattribute vec4 a_typeIdDurationSeed;\nattribute vec4 a_extrudeInfo;\nuniform mat3 u_dvsMat3;\nuniform mat3 u_displayViewMat3;\nuniform float u_time;\nuniform float u_trailLength;\nuniform float u_flowSpeed;\nvarying vec4 v_color;\nvarying vec2 v_texcoord;\nvarying float v_size;\nuniform float u_featheringSize;\nuniform float u_introFade;\n#include \x3craster/flow/vv.glsl\x3e\n#include \x3craster/flow/getFadeOpacity.glsl\x3e\nvoid main(void) {\nvec2 position0 \x3d a_xyts0.xy;\nfloat t0 \x3d a_xyts0.z;\nfloat speed0 \x3d a_xyts0.w;\nvec2 position1 \x3d a_xyts1.xy;\nfloat t1 \x3d a_xyts1.z;\nfloat speed1 \x3d a_xyts1.w;\nfloat type \x3d a_typeIdDurationSeed.x;\nfloat id \x3d a_typeIdDurationSeed.y;\nfloat duration \x3d a_typeIdDurationSeed.z;\nfloat seed \x3d a_typeIdDurationSeed.w;\nvec2 e0 \x3d a_extrudeInfo.xy;\nvec2 e1 \x3d a_extrudeInfo.zw;\nfloat animationPeriod \x3d duration + u_trailLength;\nfloat scaledTime \x3d u_time * u_flowSpeed;\nfloat randomizedTime \x3d scaledTime + seed * animationPeriod;\nfloat t \x3d mod(randomizedTime, animationPeriod);\nfloat fUnclamped \x3d (t - t0) / (t1 - t0);\nfloat f \x3d clamp(fUnclamped, 0.0, 1.0);\nfloat clampedTime \x3d mix(t0, t1, f);\nfloat speed \x3d mix(speed0, speed1, f);\nvec2 extrude;\nvec2 position;\nfloat fadeOpacity;\nfloat introOpacity;\nif (type \x3d\x3d 2.0) {\nif (fUnclamped \x3c 0.0 || (fUnclamped \x3e 1.0 \x26\x26 t1 !\x3d duration)) {\ngl_Position \x3d vec4(0.0, 0.0, -2.0, 1.0);\nreturn;\n}\nvec2 ortho \x3d mix(e0, e1, f);\nvec2 parallel;\nparallel \x3d normalize(position1 - position0) * 0.5;\nif (id \x3d\x3d 1.0) {\nextrude \x3d ortho;\nv_texcoord \x3d vec2(0.5, 0.0);\n} else if (id \x3d\x3d 2.0) {\nextrude \x3d -ortho;\nv_texcoord \x3d vec2(0.5, 1.0);\n} else if (id \x3d\x3d 3.0) {\nextrude \x3d ortho + parallel;\nv_texcoord \x3d vec2(1.0, 0.0);\n} else if (id \x3d\x3d 4.0) {\nextrude \x3d -ortho + parallel;\nv_texcoord \x3d vec2(1.0, 1.0);\n}\nfadeOpacity \x3d getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity \x3d 1.0 - exp(-clampedTime);\nv_size \x3d getSize(speed);\nv_color \x3d getColor(speed);\nv_color.a *\x3d getOpacity(speed);\nposition \x3d mix(position0, position1, f);\n} else {\nif (fUnclamped \x3c 0.0) {\ngl_Position \x3d vec4(0.0, 0.0, -2.0, 1.0);\nreturn;\n}\nif (id \x3d\x3d 1.0) {\nextrude \x3d e0;\nv_texcoord \x3d vec2(0.5, 0.0);\nfadeOpacity \x3d getFadeOpacity((t - t0) / u_trailLength);\nintroOpacity \x3d 1.0 - exp(-t0);\nv_size \x3d getSize(speed0);\nv_color \x3d getColor(speed0);\nv_color.a *\x3d getOpacity(speed0);\nposition \x3d position0;\n} else if (id \x3d\x3d 2.0) {\nextrude \x3d -e0;\nv_texcoord \x3d vec2(0.5, 1.0);\nfadeOpacity \x3d getFadeOpacity((t - t0) / u_trailLength);\nintroOpacity \x3d 1.0 - exp(-t0);\nv_size \x3d getSize(speed0);\nv_color \x3d getColor(speed0);\nv_color.a *\x3d getOpacity(speed0);\nposition \x3d position0;\n} else if (id \x3d\x3d 3.0) {\nextrude \x3d mix(e0, e1, f);\nv_texcoord \x3d vec2(0.5, 0.0);\nfadeOpacity \x3d getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity \x3d 1.0 - exp(-clampedTime);\nv_size \x3d getSize(speed);\nv_color \x3d getColor(speed);\nv_color.a *\x3d getOpacity(speed);\nposition \x3d mix(position0, position1, f);\n} else if (id \x3d\x3d 4.0) {\nextrude \x3d -mix(e0, e1, f);\nv_texcoord \x3d vec2(0.5, 1.0);\nfadeOpacity \x3d getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity \x3d 1.0 - exp(-clampedTime);\nv_size \x3d getSize(speed);\nv_color \x3d getColor(speed);\nv_color.a *\x3d getOpacity(speed);\nposition \x3d mix(position0, position1, f);\n}\n}\nvec2 xy \x3d (u_dvsMat3 * vec3(position, 1.0) + u_displayViewMat3 * vec3(extrude * v_size, 0.0)).xy;\ngl_Position \x3d vec4(xy, 0.0, 1.0);\nv_color.a *\x3d fadeOpacity;\nv_color.a *\x3d mix(1.0, introOpacity, u_introFade);\nv_color.rgb *\x3d v_color.a;\n}"},
streamlines:{"streamlines.frag":"precision highp float;\nvarying float v_side;\nvarying float v_time;\nvarying float v_totalTime;\nvarying float v_timeSeed;\nvarying vec4 v_color;\nvarying float v_size;\nuniform float u_time;\nuniform float u_trailLength;\nuniform float u_flowSpeed;\nuniform float u_featheringSize;\nuniform float u_introFade;\n#include \x3craster/flow/getFragmentColor.glsl\x3e\n#include \x3craster/flow/getFadeOpacity.glsl\x3e\nvoid main(void) {\nfloat t \x3d mod(v_timeSeed * (v_totalTime + u_trailLength) + u_time * u_flowSpeed, v_totalTime + u_trailLength) - v_time;\nvec4 color \x3d v_color * step(0.0, t) * getFadeOpacity(t / u_trailLength);\ncolor *\x3d mix(1.0, 1.0 - exp(-v_time), u_introFade);\ngl_FragColor \x3d getFragmentColor(color, length((v_side + 1.0) / 2.0 - 0.5), v_size, u_featheringSize);\n}",
"streamlines.vert":"attribute vec3 a_positionAndSide;\nattribute vec3 a_timeInfo;\nattribute vec2 a_extrude;\nattribute float a_speed;\nuniform mat3 u_dvsMat3;\nuniform mat3 u_displayViewMat3;\nvarying float v_time;\nvarying float v_totalTime;\nvarying float v_timeSeed;\nvarying vec4 v_color;\nvarying float v_side;\nvarying float v_size;\nuniform float u_featheringSize;\n#include \x3craster/flow/vv.glsl\x3e\nvoid main(void) {\nvec4 lineColor \x3d getColor(a_speed);\nfloat lineOpacity \x3d getOpacity(a_speed);\nfloat lineSize \x3d getSize(a_speed);\nvec2 position \x3d a_positionAndSide.xy;\nv_side \x3d a_positionAndSide.z;\nvec2 xy \x3d (u_dvsMat3 * vec3(position, 1.0) + u_displayViewMat3 * vec3(a_extrude * lineSize, 0.0)).xy;\ngl_Position \x3d vec4(xy, 0.0, 1.0);\nv_time \x3d a_timeInfo.x;\nv_totalTime \x3d a_timeInfo.y;\nv_timeSeed \x3d a_timeInfo.z;\nv_color \x3d lineColor;\nv_color.a *\x3d lineOpacity;\nv_color.rgb *\x3d v_color.a;\nv_size \x3d lineSize;\n}"},
"vv.glsl":"#define MAX_STOPS 8\n#ifdef VV_COLOR\nuniform float u_color_stops[MAX_STOPS];\nuniform vec4 u_color_values[MAX_STOPS];\nuniform int u_color_count;\n#else\nuniform vec4 u_color;\n#endif\n#ifdef VV_OPACITY\nuniform float u_opacity_stops[MAX_STOPS];\nuniform float u_opacity_values[MAX_STOPS];\nuniform int u_opacity_count;\n#else\nuniform float u_opacity;\n#endif\n#ifdef VV_SIZE\nuniform float u_size_stops[MAX_STOPS];\nuniform float u_size_values[MAX_STOPS];\nuniform int u_size_count;\n#else\nuniform float u_size;\n#endif\nuniform float u_featheringOffset;\nvec4 getColor(float x) {\n#ifdef VV_COLOR\nvec4 color \x3d u_color_values[0];\n{\nfor (int i \x3d 1; i \x3c MAX_STOPS; i++) {\nif (i \x3e\x3d u_color_count) {\nbreak;\n}\nfloat x1 \x3d u_color_stops[i - 1];\nif (x \x3c x1) {\nbreak;\n}\nfloat x2 \x3d u_color_stops[i];\nvec4 y2 \x3d u_color_values[i];\nif (x \x3c x2) {\nvec4 y1 \x3d u_color_values[i - 1];\ncolor \x3d y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\ncolor \x3d y2;\n}\n}\n}\n#else\nvec4 color \x3d u_color;\n#endif\nreturn color;\n}\nfloat getOpacity(float x) {\n#ifdef VV_OPACITY\nfloat opacity \x3d u_opacity_values[0];\n{\nfor (int i \x3d 1; i \x3c MAX_STOPS; i++) {\nif (i \x3e\x3d u_opacity_count) {\nbreak;\n}\nfloat x1 \x3d u_opacity_stops[i - 1];\nif (x \x3c x1) {\nbreak;\n}\nfloat x2 \x3d u_opacity_stops[i];\nfloat y2 \x3d u_opacity_values[i];\nif (x \x3c x2) {\nfloat y1 \x3d u_opacity_values[i - 1];\nopacity \x3d y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\nopacity \x3d y2;\n}\n}\n}\n#else\nfloat opacity \x3d u_opacity;\n#endif\nreturn opacity;\n}\nfloat getSize(float x) {\n#ifdef VV_SIZE\nfloat size \x3d u_size_values[0];\n{\nfor (int i \x3d 1; i \x3c MAX_STOPS; i++) {\nif (i \x3e\x3d u_size_count) {\nbreak;\n}\nfloat x1 \x3d u_size_stops[i - 1];\nif (x \x3c x1) {\nbreak;\n}\nfloat x2 \x3d u_size_stops[i];\nfloat y2 \x3d u_size_values[i];\nif (x \x3c x2) {\nfloat y1 \x3d u_size_values[i - 1];\nsize \x3d y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\nsize \x3d y2;\n}\n}\n}\n#else\nfloat size \x3d u_size;\n#endif\nreturn size + 2.0 * u_featheringSize * u_featheringOffset;\n}"},
hillshade:{"hillshade.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include \x3craster/common/common.glsl\x3e\nuniform int u_hillshadeType;\nuniform float u_sinZcosAs[6];\nuniform float u_sinZsinAs[6];\nuniform float u_cosZs[6];\nuniform float u_weights[6];\nuniform vec2 u_factor;\nuniform float u_minValue;\nuniform float u_maxValue;\nuniform float u_scaling;\n#include \x3craster/lut/colorize.glsl\x3e\n#include \x3craster/common/getSurfaceValues.glsl\x3e\nvec3 rgb2hsv(vec3 c) {\nvec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec4 p \x3d c.g \x3c c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\nvec4 q \x3d c.r \x3c p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\nfloat d \x3d q.x - min(q.w, q.y);\nfloat e \x3d 1.0e-10;\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n}\nvec3 hsv2rgb(vec3 c) {\nvec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\nreturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec4 overlay(float val, float minValue, float maxValue, float hillshade) {\nval \x3d clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);\nvec4 rgb \x3d colorize(vec4(val, val, val, 1.0), 255.0);\nvec3 hsv \x3d rgb2hsv(rgb.xyz);\nhsv.z \x3d hillshade;\nreturn vec4(hsv2rgb(hsv) * u_scaling, 1.0) * rgb.a;\n}\nvoid main() {\nvec2 pixelLocation \x3d getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nvec4 currentPixel \x3d getPixel(pixelLocation);\nif (currentPixel.a \x3d\x3d 0.0) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nfloat pv[10];\ngetSurfaceValues(u_image, pixelLocation, u_srcImageSize, pv);\nfloat alpha \x3d pv[9];\nfloat dzx \x3d (pv[2] + 2.0 * pv[5] + pv[8] - pv[0] - 2.0 * pv[3] - pv[6]) * u_factor.s;\nfloat dzy \x3d (pv[6] + 2.0 * pv[7] + pv[8] - pv[0] - 2.0 * pv[1] - pv[2]) * u_factor.t;\nfloat dzd \x3d sqrt(1.0 + dzx * dzx + dzy * dzy);\nfloat hillshade \x3d 0.0;\nif (u_hillshadeType \x3d\x3d 0){\nfloat cosDelta \x3d u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;\nfloat z \x3d (u_cosZs[0] + cosDelta) / dzd;\nif (z \x3c 0.0)  z \x3d 0.0;\nhillshade \x3d z;\n} else {\nfor (int k \x3d 0; k \x3c 6; k++) {\nfloat cosDelta \x3d u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;\nfloat z \x3d (u_cosZs[k] + cosDelta) / dzd;\nif (z \x3c 0.0) z \x3d 0.0;\nhillshade \x3d hillshade + z * u_weights[k];\nif (k \x3d\x3d 5) break;\n}\n}\n#ifdef APPLY_COLORMAP\nvec4 result \x3d overlay(pv[4], u_minValue, u_maxValue, hillshade) * alpha * u_opacity;\n#else\nhillshade *\x3d u_scaling;\nvec4 result \x3d vec4(hillshade, hillshade, hillshade, 1.0) * alpha * u_opacity;\n#endif\n#ifdef ROUND_OUTPUT\nresult \x3d vec4(floor(result.xyz + 0.5), result.a);\n#endif\ngl_FragColor \x3d result;\n}"},
lut:{"colorize.glsl":"uniform sampler2D u_colormap;\nuniform float u_colormapOffset;\nuniform float u_colormapMaxIndex;\nvec4 colorize(vec4 currentPixel, float scaleFactor) {\nfloat clrIndex \x3d clamp(currentPixel.r * scaleFactor - u_colormapOffset, 0.0, u_colormapMaxIndex);\nvec2 clrPosition \x3d vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);\nvec4 color \x3d texture2D(u_colormap, clrPosition);\nvec4 result \x3d vec4(color.rgb, color.a * currentPixel.a);\nreturn result;\n}\nvec4 colorizeNoClamp(vec4 currentPixel, float scaleFactor) {\nfloat value \x3d currentPixel.r * scaleFactor - u_colormapOffset;\nvec4 result \x3d colorize(currentPixel, scaleFactor);\nreturn result * step(0.0, value) * step(value, u_colormapMaxIndex);\n}",
"lut.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include \x3craster/common/common.glsl\x3e\n#include \x3craster/lut/colorize.glsl\x3e\nvoid main() {\nvec2 pixelLocation \x3d getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nvec4 currentPixel \x3d getPixel(pixelLocation);\nvec4 result \x3d colorizeNoClamp(currentPixel, 1.0);\ngl_FragColor \x3d vec4(result.xyz, 1.0) * result.a * u_opacity;\n}"},magdir:{"magdir.frag":"precision mediump float;\nvarying vec4 v_color;\nuniform lowp float u_opacity;\nvoid main() {\ngl_FragColor \x3d v_color * u_opacity;\n}",
"magdir.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_vv;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform vec2 u_symbolSize;\nuniform vec2 u_symbolPercentRange;\nuniform vec2 u_dataRange;\nuniform float u_rotation;\nuniform vec4 u_colors[12];\nvarying vec4 v_color;\nvoid main()\n{\nfloat angle \x3d a_offset.y + u_rotation;\n#ifndef ROTATION_GEOGRAPHIC\nangle \x3d 3.14159265359 * 2.0 - angle - 3.14159265359 / 2.0;\n#endif\nvec2 offset \x3d vec2(cos(angle), sin(angle)) * a_offset.x;\n#ifdef DATA_RANGE\nfloat valuePercentage \x3d clamp((a_vv.y - u_dataRange.x) / (u_dataRange.y - u_dataRange.x), 0.0, 1.0);\nfloat sizeRatio \x3d u_symbolPercentRange.x + valuePercentage * (u_symbolPercentRange.y - u_symbolPercentRange.x);\nfloat sizePercentage \x3d clamp(sizeRatio, u_symbolPercentRange.x, u_symbolPercentRange.y);\n#else\nfloat sizePercentage \x3d (u_symbolPercentRange.x + u_symbolPercentRange.y) / 2.0;\n#endif\nvec2 pos \x3d a_pos + offset * sizePercentage * u_symbolSize;\nv_color \x3d u_colors[int(a_vv.x)];\ngl_Position \x3d vec4(u_dvsMat3 * vec3(pos * u_coordScale, 1.0), 1.0);\n}"},
reproject:{"reproject.frag":"precision mediump float;\nvarying vec2 v_texcoord;\n#include \x3craster/common/common.glsl\x3e\nvoid main() {\nvec2 pixelLocation \x3d getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nvec4 currentPixel \x3d getPixel(pixelLocation);\ngl_FragColor \x3d vec4(currentPixel.rgb, 1.0) * currentPixel.a * u_opacity;\n}","reproject.vert":"precision mediump float;\nattribute vec2 a_position;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord \x3d a_position;\ngl_Position \x3d vec4(2.0 * (a_position - 0.5), 0.0, 1.0);\n}"},
rfx:{aspect:{"aspect.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_cellSize;\nuniform vec2 u_srcImageSize;\n#include \x3craster/common/getSurfaceValues.glsl\x3e\nconst float pi \x3d 3.14159265359;\nvoid main() {\nfloat pv[10];\ngetSurfaceValues(u_image, v_texcoord, u_srcImageSize, pv);\nfloat alpha \x3d pv[9];\nfloat dzx \x3d (pv[2] + 2.0 * pv[5] + pv[8] - pv[0] - 2.0 * pv[3] - pv[6]) / (8.0 * u_cellSize[0]);\nfloat dzy \x3d -(pv[6] + 2.0 * pv[7] + pv[8] - pv[0] - 2.0 * pv[1] - pv[2]) / (8.0 * u_cellSize[1]);\nalpha *\x3d sign(abs(dzx) + abs(dzy));\nfloat aspect_rad \x3d (dzx \x3d\x3d 0.0) ? (step(0.0, dzy) * 0.5 * pi + step(dzy, 0.0) * 1.5 * pi) : mod((2.5 * pi + atan(dzy, -dzx)), 2.0 * pi);\nfloat aspect \x3d aspect_rad * 180.0 / pi;\ngl_FragColor \x3d vec4(aspect, aspect, aspect, 1.0) * alpha;\n}"},
bandarithmetic:{"bandarithmetic.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform mediump mat3 u_bandIndexMat3;\nuniform float u_adjustments[3];\n#include \x3craster/common/inverse.glsl\x3e\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nvec3 pv2 \x3d u_bandIndexMat3 * pv.rgb;\nfloat nir \x3d pv2.r;\nfloat red \x3d pv2.g;\nfloat index;\n#ifdef NDXI\nindex \x3d (nir - red) * invertValue(nir + red);\n#elif defined(SR)\nindex \x3d nir * invertValue(red);\n#elif defined(CI)\nindex \x3d nir * invertValue(red) - 1.0;\n#elif defined(SAVI)\nindex \x3d (nir - red) * invertValue(nir + red + u_adjustments[0]) * (1.0 + u_adjustments[0]);\n#elif defined(TSAVI)\nfloat s \x3d u_adjustments[0];\nfloat a \x3d u_adjustments[1];\nfloat x \x3d u_adjustments[2];\nfloat y \x3d -a * s + x * (1.0 + s * s);\nindex \x3d (s * (nir - s * red - a)) * invertValue(a * nir + red + y);\n#elif defined(MSAVI)\nfloat nir2 \x3d 2.0 * nir + 1.0;\nindex \x3d 0.5 * (nir2 - sqrt(nir2 * nir2 - 8.0 * (nir - red)));\n#elif defined(GEMI)\nfloat eta \x3d (2.0 * (nir * nir - red * red) + 1.5 * nir + 0.5 * red) * invertValue(nir + red + 0.5);\nindex \x3d eta * (1.0 - 0.25 * eta) - (red - 0.125) * invertValue(1.0 - red);\n#elif defined(PVI)\nfloat a \x3d u_adjustments[0];\nfloat b \x3d u_adjustments[1];\nfloat y \x3d sqrt(1.0 + a * a);\nindex \x3d (nir - a * red - b) * invertValue(y);\n#elif defined(VARI)\nindex \x3d (pv2.g - pv2.r) * invertValue(pv2.g + pv2.r - pv2.b);\n#elif defined(MTVI)\nfloat green \x3d pv2.b;\nfloat v \x3d sqrt(pow((2.0 * nir + 1.0), 2.0) - (6.0 * nir - 5.0 * sqrt(red)) - 0.5);\nindex \x3d 1.5 * (1.2 * (nir - green) - 2.5 * (red - green)) * invertValue(v);\n#elif defined(RTVICORE)\nfloat green \x3d pv2.b;\nindex \x3d 100.0 * (nir - red) - 10.0 * (nir - green);\n#elif defined(EVI)\nfloat blue \x3d pv2.b;\nfloat denom \x3d nir + 6.0 * red - 7.5 * blue + 1.0;\nindex \x3d  (2.5 * (nir - red)) * invertValue(denom);\n#elif defined(WNDWI)\nfloat g \x3d pv2.r;\nfloat n \x3d pv2.g;\nfloat s \x3d pv2.b;\nfloat a \x3d u_adjustments[0];\nfloat denom \x3d g + a * n + (1.0 - a) * s;\nindex \x3d (g - a * n - (1.0 - a) * s) * invertValue(denom);\n#elif defined(BAI)\nindex \x3d invertValue(pow((0.1 - red), 2.0) + pow((0.06 - nir), 2.0));\n#else\ngl_FragColor \x3d pv;\nreturn;\n#endif\n#ifdef ROUND_OUTPUT\nindex \x3d floor(index + 0.5);\n#endif\ngl_FragColor \x3d vec4(index, index, index, pv.a);\n}"},
colormap2rgb:{"colormap2rgb.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\n#include \x3craster/lut/colorize.glsl\x3e\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nvec4 result \x3d colorizeNoClamp(vec4(pv.r, pv.r, pv.r, 1.0), 1.0);\ngl_FragColor \x3d vec4(result.xyz * 255.0, 1.0) * result.a * pv.a;\n}"},compositeband:{"compositeband.frag":"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\n#ifdef ONE_CONSTANT\nuniform float u_image1Const;\n#ifdef TWO_CONSTANT\nuniform float u_image2Const;\n#endif\nuniform mat3 u_imageSwap;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\nvec4 pv0 \x3d texture2D(u_image, v_texcoord);\nfloat a \x3d pv0.r;\nfloat alpha \x3d pv0.a;\n#ifdef TWO_CONSTANT\nfloat b \x3d u_image1Const;\nfloat c \x3d u_image2Const;\nvec3 abc \x3d u_imageSwap * vec3(a, b, c);\na \x3d abc.s;\nb \x3d abc.t;\nc \x3d abc.p;\n#elif defined(ONE_CONSTANT)\nvec4 pv1 \x3d texture2D(u_image1, v_texcoord);\nfloat b \x3d pv1.r;\nfloat c \x3d u_image1Const;\nvec3 abc \x3d u_imageSwap * vec3(a, b, c);\na \x3d abc.s;\nb \x3d abc.t;\nc \x3d abc.p;\nalpha *\x3d pv1.a;\n#else\nvec4 pv1 \x3d texture2D(u_image1, v_texcoord);\nvec4 pv2 \x3d texture2D(u_image2, v_texcoord);\nfloat b \x3d pv1.r;\nfloat c \x3d pv2.r;\nalpha \x3d alpha * pv1.a * pv2.a;\n#endif\ngl_FragColor \x3d vec4(a, b, c, alpha);\n}"},
computechange:{"computechange.frag":"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\n#ifdef ONE_CONSTANT\nuniform float u_image1Const;\nuniform mat3 u_imageSwap;\n#endif\nvarying vec2 v_texcoord;\nuniform vec2 u_domainRange;\n#include \x3craster/common/inverse.glsl\x3e\nvoid main() {\nvec4 pv0 \x3d texture2D(u_image, v_texcoord);\nfloat a \x3d pv0.r;\n#ifdef ONE_CONSTANT\nfloat b \x3d u_image1Const;\nvec3 abc \x3d u_imageSwap * vec3(a, b, 0);\na \x3d abc.s;\nb \x3d abc.t;\n#else\nvec4 pv1 \x3d texture2D(u_image1, v_texcoord);\nfloat b \x3d pv1.r;\n#endif\nfloat result \x3d a;\nfloat alpha \x3d pv0.a;\n#ifdef DIFFERENCE\nresult \x3d a - b;\n#elif defined(RELATIVE)\nresult \x3d (a - b) * invertValue(max(abs(a), abs(b)));\n#endif\nbool isInvalid \x3d result \x3c u_domainRange.s || result \x3e u_domainRange.t;\nresult \x3d isInvalid ? 0.0 : result;\nalpha *\x3d float(!isInvalid);\n#ifdef ROUND_OUTPUT\nresult \x3d floor(result + 0.5);\n#endif\ngl_FragColor \x3d vec4(result, result, result, alpha);\n}"},
contrast:{"contrast.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\n#include \x3craster/common/contrastBrightness.glsl\x3e\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nvec4 result \x3d adjustContrastBrightness(pv, false);\ngl_FragColor \x3d vec4(floor(result.rgb * 255.0 + 0.5), result.a);\n}"},convolution:{"convolution.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_srcImageSize;\n#define KERNEL_SIZE_ROWS ROWS\n#define KERNEL_SIZE_COLS COLS\nuniform vec2 u_clampRange;\nuniform float u_kernel[25];\n#include \x3craster/common/mirror.glsl\x3e\nvoid main() {\nvec3 rgb \x3d vec3(0.0, 0.0, 0.0);\nvec2 resolution \x3d 1.0 / u_srcImageSize;\nfloat rowOffset \x3d -float(floor(float(KERNEL_SIZE_ROWS) / 2.0));\nfloat colOffset \x3d -float(floor(float(KERNEL_SIZE_COLS) / 2.0));\nfloat alpha \x3d 1.0;\nfor (int row \x3d 0; row \x3c KERNEL_SIZE_ROWS; row++) {\nfloat pos_row \x3d rowOffset + float(row);\nfor (int col \x3d 0; col \x3c KERNEL_SIZE_COLS; col++) {\nvec2 pos \x3d v_texcoord + vec2(colOffset + float(col), pos_row) * resolution;\nvec4 pv \x3d texture2D(u_image, mirror(pos));\nrgb +\x3d pv.rgb * u_kernel[row * KERNEL_SIZE_COLS + col];\nalpha *\x3d pv.a;\n}\n}\nrgb \x3d clamp(rgb, u_clampRange.s, u_clampRange.t);\ngl_FragColor \x3d vec4(rgb * alpha, alpha);\n}"},
curvature:{"curvature.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform float u_zlFactor;\nuniform vec2 u_srcImageSize;\n#include \x3craster/common/getSurfaceValues.glsl\x3e\nvoid main() {\nfloat pv[10];\ngetSurfaceValues(u_image, v_texcoord, u_srcImageSize, pv);\nfloat alpha \x3d pv[9];\nfloat d \x3d ((pv[3] + pv[5]) * 0.5 - pv[4]);\nfloat e \x3d ((pv[1] + pv[7]) * 0.5 - pv[4]);\nfloat curvature \x3d 0.0;\n#ifdef STANDARD\ncurvature \x3d -u_zlFactor * (d + e);\ngl_FragColor \x3d vec4(curvature, curvature, curvature, alpha);\n#else\nfloat f \x3d (-pv[0] + pv[2] + pv[6] - pv[8]) / 4.0;\nfloat g \x3d (-pv[3] + pv[5]) / 2.0;\nfloat h \x3d (pv[1] - pv[7]) / 2.0;\nfloat g2 \x3d g * g;\nfloat h2 \x3d h * h;\n#ifdef PROFILE\ncurvature \x3d (u_zlFactor * (d * g2 + e * h2 + f * g * h)) / (g2 + h2);\n#else\ncurvature \x3d (-u_zlFactor * (d * h2 + e * g2 - f * g * h)) / (g2 + h2);\n#endif\n#endif\ngl_FragColor \x3d vec4(curvature, curvature, curvature, alpha);\n}"},
extractband:{"extractband.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform mediump mat3 u_bandIndexMat3;\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nvec3 pv2 \x3d u_bandIndexMat3 * pv.rgb;\ngl_FragColor \x3d vec4(pv2, pv.a);\n}"},focalstatistics:{"focalstatistics.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_srcImageSize;\n#define KERNEL_SIZE_ROWS ROWS\n#define KERNEL_SIZE_COLS COLS\nuniform vec2 u_clampRange;\n#include \x3craster/common/mirror.glsl\x3e\n#include \x3craster/common/inverse.glsl\x3e\nvoid main() {\nvec2 resolution \x3d 1.0 / u_srcImageSize;\nfloat rowOffset \x3d -float(floor(float(KERNEL_SIZE_ROWS) / 2.0));\nfloat colOffset \x3d -float(floor(float(KERNEL_SIZE_COLS) / 2.0));\nfloat count \x3d 0.0;\n#ifdef STDDEV\nvec3 sum \x3d vec3(0.0, 0.0, 0.0);\nvec3 sum2 \x3d vec3(0.0, 0.0, 0.0);\n#endif\nvec4 currentPixel \x3d texture2D(u_image, v_texcoord);\nvec3 rgb \x3d currentPixel.rgb;\nfor (int row \x3d 0; row \x3c KERNEL_SIZE_ROWS; row++) {\nfloat pos_row \x3d rowOffset + float(row);\nfor (int col \x3d 0; col \x3c KERNEL_SIZE_COLS; col++) {\nvec2 pos \x3d v_texcoord + vec2(colOffset + float(col), pos_row) * resolution;\nvec4 pv \x3d texture2D(u_image, mirror(pos));\ncount +\x3d pv.a;\n#ifdef MIN\nrgb \x3d min(rgb, pv.rgb);\n#elif defined(MAX)\nrgb \x3d max(rgb, pv.rgb);\n#elif defined(MEAN)\nrgb +\x3d pv.rgb;\n#elif defined(STDDEV)\nsum +\x3d pv.rgb;\nsum2 +\x3d (pv.rgb * pv.rgb);\n#endif\n}\n}\n#ifdef MEAN\nrgb *\x3d invertValue(count);\n#elif defined(STDDEV)\nrgb \x3d sqrt((sum2 - sum * sum * invertValue(count)) * invertValue(count));\n#endif\nfloat alpha \x3d step(0.9999, count);\nrgb \x3d clamp(rgb, u_clampRange.s, u_clampRange.t);\n#ifdef FILL\nrgb \x3d (1.0 - currentPixel.a) * rgb + currentPixel.a * currentPixel.rgb;\n#endif\ngl_FragColor \x3d vec4(rgb * alpha, alpha);\n}"},
grayscale:{"grayscale.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec3 u_weights;\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nfloat value \x3d dot(u_weights, pv.rgb);\ngl_FragColor \x3d vec4(value, value, value, pv.a);\n}"},local:{"local.frag":"precision highp float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\n#ifdef ONE_CONSTANT\nuniform float u_image1Const;\n#ifdef TWO_CONSTANT\nuniform float u_image2Const;\n#endif\nuniform mat3 u_imageSwap;\n#endif\nvarying vec2 v_texcoord;\nuniform vec2 u_domainRange;\n#include \x3craster/common/inverse.glsl\x3e\nvoid main() {\nvec4 pv0 \x3d texture2D(u_image, v_texcoord);\nfloat a \x3d pv0.r;\n#ifdef TWO_IMAGES\n#ifdef ONE_CONSTANT\nfloat b \x3d u_image1Const;\nvec3 abc \x3d u_imageSwap * vec3(a, b, 0);\na \x3d abc.s;\nb \x3d abc.t;\n#else\nvec4 pv1 \x3d texture2D(u_image1, v_texcoord);\nfloat b \x3d pv1.r;\n#endif\n#elif defined(CONDITIONAL)\n#ifdef TWO_CONSTANT\nfloat b \x3d u_image1Const;\nfloat c \x3d u_image2Const;\nvec3 abc \x3d u_imageSwap * vec3(a, b, c);\na \x3d abc.s;\nb \x3d abc.t;\nc \x3d abc.p;\n#elif defined(ONE_CONSTANT)\nvec4 pv1 \x3d texture2D(u_image1, v_texcoord);\nfloat b \x3d pv1.r;\nfloat c \x3d u_image1Const;\nvec3 abc \x3d u_imageSwap * vec3(a, b, c);\na \x3d abc.s;\nb \x3d abc.t;\nc \x3d abc.p;\n#else\nvec4 pv1 \x3d texture2D(u_image1, v_texcoord);\nvec4 pv2 \x3d texture2D(u_image2, v_texcoord);\nfloat b \x3d pv1.r;\nfloat c \x3d pv2.r;\n#endif\n#endif\nfloat result \x3d a;\nfloat alpha \x3d pv0.a;\n#ifdef PLUS\nresult \x3d a + b;\n#elif defined(MINUS)\nresult \x3d a - b;\n#elif defined(TIMES)\nresult \x3d a * b;\n#elif defined(DIVIDE)\nresult \x3d a * invertValue(b);\nalpha *\x3d float(abs(sign(b)));\n#elif defined(FLOATDIVIDE)\nresult \x3d a * invertValue(b);\nalpha *\x3d float(abs(sign(b)));\n#elif defined(FLOORDIVIDE)\nresult \x3d floor(a * invertValue(b));\nalpha *\x3d float(abs(sign(b)));\n#elif defined(SQUARE)\nresult \x3d a * a;\n#elif defined(SQRT)\nresult \x3d sqrt(a);\n#elif defined(POWER)\nresult \x3d pow(a, b);\n#elif defined(LN)\nresult \x3d a \x3c\x3d 0.0 ? 0.0: log(a);\nalpha *\x3d float(a \x3e 0.0);\n#elif defined(LOG_1_0)\nresult \x3d a \x3c\x3d 0.0 ? 0.0: log2(a) * invertValue(log2(10.0));\nalpha *\x3d float(a \x3e 0.0);\n#elif defined(LOG_2)\nresult \x3d a \x3c\x3d 0.0 ? 0.0: log2(a);\nalpha *\x3d float(a \x3e 0.0);\n#elif defined(EXP)\nresult \x3d exp(a);\n#elif defined(EXP_1_0)\nresult \x3d pow(10.0, a);\n#elif defined(EXP_2)\nresult \x3d pow(2.0, a);\n#elif defined(ROUNDDOWN)\nresult \x3d floor(a);\n#elif defined(ROUNDUP)\nresult \x3d ceil(a);\n#elif defined(INT)\nresult \x3d float(sign(a)) * floor(abs(a));\n#elif defined(MOD)\nresult \x3d mod(a, b);\n#elif defined(NEGATE)\nresult \x3d -a;\n#elif defined(ABS)\nresult \x3d abs(a);\n#elif defined(ACOS)\nresult \x3d abs(a) \x3e 1.0 ? 0.0: acos(a);\nalpha *\x3d step(abs(a), 1.00001);\n#elif defined(ACOSH)\nresult \x3d acosh(a);\n#elif defined(ASIN)\nresult \x3d abs(a) \x3e 1.0 ? 0.0: asin(a);\nalpha *\x3d step(abs(a), 1.00001);\n#elif defined(ASINH)\nresult \x3d asinh(a);\n#elif defined(ATAN)\nresult \x3d atan(a);\n#elif defined(ATANH)\nresult \x3d abs(a) \x3e 1.0 ? 0.0: atanh(a);\nalpha *\x3d step(abs(a), 1.0);\n#elif defined(ATAN_2)\nresult \x3d atan(a, b);\n#elif defined(COS)\nresult \x3d cos(a);\n#elif defined(COSH)\nresult \x3d cosh(a);\n#elif defined(SIN)\nresult \x3d sin(a);\n#elif defined(SINH)\nresult \x3d sinh(a);\n#elif defined(TAN)\nresult \x3d tan(a);\n#elif defined(TANH)\nresult \x3d tanh(a);\n#elif defined(BITWISEAND)\nresult \x3d float(int(a) \x26 int(b));\n#elif defined(BITWISEOR)\nresult \x3d float(int(a) | int(b));\n#elif defined(BITWISELEFTSHIFT)\nresult \x3d float(int(a) \x3c\x3c int(b));\n#elif defined(BITWISERIGHTSHIFT)\nresult \x3d float(int(a) \x3e\x3e int(b));\n#elif defined(BITWISENOT)\nresult \x3d float(~(int(a)));\n#elif defined(BITWISEXOR)\nresult \x3d float(int(a) ^ int(b));\n#elif defined(BOOLEANAND)\nresult \x3d float((a !\x3d 0.0) \x26\x26 (b !\x3d 0.0));\n#elif defined(BOOLEANNOT)\nresult \x3d float(a \x3d\x3d 0.0);\n#elif defined(BOOLEANOR)\nresult \x3d float((a !\x3d 0.0) || (b !\x3d 0.0));\n#elif defined(BOOLEANXOR)\nresult \x3d float((a !\x3d 0.0) ^^ (b !\x3d 0.0));\n#elif defined(GREATERTHAN)\nresult \x3d float(a \x3e b);\n#elif defined(GREATERTHANEQUAL)\nresult \x3d float(a \x3e\x3d b);\n#elif defined(LESSTHAN)\nresult \x3d float(a \x3c b);\n#elif defined(LESSTHANEQUAL)\nresult \x3d float(a \x3c\x3d b);\n#elif defined(EQUALTO)\nresult \x3d float(a \x3d\x3d b);\n#elif defined(NOTEQUAL)\nresult \x3d float(a !\x3d b);\n#elif defined(ISNULL)\nresult \x3d float(alpha \x3d\x3d 0.0);\nalpha \x3d 1.0;\n#elif defined(SETNULL)\nfloat maskValue \x3d float(a \x3d\x3d 0.0);\nresult \x3d maskValue * b;\nalpha *\x3d maskValue;\n#elif defined(CONDITIONAL)\nfloat weight \x3d float(abs(sign(a)));\nresult \x3d weight * b + (1.0 - weight) * c;\n#endif\nfloat rangeFactor \x3d step(u_domainRange.s, result) * step(result, u_domainRange.t);\nresult *\x3d rangeFactor;\nalpha *\x3d rangeFactor;\n#ifdef ROUND_OUTPUT\nresult \x3d floor(result + 0.5);\n#endif\ngl_FragColor \x3d vec4(result, result, result, alpha);\n}"},
mask:{"mask.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\n#define LEN_INCLUDED_RANGES 6\n#define LEN_NODATA_VALUES 6\nuniform highp float u_includedRanges[6];\nuniform highp float u_noDataValues[6];\nfloat maskFactor(float bandValue, float fromValue, float to) {\nfloat factor \x3d 1.0;\nfor (int i \x3d 0; i \x3c LEN_NODATA_VALUES; i++) {\nfactor *\x3d float(u_noDataValues[i] !\x3d bandValue);\n}\nfactor *\x3d step(fromValue, bandValue) * step(bandValue, to);\nreturn factor;\n}\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nfloat redFactor \x3d maskFactor(pv.r, u_includedRanges[0], u_includedRanges[1]);\n#ifdef MULTI_BAND\nfloat greenFactor \x3d maskFactor(pv.g, u_includedRanges[2], u_includedRanges[3]);\nfloat blueFactor \x3d maskFactor(pv.b, u_includedRanges[4], u_includedRanges[5]);\nfloat maskFactor \x3d redFactor * greenFactor * blueFactor;\ngl_FragColor \x3d pv * maskFactor;\n#else\ngl_FragColor \x3d pv * redFactor;\n#endif\n}"},
ndvi:{"ndvi.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform mediump mat3 u_bandIndexMat3;\n#include \x3craster/common/inverse.glsl\x3e\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nvec3 pv2 \x3d u_bandIndexMat3 * pv.rgb;\nfloat nir \x3d pv2.r;\nfloat red \x3d pv2.g;\nfloat index \x3d (nir - red) * invertValue(nir + red);\n#ifdef SCALED\nindex \x3d floor((index + 1.0) * 100.0 + 0.5);\n#endif\ngl_FragColor \x3d vec4(index, index, index, pv.a);\n}"},
remap:{"remap.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\n#define LEN_REMAP_RANGES 18\n#define LEN_NODATA_RANGES 12\nuniform highp float u_rangeMaps[18];\nuniform highp float u_noDataRanges[12];\nuniform highp float u_unmatchMask;\nuniform vec2 u_clampRange;\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nfloat factor \x3d 1.0;\nfloat bandValue \x3d pv.r;\nfor (int i \x3d 0; i \x3c LEN_NODATA_RANGES; i+\x3d2) {\nfloat inside \x3d 1.0 - step(u_noDataRanges[i], bandValue) * step(bandValue, u_noDataRanges[i+1]);\nfactor *\x3d inside;\n}\nfloat mapValue \x3d 0.0;\nfloat includeMask \x3d 0.0;\nfor (int i \x3d 0; i \x3c LEN_REMAP_RANGES; i+\x3d3) {\nfloat stepMask \x3d step(u_rangeMaps[i], bandValue) * step(bandValue, u_rangeMaps[i+1]);\nincludeMask \x3d (1.0 - stepMask) * includeMask + stepMask;\nmapValue \x3d (1.0 - stepMask) * mapValue + stepMask * u_rangeMaps[i+2];\n}\nbandValue \x3d factor * (mapValue + (1.0 - includeMask) * u_unmatchMask * pv.r);\nfloat bandMask \x3d factor * max(u_unmatchMask, includeMask);\nbandValue \x3d clamp(bandValue, u_clampRange.s, u_clampRange.t);\ngl_FragColor \x3d vec4(bandValue, bandValue, bandValue, bandMask * pv.a);\n}"},
slope:{"slope.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_cellSize;\nuniform float u_zFactor;\nuniform vec2 u_srcImageSize;\nuniform float u_pixelSizePower;\nuniform float u_pixelSizeFactor;\n#include \x3craster/common/getSurfaceValues.glsl\x3e\nvoid main() {\nfloat pv[10];\ngetSurfaceValues(u_image, v_texcoord, u_srcImageSize, pv);\nfloat alpha \x3d pv[9];\nfloat xf \x3d (u_zFactor + pow(u_cellSize[0], u_pixelSizePower) * u_pixelSizeFactor) / (8.0 * u_cellSize[0]);\nfloat yf \x3d (u_zFactor + pow(u_cellSize[1], u_pixelSizePower) * u_pixelSizeFactor) / (8.0 * u_cellSize[1]);\nfloat dzx \x3d (pv[2] + 2.0 * pv[5] + pv[8] - pv[0] - 2.0 * pv[3] - pv[6]) * xf;\nfloat dzy \x3d -(pv[6] + 2.0 * pv[7] + pv[8] - pv[0] - 2.0 * pv[1] - pv[2]) * yf;\nfloat rise2run \x3d sqrt(dzx * dzx + dzy * dzy);\n#ifdef PERCENT_RISE\nfloat result \x3d rise2run * 100.0;\n#else\nfloat result \x3d atan(rise2run) * 57.2957795;\n#endif\n#ifdef ROUND_OUTPUT\nresult \x3d floor(result + 0.5);\n#endif\ngl_FragColor \x3d vec4(result, result, result, alpha);\n}"},
stretch:{"stretch.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying highp vec2 v_texcoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput;\nuniform float u_maxOutput;\nuniform float u_factor[3];\nuniform float u_gamma[3];\nuniform float u_gammaCorrection[3];\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, float gamma, float gammaCorrection) {\nval \x3d clamp(val, minCutOff, maxCutOff);\nfloat stretchedVal;\n#ifdef USE_GAMMA\nfloat tempf \x3d 1.0;\nfloat outRange \x3d maxOutput - minOutput;\nfloat relativeVal \x3d (val - minCutOff) / (maxCutOff - minCutOff);\ntempf -\x3d step(1.0, gamma) * sign(gamma - 1.0) * pow(1.0 / outRange, relativeVal * gammaCorrection);\nstretchedVal \x3d tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput;\nstretchedVal \x3d clamp(stretchedVal, minOutput, maxOutput);\n#else\nstretchedVal \x3d minOutput + (val - minCutOff) * factor;\n#endif\n#ifdef ROUND_OUTPUT\nstretchedVal \x3d floor(stretchedVal + 0.5);\n#endif\nreturn stretchedVal;\n}\nvoid main() {\nvec4 currentPixel \x3d texture2D(u_image, v_texcoord);\nfloat redVal \x3d stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_gamma[0], u_gammaCorrection[0]);\n#ifdef MULTI_BAND\nfloat greenVal \x3d stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_gamma[1], u_gammaCorrection[1]);\nfloat blueVal \x3d stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_gamma[2], u_gammaCorrection[2]);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, currentPixel.a);\n#else\ngl_FragColor \x3d vec4(redVal, redVal, redVal, currentPixel.a);\n#endif\n}"},
vs:{"vs.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord \x3d a_pos;\ngl_Position \x3d vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"}},scalar:{"scalar.frag":"precision mediump float;\nuniform lowp float u_opacity;\nvarying vec2 v_pos;\nconst vec4 outlineColor \x3d vec4(0.2, 0.2, 0.2, 1.0);\nconst float outlineSize \x3d 0.02;\nconst float innerRadius \x3d 0.25;\nconst float outerRadius \x3d 0.42;\nconst float innerSquareLength \x3d 0.15;\nvoid main() {\nmediump float dist \x3d length(v_pos);\nmediump float fillalpha1 \x3d smoothstep(outerRadius, outerRadius + outlineSize, dist);\nfillalpha1 *\x3d (1.0-smoothstep(outerRadius + outlineSize, outerRadius + 0.1 + outlineSize, dist));\n#ifdef INNER_CIRCLE\nmediump float fillalpha2 \x3d smoothstep(innerRadius, innerRadius + outlineSize, dist);\nfillalpha2 *\x3d (1.0-smoothstep(innerRadius + outlineSize, innerRadius + 0.1 + outlineSize, dist));\n#else\nmediump float fillalpha2 \x3d (abs(v_pos.x) \x3c innerSquareLength ? 1.0 : 0.0) * (abs(v_pos.y) \x3c innerSquareLength ? 1.0 : 0.0);\n#endif\ngl_FragColor \x3d (fillalpha2 + fillalpha1) * outlineColor * u_opacity;\n}",
"scalar.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_vv;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform vec2 u_symbolSize;\nuniform vec2 u_symbolPercentRange;\nuniform vec2 u_dataRange;\nvarying vec2 v_pos;\nvoid main()\n{\n#ifdef DATA_RANGE\nfloat valuePercentage \x3d clamp((a_vv.y - u_dataRange.x) / (u_dataRange.y - u_dataRange.x), 0.0, 1.0);\nfloat sizeRatio \x3d u_symbolPercentRange.x + valuePercentage * (u_symbolPercentRange.y - u_symbolPercentRange.x);\nfloat sizePercentage \x3d clamp(sizeRatio, u_symbolPercentRange.x, u_symbolPercentRange.y);\n#else\nfloat sizePercentage \x3d (u_symbolPercentRange.x + u_symbolPercentRange.y) / 2.0;\n#endif\nvec2 size \x3d u_symbolSize * sizePercentage;\nvec2 pos \x3d a_pos + a_offset * size;\nv_pos \x3d a_offset;\ngl_Position \x3d vec4(u_dvsMat3 * vec3(pos * u_coordScale, 1.0), 1.0);\n}"},
stretch:{"stretch.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include \x3craster/common/common.glsl\x3e\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput;\nuniform float u_maxOutput;\nuniform float u_factor[3];\nuniform bool u_useGamma;\nuniform float u_gamma[3];\nuniform float u_gammaCorrection[3];\n#include \x3craster/lut/colorize.glsl\x3e\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {\nif (val \x3e\x3d maxCutOff) {\nreturn maxOutput;\n} else if (val \x3c\x3d minCutOff) {\nreturn minOutput;\n}\nfloat stretchedVal;\nif (useGamma) {\nfloat tempf \x3d 1.0;\nfloat outRange \x3d maxOutput - minOutput;\nfloat relativeVal \x3d (val - minCutOff) / (maxCutOff - minCutOff);\nif (gamma \x3e 1.0) {\ntempf -\x3d pow(1.0 / outRange, relativeVal * gammaCorrection);\n}\nstretchedVal \x3d (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;\n} else {\nstretchedVal \x3d minOutput + (val - minCutOff) * factor;\n}\n#ifdef ROUND_OUTPUT\nstretchedVal \x3d floor(stretchedVal + 0.5);\n#endif\nreturn stretchedVal;\n}\nvoid main() {\nvec2 pixelLocation \x3d getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nvec4 currentPixel \x3d getPixel(pixelLocation);\n#ifdef NOOP\ngl_FragColor \x3d vec4(currentPixel.rgb, 1.0) * currentPixel.a * u_opacity;\nreturn;\n#endif\nif (u_bandCount \x3d\x3d 1) {\nfloat grayVal \x3d stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\n#ifdef APPLY_COLORMAP\nvec4 result \x3d colorize(vec4(grayVal, grayVal, grayVal, 1.0), u_useGamma ? 255.0 : 1.0);\ngl_FragColor \x3d vec4(result.xyz, 1.0) * result.a * currentPixel.a * u_opacity;\n#else\ngl_FragColor \x3d vec4(grayVal, grayVal, grayVal, 1.0) * currentPixel.a * u_opacity;\n#endif\n} else {\nfloat redVal \x3d stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\nfloat greenVal \x3d stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);\nfloat blueVal \x3d stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, 1.0) * currentPixel.a * u_opacity;\n}\n}"}},
stencil:{"stencil.frag":"void main() {\ngl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\n}","stencil.vert":"attribute vec2 a_pos;\nuniform mat3 u_worldExtent;\nvoid main() {\ngl_Position \x3d vec4(u_worldExtent * vec3(a_pos, 1.0), 1.0);\n}"},test:{"TestShader.common.glsl":"#ifndef RETURN_RED\nvarying    vec4      v_color;\n#endif\nvarying    vec2      v_offset;","TestShader.frag":"precision highp float;\n#include \x3ctest/TestShader.common.glsl\x3e\nvoid main() {\nif (v_offset.x \x3e -.5 \x26\x26 v_offset.y \x3e -.5 \x26\x26 v_offset.x \x3c .5 \x26\x26 v_offset.y \x3c .5) {\ndiscard;\n}\n#ifdef RETURN_RED\ngl_FragColor \x3d vec4(1., 0., 0., 1.);\n#else\ngl_FragColor \x3d v_color;\n#endif\n}",
"TestShader.vert":"const float POS_PRECISION_FACTOR \x3d 10.;\nconst float OFFSET_PRECISION_FACTOR \x3d 10.;\nconst float SIZE_PRECISION_FACTOR \x3d 10.;\nattribute  vec2      a_pos_packed;\nattribute  vec2      a_offset_packed;\nattribute  float     a_size_packed;\n#ifdef DATA_DRIVEN_COLOR\nconst float u_dataDrivenColor_validValues[4] \x3d float[4](0., 0., 1., 0.);\nuniform    vec4      u_dataDrivenColor_colorFallback;\nuniform    vec4      u_dataDrivenColor_color;\n#endif\nuniform    float     u_view_zoomLevel;\n#include \x3ctest/TestShader.common.glsl\x3e\n#ifdef DATA_DRIVEN_COLOR\nvec4 getColor(float value) {\nint index \x3d -1;\nfor (int i \x3d 0; i \x3c 4; i++) {\nif (u_dataDrivenColor_validValues[i] \x3d\x3d value) {\nindex \x3d i;\nbreak;\n}\n}\nif (index \x3d\x3d -1) {\nreturn u_dataDrivenColor_colorFallback;\n}\nreturn u_dataDrivenColor_color;\n}\n#endif\nvoid main() {\nvec2  a_pos \x3d a_pos_packed / POS_PRECISION_FACTOR;\nvec2  a_offset \x3d a_offset_packed / OFFSET_PRECISION_FACTOR;\nfloat a_size \x3d a_size_packed / SIZE_PRECISION_FACTOR;\nvec4 color \x3d vec4(1., 0., 0., 1.);\n#ifdef DATA_DRIVEN_COLOR\ncolor \x3d getColor(1.);\n#endif\nvec2 offsetScaled \x3d a_offset * a_size;\nvec4 pos \x3d vec4(a_pos.xy + offsetScaled, 0., 1.);\ngl_Position \x3d pos;\n#ifndef RETURN_RED\nv_color \x3d color;\n#endif\nv_offset \x3d a_offset;\n}"},
tileInfo:{"tileInfo.frag":"uniform mediump sampler2D u_texture;\nvarying mediump vec2 v_tex;\nvoid main(void) {\nlowp vec4 color \x3d texture2D(u_texture, v_tex);\ncolor.rgb *\x3d color.a;\ngl_FragColor \x3d color;\n}","tileInfo.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_coord_ratio;\nuniform mediump vec2 u_delta;\nuniform mediump vec2 u_dimensions;\nvarying mediump vec2 v_tex;\nvoid main() {\nmediump vec2 offset \x3d u_coord_ratio * vec2(u_delta + a_pos * u_dimensions);\nvec3 v_pos \x3d u_dvsMat3 * vec3(offset, 1.0);\ngl_Position \x3d vec4(v_pos.xy, 0.0, 1.0);\nv_tex \x3d a_pos;\n}"},
util:{"atan2.glsl":"float atan2(in float y, in float x) {\nfloat t0, t1, t2, t3, t4;\nt3 \x3d abs(x);\nt1 \x3d abs(y);\nt0 \x3d max(t3, t1);\nt1 \x3d min(t3, t1);\nt3 \x3d 1.0 / t0;\nt3 \x3d t1 * t3;\nt4 \x3d t3 * t3;\nt0 \x3d         - 0.013480470;\nt0 \x3d t0 * t4 + 0.057477314;\nt0 \x3d t0 * t4 - 0.121239071;\nt0 \x3d t0 * t4 + 0.195635925;\nt0 \x3d t0 * t4 - 0.332994597;\nt0 \x3d t0 * t4 + 0.999995630;\nt3 \x3d t0 * t3;\nt3 \x3d (abs(y) \x3e abs(x)) ? 1.570796327 - t3 : t3;\nt3 \x3d x \x3c 0.0 ?  3.141592654 - t3 : t3;\nt3 \x3d y \x3c 0.0 ? -t3 : t3;\nreturn t3;\n}",
"encoding.glsl":"const vec4 rgba2float_factors \x3d vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}"}}})},"esri/views/2d/engine/webgl/brushes/WGLBrushStencil":function(){define("../../../../../core/libs/gl-matrix-2/factories/vec4f32 ../DefaultVertexAttributeLayouts ./WGLBrush ../shaders/BackgroundPrograms ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/ProgramTemplate ../../../../webgl/VertexArrayObject".split(" "),
function(k,r,p,e,n,m,l,d){class a extends p{constructor(){super(...arguments);this._color=k.fromValues(1,0,0,1);this._initialized=!1}dispose(){this._solidProgram&&(this._solidProgram.dispose(),this._solidProgram=null);this._solidVertexArrayObject&&(this._solidVertexArrayObject.dispose(),this._solidVertexArrayObject=null)}prepareState({context:b}){b.setDepthWriteEnabled(!1);b.setDepthTestEnabled(!1);b.setStencilTestEnabled(!0);b.setBlendingEnabled(!1);b.setColorMask(!1,!1,!1,!1);b.setStencilOp(m.StencilOperation.KEEP,
m.StencilOperation.KEEP,m.StencilOperation.REPLACE);b.setStencilWriteMask(255)}draw(b,f){const {context:g,requestRender:q,allowDelayedRender:c}=b;this._initialized||this._initialize(g);c&&null!=q&&!this._solidProgram.compiled?q():(g.setStencilFunctionSeparate(m.Face.FRONT_AND_BACK,m.CompareFunction.GREATER,f.stencilRef,255),g.bindVAO(this._solidVertexArrayObject),g.useProgram(this._solidProgram),this._solidProgram.setUniformMatrix3fv("u_dvsMat3",f.transforms.displayViewScreenMat3),this._solidProgram.setUniform2fv("u_coord_range",
[f.rangeX,f.rangeY]),this._solidProgram.setUniform1f("u_depth",0),this._solidProgram.setUniform4fv("u_color",this._color),g.drawArrays(m.PrimitiveType.TRIANGLE_STRIP,0,4),g.bindVAO())}_initialize(b){if(this._initialized)return!0;const f=l.createProgram(b,e.background);if(!f)return!1;var g=new Int8Array([0,0,1,0,0,1,1,1]);g=n.BufferObject.createVertex(b,m.Usage.STATIC_DRAW,g);b=new d.VertexArrayObject(b,e.background.attributes,r.Pos2b,new Map([["geometry",g]]));this._solidProgram=f;this._solidVertexArrayObject=
b;return this._initialized=!0}}return a})},"esri/views/2d/engine/webgl/DefaultVertexAttributeLayouts":function(){define(["exports","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(k,r,p){const e=new Map([["geometry",[new p.VertexElementDescriptor("a_pos",2,r.DataType.BYTE,0,2)]]]),n=new Map([["geometry",[new p.VertexElementDescriptor("a_pos",2,r.DataType.BYTE,0,4),new p.VertexElementDescriptor("a_tex",2,r.DataType.BYTE,2,4)]]]);r=new Map([["geometry",[new p.VertexElementDescriptor("a_pos",
2,r.DataType.UNSIGNED_SHORT,0,4)]]]);k.Pos2b=e;k.Pos2us=r;k.PosTex2b=n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushTileDebugInfo":function(){define("../../../../../core/libs/gl-matrix-2/factories/vec4f32 ../DefaultVertexAttributeLayouts ../FeatureTile ./WGLBrush ../shaders/BackgroundPrograms ../shaders/TileInfoPrograms ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/ProgramTemplate ../../../../webgl/Texture ../../../../webgl/TextureDescriptor ../../../../webgl/VertexArrayObject".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g){class q extends e{constructor(){super(...arguments);this._color=k.fromValues(1,0,0,1)}dispose(){this._outlineProgram?.dispose();this._outlineProgram=null;this._tileInfoProgram?.dispose();this._tileInfoProgram=null;this._outlineVertexArrayObject?.dispose();this._outlineVertexArrayObject=null;this._tileInfoVertexArrayObject?.dispose();this._ctx=this._tileInfoVertexArrayObject=null}prepareState({context:c}){c.setBlendingEnabled(!0);c.setBlendFunctionSeparate(d.BlendFactor.ONE,
d.BlendFactor.ONE_MINUS_SRC_ALPHA,d.BlendFactor.ONE,d.BlendFactor.ONE_MINUS_SRC_ALPHA);c.setColorMask(!0,!0,!0,!0);c.setStencilWriteMask(0);c.setStencilTestEnabled(!1)}draw(c,h){const {context:u,requestRender:A,allowDelayedRender:z}=c;if(!(!h.isReady&&h instanceof p.FeatureTile&&h.hasData))if(this._loadWGLResources(u),!z||null==A||this._outlineProgram.compiled&&this._tileInfoProgram.compiled){u.bindVAO(this._outlineVertexArrayObject);u.useProgram(this._outlineProgram);this._outlineProgram.setUniformMatrix3fv("u_dvsMat3",
h.transforms.displayViewScreenMat3);this._outlineProgram.setUniform2f("u_coord_range",h.rangeX,h.rangeY);this._outlineProgram.setUniform1f("u_depth",0);this._outlineProgram.setUniform4fv("u_color",this._color);u.drawArrays(d.PrimitiveType.LINE_STRIP,0,4);if(c=this._getTexture(u,h))u.bindVAO(this._tileInfoVertexArrayObject),u.useProgram(this._tileInfoProgram),u.bindTexture(c,0),this._tileInfoProgram.setUniformMatrix3fv("u_dvsMat3",h.transforms.displayViewScreenMat3),this._tileInfoProgram.setUniform1f("u_depth",
0),this._tileInfoProgram.setUniform2f("u_coord_ratio",h.rangeX/h.width,h.rangeY/h.height),this._tileInfoProgram.setUniform2f("u_delta",0,0),this._tileInfoProgram.setUniform2f("u_dimensions",c.descriptor.width,c.descriptor.height),u.drawArrays(d.PrimitiveType.TRIANGLE_STRIP,0,4);u.bindVAO()}else A()}_loadWGLResources(c){if(!this._outlineProgram||!this._tileInfoProgram){var h=a.createProgram(c,n.background),u=a.createProgram(c,m.tileInfo),A=new Int8Array([0,0,1,0,1,1,0,1]);A=l.BufferObject.createVertex(c,
d.Usage.STATIC_DRAW,A);A=new g.VertexArrayObject(c,n.background.attributes,r.Pos2b,new Map([["geometry",A]]));var z=new Int8Array([0,0,1,0,0,1,1,1]);z=l.BufferObject.createVertex(c,d.Usage.STATIC_DRAW,z);c=new g.VertexArrayObject(c,m.tileInfo.attributes,r.Pos2b,new Map([["geometry",z]]));this._outlineProgram=h;this._tileInfoProgram=u;this._outlineVertexArrayObject=A;this._tileInfoVertexArrayObject=c}}_getTexture(c,h){if(!this._ctx){var u=document.createElement("canvas");u.width=512;u.height=512;this._ctx=
u.getContext("2d")}h.tileDebugInfoTexture||(u=new f.TextureDescriptor,u.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE,u.samplingMode=d.TextureSamplingMode.LINEAR,u.isImmutable=!0,u.width=512,u.height=512,h.tileDebugInfoTexture=new b.Texture(c,u));c=this._ctx;c.clearRect(0,0,c.canvas.width,c.canvas.height);c.textAlign="left";c.textBaseline="top";c.font="14px sans-serif";c.lineWidth=2;c.fillStyle="white";c.strokeStyle="black";var {debugSlot:A}=h;u=8+99.2*A;A=`${A}) ${h.key.id} (${h.constructor.name})`;c.strokeText(A,
8,u);c.fillText(A,8,u);u+=16;({debugInfo:A}=h);if(A){const {length:t,minOrderedLength:w,minUnorderedLength:x,triangleCount:B}=A.display;if(0<t){var z=`Length: ${t}`;c.strokeText(z,8,u);c.fillText(z,8,u);u+=16}w&&(z=`Min ordered length: ${w}`,c.strokeText(z,8,u),c.fillText(z,8,u),u+=16);x&&(z=`Min unordered length: ${x}`,c.strokeText(z,8,u),c.fillText(z,8,u),u+=16);0<B&&(1E5<B&&(c.fillStyle="red",c.strokeStyle="white"),z=`Triangle count: ${B}`,c.strokeText(z,8,u),c.fillText(z,8,u),u+=16);const {bytesUsed:C,
bytesReserved:y}=A.memory;c.fillStyle="white";c.strokeStyle="black";if(0<C||0<y)A=`Memory usage: ${C} of ${y} bytes`,c.strokeText(A,8,u),c.fillText(A,8,u),u+=16}h.tileDebugInfoTexture.setData(c.canvas);return h.tileDebugInfoTexture}}return q})},"esri/views/2d/engine/webgl/FeatureTile":function(){define("exports ../../../../core/has ../../../../core/Logger ../../../../core/libs/gl-matrix-2/factories/mat2df32 ./AFeatureTile ./definitions ./DisplayEntity ./enums ./FeatureDisplayList ./ReshufflePlan ./collisions/LabelMetric ./cpuMapped/MappedMesh ./mesh/meshDebugUtils ./util/Reader ./util/serializationUtils".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g,q,c,h){let u=0;class A extends n.AFeatureTile{constructor(z,t,w,x,B=!1){super(z,t,w,x);this._meshes=new Map;this._entities=[];this._nextUploadAllowed=this._invalidated=!1;this.tileAge=u++;this._metrics=[];this._entityIds=new Set;this._entityIdsFromBuffer=new Set;this._attributeEpoch=0;this._encounteredEnd=!1;this._objectIdMap=null;this.visible=!0;this.transforms.labelMat2d=e.create();this.enableDeferredUploads=B}destroy(){super.destroy();this.clear()}clear(){for(const z of this._meshes.values())z.destroy();
this._meshes.clear();this._entities=[];this._metrics=[];this._displayList=null;this._invalidated=!0;this._entityIds.clear();this._nextUploadAllowed=!0}beforeRender(z){super.beforeRender(z);this._needsReshuffle&&z.reshuffleManager.schedule(this)}tryReady(z){const t=this._invalidated&&!this._uploadAllowed;return!this.isReady&&!t&&this._encounteredEnd&&z>=this._attributeEpoch?(r("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.ready [epoch=${z}]`),this.ready(),this.requestRender(),
!0):!1}get labelMetrics(){return this._metrics}get hasData(){return!!this._meshes.size}get hasAnimations(){return!!this._objectIdMap}get needsUpload(){return this._invalidated}get _uploadAllowed(){return!this.enableDeferredUploads||this._nextUploadAllowed}upload(){this._nextUploadAllowed=!0}getDisplayList(z,t){if(this._uploadAllowed&&this._invalidated){this._entities.sort((w,x)=>{const B=x.sortKey,C=w.sortKey;return C===B?w.id-x.id:C-B});t===d.FeatureBatchingStrategy.BATCHING&&this.reshuffle(!0);
this._displayList=a.DisplayList.fromDisplayEntities(this._entities,this,z,t);for(const w of this._meshes.values())w.upload();this.debugInfo.display.length=this._displayList.length;this.debugInfo.display.minOrderedLength=this._displayList.minOrderedLength;this.debugInfo.display.minUnorderedLength=this._displayList.minUnorderedLength;this.requestRender();this._nextUploadAllowed=this._invalidated=!1}return this._displayList}getMesh(z){if(!this._meshes.has(z))throw Error(`InternalError: Unable to find VAO for instance: ${z}`);
return this._meshes.get(z)}getSortKeys(z){const t=new Map;for(const {id:w,sortKey:x}of this._entities)if(z.has(w)&&t.set(w,x),t.size===z.size)break;return t}onMessage(z){if(z.objectIdMap)for(const t in z.objectIdMap)this._objectIdMap||(this._objectIdMap={}),this._objectIdMap[t]=z.objectIdMap[t];switch(z.type){case "append":this._onAppendMessage(z);break;case "update":this._onUpdateMessage(z)}this._aggregateMemoryStats();this.requestRender();if(z.end){r("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.end [epoch=${z.attributeEpoch}]`);
if(!z.attributeEpoch)throw Error("InternalError: Attribute epoch not defined.");this._attributeEpoch=z.attributeEpoch;this._encounteredEnd=!0}}_onAppendMessage(z){r("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.append`,{append:q.debugMeshDataInfo(z?.append)});z.clear&&this.clear();if(z.append){var t=h.deserializeList(new c(z.append.entities),l);this._insert(t,z.append.data,!1)}}_onUpdateMessage(z){r("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.update`,
{isPixelBuffer:z.isPixelBuffer,modify:q.debugMeshDataInfo(z.modify),remove:z.remove});const t=h.deserializeList(new c(z.modify.entities),l);var w=t.map(B=>B.id);const x=z.isPixelBuffer??!1;w=[...z.remove,...w];x?this._removeByIdsFromBuffer(w):this._removeByIds(w);this._insert(t,z.modify.data,x)}reshuffle(z=!1){if(!this.destroyed){var t=new Map;for(const w of this._entities)for(const x of w.records){const B=this._meshes.get(x.instanceId);let C=t.get(B);C||(C=new b.ReshufflePlan(z),t.set(B,C));C.copyRecord(x)}for(const [w,
x]of t)w.reshuffle(x);this._invalidated=!0;this._aggregateMemoryStats();r("esri-2d-update-debug")&&p.getLogger("esri.views.2d.engine.webgl.FeatureTile").info(`Tile ${this.key.id} was reshuffled.`)}}copyPixelBufferedEntitesFrom(z,t,w,x){w*=m.tileSize;x*=m.tileSize;for(const C of z._entities){let y=null;for(const v of C.records)if(v.overlaps&t){var B=z.getMesh(v.instanceId);B=this._ensureMesh(v.instanceId,B.layout).copyRecordFrom(B,v,w,x);y||(y=new l(C.id,C.sortKey),this._entityIdsFromBuffer.add(C.id),
this._entities.push(y));y.records.push(B)}}this._invalidated=!0}_ensureMesh(z,t){this._meshes.has(z)||this._meshes.set(z,new g.MappedMesh(this._stage.bufferPool,t));return this._meshes.get(z)}_insert(z,t,w){if(z.length){this._removeDuplicatedBufferedEntites(z);t=this._insertVertexData(t);for(const x of z){for(const B of x.records)B.updateBaseOffsets(t.get(B.instanceId));w?this._tryInsertBufferedEntity(x):this._insertEntity(x)}this._invalidated=!0}}_insertVertexData(z){const t=new Map;for(const w of z){const {instanceId:x,
layout:B}=w;z=this._ensureMesh(x,B).append(w);if(w.metrics){const C=h.deserializeList(new c(w.metrics),f.LabelMetric)??[];this._metrics.push(...C)}t.set(x,z)}return t}_insertEntity(z){r("esri-2d-update-debug")&&this._entityIds.has(z.id)&&console.error(`Tile ${this.key.id} insertEnitty: Already have entityId ${z.id}`);this._entityIds.add(z.id);this._entities.push(z)}_tryInsertBufferedEntity(z){this._entityIds.has(z.id)?this._removeRecordsFromMesh(z.records):(this._entityIdsFromBuffer.add(z.id),this._entities.push(z))}_removeDuplicatedBufferedEntites(z){if(this._entityIdsFromBuffer.size){var t=
[];for(const w of z)this._entityIdsFromBuffer.has(w.id)&&t.push(w.id);this._removeByIds(t)}}_removeByIdsFromBuffer(z){this._removeByIds(z.filter(t=>this._entityIdsFromBuffer.has(t)))}_removeByIds(z){if(0!==z.length){z=new Set(z);var t=[];for(const w of this._entities)z.has(w.id)?this._remove(w):t.push(w);this._entities=t;this._invalidated=!0}}_remove(z){this._removeRecordsFromMesh(z.records);this._entityIds.delete(z.id);this._entityIdsFromBuffer.delete(z.id);for(let t=this._metrics.length-1;0<=t;t--)this._metrics[t].entityTexel===
z.id&&this._metrics.splice(t,1)}_removeRecordsFromMesh(z){for(const t of z){const {instanceId:w,indexStart:x,indexCount:B,vertexStart:C,vertexCount:y}=t;this._meshes.get(w)?.remove(x,B,C,y)}}_aggregateMemoryStats(){this.debugInfo.memory.bytesUsed=0;this.debugInfo.memory.bytesReserved=0;for(const z of this._meshes.values())this.debugInfo.memory.bytesUsed+=z.memoryStats.bytesUsed,this.debugInfo.memory.bytesReserved+=z.memoryStats.bytesReserved}get _needsReshuffle(){if(this.destroyed)return!1;const {bytesUsed:z,
bytesReserved:t}=this.debugInfo.memory,{minOrderedLength:w,length:x}=this.debugInfo.display;return t>m.RESHUFFLING_EXEMPT_MEMORY_BYTES&&z/t<m.RESHUFFLING_TARGET_MEMORY_EFFICIENCY||x>m.RESHUFFLING_EXEMPT_DRAW_CALLS&&w/x<m.RESHUFFLING_TARGET_DRAW_EFFICIENCY?!0:!1}get entityIds(){return this._objectIdMap?this._entities.map(({id:z})=>({objectId:this._objectIdMap[z],displayId:z})):[]}}k.FeatureTile=A;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/AFeatureTile":function(){define("exports ../../../../core/libs/gl-matrix-2/math/mat2d ../../../../core/libs/gl-matrix-2/factories/mat2df32 ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f32 ./definitions ./TiledDisplayObject".split(" "),
function(k,r,p,e,n,m,l,d,a){const b=n.create(),f=l.create();class g extends a.TiledDisplayObject{constructor(q,c,h,u){super(q,c,h,u,d.tileSize,d.tileSize)}destroy(){super.destroy()}setTransform(q){var c=this.resolution/q.resolution,h=this.transforms.tileMat3;const [u,A]=q.toScreenNoRotation([0,0],[this.x,this.y]),z=this.width/this.rangeX*c;c*=this.height/this.rangeY;e.set(h,z,0,0,0,c,0,u,A,1);e.multiply(this.transforms.displayViewScreenMat3,q.displayViewMat3,h);h=r.set(p.create(),z,0,0,c,u,A);r.multiply(this.transforms.labelMat2d,
q.viewMat2d,h)}_createTransforms(){return{labelMat2d:p.create(),tileMat3:n.create(),displayViewScreenMat3:n.create()}}containsScreenPoint(q,c,h){var u=e.multiply(b,q.viewMat3,this.transforms.tileMat3);u=e.invert(b,u);if(null==u)return!0;m.set(f,...c,1);c=m.transformMat3(f,f,u);q=this.resolution/q.resolution*h;return c[0]>=-q&&c[0]<this.width+q&&c[1]>=-q&&c[1]<this.height+q}}k.AFeatureTile=g;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/vec3f32":function(){define(["exports"],
function(k){function r(){return new Float32Array(3)}function p(A){const z=new Float32Array(3);z[0]=A[0];z[1]=A[1];z[2]=A[2];return z}function e(A,z,t){const w=new Float32Array(3);w[0]=A;w[1]=z;w[2]=t;return w}function n(A,z){return new Float32Array(A,z,3)}function m(){return r()}function l(){return e(1,1,1)}function d(){return e(1,0,0)}function a(){return e(0,1,0)}function b(){return e(0,0,1)}const f=r(),g=l(),q=d(),c=a(),h=b(),u=Object.freeze(Object.defineProperty({__proto__:null,ONES:g,UNIT_X:q,
UNIT_Y:c,UNIT_Z:h,ZEROS:f,clone:p,create:r,createView:n,fromValues:e,ones:l,unitX:d,unitY:a,unitZ:b,zeros:m},Symbol.toStringTag,{value:"Module"}));k.ONES=g;k.UNIT_X=q;k.UNIT_Y=c;k.UNIT_Z=h;k.ZEROS=f;k.clone=p;k.create=r;k.createView=n;k.fromValues=e;k.ones=l;k.unitX=d;k.unitY=a;k.unitZ=b;k.vec3f32=u;k.zeros=m;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TiledDisplayObject":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/mat3","../DisplayObject",
"../../tiling/TileKey"],function(k,r,p,e){class n extends p.DisplayObject{constructor(m,l,d,a,b,f,g=b,q=f){super();this.tileDebugInfoTexture=null;this.debugInfo={display:{length:0,minOrderedLength:0,minUnorderedLength:0,triangleCount:0},memory:{bytesUsed:0,bytesReserved:0}};this._destroyed=!1;this.key=new e(m);this.resolution=l;this.x=d;this.y=a;this.width=b;this.height=f;this.rangeX=g;this.rangeY=q}destroy(){this.tileDebugInfoTexture&&(this.tileDebugInfoTexture.dispose(),this.tileDebugInfoTexture=
null);this._destroyed=!0}get debugSlot(){let m=this;for(;m.parent!==this._stage;){if(!m.parent)return 0;m=m.parent}return this._stage.children.indexOf(m)}setTransform(m){const l=this.resolution/(m.resolution*m.pixelRatio),d=this.transforms.tileMat3,[a,b]=m.toScreenNoRotation([0,0],[this.x,this.y]);r.set(d,this.width/this.rangeX*l,0,0,0,this.height/this.rangeY*l,0,a,b,1);r.multiply(this.transforms.displayViewScreenMat3,m.displayViewMat3,d)}get destroyed(){return this._destroyed}}k.TiledDisplayObject=
n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/DisplayEntity":function(){define(["./DisplayRecord","./util/serializationUtils"],function(k,r){class p{constructor(e,n){this.id=e;this.sortKey=n;this.records=[]}serialize(e){e.push(this.id);e.writeF32(this.sortKey);r.serializeList(e,this.records);return e}static deserialize(e){var n=e.readInt32();const m=e.readF32();n=new p(n,m);n.records=r.deserializeList(e,k)??[];return n}}p.byteSizeHint=2*Uint32Array.BYTES_PER_ELEMENT+
k.byteSizeHint;return p})},"esri/views/2d/engine/webgl/DisplayRecord":function(){define(function(){class k{constructor(r,p,e,n,m,l,d){this.instanceId=r;this.textureKey=p;this.indexStart=e;this.indexCount=n;this.vertexStart=m;this.vertexCount=l;this.overlaps=d}updateBaseOffsets(r){this.vertexStart+=r.vertexFrom;this.indexStart+=r.indexFrom}clone(){return new k(this.instanceId,this.textureKey,this.indexStart,this.indexCount,this.vertexStart,this.vertexCount,this.overlaps)}static write(r,p,e,n,m,l,d,
a){r.push(p);r.push(e);r.push(n);r.push(m);r.push(l);r.push(d);r.push(a)}serialize(r){r.push(this.instanceId);r.push(this.textureKey);r.push(this.indexStart);r.push(this.indexCount);r.push(this.vertexStart);r.push(this.vertexCount);r.push(this.overlaps);return r}static deserialize(r){const p=r.readInt32(),e=r.readInt32(),n=r.readInt32(),m=r.readInt32(),l=r.readInt32(),d=r.readInt32();r=r.readInt32();return new k(p,e,n,m,l,d,r)}}k.byteSizeHint=7*Uint32Array.BYTES_PER_ELEMENT;return k})},"esri/views/2d/engine/webgl/util/serializationUtils":function(){define(["exports"],
function(k){k.deserializeList=function(r,p,e){var n=r.readInt32();n=Array(n);for(let m=0;m<n.length;m++)n[m]=p.deserialize(r,e);return n};k.serializeList=function(r,p){if(null===p)r.push(0);else{r.push(p.length);for(const e of p)e.serialize(r);return r}};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/FeatureDisplayList":function(){define("exports ../../../../core/has ./enums ./cpuMapped/FreeList ./shaderGraph/techniques/featureTechniqueUtils ../../../webgl/enums".split(" "),
function(k,r,p,e,n,m){class l{constructor(a,b,f,g,q){this.instance=a;this.materialKey=b;this.target=f;this.start=g;this.count=q}get textureKey(){return this.materialKey&255}get indexEnd(){return this.start+this.count}extend(a){this.count+=a}render(a){this.instance.techniqueRef.render(a,this)}getStencilReference(){return this.target.stencilRef}getAttributePrecisionPackFactors(){return this.target.getMesh(this.instance.instanceId).getAttributePrecisionPackFactors()}draw(a,b){n.isHittest(a)?this.drawCompute(a.context,
b):this.drawGeometry(a.context,b)}drawCompute(a,b){b=this.target.getMesh(this.instance.instanceId).getComputeVAO(a,b);const f=this.start*Uint32Array.BYTES_PER_ELEMENT/3;a.bindVAO(b);a.drawElements(m.PrimitiveType.POINTS,this.count/3,m.DataType.UNSIGNED_INT,f);a.bindVAO(null)}drawGeometry(a,b){b=this.target.getMesh(this.instance.instanceId).getGeometryVAO(a,b);const f=this.start*Uint32Array.BYTES_PER_ELEMENT;a.bindVAO(b);a.drawElements(m.PrimitiveType.TRIANGLES,this.count,m.DataType.UNSIGNED_INT,f);
a.bindVAO(null)}}class d{constructor(){this._minOrderedLength=this._length=0;this._materialKeys=new Set}static fromDisplayEntities(a,b,f,g){const q=new d;for(const c of a.values())for(const h of c.records)a=f.getInstance(h.instanceId),q.addRecord(a,a.instanceId<<16|h.textureKey&255,h.indexStart,h.indexCount,h.vertexStart,h.vertexCount,b,g);return q}get length(){return this._length}get minOrderedLength(){return this._minOrderedLength}get minUnorderedLength(){return this._materialKeys.size}render(a,
b){const {drawPhase:f}=a;for(const g of this.infos()){const q=g.instance.techniqueRef;q.drawPhase&f&&(null==b||q.type===b)&&g.render(a)}}addRecord(a,b,f,g,q,c,h,u){g||(f=q,g=c);if(g)if(null==this._head)a=new l(a,b,h,f,g),this._tail=this._head=new e.List(a),this._length++,this._minOrderedLength++;else{if(u===p.FeatureBatchingStrategy.STRICT_ORDER)return this._insert(a,b,h,f,g,this._tail,null);q=null;c=this._head;var A=a.instanceId,z=a.techniqueRef.symbologyPlane;if(u===p.FeatureBatchingStrategy.STRICT_MARKERS_AND_TEXT&&
(z===p.FeatureSymbologyDrawOrder.MARKER||z===p.FeatureSymbologyDrawOrder.TEXT))return this._insert(a,b,h,f,g,this._tail,null);for(;c;){u=c.data.instance;const t=u.instanceId,w=q?.data.instance.instanceId;if(z<u.techniqueRef.symbologyPlane||A===w&&A!==t)return this._insert(a,b,h,f,g,q,c);q=c;c=c.next}this._insert(a,b,h,f,g,q,null)}}*infos(){if(null!=this._head)for(const a of this._head.values())yield a}_insert(a,b,f,g,q,c,h){if(null==c&&null==h)a=new l(a,b,f,g,q),this._tail=this._head=new e.List(a),
this._length++,this._minOrderedLength++;else{b!==this._tail.data.materialKey&&this._minOrderedLength++;this._materialKeys.add(b);if(null==c&&null!=h)return this._insertAtHead(a,b,f,g,q,h);if(null!=c&&null==h)return this._insertAtEnd(a,b,f,g,q,c);if(null!=c&&null!=h)return this._insertAtMiddle(a,b,f,g,q,c,h)}}_insertAtHead(a,b,f,g,q,c){b===c.data.materialKey&&f===c.data.target&&g+q===c.data.start?(c.data.start=g,c.data.count+=q):(a=new l(a,b,f,g,q),this._head=new e.List(a),this._head.next=c,this._length++)}_insertAtEnd(a,
b,f,g,q,c){c.data.materialKey===b&&c.data.indexEnd===g?c.data.count+=q:(a=new l(a,b,f,g,q),this._tail=new e.List(a),c.next=this._tail,this._length++)}_insertAtMiddle(a,b,f,g,q,c,h){c.data.materialKey===b&&c.data.target===f&&c.data.indexEnd===g?(c.data.count+=q,c.data.materialKey===h.data.materialKey&&c.data.target===h.data.target&&c.data.indexEnd===h.data.start&&(c.data.count+=h.data.count,c.next=h.next,this._length--)):b===h.data.materialKey&&f===h.data.target&&g+q===h.data.start?(h.data.start=g,
h.data.count+=q):(a=new l(a,b,f,g,q),a=new e.List(a),c.next=a,a.next=h,this._length++)}}k.DisplayList=d;k.DisplayListInfo=l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/cpuMapped/FreeList":function(){define(["exports"],function(k){class r{constructor(e){this.next=null;if(Array.isArray(e)){this.data=e[0];var n=this;for(let m=1;m<e.length;m++)n.next=new r([e[m]]),n=n.next}else this.data=e}*values(){let e=this;for(;e;)yield e.data,e=e.next}forEach(e){let n=
this;for(;n;)e(n.data),n=n.next}get last(){return this.next?this.next.last:this}}class p{constructor(e){this._head=null;null!=e&&(this._head=new r(e))}get head(){return this._head}maxAvailableSpace(){if(null==this._head)return 0;let e=0;this._head.forEach(n=>{e=Math.max(e,n.end-n.start)});return e}firstFit(e){if(null==this._head)return null;var n=null;let m=this._head;for(;m;){const l=m.data.end-m.data.start;if(l===e)return n?n.next=m.next:this._head=m.next,m.data.start;if(l>e)return n=m.data.start,
m.data.start+=e,n;n=m;m=m.next}return null}free(e,n){const m=e+n;if(null==this._head)this._head=new r({start:e,end:m});else if(m<=this._head.data.start)if(m===this._head.data.start)this._head.data.start-=n;else{var l=new r({start:e,end:m});l.next=this._head;this._head=l}else{l=this._head;for(var d=l.next;d;){if(d.data.start>=m){if(l.data.end===e){l.data.end+=n;l.data.end===d.data.start&&(l.data.end+=d.data.end-d.data.start,l.next=d.next);return}if(d.data.start===m){d.data.start-=n;return}e=new r({start:e,
end:m});e.next=l.next;l.next=e;return}l=d;d=d.next}e===l.data.end?l.data.end+=n:(e=new r({start:e,end:m}),l.next=e)}}clear(){this._head=null}}k.FreeList=p;k.List=r;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/ReshufflePlan":function(){define(["exports"],function(k){class r{constructor(p){this._indexOnly=p;this.vertex={count:0,operations:[]};this.index={count:0,operations:[]}}copyRecord(p){let e=0;this._indexOnly||(e=this.vertex.count-p.vertexStart,this.vertex.operations.push({srcFrom:p.vertexStart,
dstFrom:this.vertex.count,count:p.vertexCount,mutate:0}),p.vertexStart=this.vertex.count,this.vertex.count+=p.vertexCount);let n=!1;if(this._indexOnly&&1<=this.index.operations.length){const m=this.index.operations[this.index.operations.length-1];m.srcFrom+m.count===p.indexStart&&(m.count+=p.indexCount,n=!0)}n||this.index.operations.push({srcFrom:p.indexStart,dstFrom:this.index.count,count:p.indexCount,mutate:e});p.indexStart=this.index.count;this.index.count+=p.indexCount}}k.ReshufflePlan=r;Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/collisions/LabelMetric":function(){define(["exports","./BoundingBox","../util/serializationUtils"],function(k,r,p){class e{constructor(n,m,l,d,a,b,f,g,q=[]){this.entityTexel=n;this.anchorX=m;this.anchorY=l;this.directionX=d;this.directionY=a;this.maxScale=b;this.minScale=f;this.referenceBounds=g;this.bounds=q}serialize(n){n.push(this.entityTexel);n.writeF32(this.anchorX);n.writeF32(this.anchorY);n.writeF32(this.directionX);n.writeF32(this.directionY);
n.writeF32(this.maxScale);n.writeF32(this.minScale);null===this.referenceBounds?(n.writeF32(0),n.writeF32(0),n.writeF32(0)):(n.writeF32(this.referenceBounds.size),n.writeF32(this.referenceBounds.offsetX),n.writeF32(this.referenceBounds.offsetY));p.serializeList(n,this.bounds)}static deserialize(n){const m=n.readInt32(),l=n.readF32(),d=n.readF32(),a=n.readF32(),b=n.readF32(),f=n.readF32(),g=n.readF32(),q=n.readF32(),c=n.readF32(),h=n.readF32();n=p.deserializeList(n,r)??[];return new e(m,l,d,a,b,f,
g,{size:q,offsetX:c,offsetY:h},n)}}k.LabelMetric=e;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/cpuMapped/MappedMesh":function(){define("exports ../../../../../core/maybe ../number ./Buffer ../shaderGraph/techniques/mesh/dataViewUtils ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),function(k,r,p,e,n,m,l){function d(f,g){const q=f.attributes.filter(c=>g.locations.has(c.name)).map(c=>({name:c.name,type:c.type,count:c.count,divisor:0,
normalized:c.normalized??!1,offset:c.offset,stride:f.stride}));return new Map([["geometry",q]])}function a(f,g){const q=[];var c=f.attributes.filter(h=>g.locations.has(h.name));for(const h of c)q.push({name:h.name,type:h.type,count:h.count,divisor:0,normalized:h.normalized??!1,offset:h.offset,stride:f.stride}),c=g.computeAttributeMap[h.name],null!=c&&2===c.length&&(q.push({name:c[0],count:h.count,divisor:0,type:h.type,normalized:h.normalized??!1,offset:h.offset+f.stride,stride:f.stride}),q.push({name:c[1],
count:h.count,divisor:0,type:h.type,normalized:h.normalized??!1,offset:h.offset+2*f.stride,stride:f.stride}));return new Map([["geometry",q]])}class b{constructor(f,g){this._bufferPool=f;this._layout=g;this._invalidatedCompute=this._invalidatedGeometry=!1;this._position=this._layout.attributes.find(q=>"pos"===q.name||"position"===q.name);if(!this._position)throw Error("InternalError: Unable to find position attribute");}destroy(){this._indexBuffer=r.destroyMaybe(this._indexBuffer);this._vertexBuffer=
r.destroyMaybe(this._vertexBuffer);this._computeVAO?.disposeVAOOnly();this._geometryVAO?.disposeVAOOnly()}get layout(){return this._layout}getDrawArgs(f,g,q,c){return c?{primitive:m.PrimitiveType.POINTS,count:g/3,offset:q/3}:{primitive:f,count:g,offset:q}}getAttributePrecisionPackFactors(){const f={};for(const g of this.layout.attributes)g.packPrecisionFactor&&(f[g.name]=g.packPrecisionFactor);return f}getDebugVertexInfo(f=!1,g){if(!this._vertexBuffer)return null;const q=this._layout,c=q.stride;var h=
this._vertexBuffer.getView(0,this._vertexBuffer.byteSize);const u=[];if(f)if(null==g)console.log("must provide location info to see compute attributes");else for(var A of q.attributes){var z=g.computeAttributeMap[A.name];null!=z&&2===z.length&&(u.push({...A,name:z[0],offset:A.offset+c}),u.push({...A,name:z[1],offset:A.offset+2*c}))}g=new DataView(h.slice().buffer);h=h.byteLength/c;f&&(h=this._indexBuffer.fillPointer/3);A=this._indexBuffer.getView(0,this._indexBuffer.byteSize);z=0;const t=[];for(let w=
0;w<h;w++){f&&(z=A[3*w]*c);const x={};for(const B of[...q.attributes,...u]){let C=`${B.offset} ${B.name}`,y=n.unpackDataView(g,B,z);if(B.packPrecisionFactor)if(C+=` (precision: ${B.packPrecisionFactor})`,"number"===typeof y)y/=B.packPrecisionFactor;else for(let v=0;v<y.length;v++)y[v]/=B.packPrecisionFactor;x[C]=y}z+=c;t.push(x)}return{vertices:t,layout:q}}_ensure(f,g){if(this._vertexBuffer&&this._indexBuffer)this._indexBuffer.ensure(Math.max(f,1E3)),this._vertexBuffer.ensure(Math.max(g,1E3));else{const q=
this._layout.stride/Uint32Array.BYTES_PER_ELEMENT;this._indexBuffer=new e.MappedBuffer("index",Math.max(f,1E3),1,this._bufferPool);this._vertexBuffer=new e.MappedBuffer("vertex",Math.max(g,1E3),q,this._bufferPool)}}append(f){var g=f.layout.stride;this._ensure(f.indices.byteLength/Uint32Array.BYTES_PER_ELEMENT,f.vertices.byteLength/g);const {vertices:q,indices:c}=f;f=this._vertexBuffer.insert(q,0,q.byteLength/g,0);g=this._indexBuffer.insert(c,0,c.byteLength/4,f);return{vertexFrom:f,indexFrom:g}}copyRecordFrom(f,
g,q,c){const {indexStart:h,indexCount:u,vertexStart:A,vertexCount:z}=g;this._ensure(u,z);const t=f._position;var w=t.offset;q=p.i1616to32(q*(t.packPrecisionFactor??1),c*(t.packPrecisionFactor??1));w=this._vertexBuffer.copyFrom(f._vertexBuffer,A,z,q,w);f=this._indexBuffer.copyFrom(f._indexBuffer,h,u,w-A,0);g=g.clone();g.vertexStart=w;g.indexStart=f;g.overlaps=0;return g}remove(f,g,q,c){this._indexBuffer.free(f,g);this._vertexBuffer.free(q,c)}upload(){this._invalidatedCompute=this._invalidatedGeometry=
!0}getGeometryVAO(f,g){if(!this._vertexBuffer||!this._indexBuffer||!this._vertexBuffer.bufferSize)return null;if(this._invalidatedGeometry){if(this._vertexBuffer.invalidated||this._indexBuffer.invalidated)this._vertexBuffer.invalidate(),this._indexBuffer.invalidate(),this._geometryVAO?.disposeVAOOnly(),this._geometryVAO=null;this._vertexBuffer.upload();this._indexBuffer.upload();const q=this._indexBuffer.getGPUBuffer(f,!1),c=this._vertexBuffer.getGPUBuffer(f);this._geometryVAO||(this._geometryVAO=
new l.VertexArrayObject(f,g.locations,d(this.layout,g),new Map([["geometry",c]]),q));this._invalidatedGeometry=!1}return this._geometryVAO}getComputeVAO(f,g){if(!this._vertexBuffer||!this._indexBuffer||!this._vertexBuffer.bufferSize)return null;if(this._invalidatedCompute){if(this._vertexBuffer.invalidated||this._indexBuffer.invalidatedComputeBuffer)this._vertexBuffer.invalidate(),this._indexBuffer.invalidate(),this._computeVAO?.disposeVAOOnly(),this._computeVAO=null;this._vertexBuffer.upload();this._indexBuffer.upload();
const q=this._indexBuffer.getGPUBuffer(f,!0),c=this._vertexBuffer.getGPUBuffer(f);this._computeVAO||(this._computeVAO=new l.VertexArrayObject(f,g.locations,a(this.layout,g),new Map([["geometry",c]]),q),this._invalidatedCompute=!1)}return this._computeVAO}get memoryStats(){return{bytesUsed:this._vertexBuffer.memoryStats.bytesUsed+this._indexBuffer.memoryStats.bytesUsed,bytesReserved:this._vertexBuffer.memoryStats.bytesReserved+this._indexBuffer.memoryStats.bytesReserved,vertex:this._vertexBuffer.memoryStats,
index:this._indexBuffer.memoryStats}}reshuffle(f){this._vertexBuffer&&this._vertexBuffer.reshuffle(f.vertex.count,f.vertex.operations);this._indexBuffer&&this._indexBuffer.reshuffle(f.index.count,f.index.operations)}}k.MappedMesh=b;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/number":function(){define(["exports"],function(k){function r(m,l,d){return Math.round(Math.max(Math.min(m,d),l))}function p(m){e[0]=m;return n[0]}const e=new Float32Array(1),n=new Uint32Array(e.buffer);
k.fromUint16=function(m){let l,d;l=(m>>10&31)-15;d=(m&1023)/1024;-15<l?d+=1:l=-14;return(m>>>15?-1:1)*2**l*d};k.i16=function(m){return r(m,-32768,32767)};k.i1616to32=function(m,l){return 65535&m|l<<16};k.i32=function(m){return r(m,-2147483648,2147483647)};k.i8=function(m){return r(m,-128,127)};k.i8816to32=function(m,l,d){return m&255|(l&255)<<8|d<<16};k.i8888to32=function(m,l,d,a){return m&255|(l&255)<<8|(d&255)<<16|a<<24};k.numTo32=function(m){return m|0};k.toFloat32=function(m){n[0]=m;return e[0]};
k.toUint16=function(m){var l=p(m);m=l>>>31;var d=l&8388607;l=(l>>>23&255)-127;if(15<l)return m<<15|31744;if(-25>l)return 0;-14>l&&(d=(d+8388608)/2**(-14-l),l=-15);var a=d/8192;d=Math.floor(a);a-=d;d=1023>d&&(.5<a||.5===a&&1===d%2)?d+1:d;return m<<15|l+15<<10|d};k.toUint32=p;k.u16=function(m){return r(m,0,65535)};k.u32=function(m){return r(m,0,4294967295)};k.u32to4Xu8=function(m){return[m&255,(m&65280)>>>8,(m&16711680)>>>16,(m&4278190080)>>>24]};k.u4u4to8=function(m,l){return 15&m|(15&l)<<4};k.u8=
function(m){return r(m,0,255)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/cpuMapped/Buffer":function(){define("exports ../../../../../core/has ../../../../../core/maybe ../PooledUint32Array ./FreeList ../../../../webgl/BufferObject ../../../../webgl/enums".split(" "),function(k,r,p,e,n,m,l){class d{constructor(a,b,f,g){this._pool=g;g=e.PooledUint32Array.create(b*f*Uint32Array.BYTES_PER_ELEMENT,this._pool);this.size=b;this.strideInt=f;this.bufferType=
a;this.dirty={start:Infinity,end:0};this.memoryStats={bytesUsed:0,bytesReserved:b*f*Uint32Array.BYTES_PER_ELEMENT};this._gpu=null;this._cpu=g;this.clear()}get elementSize(){return this._cpu.length/this.strideInt}get intSize(){return this.fillPointer*this.strideInt}get byteSize(){return this.intSize*Uint32Array.BYTES_PER_ELEMENT}get invalidated(){return 0<this.bufferSize&&!this._gpu}get invalidatedComputeBuffer(){return 0<this.bufferSize&&!this._gpuComputeTriangles}invalidate(){this._invalidateTriangleBuffer();
this._gpu?.dispose();this._gpu=null}_invalidateTriangleBuffer(){this._gpuComputeTriangles?.dispose();this._gpuComputeTriangles=null}destroy(){this._gpu?.dispose();this._gpuComputeTriangles?.dispose();this._cpu?.destroy()}clear(){this.dirty.start=Infinity;this.dirty.end=0;this.freeList=new n.FreeList({start:0,end:this._cpu.length/this.strideInt});this.fillPointer=0}ensure(a){if(!(this.maxAvailableSpace()>=a)&&a*this.strideInt>this._cpu.length-this.fillPointer){this.invalidate();const b=this._cpu.length/
this.strideInt;a=Math.round(1.25*(b+a));this._cpu.expand(a*this.strideInt*Uint32Array.BYTES_PER_ELEMENT);this.freeList.free(b,a-b);this.memoryStats.bytesReserved+=(a-b)*this.strideInt*Uint32Array.BYTES_PER_ELEMENT}}set(a,b){this._cpu.array[a]!==b&&(this._cpu.array[a]=b,this.dirty.start=Math.min(a,this.dirty.start),this.dirty.end=Math.max(a+1,this.dirty.end))}getGPUBuffer(a,b=!1){if(!this.bufferSize)return null;if(b){if("index"!==this.bufferType)throw Error("Tired to get triangle buffer, but target is not an index buffer");
null==this._gpuComputeTriangles&&(this._gpuComputeTriangles=this._createComputeBuffer(a));return this._gpuComputeTriangles}null==this._gpu&&(this._gpu=this._createBuffer(a));return this._gpu}getView(a,b){return this._cpu.getUint32View(a,b/Uint32Array.BYTES_PER_ELEMENT)}get bufferSize(){return this._cpu.length/this.strideInt}maxAvailableSpace(){return this.freeList.maxAvailableSpace()}insert(a,b,f,g){const q=f*this.strideInt;if(!q)return 0;a=new Uint32Array(a,b*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,
q);b=this.freeList.firstFit(f);p.assertIsSome(b,"First fit region must be defined");const c=b*this.strideInt;this._cpu.array.set(a,c);if(0!==g)for(let h=0;h<a.length;h++)this._cpu.array[h+c]+=g;this.dirty.start=Math.min(this.dirty.start,c);this.dirty.end=Math.max(this.dirty.end,c+q);this.fillPointer=Math.max(this.fillPointer,c+q);this.memoryStats.bytesUsed+=f*this.strideInt*Uint32Array.BYTES_PER_ELEMENT;return b}copyFrom(a,b,f,g,q){const c=f*this.strideInt;if(!c)return 0;var h=a._cpu.getUint32View(b*
this.strideInt*Uint32Array.BYTES_PER_ELEMENT,c);a=this.freeList.firstFit(f);p.assertIsSome(a,"First fit region must be defined");b=a*this.strideInt;this._cpu.array.set(h,b);if(0!==g)for(h=0;h<c;h++)this._cpu.array[b+h*this.strideInt+q]+=g;this.dirty.start=Math.min(this.dirty.start,b);this.dirty.end=Math.max(this.dirty.end,b+c);this.fillPointer=Math.max(this.fillPointer,b+c);this.memoryStats.bytesUsed+=f*this.strideInt*Uint32Array.BYTES_PER_ELEMENT;return a}free(a,b,f){const g=a*this.strideInt,q=(a+
b)*this.strideInt;if(!0===f)for(f=a;f!==a+b;f++)this._cpu.array[f*this.strideInt]=2147450879;this.dirty.start=Math.min(this.dirty.start,g);this.dirty.end=Math.max(this.dirty.end,q);this.freeList.free(a,b);this.memoryStats.bytesUsed-=b*this.strideInt*Uint32Array.BYTES_PER_ELEMENT}upload(){this.dirty.end&&(this._invalidateTriangleBuffer(),null!=this._gpu&&this._gpu.setSubData(this._cpu.array,this.dirty.start,this.dirty.start,this.dirty.end),this.dirty.start=Infinity,this.dirty.end=0)}reshuffle(a,b){if(0!==
b.length){a=a*this.strideInt*Uint32Array.BYTES_PER_ELEMENT;var f=this.byteSize>a,g=this._cpu,q=e.PooledUint32Array.create(a,this._pool);f||q.array.set(this._cpu.getUint32View(0,this.intSize));for(const c of b)if(f||c.srcFrom!==c.dstFrom||0!==c.mutate)for(this.dirty.start=Math.min(this.dirty.start,c.dstFrom*this.strideInt),this.dirty.end=Math.max(this.dirty.end,(c.dstFrom+c.count)*this.strideInt),b=0;b<c.count;b++){const h=(c.dstFrom+b)*this.strideInt,u=(c.srcFrom+b)*this.strideInt;for(let A=0;A<this.strideInt;A++)q.array[h+
A]=g.array[u+A]+c.mutate}this._cpu.destroy();this._cpu=q;f&&this.invalidate();this.freeList.clear();this.memoryStats.bytesUsed=this.memoryStats.bytesReserved=a}}_createBuffer(a){const b=l.Usage.DYNAMIC_DRAW;return"index"===this.bufferType?m.BufferObject.createIndex(a,b,this._cpu.array):m.BufferObject.createVertex(a,b,this._cpu.array)}_createComputeBuffer(a){const b=l.Usage.DYNAMIC_DRAW,f=new Uint32Array(this.fillPointer/3);for(let g=0;g<this.fillPointer;g+=3)f[g/3]=this._cpu.array[g];return m.BufferObject.createIndex(a,
b,f)}}k.MappedBuffer=d;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/PooledUint32Array":function(){define(["exports","../../../../core/has","../../../../core/maybe","./cpuMapped/FreeList"],function(k,r,p,e){const n=r("esri-2d-log-allocations");class m{static create(a,b){a=b.acquireUint32Array(a);return new m(a,b)}constructor(a,b){this._array=a;this._pool=b}get array(){return this._array}get length(){return this._array.length}getUint32View(a,b){return new Uint32Array(this._array.buffer,
a+this._array.byteOffset,b)}expand(a){a<=this._array.byteLength||(a=this._pool.acquireUint32Array(a),a.set(this._array),this._pool.releaseUint32Array(this._array),this._array=a)}destroy(){this._pool.releaseUint32Array(this._array)}}class l{constructor(){this._data=new ArrayBuffer(l.BYTE_LENGTH);this._freeList=new e.FreeList({start:0,end:this._data.byteLength})}static get BYTE_LENGTH(){return 16E6}get buffer(){return this._data}acquireUint32Array(a){const b=this._freeList.firstFit(a);return null==
b?null:new Uint32Array(this._data,b,a/Uint32Array.BYTES_PER_ELEMENT)}releaseUint32Array(a){this._freeList.free(a.byteOffset,a.byteLength)}}class d{constructor(){this._pages=[];this._pagesByBuffer=new Map;this._bytesAllocated=0}destroy(){this._pages=[];this._pagesByBuffer=null}get _bytesTotal(){return this._pages.length*l.BYTE_LENGTH}acquireUint32Array(a){this._bytesAllocated+=a;n&&console.log(`Allocating ${a}, (${this._bytesAllocated} / ${this._bytesTotal})`);if(a>=l.BYTE_LENGTH)return new Uint32Array(a/
Uint32Array.BYTES_PER_ELEMENT);for(const b of this._pages){const f=b.acquireUint32Array(a);if(null!=f)return f}a=this._addPage().acquireUint32Array(a);p.assertIsSome(a,"Expected to allocate page");return a}releaseUint32Array(a){this._bytesAllocated-=a.byteLength;n&&console.log(`Freeing ${a.byteLength}, (${this._bytesAllocated} / ${this._bytesTotal})`);const b=this._pagesByBuffer.get(a.buffer);b&&b.releaseUint32Array(a)}_addPage(){const a=new l;this._pages.push(a);this._pagesByBuffer.set(a.buffer,
a);return a}}k.ArrayBufferPool=d;k.PooledUint32Array=m;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/dataViewUtils":function(){define(["exports","../../../number","../../../../../../webgl/enums"],function(k,r,p){k.packDataView=function(e,n,m,l){const d=m.packPrecisionFactor??1;switch(m.type){case p.DataType.BYTE:if(1===m.count)e.setInt8(l+m.offset,n*d);else for(var a=0;a<m.count;a++)e.setInt8(l+m.offset+a*Int8Array.BYTES_PER_ELEMENT,
n[a]*d);break;case p.DataType.UNSIGNED_BYTE:if(1===m.count)e.setUint8(l+m.offset,n*d);else for(a=0;a<m.count;a++)e.setUint8(l+m.offset+a*Uint8Array.BYTES_PER_ELEMENT,n[a]*d);break;case p.DataType.SHORT:if(1===m.count)e.setInt16(l+m.offset,n*d,!0);else for(a=0;a<m.count;a++)e.setInt16(l+m.offset+a*Int16Array.BYTES_PER_ELEMENT,n[a]*d,!0);break;case p.DataType.UNSIGNED_SHORT:if(1===m.count)e.setUint16(l+m.offset,n*d,!0);else for(a=0;a<m.count;a++)e.setUint16(l+m.offset+a*Uint16Array.BYTES_PER_ELEMENT,
n[a]*d,!0);break;case p.DataType.INT:if(1===m.count)e.setInt32(l+m.offset,n*d,!0);else for(a=0;a<m.count;a++)e.setInt32(l+m.offset+a*Int32Array.BYTES_PER_ELEMENT,n[a]*d,!0);break;case p.DataType.UNSIGNED_INT:if(1===m.count)e.setUint32(l+m.offset,n*d,!0);else for(a=0;a<m.count;a++)e.setUint32(l+m.offset+a*Uint32Array.BYTES_PER_ELEMENT,n[a]*d,!0);break;case p.DataType.FLOAT:if(1===m.count)e.setFloat32(l+m.offset,n*d,!0);else for(a=0;a<m.count;a++)e.setFloat32(l+m.offset+a*Float32Array.BYTES_PER_ELEMENT,
n[a]*d,!0);break;case p.DataType.HALF_FLOAT:if(1===m.count)e.setUint16(l+m.offset,r.toUint16(n*d),!0);else for(a=0;a<m.count;a++)e.setUint16(l+m.offset+a*Uint16Array.BYTES_PER_ELEMENT,r.toUint16(n[a]*d),!0)}};k.unpackDataView=function(e,n,m){switch(n.type){case p.DataType.BYTE:if(1===n.count)return e.getInt8(m+n.offset);var l=[];for(var d=0;d<n.count;d++)l.push(e.getInt8(m+n.offset+d*Int8Array.BYTES_PER_ELEMENT));return l;case p.DataType.UNSIGNED_BYTE:if(1===n.count)return e.getUint8(m+n.offset);
l=[];for(d=0;d<n.count;d++)l.push(e.getUint8(m+n.offset+d*Uint8Array.BYTES_PER_ELEMENT));return l;case p.DataType.SHORT:if(1===n.count)return e.getInt16(m+n.offset,!0);l=[];for(d=0;d<n.count;d++)l.push(e.getInt16(m+n.offset+d*Int16Array.BYTES_PER_ELEMENT,!0));return l;case p.DataType.UNSIGNED_SHORT:if(1===n.count)return e.getUint16(m+n.offset,!0);l=[];for(d=0;d<n.count;d++)l.push(e.getUint16(m+n.offset+d*Uint16Array.BYTES_PER_ELEMENT,!0));return l;case p.DataType.INT:if(1===n.count)return e.getInt32(m+
n.offset,!0);l=[];for(d=0;d<n.count;d++)l.push(e.getInt32(m+n.offset+d*Int32Array.BYTES_PER_ELEMENT,!0));return l;case p.DataType.UNSIGNED_INT:if(1===n.count)return e.getUint32(m+n.offset,!0);l=[];for(d=0;d<n.count;d++)l.push(e.getUint32(m+n.offset+d*Uint32Array.BYTES_PER_ELEMENT,!0));return l;case p.DataType.FLOAT:if(1===n.count)return e.getFloat32(m+n.offset,!0);l=[];for(d=0;d<n.count;d++)l.push(e.getFloat32(m+n.offset+d*Float32Array.BYTES_PER_ELEMENT,!0));return l;case p.DataType.HALF_FLOAT:if(1===
n.count)return r.fromUint16(e.getUint16(m+n.offset,!0));l=[];for(d=0;d<n.count;d++)l.push(r.fromUint16(e.getUint16(m+n.offset+d*Uint16Array.BYTES_PER_ELEMENT,!0)));return l}};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/meshDebugUtils":function(){define(["exports","../DisplayEntity","../shaderGraph/techniques/mesh/dataViewUtils","../util/Reader","../util/serializationUtils"],function(k,r,p,e,n){function m(l){const d=l.layout.stride,a=new DataView(l.vertices),
b=[],f=l.vertices.byteLength/d;let g=0;for(let q=0;q<f;q++){const c={};for(const h of l.layout.attributes){let u=`${h.offset} ${h.name}`,A=p.unpackDataView(a,h,g);if(h.packPrecisionFactor)if(u+=` (precision: ${h.packPrecisionFactor})`,"number"===typeof A)A/=h.packPrecisionFactor;else for(let z=0;z<A.length;z++)A[z]/=h.packPrecisionFactor;c[u]=A}g+=d;b.push(c)}return{vertices:b,layout:l.layout}}k.debugMeshDataInfo=function(l){if(!l)return null;const d=n.deserializeList(new e(l.entities),r);l=l.data.map(m);
return{entities:d,vertexData:l}};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/Reader":function(){define(function(){class k{constructor(r){this._pos=0;this._buffer=r;this._i32View=new Int32Array(this._buffer);this._f32View=new Float32Array(this._buffer)}readInt32(){return this._i32View[this._pos++]}readF32(){return this._f32View[this._pos++]}}return k})},"esri/views/2d/engine/webgl/shaders/TileInfoPrograms":function(){define(["exports","./sources/resolver"],
function(k,r){r={shaders:{vertexShader:r.resolveIncludes("tileInfo/tileInfo.vert"),fragmentShader:r.resolveIncludes("tileInfo/tileInfo.frag")},attributes:new Map([["a_pos",0]])};k.tileInfo=r;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLBackground":function(){define("exports ../../../../../core/mathUtils ../../../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../../../core/libs/gl-matrix-2/factories/vec4f32 ../definitions ./WGLBrush ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),
function(k,r,p,e,n,m,l,d,a){class b extends m{constructor(){super(...arguments);this._color=e.fromValues(1,0,0,1);this._patternMatrix=p.create();this._programOptions={id:!1,pattern:!1}}dispose(){this._vao&&(this._vao.dispose(),this._vao=null)}drawMany(f,g){const {context:q,painter:c,requestRender:h,allowDelayedRender:u}=f;this._loadWGLResources(f);const A=f.displayLevel;var z=f.styleLayer,t=z.backgroundMaterial;const w=c.vectorTilesMaterialManager;var x=z.getPaintValue("background-color",A),B=z.getPaintValue("background-opacity",
A);const C=z.getPaintValue("background-pattern",A),y=void 0!==C,v=f.spriteMosaic;let F,D;f=(window.devicePixelRatio|1)>n.vtlHighResCutoff?2:1;const G=this._programOptions;G.pattern=y;t=w.getMaterialProgram(q,t,G);if(u&&null!=h&&!t.compiled)h();else{q.bindVAO(this._vao);q.useProgram(t);if(y){x=v.getMosaicItemPosition(C,!0);if(null!=x){const {tl:E,br:H,page:K}=x;F=H[0]-E[0];D=H[1]-E[1];x=v.getPageSize(K);null!=x&&(v.bind(q,d.TextureSamplingMode.LINEAR,K,n.vtlTextureBindingUnitSprites),t.setUniform4f("u_tlbr",
E[0],E[1],H[0],H[1]),t.setUniform2fv("u_mosaicSize",x),t.setUniform1i("u_texture",n.vtlTextureBindingUnitSprites))}t.setUniform1f("u_opacity",B)}else B*=x[3],this._color[0]=B*x[0],this._color[1]=B*x[1],this._color[2]=B*x[2],this._color[3]=B,t.setUniform4fv("u_color",this._color);t.setUniform1f("u_depth",z.z||0);for(const E of g)t.setUniform1f("u_coord_range",E.rangeX),t.setUniformMatrix3fv("u_dvsMat3",E.transforms.displayViewScreenMat3),y&&(z=f*E.width*Math.max(2**(Math.round(A)-E.key.level),1),g=
z/r.nextPowerOfTwo(F),z/=r.nextPowerOfTwo(D),this._patternMatrix[0]=g,this._patternMatrix[4]=z,t.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)),q.setStencilFunction(d.CompareFunction.EQUAL,0,255),q.drawArrays(d.PrimitiveType.TRIANGLE_STRIP,0,4)}}_loadWGLResources(f){if(!this._vao){var {context:g,styleLayer:q}=f;f=q.backgroundMaterial;var c=new Int8Array([0,0,1,0,0,1,1,1]);c=l.BufferObject.createVertex(g,d.Usage.STATIC_DRAW,c);this._vao=new a.VertexArrayObject(g,f.getAttributeLocations(),
f.getLayoutInfo(),new Map([["geometry",c]]))}}}k.WGLBrushVTLBackground=b;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLCircle":function(){define(["exports","../../vectorTiles/style/StyleDefinition","./WGLBrush","../../../../webgl/enums"],function(k,r,p,e){class n extends p{constructor(){super(...arguments);this._programOptions={id:!1}}dispose(){}drawMany(m,l){const {context:d,displayLevel:a,requiredLevel:b,state:f,painter:g,spriteMosaic:q,
styleLayerUID:c,requestRender:h,allowDelayedRender:u}=m;if(l.some(x=>x.layerData.get(c)?.circleIndexCount??!1)){m=m.styleLayer;var A=m.circleMaterial,z=g.vectorTilesMaterialManager,t=m.getPaintValue("circle-translate",a),w=m.getPaintValue("circle-translate-anchor",a);z=z.getMaterialProgram(d,A,this._programOptions);if(u&&null!=h&&!z.compiled)h();else{d.useProgram(z);z.setUniformMatrix3fv("u_displayMat3",w===r.TranslateAnchor.VIEWPORT?f.displayMat3:f.displayViewMat3);z.setUniform2fv("u_circleTranslation",
t);z.setUniform1f("u_depth",m.z);z.setUniform1f("u_antialiasingWidth",1.2);t=-1;for(const x of l)x.layerData.has(c)&&(x.key.level!==t&&(t=x.key.level,A.setDataUniforms(z,a,m,t,q)),l=x.layerData.get(c),l.circleIndexCount&&(l.prepareForRendering(d),w=l.vao,null!=w&&(d.bindVAO(w),z.setUniformMatrix3fv("u_dvsMat3",x.transforms.displayViewScreenMat3),b!==x.key.level?d.setStencilFunction(e.CompareFunction.EQUAL,x.stencilRef,255):d.setStencilFunction(e.CompareFunction.GREATER,255,255),d.drawElements(e.PrimitiveType.TRIANGLES,
l.circleIndexCount,e.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*l.circleIndexStart),x.triangleCount+=l.circleIndexCount/3)))}}}}k.WGLBrushVTLCircle=n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/StyleDefinition":function(){define(["exports","../../../../../symbols/cim/enums"],function(k,r){k.StyleLayerType=void 0;(function(e){e[e.BACKGROUND=0]="BACKGROUND";e[e.FILL=1]="FILL";e[e.LINE=2]="LINE";e[e.SYMBOL=3]="SYMBOL";e[e.CIRCLE=4]=
"CIRCLE"})(k.StyleLayerType||(k.StyleLayerType={}));k.Visibility=void 0;(function(e){e[e.VISIBLE=0]="VISIBLE";e[e.NONE=1]="NONE"})(k.Visibility||(k.Visibility={}));k.SymbolPlacement=void 0;(function(e){e[e.POINT=0]="POINT";e[e.LINE=1]="LINE";e[e.LINE_CENTER=2]="LINE_CENTER"})(k.SymbolPlacement||(k.SymbolPlacement={}));k.RotationAlignment=void 0;(function(e){e[e.MAP=0]="MAP";e[e.VIEWPORT=1]="VIEWPORT";e[e.AUTO=2]="AUTO"})(k.RotationAlignment||(k.RotationAlignment={}));k.TextJustification=void 0;(function(e){e[e.AUTO=
0]="AUTO";e[e.LEFT=1]="LEFT";e[e.CENTER=2]="CENTER";e[e.RIGHT=3]="RIGHT"})(k.TextJustification||(k.TextJustification={}));k.SymbolAnchor=void 0;(function(e){e[e.CENTER=0]="CENTER";e[e.LEFT=1]="LEFT";e[e.RIGHT=2]="RIGHT";e[e.TOP=3]="TOP";e[e.BOTTOM=4]="BOTTOM";e[e.TOP_LEFT=5]="TOP_LEFT";e[e.TOP_RIGHT=6]="TOP_RIGHT";e[e.BOTTOM_LEFT=7]="BOTTOM_LEFT";e[e.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"})(k.SymbolAnchor||(k.SymbolAnchor={}));k.TextTransform=void 0;(function(e){e[e.NONE=0]="NONE";e[e.UPPERCASE=1]="UPPERCASE";
e[e.LOWERCASE=2]="LOWERCASE"})(k.TextTransform||(k.TextTransform={}));k.TranslateAnchor=void 0;(function(e){e[e.MAP=0]="MAP";e[e.VIEWPORT=1]="VIEWPORT"})(k.TranslateAnchor||(k.TranslateAnchor={}));k.TextWritingMode=void 0;(function(e){e[e.HORIZONTAL=0]="HORIZONTAL";e[e.VERTICAL=1]="VERTICAL"})(k.TextWritingMode||(k.TextWritingMode={}));class p{}p.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:k.Visibility.VISIBLE}};p.fillLayoutDefinition={visibility:{type:"enum",
values:["visible","none"],default:k.Visibility.VISIBLE}};p.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:k.Visibility.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:r.CapType.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:r.JoinType.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}};p.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:k.Visibility.VISIBLE},
"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:k.SymbolPlacement.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:k.SymbolAnchor.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},
"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:k.RotationAlignment.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",
values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:k.SymbolAnchor.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:k.TextJustification.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},
"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:k.RotationAlignment.AUTO},"text-size":{type:"number",minimum:0,default:16},
"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:k.TextTransform.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[k.TextWritingMode.HORIZONTAL]}};p.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:k.Visibility.VISIBLE}};p.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}};
p.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:k.TranslateAnchor.MAP}};p.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",
default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:k.TranslateAnchor.MAP},"line-width":{type:"number",minimum:0,default:1}};p.symbolPaintDefinition={"icon-color":{type:"color",
default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:k.TranslateAnchor.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},
"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:k.TranslateAnchor.MAP}};p.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",
minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}};p.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",
minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:k.TranslateAnchor.MAP}};k.StyleDefinition=p;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLFill":function(){define(["exports",
"../../vectorTiles/style/StyleDefinition","../definitions","./WGLBrush","../../../../webgl/enums"],function(k,r,p,e,n){const m=1/65536;class l extends e{constructor(){super(...arguments);this._fillProgramOptions={id:!1,pattern:!1};this._outlineProgramOptions={id:!1}}dispose(){}drawMany(d,a){const {displayLevel:b,renderPass:f,spriteMosaic:g,styleLayerUID:q}=d;var c=!1;for(var h of a)if(h.layerData.has(q)){var u=h.layerData.get(q);if(0<u.fillIndexCount||0<u.outlineIndexCount){c=!0;break}}if(c){c=d.styleLayer;
var A=c.getPaintProperty("fill-pattern");u=(h=void 0!==A)&&A.isDataDriven;if(h&&!u){var z=A.getValue(b);z=g.getMosaicItemPosition(z,!0)}A=!h&&c.getPaintValue("fill-antialias",b);var t=!0,w=1;if(!h){var x=c.getPaintProperty("fill-color"),B=c.getPaintProperty("fill-opacity");x?.isDataDriven||B?.isDataDriven||(w=c.getPaintValue("fill-color",b),w=c.getPaintValue("fill-opacity",b)*w[3],1<=w&&(t=!1))}t&&"opaque"===f||(x=c.getPaintValue("fill-translate",b),B=c.getPaintValue("fill-translate-anchor",b),(t||
"translucent"!==f)&&this._drawFill(d,q,c,a,x,B,h,z,u),z=!c.hasDataDrivenOutlineColor&&c.outlineUsesFillColor&&1>w,A&&"opaque"!==f&&!z&&this._drawOutline(d,q,c,a,x,B))}}_drawFill(d,a,b,f,g,q,c,h,u){if(!c||u||null!=h){var {context:A,displayLevel:z,state:t,painter:w,pixelRatio:x,spriteMosaic:B,requestRender:C,allowDelayedRender:y}=d;d=b.fillMaterial;var v=w.vectorTilesMaterialManager,F=x>p.vtlHighResCutoff?2:1,D=this._fillProgramOptions;D.pattern=c;v=v.getMaterialProgram(A,d,D);if(y&&null!=C&&!v.compiled)C();
else{A.useProgram(v);null!=h&&({page:h}=h,D=B.getPageSize(h),null!=D&&(B.bind(A,n.TextureSamplingMode.LINEAR,h,p.vtlTextureBindingUnitSprites),v.setUniform2fv("u_mosaicSize",D),v.setUniform1i("u_texture",p.vtlTextureBindingUnitSprites)));v.setUniformMatrix3fv("u_displayMat3",q===r.TranslateAnchor.VIEWPORT?t.displayMat3:t.displayViewMat3);v.setUniform2fv("u_fillTranslation",g);v.setUniform1f("u_depth",b.z+m);g=-1;for(const G of f)if(G.layerData.has(a)&&(G.key.level!==g&&(g=G.key.level,d.setDataUniforms(v,
z,b,g,B)),f=G.layerData.get(a),f.fillIndexCount&&(f.prepareForRendering(A),q=f.fillVAO,null!=q))){A.bindVAO(q);v.setUniformMatrix3fv("u_dvsMat3",G.transforms.displayViewScreenMat3);A.setStencilFunction(n.CompareFunction.EQUAL,G.stencilRef,255);c&&v.setUniform1f("u_patternFactor",G.rangeX/(F*G.width*Math.max(2**(Math.round(z)-G.key.level),1)));if(u){q=f.patternMap;if(!q)continue;for(const [E,H]of q)q=B.getPageSize(E),null!=q&&(B.bind(A,n.TextureSamplingMode.LINEAR,E,p.vtlTextureBindingUnitSprites),
v.setUniform2fv("u_mosaicSize",q),v.setUniform1i("u_texture",p.vtlTextureBindingUnitSprites),A.drawElements(n.PrimitiveType.TRIANGLES,H[1],n.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*H[0]))}else A.drawElements(n.PrimitiveType.TRIANGLES,f.fillIndexCount,n.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*f.fillIndexStart);G.triangleCount+=f.fillIndexCount/3}}}}_drawOutline(d,a,b,f,g,q){const {context:c,displayLevel:h,state:u,painter:A,pixelRatio:z,spriteMosaic:t,requestRender:w,allowDelayedRender:x}=
d;d=b.outlineMaterial;const B=.75/z,C=A.vectorTilesMaterialManager.getMaterialProgram(c,d,this._outlineProgramOptions);if(x&&null!=w&&!C.compiled)w();else{c.useProgram(C);C.setUniformMatrix3fv("u_displayMat3",q===r.TranslateAnchor.VIEWPORT?u.displayMat3:u.displayViewMat3);C.setUniform2fv("u_fillTranslation",g);C.setUniform1f("u_depth",b.z+m);C.setUniform1f("u_outline_width",B);g=-1;for(const y of f)y.layerData.has(a)&&(y.key.level!==g&&(g=y.key.level,d.setDataUniforms(C,h,b,g,t)),f=y.layerData.get(a),
f.prepareForRendering(c),f.outlineIndexCount&&(q=f.outlineVAO,null!=q&&(c.bindVAO(q),C.setUniformMatrix3fv("u_dvsMat3",y.transforms.displayViewScreenMat3),c.setStencilFunction(n.CompareFunction.EQUAL,y.stencilRef,255),c.drawElements(n.PrimitiveType.TRIANGLES,f.outlineIndexCount,n.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*f.outlineIndexStart),y.triangleCount+=f.outlineIndexCount/3)))}}}k.WGLBrushVTLFill=l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLLine":function(){define(["exports",
"../../vectorTiles/style/StyleDefinition","../definitions","./WGLBrush","../../../../webgl/enums"],function(k,r,p,e,n){class m extends e{constructor(){super(...arguments);this._programOptions={id:!1,pattern:!1,sdf:!1}}dispose(){}drawMany(l,d){const {context:a,displayLevel:b,state:f,painter:g,pixelRatio:q,spriteMosaic:c,styleLayerUID:h,requestRender:u,allowDelayedRender:A}=l;if(d.some(E=>E.layerData.get(h)?.lineIndexCount??!1)){l=l.styleLayer;var z=l.lineMaterial,t=g.vectorTilesMaterialManager,w=l.getPaintValue("line-translate",
b),x=l.getPaintValue("line-translate-anchor",b),B=l.getPaintProperty("line-pattern"),C=void 0!==B,y=C&&B.isDataDriven;if(C&&!y){B=B.getValue(b);var v=c.getMosaicItemPosition(B)}var F;B=!1;if(!C){var D=l.getPaintProperty("line-dasharray");B=(F=void 0!==D)&&D.isDataDriven;F&&!B&&(v=D.getValue(b),v=l.getDashKey(v,l.getLayoutValue("line-cap",b)),v=c.getMosaicItemPosition(v))}D=1/q;var G=this._programOptions;G.pattern=C;G.sdf=F;F=t.getMaterialProgram(a,z,G);if(A&&null!=u&&!F.compiled)u();else{a.useProgram(F);
F.setUniformMatrix3fv("u_displayViewMat3",f.displayViewMat3);F.setUniformMatrix3fv("u_displayMat3",x===r.TranslateAnchor.VIEWPORT?f.displayMat3:f.displayViewMat3);F.setUniform2fv("u_lineTranslation",w);F.setUniform1f("u_depth",l.z);F.setUniform1f("u_antialiasing",D);v&&null!=v&&({page:w}=v,x=c.getPageSize(w),null!=x&&(c.bind(a,n.TextureSamplingMode.LINEAR,w,p.vtlTextureBindingUnitSprites),F.setUniform2fv("u_mosaicSize",x),F.setUniform1i("u_texture",p.vtlTextureBindingUnitSprites)));w=-1;for(const E of d)if(E.layerData.has(h)&&
(E.key.level!==w&&(w=E.key.level,z.setDataUniforms(F,b,l,w,c)),F.setUniform1f("u_zoomFactor",2**(b-w)/q),d=E.layerData.get(h),d.lineIndexCount&&(d.prepareForRendering(a),x=d.vao,null!=x))){a.bindVAO(x);F.setUniformMatrix3fv("u_dvsMat3",E.transforms.displayViewScreenMat3);a.setStencilFunction(n.CompareFunction.EQUAL,E.stencilRef,255);if(y||B){x=d.patternMap;if(!x)continue;for(const [H,K]of x)x=c.getPageSize(H),null!=x&&(c.bind(a,n.TextureSamplingMode.LINEAR,H,p.vtlTextureBindingUnitSprites),F.setUniform2fv("u_mosaicSize",
x),F.setUniform1i("u_texture",p.vtlTextureBindingUnitSprites),a.drawElements(n.PrimitiveType.TRIANGLES,K[1],n.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*K[0]))}else a.drawElements(n.PrimitiveType.TRIANGLES,d.lineIndexCount,n.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*d.lineIndexStart);E.triangleCount+=d.lineIndexCount/3}}}}}k.WGLBrushVTLLine=m;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLSymbol":function(){define("exports ../../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../vectorTiles/decluttering/config ../../vectorTiles/style/StyleDefinition ../definitions ../GeometryUtils ./WGLBrush ../../../../webgl/enums".split(" "),
function(k,r,p,e,n,m,l,d){const a=1/65536;class b extends l{constructor(){super(...arguments);this._iconProgramOptions={id:!1,sdf:!1};this._sdfProgramOptions={id:!1};this._spritesTextureSize=r.create()}dispose(){}drawMany(f,g){const q=f.styleLayer;this._drawIcons(f,q,g);this._drawText(f,q,g)}_drawIcons(f,g,q){const {context:c,displayLevel:h,painter:u,spriteMosaic:A,state:z,styleLayerUID:t,requestRender:w,allowDelayedRender:x}=f,B=g.iconMaterial;var C=u.vectorTilesMaterialManager;let y;var v=!1;for(var F of q)if(F.layerData.has(t)&&
(y=F.layerData.get(t),0<y.iconPerPageElementsMap.size)){v=!0;break}if(v){v=g.getPaintValue("icon-translate",h);F=g.getPaintValue("icon-translate-anchor",h);var D=g.getLayoutValue("icon-rotation-alignment",h);D===e.RotationAlignment.AUTO&&(D=g.getLayoutValue("symbol-placement",h)===e.SymbolPlacement.POINT?e.RotationAlignment.VIEWPORT:e.RotationAlignment.MAP);var G=D===e.RotationAlignment.MAP;G=g.getLayoutValue("icon-keep-upright",h)&&G;var E=this._iconProgramOptions;E.sdf=y.isIconSDF;C=C.getMaterialProgram(c,
B,E);if(x&&null!=w&&!C.compiled)w();else{c.useProgram(C);C.setUniformMatrix3fv("u_displayViewMat3",D===e.RotationAlignment.MAP?z.displayViewMat3:z.displayMat3);C.setUniformMatrix3fv("u_displayMat3",F===e.TranslateAnchor.VIEWPORT?z.displayMat3:z.displayViewMat3);C.setUniform2fv("u_iconTranslation",v);C.setUniform1f("u_depth",g.z);C.setUniform1f("u_mapRotation",m.degToByte(z.rotation));C.setUniform1f("u_keepUpright",G?1:0);C.setUniform1f("u_level",10*h);C.setUniform1i("u_texture",n.vtlTextureBindingUnitSprites);
C.setUniform1f("u_fadeDuration",p.fadeDuration/1E3);v=-1;for(const H of q)if(H.layerData.has(t)&&(H.key.level!==v&&(v=H.key.level,B.setDataUniforms(C,h,g,v,A)),y=H.layerData.get(t),0!==y.iconPerPageElementsMap.size&&(y.prepareForRendering(c),y.updateOpacityInfo(),q=y.iconVAO,null!=q))){c.bindVAO(q);C.setUniformMatrix3fv("u_dvsMat3",H.transforms.displayViewScreenMat3);C.setUniform1f("u_time",(performance.now()-y.lastOpacityUpdate)/1E3);for(const [K,J]of y.iconPerPageElementsMap)this._renderIconRange(f,
C,J,K,H)}}}}_renderIconRange(f,g,q,c,h){const {context:u,spriteMosaic:A}=f;this._spritesTextureSize[0]=A.getWidth(c)/4;this._spritesTextureSize[1]=A.getHeight(c)/4;g.setUniform2fv("u_mosaicSize",this._spritesTextureSize);A.bind(u,d.TextureSamplingMode.LINEAR,c,n.vtlTextureBindingUnitSprites);this._setStencilState(f,h);u.drawElements(d.PrimitiveType.TRIANGLES,q[1],d.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*q[0]);h.triangleCount+=q[1]/3}_drawText(f,g,q){const {context:c,displayLevel:h,glyphMosaic:u,
painter:A,pixelRatio:z,spriteMosaic:t,state:w,styleLayerUID:x,requestRender:B,allowDelayedRender:C}=f,y=g.textMaterial;var v=A.vectorTilesMaterialManager,F=!1;for(var D of q)if(D.layerData.has(x)){var G=D.layerData.get(x);if(0<G.glyphPerPageElementsMap.size){F=!0;break}}if(F&&(G=g.getPaintProperty("text-opacity"),!G||G.isDataDriven||0!==G.getValue(h))){G=g.getPaintProperty("text-color");var E=!G||G.isDataDriven||0<G.getValue(h)[3];G=g.getPaintProperty("text-halo-width");F=g.getPaintProperty("text-halo-color");
var H=(!G||G.isDataDriven||0<G.getValue(h))&&(!F||F.isDataDriven||0<F.getValue(h)[3]);if(E||H){G=g.getLayoutValue("text-rotation-alignment",h);G===e.RotationAlignment.AUTO&&(G=g.getLayoutValue("symbol-placement",h)===e.SymbolPlacement.POINT?e.RotationAlignment.VIEWPORT:e.RotationAlignment.MAP);F=G===e.RotationAlignment.MAP;F=g.getLayoutValue("text-keep-upright",h)&&F;D=.8*3/z;this._glyphTextureSize||(this._glyphTextureSize=r.fromValues(u.width/4,u.height/4));var K=g.getPaintValue("text-translate",
h),J=g.getPaintValue("text-translate-anchor",h),L=v.getMaterialProgram(c,y,this._sdfProgramOptions);if(C&&null!=B&&!L.compiled)B();else{c.useProgram(L);L.setUniformMatrix3fv("u_displayViewMat3",G===e.RotationAlignment.MAP?w.displayViewMat3:w.displayMat3);L.setUniformMatrix3fv("u_displayMat3",J===e.TranslateAnchor.VIEWPORT?w.displayMat3:w.displayViewMat3);L.setUniform2fv("u_textTranslation",K);L.setUniform1f("u_depth",g.z+a);L.setUniform2fv("u_mosaicSize",this._glyphTextureSize);L.setUniform1f("u_mapRotation",
m.degToByte(w.rotation));L.setUniform1f("u_keepUpright",F?1:0);L.setUniform1f("u_level",10*h);L.setUniform1i("u_texture",n.vtlTextureBindingUnitGlyphs);L.setUniform1f("u_antialiasingWidth",D);L.setUniform1f("u_fadeDuration",p.fadeDuration/1E3);v=-1;for(const P of q)P.layerData.has(x)&&(P.key.level!==v&&(v=P.key.level,y.setDataUniforms(L,h,g,v,t)),G=P.layerData.get(x),0!==G.glyphPerPageElementsMap.size&&(G.prepareForRendering(c),G.updateOpacityInfo(),q=G.textVAO,null!=q&&(c.bindVAO(q),L.setUniformMatrix3fv("u_dvsMat3",
P.transforms.displayViewScreenMat3),this._setStencilState(f,P),q=(performance.now()-G.lastOpacityUpdate)/1E3,L.setUniform1f("u_time",q),G.glyphPerPageElementsMap.forEach((Q,S)=>{this._renderGlyphRange(c,Q,S,u,L,H,E,P)}))))}}}}_renderGlyphRange(f,g,q,c,h,u,A,z){c.bind(f,d.TextureSamplingMode.LINEAR,q,n.vtlTextureBindingUnitGlyphs);u&&(h.setUniform1f("u_halo",1),f.drawElements(d.PrimitiveType.TRIANGLES,g[1],d.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*g[0]),z.triangleCount+=g[1]/3);A&&(h.setUniform1f("u_halo",
0),f.drawElements(d.PrimitiveType.TRIANGLES,g[1],d.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*g[0]),z.triangleCount+=g[1]/3)}_setStencilState(f,g){const {context:q,is3D:c,stencilSymbols:h}=f;q.setStencilTestEnabled(!0);h?(q.setStencilWriteMask(255),q.setStencilFunction(d.CompareFunction.ALWAYS,g.stencilRef,255)):(q.setStencilWriteMask(0),c?q.setStencilFunction(d.CompareFunction.EQUAL,g.stencilRef,255):q.setStencilFunction(d.CompareFunction.GREATER,255,255))}}k.WGLBrushVTLSymbol=b;Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/config":function(){define(["exports"],function(k){k.collisionGridCellSize=32;k.declutterBudget=1.5;k.declutterTiles=!0;k.fadeDuration=200;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/GeometryUtils":function(){define(["exports"],function(k){function r(m,l){m%=l;return 0<=m?m:m+l}const p=128/Math.PI,e=256/360,n=1/Math.LN2;k.between=function(m,l,d){return m>=l&&m<=d||
m>=d&&m<=l};k.degToByte=function(m){return r(m*e,256)};k.interpolate=function(m,l,d){return m*(1-d)+l*d};k.log2=function(m){return Math.log(m)*n};k.positiveMod=r;k.radToByte=function(m){return r(m*p,256)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLMaterialManager":function(){define(["../enums","./Programs"],function(k,r){class p{constructor(){this._programByKey=new Map}dispose(){this._programByKey.forEach(e=>e.dispose());this._programByKey.clear()}getMaterialProgram(e,
n,m){const l=n.key<<3|this._getMaterialOptionsValue(n.type,m);if(this._programByKey.has(l))return this._programByKey.get(l);var d=this._getProgramTemplate(n.type);({shaders:d}=d);const {vertexShader:a,fragmentShader:b}=d(m);m=n.getShaderHeader();d=n.getShaderMain();m=a.replace("#pragma header",m).replace("#pragma main",d);e=e.programCache.acquire(m,b,n.getAttributeLocations());this._programByKey.set(l,e);return e}_getMaterialOptionsValue(e,n){switch(e){case k.ShaderProgramType.BACKGROUND:return(n.pattern?
1:0)<<1;case k.ShaderProgramType.FILL:return(n.pattern?1:0)<<1;case k.ShaderProgramType.OUTLINE:return 0;case k.ShaderProgramType.LINE:return(n.sdf?1:0)<<2|(n.pattern?1:0)<<1;case k.ShaderProgramType.ICON:return(n.sdf?1:0)<<1;case k.ShaderProgramType.CIRCLE:return 0;case k.ShaderProgramType.TEXT:return 0;default:return 0}}_getProgramTemplate(e){switch(e){case k.ShaderProgramType.BACKGROUND:return r.background;case k.ShaderProgramType.CIRCLE:return r.circle;case k.ShaderProgramType.FILL:return r.fill;
case k.ShaderProgramType.ICON:return r.icon;case k.ShaderProgramType.LINE:return r.line;case k.ShaderProgramType.OUTLINE:return r.outline;case k.ShaderProgramType.TEXT:return r.text;default:return null}}}return p})},"esri/views/2d/engine/vectorTiles/enums":function(){define(["exports"],function(k){k.BucketType=void 0;(function(r){r[r.FILL=1]="FILL";r[r.LINE=2]="LINE";r[r.SYMBOL=3]="SYMBOL";r[r.CIRCLE=4]="CIRCLE"})(k.BucketType||(k.BucketType={}));k.ShaderProgramType=void 0;(function(r){r[r.BACKGROUND=
0]="BACKGROUND";r[r.FILL=1]="FILL";r[r.OUTLINE=2]="OUTLINE";r[r.LINE=3]="LINE";r[r.ICON=4]="ICON";r[r.CIRCLE=5]="CIRCLE";r[r.TEXT=6]="TEXT";r[r.TILEINFO=7]="TILEINFO"})(k.ShaderProgramType||(k.ShaderProgramType={}));k.StyleUpdateType=void 0;(function(r){r[r.PAINTER_CHANGED=0]="PAINTER_CHANGED";r[r.LAYOUT_CHANGED=1]="LAYOUT_CHANGED";r[r.LAYER_CHANGED=2]="LAYER_CHANGED";r[r.LAYER_REMOVED=3]="LAYER_REMOVED";r[r.SPRITES_CHANGED=4]="SPRITES_CHANGED"})(k.StyleUpdateType||(k.StyleUpdateType={}));Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/Programs":function(){define(["exports","./sources/resolver","../../../../webgl/programUtils"],function(k,r,p){k.background={shaders:e=>({vertexShader:p.glslifyDefineMap({PATTERN:e.pattern})+r.resolveIncludes("background/background.vert"),fragmentShader:p.glslifyDefineMap({PATTERN:e.pattern})+r.resolveIncludes("background/background.frag")})};k.circle={shaders:e=>({vertexShader:r.resolveIncludes("circle/circle.vert"),
fragmentShader:r.resolveIncludes("circle/circle.frag")})};k.fill={shaders:e=>({vertexShader:p.glslifyDefineMap({PATTERN:e.pattern})+r.resolveIncludes("fill/fill.vert"),fragmentShader:p.glslifyDefineMap({PATTERN:e.pattern})+r.resolveIncludes("fill/fill.frag")})};k.icon={shaders:e=>({vertexShader:p.glslifyDefineMap({SDF:e.sdf})+r.resolveIncludes("icon/icon.vert"),fragmentShader:p.glslifyDefineMap({SDF:e.sdf})+r.resolveIncludes("icon/icon.frag")})};k.line={shaders:e=>({vertexShader:p.glslifyDefineMap({PATTERN:e.pattern,
SDF:e.sdf})+r.resolveIncludes("line/line.vert"),fragmentShader:p.glslifyDefineMap({PATTERN:e.pattern,SDF:e.sdf})+r.resolveIncludes("line/line.frag")})};k.outline={shaders:e=>({vertexShader:r.resolveIncludes("outline/outline.vert"),fragmentShader:r.resolveIncludes("outline/outline.frag")})};k.text={shaders:e=>({vertexShader:r.resolveIncludes("text/text.vert"),fragmentShader:r.resolveIncludes("text/text.frag")})};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/sources/resolver":function(){define(["exports",
"./shaderRepository","../../../../../webgl/ShaderCompiler"],function(k,r,p){const e=new p.ShaderCompiler(function(n){let m=r;n.split("/").forEach(l=>{m&&=m[l]});return m});k.resolveIncludes=function(n){return e.resolveIncludes(n)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/sources/shaderRepository":function(){define(function(){return{background:{"background.frag":"#ifdef PATTERN\nuniform lowp float u_opacity;\nuniform lowp sampler2D u_texture;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_tileTextureCoord;\n#else\nuniform lowp vec4 u_color;\n#endif\nvoid main() {\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord \x3d mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos \x3d mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color \x3d texture2D(u_texture, samplePos);\ngl_FragColor \x3d u_opacity * color;\n#else\ngl_FragColor \x3d u_color;\n#endif\n}",
"background.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\nuniform mediump vec4 u_tlbr;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\n#endif\nvoid main() {\ngl_Position \x3d vec4((u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0)).xy, u_depth, 1.0);\n#ifdef PATTERN\nv_tileTextureCoord \x3d (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\nv_tlbr             \x3d u_tlbr / u_mosaicSize.xyxy;\n#endif\n}"},
circle:{"circle.frag":"precision lowp float;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\nvoid main()\n{\nmediump float dist \x3d length(v_offset);\nmediump float alpha \x3d smoothstep(0.0, -v_blur, dist - 1.0);\nlowp float color_mix_ratio \x3d v_stroke_width \x3c 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\ngl_FragColor \x3d alpha * mix(v_color, v_stroke_color, color_mix_ratio);\n}",
"circle.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_circleTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_antialiasingWidth;\nvoid main()\n{\n#pragma main\nv_color \x3d color * opacity;\nv_stroke_color \x3d stroke_color * stroke_opacity;\nv_stroke_width \x3d stroke_width;\nv_radius \x3d radius;\nv_blur \x3d max(blur, u_antialiasingWidth / (radius + stroke_width));\nmediump vec2 offset \x3d vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\nv_offset \x3d offset;\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos * 0.5, 1.0) + u_displayMat3 * vec3((v_radius + v_stroke_width) * offset + u_circleTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
fill:{"fill.frag":"precision lowp float;\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\nvarying lowp vec4 v_color;\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha \x3d color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor \x3d color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord \x3d fract(v_tileTextureCoord);\nmediump vec2 samplePos \x3d mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color \x3d texture2D(u_texture, samplePos);\ngl_FragColor \x3d v_color[3] * color;\n#else\ngl_FragColor \x3d v_color;\n#endif\n}",
"fill.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_fillTranslation;\n#ifdef PATTERN\n#include \x3cutil/util.glsl\x3e\nuniform mediump vec2 u_mosaicSize;\nuniform mediump float u_patternFactor;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\nvarying lowp vec4 v_color;\nvoid main()\n{\n#pragma main\nv_color \x3d color * opacity;\n#ifdef PATTERN\nfloat patternWidth \x3d nextPOT(tlbr.z - tlbr.x);\nfloat patternHeight \x3d nextPOT(tlbr.w - tlbr.y);\nfloat scaleX \x3d 1.0 / (patternWidth * u_patternFactor);\nfloat scaleY \x3d 1.0 / (patternHeight * u_patternFactor);\nmat3 patterMat \x3d mat3(scaleX, 0.0,    0.0,\n0.0,    -scaleY, 0.0,\n0.0,    0.0,    1.0);\nv_tileTextureCoord \x3d (patterMat * vec3(a_pos, 1.0)).xy;\nv_tlbr             \x3d tlbr / u_mosaicSize.xyxy;\n#endif\nvec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(u_fillTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
icon:{"icon.frag":"precision mediump float;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nuniform lowp vec4 u_color;\nuniform lowp vec4 u_outlineColor;\n#endif\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump flaot v_halo_width;\n#endif\n#include \x3cutil/encoding.glsl\x3e\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha \x3d color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor \x3d color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef SDF\nlowp vec4 fillPixelColor \x3d v_color;\nfloat d \x3d rgba2float(texture2D(u_texture, v_tex)) - 0.5;\nconst float softEdgeRatio \x3d 0.248062016;\nfloat size \x3d max(v_size.x, v_size.y);\nfloat dist \x3d d * softEdgeRatio * size;\nfillPixelColor *\x3d clamp(0.5 - dist, 0.0, 1.0);\nif (v_halo_width \x3e 0.25) {\nlowp vec4 outlinePixelColor \x3d u_outlineColor;\nconst float outlineLimitRatio \x3d (16.0 / 86.0);\nfloat clampedOutlineSize \x3d softEdgeRatio * min(v_halo_width, outlineLimitRatio * max(v_size.x, v_size.y));\noutlinePixelColor *\x3d clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\ngl_FragColor \x3d v_opacity * mixColors(fillPixelColor, outlinePixelColor);\n}\nelse {\ngl_FragColor \x3d v_opacity * fillPixelColor;\n}\n#else\nlowp vec4 texColor \x3d texture2D(u_texture, v_tex);\ngl_FragColor \x3d v_opacity * texColor;\n#endif\n}",
"icon.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump float v_halo_width;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_iconTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nconst float C_OFFSET_PRECISION \x3d 1.0 / 8.0;\nconst float C_256_TO_RAD \x3d 3.14159265359 / 128.0;\nconst float C_DEG_TO_RAD \x3d 3.14159265359 / 180.0;\nconst float tileCoordRatio \x3d 1.0 / 8.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nv_color \x3d color;\nv_opacity \x3d opacity;\n#ifdef SDF\nv_halo_width \x3d halo_width;\n#endif\nfloat modded \x3d mod(a_opacityInfo, 128.0);\nfloat targetOpacity \x3d (a_opacityInfo - modded) / 128.0;\nfloat startOpacity \x3d modded / 127.0;\nfloat interpolatedOpacity \x3d clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_opacity *\x3d interpolatedOpacity;\nmediump float a_angle         \x3d a_levelInfo[1];\nmediump float a_minLevel      \x3d a_levelInfo[2];\nmediump float a_maxLevel      \x3d a_levelInfo[3];\nmediump vec2 a_tex            \x3d a_texAngleRange.xy;\nmediump float delta_z \x3d 0.0;\nmediump float rotated \x3d mod(a_angle + u_mapRotation, 256.0);\ndelta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\ndelta_z +\x3d 1.0 - step(a_minLevel, u_level);\ndelta_z +\x3d step(a_maxLevel, u_level);\ndelta_z +\x3d step(v_opacity, 0.0);\nvec2 offset \x3d C_OFFSET_PRECISION * a_vertexOffset;\nv_size \x3d abs(offset);\n#ifdef SDF\noffset \x3d (120.0 / 86.0) * offset;\n#endif\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayViewMat3 * vec3(size * offset, 0.0) + u_displayMat3 * vec3(u_iconTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth + delta_z, 1.0);\nv_tex \x3d a_tex.xy / u_mosaicSize;\n}"},
line:{"line.frag":"precision lowp float;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying mediump float v_blur;\n#if defined (PATTERN) || defined(SDF)\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\nuniform sampler2D u_texture;\nuniform mediump float u_antialiasing;\n#endif\n#ifdef SDF\n#include \x3cutil/encoding.glsl\x3e\n#endif\nvoid main()\n{\nmediump float fragDist \x3d length(v_normal) * v_lineHalfWidth;\nlowp float alpha \x3d clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\n#ifdef PATTERN\nmediump float relativeTexX \x3d fract(v_accumulatedDistance / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY \x3d 0.5 + v_normal.y * v_lineHalfWidth / (v_patternSize.y * v_widthRatio);\nmediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color \x3d texture2D(u_texture, texCoord);\ngl_FragColor \x3d alpha * v_color[3] * color;\n#elif defined(SDF)\nmediump float relativeTexX \x3d fract((v_accumulatedDistance * 0.5) / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY \x3d  0.5 + 0.25 * v_normal.y;\nmediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d \x3d rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist \x3d d * (v_lineHalfWidth + u_antialiasing / 2.0);\ngl_FragColor \x3d alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\n#else\ngl_FragColor \x3d alpha * v_color;\n#endif\n}",
"line.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_extrude_offset;\nattribute vec4 a_dir_normal;\nattribute vec2 a_accumulatedDistance;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump float u_zoomFactor;\nuniform mediump vec2 u_lineTranslation;\nuniform mediump float u_antialiasing;\nuniform mediump float u_depth;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nconst float scale \x3d 1.0 / 31.0;\nconst mediump float tileCoordRatio \x3d 8.0;\n#if defined (SDF)\nconst mediump float sdfPatternHalfWidth \x3d 15.5;\n#endif\n#if defined (PATTERN) || defined(SDF)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\n#endif\nvarying lowp vec4 v_color;\nvarying mediump float v_lineHalfWidth;\nvarying mediump float v_blur;\nvoid main()\n{\n#pragma main\nv_color \x3d color * opacity;\nv_blur \x3d blur + u_antialiasing;\nv_normal \x3d a_dir_normal.zw * scale;\n#if defined (PATTERN) || defined(SDF)\nv_tlbr          \x3d tlbr / u_mosaicSize.xyxy;\nv_patternSize   \x3d vec2(tlbr.z - tlbr.x, tlbr.y - tlbr.w);\n#if defined (PATTERN)\nv_widthRatio \x3d width / v_patternSize.y;\n#else\nv_widthRatio \x3d width / sdfPatternHalfWidth / 2.0;\n#endif\n#endif\nv_lineHalfWidth \x3d (width + u_antialiasing) * 0.5;\nmediump vec2 dir \x3d a_dir_normal.xy * scale;\nmediump vec2 offset_ \x3d a_extrude_offset.zw * scale * offset;\nmediump vec2 dist \x3d v_lineHalfWidth * scale * a_extrude_offset.xy;\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos + offset_ * tileCoordRatio / u_zoomFactor, 1.0) + u_displayViewMat3 * vec3(dist, 0.0) + u_displayMat3 * vec3(u_lineTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n#if defined (PATTERN) || defined(SDF)\nv_accumulatedDistance \x3d a_accumulatedDistance.x * u_zoomFactor / tileCoordRatio + dot(dir, dist + offset_);\n#endif\n}"},
outline:{"outline.frag":"varying lowp vec4 v_color;\nvarying mediump vec2 v_normal;\nvoid main()\n{\nlowp float dist \x3d abs(v_normal.y);\nlowp float alpha \x3d smoothstep(1.0, 0.0, dist);\ngl_FragColor \x3d alpha * v_color;\n}","outline.vert":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n#pragma header\nvarying lowp vec4 v_color;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_fillTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\nvarying lowp vec2 v_normal;\nconst float scale \x3d 1.0 / 15.0;\nvoid main()\n{\n#pragma main\nv_color \x3d color * opacity;\nv_normal \x3d a_xnormal;\nmediump vec2 dist \x3d u_outline_width * scale * a_offset;\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(dist + u_fillTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
text:{"text.frag":"uniform lowp sampler2D u_texture;\nvarying lowp vec2 v_tex;\nvarying lowp vec4 v_color;\nvarying mediump float v_edgeWidth;\nvarying mediump float v_edgeDistance;\nvoid main()\n{\nlowp float dist \x3d texture2D(u_texture, v_tex).a;\nmediump float alpha \x3d smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist);\ngl_FragColor \x3d alpha * v_color;\n}","text.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_textTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying lowp vec2 v_tex;\nconst float offsetPrecision \x3d 1.0 / 8.0;\nconst mediump float edgePos \x3d 0.75;\nuniform mediump float u_antialiasingWidth;\nvarying mediump float v_edgeDistance;\nvarying mediump float v_edgeWidth;\nuniform lowp float u_halo;\nconst float sdfFontScale \x3d 1.0 / 24.0;\nconst float sdfPixel \x3d 3.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nif (u_halo \x3e 0.5)\n{\nv_color \x3d halo_color * opacity;\nhalo_width *\x3d sdfPixel;\nhalo_blur *\x3d sdfPixel;\n}\nelse\n{\nv_color \x3d color * opacity;\nhalo_width \x3d 0.0;\nhalo_blur \x3d 0.0;\n}\nfloat modded \x3d mod(a_opacityInfo, 128.0);\nfloat targetOpacity \x3d (a_opacityInfo - modded) / 128.0;\nfloat startOpacity \x3d modded / 127.0;\nfloat interpolatedOpacity \x3d clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_color *\x3d interpolatedOpacity;\nmediump float a_angle       \x3d a_levelInfo[1];\nmediump float a_minLevel    \x3d a_levelInfo[2];\nmediump float a_maxLevel    \x3d a_levelInfo[3];\nmediump vec2 a_tex          \x3d a_texAngleRange.xy;\nmediump float a_visMinAngle    \x3d a_texAngleRange.z;\nmediump float a_visMaxAngle    \x3d a_texAngleRange.w;\nmediump float delta_z \x3d 0.0;\nmediump float angle \x3d mod(a_angle + u_mapRotation, 256.0);\nif (a_visMinAngle \x3c a_visMaxAngle)\n{\ndelta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) + (1.0 - step(a_visMinAngle, angle)));\n}\nelse\n{\ndelta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) * (1.0 - step(a_visMinAngle, angle)));\n}\ndelta_z +\x3d 1.0 - step(a_minLevel, u_level);\ndelta_z +\x3d step(a_maxLevel, u_level);\ndelta_z +\x3d step(v_color[3], 0.0);\nv_tex \x3d a_tex.xy / u_mosaicSize;\nv_edgeDistance \x3d edgePos - halo_width / size;\nv_edgeWidth \x3d (u_antialiasingWidth + halo_blur) / size;\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + sdfFontScale * u_displayViewMat3 * vec3(offsetPrecision * size * a_vertexOffset, 0.0) + u_displayMat3 * vec3(u_textTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth + delta_z, 1.0);\n}"},
util:{"encoding.glsl":"const vec4 rgba2float_factors \x3d vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}","util.glsl":"float nextPOT(in float x) {\nreturn pow(2.0, ceil(log2(abs(x))));\n}"}}})},"esri/views/2d/engine/webgl/BitBlitRenderer":function(){define("exports ../../../../core/maybe ./DefaultVertexAttributeLayouts ./shaders/BitBlitPrograms ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/ProgramTemplate ../../../webgl/VertexArrayObject".split(" "),
function(k,r,p,e,n,m,l,d){class a{constructor(){this._initialized=!1}dispose(){this._program=r.disposeMaybe(this._program);this._vertexArrayObject=r.disposeMaybe(this._vertexArrayObject)}render(b,f,g,q){b&&(this._initialized||this._initialize(b),b.setBlendFunctionSeparate(m.BlendFactor.ONE,m.BlendFactor.ONE_MINUS_SRC_ALPHA,m.BlendFactor.ONE,m.BlendFactor.ONE_MINUS_SRC_ALPHA),b.bindVAO(this._vertexArrayObject),b.useProgram(this._program),f.setSamplingMode(g),b.bindTexture(f,0),this._program.setUniform1i("u_tex",
0),this._program.setUniform1f("u_opacity",q),b.drawArrays(m.PrimitiveType.TRIANGLE_STRIP,0,4),b.bindTexture(null,0),b.bindVAO())}_initialize(b){if(this._initialized)return!0;const f=l.createProgram(b,e.bitBlit);if(!f)return!1;const g=new Int8Array(16);g[0]=-1;g[1]=-1;g[2]=0;g[3]=0;g[4]=1;g[5]=-1;g[6]=1;g[7]=0;g[8]=-1;g[9]=1;g[10]=0;g[11]=1;g[12]=1;g[13]=1;g[14]=1;g[15]=1;b=new d.VertexArrayObject(b,e.bitBlit.attributes,p.PosTex2b,new Map([["geometry",n.BufferObject.createVertex(b,m.Usage.STATIC_DRAW,
g)]]));this._program=f;this._vertexArrayObject=b;return this._initialized=!0}}k.BitBlitRenderer=a;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaders/BitBlitPrograms":function(){define(["exports","./sources/resolver"],function(k,r){r={shaders:{vertexShader:r.resolveIncludes("bitBlit/bitBlit.vert"),fragmentShader:r.resolveIncludes("bitBlit/bitBlit.frag")},attributes:new Map([["a_pos",0],["a_tex",1]])};k.bitBlit=r;Object.defineProperty(k,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/MaterialManager":function(){define(["./shaders/MaterialPrograms"],function(k){class r{constructor(p){this._rctx=p;this._programByKey=new Map}dispose(){this._programByKey.forEach(p=>p.dispose());this._programByKey.clear()}getProgram(p,e=[]){const n=p.vsPath+"."+p.fsPath+JSON.stringify(e);if(this._programByKey.has(n))return this._programByKey.get(n);e={...e.map(a=>"string"===typeof a?{name:a,value:!0}:a).reduce((a,b)=>({...a,[b.name]:b.value}),{})};const {vsPath:m,
fsPath:l,attributes:d}=p;p=k.createProgramTemplate(m,l,d,e);p=this._rctx.programCache.acquire(p.shaders.vertexShader,p.shaders.fragmentShader,p.attributes);if(!p)throw Error("Unable to get program for key: ${key}");this._programByKey.set(n,p);return p}}return r})},"esri/views/2d/engine/webgl/shaders/MaterialPrograms":function(){define(["exports","./sources/resolver","../../../../webgl/programUtils"],function(k,r,p){k.createProgramTemplate=(e,n,m,l)=>{e+=e.slice(Math.max(0,e.lastIndexOf("/")));n+=
n.slice(Math.max(0,n.lastIndexOf("/")));const d={};for(const b in l){let f=void 0;var a=b;f=""+a[0].toUpperCase();for(let g=1;g<a.length;g++){const q=a[g];q===q.toUpperCase()?(f+="_",f+=q):f+=q.toUpperCase()}d[f]=l[b]}l=p.glslifyDefineMap(d);return{attributes:m,shaders:{vertexShader:l+r.resolveIncludes(`${e}.vert`),fragmentShader:l+r.resolveIncludes(`${n}.frag`)}}};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TextureManager":function(){define("../../../../config ../../../../request ../../../../core/BidiText ../../../../core/Error ../../../../core/fontUtils ../../../../core/has ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/QueueProcessor ../../../../core/screenUtils ../../../../core/string ../../../../symbols/cim/CIMResourceManager ../../../../symbols/cim/CIMSymbolHelper ../../../../symbols/cim/Rasterizer ../../../../symbols/cim/utils ./definitions ./enums ./GlyphMosaic ./GlyphSource ./Rect ./SDFConverter ./SpriteMosaic ./urlUtils ./Utils ./animatedFormats/AnimatableTextureResource ./animations/store/AnimationStore ../../../webgl/enums".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g,q,c,h,u,A,z,t,w,x,B,C,y,v,F,D){function G(L){switch(L.type){case "CIMVectorMarker":case "CIMPictureMarker":return L&&"markerPlacement"in L&&L.markerPlacement&&"CIMMarkerPlacementInsidePolygon"===L.markerPlacement.type;default:return!0}}const E=(L,P,Q)=>l.getLogger("esri.views.MapView").error(new e(L,P,Q)),H=(L,P="")=>l.getLogger("esri.views.MapView").warnOnce(L,P);class K{static fromMosaic(L,P){return new K(L,P.page,P.sdf,P.samplingMode)}constructor(L,P,Q,S){this.mosaicType=
L;this.page=P;this.sdf=Q;this.samplingMode=S}}class J{constructor(L){this._requestRender=L;this._resourceManager=new g;this._invalidFontsMap=new Map;this._sdfConverter=new x(u.svgSdfTextureInnerSize);this._bindingInfos=[];this._hashToBindingIndex=new Map;this._ongoingRasterizations=new Map;this._imageRequestQueue=new a.QueueProcessor({concurrency:10,process:async(P,Q)=>{d.throwIfAborted(Q);try{return await r(P,{responseType:"image",signal:Q})}catch(S){if(!d.isAbortError(S))throw new e("mapview-invalid-resource",
`Could not fetch requested resource at ${P}`,S);throw S;}}});this.animationStore=new F.AnimationStore;this._spriteMosaic=new B(2048,2048,500);this._glyphSource=new t(`${k.fontsUrl}/{fontstack}/{range}.pbf`);this._glyphMosaic=new z(1024,1024,this._glyphSource);this._rasterizer=new c(this.resourceManager)}dispose(){this._spriteMosaic.dispose();this._glyphMosaic.dispose();this._rasterizer.dispose();this._sdfConverter.dispose();this._sdfConverter=this._glyphMosaic=this._spriteMosaic=null;this._hashToBindingIndex.clear();
this._bindingInfos=this._hashToBindingIndex=null;this._ongoingRasterizations.clear();this._ongoingRasterizations=null;this._imageRequestQueue.clear();this._imageRequestQueue=null;this._resourceManager.destroy();this.animationStore.destroy()}get sprites(){return this._spriteMosaic}get glyphs(){return this._glyphMosaic}get resourceManager(){return this._resourceManager}async rasterizeItem(L,P){if(null==L)return E("mapview-null-resource","Unable to rasterize null resource"),null;if("animation-info"===
L.type){var {resource:Q}=L;P=this.animationStore.add(Q);({location:P}=P);return{rect:new w(P.column,P.row,Q.length,1),page:P.page,type:"sprite",width:Q.length,height:1,rasterizationScale:1,sdfPaddingRatio:.5,samplingMode:"Linear",sdfDecodeCoeff:1,simplePattern:!1}}if("cim-rasterization-info"!==L.type)return E("mapview-unexpected-resource","Unable to rasterize resource"),null;({resource:L}=L);if("text"===L.type){P=await this._rasterizeText(L,P);for(Q of P.glyphs)this._setTextureBinding(A.MosaicType.GLYPH,
Q);return P}(Q=await this._rasterizeSprite(L,P))&&this._setTextureBinding(A.MosaicType.SPRITE,Q);return Q}getMosaicInfo(L,P,Q=!1){L=this._getTextureBindingInfo(L,P,Q);return L?{size:L.size,texture:{texture:L.texture,unit:"sprite"===L.type?u.textureBindingSpriteAtlas:u.textureBindingGlyphAtlas}}:(E("mapview-invalid-resource",`Unable to find resource for ${P}`),{size:[0,0],texture:{texture:null,unit:0}})}_getTextureBindingInfo(L,P,Q){var S=this._bindingInfos[P-1];P=S.page;Q="Nearest"===S.samplingMode?
D.TextureSamplingMode.NEAREST:Q?D.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:D.TextureSamplingMode.LINEAR;switch(S.mosaicType){case A.MosaicType.SPRITE:S=this.sprites.getWidth(P);var U=this.sprites.getHeight(P);S=[S,U];L=this._spriteMosaic.getTexture(L,P);L.setSamplingMode(Q);return{type:"sprite",texture:L,size:S};case A.MosaicType.GLYPH:return S=[this.glyphs.width,this.glyphs.height],U=this._glyphMosaic.getTexture(L,P),this._glyphMosaic.bind(L,Q,P,u.textureBindingGlyphAtlas),U.setSamplingMode(Q),{type:"glyph",
texture:U,size:S};default:return E("mapview-texture-manager",`Cannot handle unknown type ${S.mosaicType}`),null}}_hashMosaic(L,P){return 1|L<<1|(P.sdf?1:0)<<2|("Nearest"===P.samplingMode?1:0)<<3|P.page<<4}_setTextureBinding(L,P){const Q=this._hashMosaic(L,P);this._hashToBindingIndex.has(Q)||(L=K.fromMosaic(L,P),this._hashToBindingIndex.set(Q,this._bindingInfos.length+1),this._bindingInfos.push(L));P.textureBinding=this._hashToBindingIndex.get(Q)}async _rasterizeText(L,P){const {font:Q,textString:S}=
L;L=n.getFullyQualifiedFontName(Q);var U=this._invalidFontsMap.has(L);const [X,aa]=p.bidiText(S),ba=y.charCodes(X);try{return U=U?"arial-unicode-ms-regular":L,m("esri-2d-stabilize-glyphs")&&await this._glyphMosaic.preloadASCIIGlyphCache(U),{type:"glyphs",glyphs:await this._glyphMosaic.getGlyphItems(U,ba,P),isRightToLeft:aa}}catch(fa){return H(`Font ${L} is not available on the web, using "Arial Unicode MS Regular"`),this._invalidFontsMap.set(L,!0),{type:"glyphs",glyphs:await this._glyphMosaic.getGlyphItems("arial-unicode-ms-regular",
ba,P),isRightToLeft:aa}}}_hashSpriteResource(L){switch(L.type){case "path":return`path:${L.path}.${L.asFill?1:0}`;case "CIMPictureMarker":return`${L.type}:${L.url}:${L.size}:${y.getCIMMarkerPlacementHash(L.markerPlacement)}`;case "CIMPictureFill":return`${L.type}:${L.url}:${L.height}`;case "CIMPictureStroke":return`${L.type}:${L.url}:${L.width}`;case "dash":return`dash:${L.capStyle}.${h.normalizeDashTemplate(L.dashTemplate).join("")}`;case "sdf":return`sdf:${JSON.stringify(L.geom)}.${L.asFill?1:0}`;
case "fill-style":return`fill_style:${L.style}`;case "animated":return JSON.stringify(C.discardUrlIfHasUrlHash(L));case "CIMGradientFill":case "CIMGradientStroke":return`gradient:${JSON.stringify(L.colorRamp)}.${L.gradientType}.${L.interval}`;case "CIMHatchFill":case "CIMVectorMarker":return JSON.stringify(L)}}async _rasterizeSprite(L,P){if(!L)return null;const Q=f.numericHash(this._hashSpriteResource(L));if(this._spriteMosaic.has(Q))return this._spriteMosaic.getSpriteItem(Q);if("url"in L&&L.url||
"CIMPictureFill"===L.type||"CIMPictureStroke"===L.type||"CIMPictureMarker"===L.type||"CIMVectorMarker"===L.type){const S=[];q.CIMSymbolHelper.fetchResources({type:"CIMPointSymbol",symbolLayers:[L]},this._resourceManager,S);0<S.length&&await Promise.all(S)}switch(L.type){case "CIMPictureMarker":return"CIMMarkerPlacementInsidePolygon"===L.markerPlacement?.type?this._rasterizeJSONResource(Q,L):this._handleAsyncResource(Q,L,P);case "animated":return this._handleAsyncResource(Q,L,P);case "CIMPictureFill":case "CIMPictureStroke":case "path":return this._handleAsyncResource(Q,
L,P);case "CIMGradientFill":case "CIMGradientStroke":case "CIMHatchFill":case "CIMVectorMarker":case "dash":case "fill-style":case "sdf":return this._rasterizeJSONResource(Q,L)}}_rasterizeJSONResource(L,P){const Q=this._rasterizer.rasterizeJSONResource(P);if(Q){const {size:S,image:U,sdf:X,simplePattern:aa,rasterizationScale:ba,samplingMode:fa,sdfPaddingRatio:I,sdfDecodeCoeff:M}=Q;return this._addItemToMosaic(L,S,{type:"static",data:U},G(P),X,aa,ba,fa,I,M)}return null}async _handleAsyncResource(L,
P,Q){if(this._ongoingRasterizations.has(L))return this._ongoingRasterizations.get(L);P="path"===P.type?this._handleSVG(P,L,Q):this._handleImage(P,L,Q);this._ongoingRasterizations.set(L,P);P.finally(()=>this._ongoingRasterizations.delete(L));return P}async _handleSVG(L,P,Q){const S=[u.svgSdfTextureInnerSize,u.svgSdfTextureInnerSize],{asFill:U}=L;L=await this._sdfConverter.draw(L.path,U,Q);return this._addItemToMosaic(P,S,{type:"static",data:new Uint32Array(L.buffer)},!1,!0,!0)}async _handleGIFOrPNG(L,
P,Q){const S=this.resourceManager.getResource(L.url);if(null==S)return null;const {width:U,height:X}=S;if(S instanceof HTMLImageElement){if("animated"===L.type)return E("mapview-unexpected-resource","Attempt to configure animations for a non-animated image."),null;const {size:ba,sdf:fa,image:I}=this._rasterizer.rasterizeImageResource(U,X,S,"colorSubstitutions"in L?L.colorSubstitutions:void 0);return this._addItemToMosaic(P,ba,{type:"static",data:I},G(L),fa,!1)}let aa;"animated"===L.type?(Q=!1,aa=
{type:"CIMAnimatedSymbolProperties",playAnimation:L.playAnimation,reverseAnimation:L.reverseAnimation,randomizeStartTime:L.randomizeStartTime,randomizeStartSeed:L.randomizeStartSeed,startTimeOffset:L.startTimeOffset,duration:L.duration,repeatType:L.repeatType,repeatDelay:L.repeatDelay},L=L.startGroup||0):(Q=G(L),aa={type:"CIMAnimatedSymbolProperties"},L=0);L=new v.AnimatableTextureResource(S,this._requestRender,aa,L);return this._addItemToMosaic(P,[L.width,L.height],{type:"animated",data:L},Q,!1,
!1)}async _handleImage(L,P,Q){const S=L.url;var U;(U=S&&(S.includes(".gif")||null!=S&&S.startsWith("data:image/gif")))||(U=S&&(S.includes(".png")||null!=S&&S.startsWith("data:image/png")));if(U)return this._handleGIFOrPNG(L,P,Q);if("animated"===L.type)return E("mapview-unexpected-resource","Attempt to configure animations for a non-animated image."),null;try{let X;const aa=this.resourceManager.getResource(S);if(null!=aa&&aa instanceof HTMLImageElement)X=aa;else{const {data:M}=await this._imageRequestQueue.push(S,
{...Q});X=M}y.isSVGImage(S)&&("width"in L&&"height"in L?(X.width=b.pt2px(L.width),X.height=b.pt2px(L.height)):"cim"in L&&(X.width=b.pt2px(L.width??L.scaleX*L.size),X.height=b.pt2px(L.size)));if(!X.width||!X.height)return null;const {size:ba,sdf:fa,image:I}=this._rasterizer.rasterizeImageResource(X.width,X.height,X,"colorSubstitutions"in L?L.colorSubstitutions:void 0);return this._addItemToMosaic(P,ba,{type:"static",data:I},G(L),fa,!1)}catch(X){if(!d.isAbortError(X))throw new e("mapview-invalid-resource",
`Could not fetch requested resource at ${S}. ${X.message}`);throw X;}}_addItemToMosaic(L,P,Q,S,U,X,aa,ba,fa,I){return this._spriteMosaic.addSpriteItem(L,P,Q,S,U,X,aa,ba,fa,I)}}return J})},"esri/core/QueueProcessor":function(){define("exports ./maybe ./promiseUtils ./Queue ./ReactiveMap ./scheduling ./signal".split(" "),function(k,r,p,e,n,m,l){class d{constructor(b,f){this.item=b;this.controller=f;this.promise=null}}class a{constructor(b){this._schedule=null;this._deferreds=new n;this._controllers=
new n;this._processingItems=new n;this._pausedSignal=l.signal(!1);this.concurrency=1;b.concurrency&&(this.concurrency=b.concurrency);this._queue=new e(b.peeker);this.process=b.process}destroy(){this.clear();this._schedule=r.removeMaybe(this._schedule)}get updating(){return this.running}get length(){return this._processingItems.size+this._queue.length}get running(){return!this._pausedSignal.value&&0<this._queue.length&&this._processingItems.size<this.concurrency}abort(b){(b=this._controllers.get(b))&&
b.abort()}clear(){this._queue.clear();const b=[];this._controllers.forEach(f=>b.push(f));this._controllers.clear();b.forEach(f=>f.abort());this._processingItems.clear();this._cancelNext()}forEach(b){this._deferreds.forEach((f,g)=>b(g))}get(b){return(b=this._deferreds.get(b))?b.promise:void 0}isOngoing(b){return this._processingItems.has(b)}has(b){return this._deferreds.has(b)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(b,f){const g=this.get(b);if(g)return g;
const q=new AbortController;let c=null;f&&(c=p.onAbort(f,()=>q.abort()));const h=()=>{u.remove();null!=c&&c.remove();this._removeItem(b);this._queue.remove(b);this._scheduleNext()},u=p.onAbortOrThrow(q.signal,()=>{const z=this._processingItems.get(b);z&&z.controller.abort();h();A.reject(p.createAbortError())}),A=p.createResolver();this._deferreds.set(b,A);this._controllers.set(b,q);A.promise.then(h,h);this._queue.push(b);this._scheduleNext();return A.promise}last(){return this._queue.last()}lastPromise(){const b=
this.last();return b?this.get(b):null}peek(){return this._queue.peek()}popLast(){const b=this._queue.popLast();b&&(this._deferreds.get(b)?.reject(p.createAbortError()),this._removeItem(b));return b}reset(){const b=Array.from(this._processingItems.values());this._processingItems.clear();for(const f of b)this._queue.push(f.item),f.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const b=[];for(;this._queue.length;)b.push(this._queue.pop());
this.clear();return b}_removeItem(b){this._deferreds.delete(b);this._controllers.delete(b);this._processingItems.delete(b)}_scheduleNext(){this._pausedSignal.value||this._schedule||(this._schedule=m.schedule(()=>{this._schedule=null;this._next()}))}_next(){for(;0<this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(b,f){this._canProcessFulfillment(b)&&(this._scheduleNext(),
this._deferreds.get(b.item).resolve(f))}_processError(b,f){this._canProcessFulfillment(b)&&(this._scheduleNext(),this._deferreds.get(b.item).reject(f))}_canProcessFulfillment(b){return this._deferreds.get(b.item)&&this._processingItems.get(b.item)===b?!0:!1}_process(b){if(null!=b){var f=new AbortController,g=new d(b,f);this._processingItems.set(b,g);try{var q=this.process(b,f.signal)}catch(c){this._processError(g,c)}p.isPromiseLike(q)?(g.promise=q,q.then(c=>this._processResult(g,c),c=>this._processError(g,
c))):this._processResult(g,q)}}}k.QueueProcessor=a;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMResourceManager":function(){define(["../../core/fontUtils","../../core/imageUtils"],function(k,r){class p{constructor(){this._resourceMap=new Map;this._inFlightResourceMap=new Map;this.geometryEnginePromise=this.geometryEngine=null}destroy(){this._inFlightResourceMap.clear();this._resourceMap.clear()}getResource(e){return this._resourceMap.get(e)??null}async fetchResource(e,
n){var m=this._resourceMap.get(e);if(m)return{width:m.width,height:m.height};if(m=this._inFlightResourceMap.get(e))return m.then(l=>({width:l.width,height:l.height}));m=r.getImageData(e,n);this._inFlightResourceMap.set(e,m);return m.then(l=>{this._inFlightResourceMap.delete(e);this._resourceMap.set(e,l);return{width:l.width,height:l.height}},()=>({width:0,height:0}))}deleteResource(e){this._inFlightResourceMap.delete(e);this._resourceMap.delete(e)}loadFont(e){return k.loadFont(e)}}return p})},"esri/symbols/cim/Rasterizer":function(){define("./CIMSymbolHelper ./rasterizingUtils ./Rect ./SDFHelper ./utils ../../views/2d/engine/webgl/definitions".split(" "),
function(k,r,p,e,n,m){function l(a){if(!a)return null;const {data:b,width:f,height:g,sdfPaddingRatio:q,sdfDecodeCoeff:c}=e.buildSDF(a);return b?{size:[f,g],image:new Uint32Array(b.buffer),sdf:!0,simplePattern:!0,sdfPaddingRatio:q,sdfDecodeCoeff:c,anchorX:0,anchorY:0}:null}class d{constructor(a){this._resourceManager=a;this._cachedRasterizationCanvas=null}dispose(){this._cachedRasterizationCanvas=null}get _canvas(){this._cachedRasterizationCanvas||(this._cachedRasterizationCanvas=document.createElement("canvas"));
return this._cachedRasterizationCanvas}rasterizeJSONResource(a){switch(a.type){case "dash":a=n.normalizeDashTemplate(a.dashTemplate);const [b,f,g]=r.rasterizeDash1D(a);return{size:[f,g],image:new Uint32Array(b.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0};case "fill-style":const [q,c,h,u]=r.rasterizeFillStyle(this._canvas,a,m.patternFillRasterizationScale);return{size:[c,h],image:new Uint32Array(q.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0,rasterizationScale:u};case "sdf":return l(a);
case "CIMGradientFill":case "CIMGradientStroke":case "CIMHatchFill":case "CIMPictureMarker":case "CIMVectorMarker":return this._rasterizeCIMJSONResource(a)}}_rasterizeCIMJSONResource(a){switch(a.type){case "CIMGradientFill":case "CIMGradientStroke":const [b,f,g]=r.rasterizeGradient(this._canvas,a);return{size:[f,g],image:new Uint32Array(b.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,samplingMode:"Discrete"===a.gradientType||"CIMFixedColorRamp"===a.colorRamp.type?"Nearest":"Linear"};case "CIMHatchFill":return a=
k.CIMSymbolHelper.fromCIMHatchFill(a,m.patternFillRasterizationScale),this._rasterizeCIMVectorMarker(a);case "CIMPictureMarker":return a=k.CIMSymbolHelper.fromCIMInsidePolygon(a),this._rasterizeCIMVectorMarker(a);case "CIMVectorMarker":if("CIMMarkerPlacementInsidePolygon"===a.markerPlacement?.type)return a=k.CIMSymbolHelper.fromCIMInsidePolygon(a),this._rasterizeCIMVectorMarker(a);const q=e.getSDFInfo(a);return q&&!a.avoidSDFRasterization?l(q):this._rasterizeCIMVectorMarker(a,!1,m.rasterizedVectorMarkerMinSize)}}_rasterizeCIMVectorMarker(a,
b=!0,f){b=b?p.fromExtent(a.frame):null;const [g,q,c,h,u]=k.CIMSymbolHelper.rasterize(this._canvas,a,b,this._resourceManager,!0,f);return g?{size:[q,c],image:new Uint32Array(g.buffer),sdf:!1,simplePattern:!1,anchorX:h,anchorY:u}:null}rasterizeImageResource(a,b,f,g){this._canvas.width=a;this._canvas.height=b;var q=this._canvas.getContext("2d",{willReadFrequently:!0});f instanceof ImageData?q.putImageData(f,0,0):(f.setAttribute("width",`${a}px`),f.setAttribute("height",`${b}px`),q.drawImage(f,0,0,a,
b));f=q.getImageData(0,0,a,b);f=new Uint8Array(f.data);if(g)for(var c of g)if(c&&c.oldColor&&4===c.oldColor.length&&c.newColor&&4===c.newColor.length){const [h,u,A,z]=c.oldColor,[t,w,x,B]=c.newColor;if(h!==t||u!==w||A!==x||z!==B)for(g=0;g<f.length;g+=4)h===f[g]&&u===f[g+1]&&A===f[g+2]&&z===f[g+3]&&(f[g]=t,f[g+1]=w,f[g+2]=x,f[g+3]=B)}for(g=0;g<f.length;g+=4)c=f[g+3]/255,f[g]*=c,f[g+1]*=c,f[g+2]*=c;q=f;c=a;g=b;if(512<=c||512<=g){q=c/g;1<q?(c=512,g=Math.round(512/q)):(g=512,c=Math.round(512*q));q=new Uint8Array(4*
c*g);const h=new Uint8ClampedArray(q.buffer);n.resampleHermite(f,a,b,h,c,g,!1)}return{size:[c,g],image:new Uint32Array(q.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}}return d})},"esri/views/2d/engine/webgl/GlyphMosaic":function(){define("../../../../core/has ../../../../core/promiseUtils ./Rect ./RectangleBinPack ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),function(k,r,p,e,n,m,l){function d(f){const g=new Set;for(const q of f)g.add(Math.floor(q/
256));return g}function a(f,g,q){f.has(g)||f.set(g,q().then(()=>{f.delete(g)}).catch(c=>{f.delete(g);r.throwIfNotAbortError(c)}));return f.get(g)}class b{constructor(f,g,q){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphCache={};this._textures=[];this._rangePromises=new Map;this._preloadCache={};this.width=f;this.height=g;this._glyphSource=q;this._binPack=new e(f-4,g-4);this._glyphData.push(new Uint8Array(f*g));this._dirties.push(!0);this._textures.push(null);
this._initDecorationGlyphs()}dispose(){this._binPack=null;for(const f of this._textures)f&&f.dispose();this._textures.length=0;this._glyphData.length=0}_initDecorationGlyphs(){var f=[117,149,181,207,207,181,149,117];const g=[];var q=[];for(let c=0;c<f.length;c++){const h=f[c];for(let u=0;11>u;u++){const A=3<=c&&5>c&&3<=u&&8>u?255:0;g.push(h);q.push(A)}}f={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(g)};q={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(q)};
this._recordGlyph(f);this._recordGlyph(q)}getTexture(f,g){if(!this._textures[g]){const q=new l.TextureDescriptor;q.pixelFormat=n.PixelFormat.ALPHA;q.wrapMode=n.TextureWrapMode.CLAMP_TO_EDGE;q.width=this.width;q.height=this.height;this._textures[g]=new m.Texture(f,q,new Uint8Array(this.width*this.height))}this._dirties[g]&&(this._textures[g].setData(this._glyphData[g]),this._dirties[g]=!1);return this._textures[g]}async getGlyphItems(f,g,q){const c=this._getGlyphCache(f);await this._fetchRanges(f,
g,q);return g.map(h=>this._getMosaicItem(c,f,h))}bind(f,g,q,c){q=this.getTexture(f,q);q.setSamplingMode(g);f.bindTexture(q,c)}preloadASCIIGlyphCache(f){var g=this._preloadCache[f];if(null!=g)return g;g=this._glyphSource.preloadASCIIRange(f).then(()=>{const q=this._getGlyphCache(f);for(let c=0;256>c;c++)this._getMosaicItem(q,f,c)});return this._preloadCache[f]=g}_getGlyphCache(f){this._glyphCache[f]||(this._glyphCache[f]={});return this._glyphCache[f]}_invalidate(){this._dirties[this._currentPage]=
!0}async _fetchRanges(f,g,q){const c=[];d(g).forEach(h=>{c.push(this._fetchRange(f,h,q))});await Promise.all(c)}async _fetchRange(f,g,q){if(!(256<g))return a(this._rangePromises,f+g,()=>this._glyphSource.getRange(f,g,q))}_getMosaicItem(f,g,q){if(!f[q]){g=this._glyphSource.getGlyph(g,q);if(!g?.metrics)return{rect:new p(0,0,0,0),page:0,metrics:{left:0,width:0,height:0,advance:0,top:0},code:q,sdf:!0};const c=this._recordGlyph(g);f[q]={rect:c,page:this._currentPage,metrics:g.metrics,code:q,sdf:!0};this._invalidate()}return f[q]}_recordGlyph(f){var g=
f.metrics;if(0===g.width)g=new p(0,0,0,0);else{const q=g.width+6,c=g.height+6;g=this._binPack.allocate(q,c);g.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyphs(),this._binPack=new e(this.width-4,this.height-4),g=this._binPack.allocate(q,c));const h=this._glyphData[this._currentPage];f=f.bitmap;
let u,A;if(f)for(let z=0;z<c;z++){u=q*z;A=this.width*(g.y+z)+g.x;for(let t=0;t<q;t++)h[A+t]=f[u+t]}k("esri-glyph-debug")&&this._showDebugPage(h)}return g}_showDebugPage(f){const g=document.createElement("canvas"),q=g.getContext("2d"),c=new ImageData(this.width,this.height),h=c.data;g.width=this.width;g.height=this.height;g.style.border="1px solid black";for(let u=0;u<f.length;++u)h[4*u]=f[u],h[4*u+1]=0,h[4*u+2]=0,h[4*u+3]=255;q.putImageData(c,0,0);document.body.appendChild(g)}}return b})},"esri/views/2d/engine/webgl/RectangleBinPack":function(){define(["./Rect"],
function(k){class r{constructor(p,e){this._height=this._width=0;this._free=[];this._width=p;this._height=e;this._free.push(new k(0,0,p,e))}get width(){return this._width}get height(){return this._height}allocate(p,e){if(p>this._width||e>this._height)return new k;let n=null,m=-1;for(let l=0;l<this._free.length;++l){const d=this._free[l];p<=d.width&&e<=d.height&&(null===n||d.y<=n.y&&d.x<=n.x)&&(n=d,m=l)}if(null===n)return new k;this._free.splice(m,1);n.width<n.height?(n.width>p&&this._free.push(new k(n.x+
p,n.y,n.width-p,e)),n.height>e&&this._free.push(new k(n.x,n.y+e,n.width,n.height-e))):(n.width>p&&this._free.push(new k(n.x+p,n.y,n.width-p,n.height)),n.height>e&&this._free.push(new k(n.x,n.y+e,p,n.height-e)));return new k(n.x,n.y,p,e)}release(p){for(let e=0;e<this._free.length;++e){const n=this._free[e];if(n.y===p.y&&n.height===p.height&&n.x+n.width===p.x)n.width+=p.width;else if(n.x===p.x&&n.width===p.width&&n.y+n.height===p.y)n.height+=p.height;else if(p.y===n.y&&p.height===n.height&&p.x+p.width===
n.x)n.x=p.x,n.width+=p.width;else if(p.x===n.x&&p.width===n.width&&p.y+p.height===n.y)n.y=p.y,n.height+=p.height;else continue;this._free.splice(e,1);this.release(p)}this._free.push(p)}}return r})},"esri/views/2d/engine/webgl/GlyphSource":function(){define(["../../../../request","../../../../core/pbf"],function(k,r){class p{constructor(m){this._metrics=[];for(this._bitmaps=[];m.next();)switch(m.tag()){case 1:const l=m.getMessage();for(;l.next();)switch(l.tag()){case 3:const d=l.getMessage();let a,
b,f,g,q,c,h;for(;d.next();)switch(d.tag()){case 1:a=d.getUInt32();break;case 2:b=d.getBytes();break;case 3:f=d.getUInt32();break;case 4:g=d.getUInt32();break;case 5:q=d.getSInt32();break;case 6:c=d.getSInt32();break;case 7:h=d.getUInt32();break;default:d.skip()}d.release();a&&(this._metrics[a]={width:f,height:g,left:q,top:c,advance:h},this._bitmaps[a]=b);break;default:l.skip()}l.release();break;default:m.skip()}}getMetrics(m){return this._metrics[m]}getBitmap(m){return this._bitmaps[m]}}class e{constructor(){this._ranges=
[]}getRange(m){return this._ranges[m]}addRange(m,l){this._ranges[m]=l}}class n{constructor(m){this._glyphInfo={};this._baseURL=m}getRange(m,l,d){const a=this._getFontStack(m);if(a.getRange(l))return Promise.resolve();const b=256*l,f=b+255;m=this._baseURL.replace("{fontstack}",m).replace("{range}",b+"-"+f);return k(m,{responseType:"array-buffer",...d}).then(g=>{a.addRange(l,new p(new r(new Uint8Array(g.data),new DataView(g.data))))})}async preloadASCIIRange(m){const l=this._getFontStack(m);m=this._baseURL.replace("{fontstack}",
m).replace("{range}","0-255");m=await k(m,{responseType:"array-buffer"});m=new p(new r(new Uint8Array(m.data),new DataView(m.data)));for(let d=0;255>=d;d++)l.getRange(d)||l.addRange(d,m)}getGlyph(m,l){if(m=this._getFontStack(m))if(m=m.getRange(Math.floor(l/256)))return{metrics:m.getMetrics(l),bitmap:m.getBitmap(l)}}_getFontStack(m){let l=this._glyphInfo[m];l||=this._glyphInfo[m]=new e;return l}}return n})},"esri/views/2d/engine/webgl/SDFConverter":function(){define(["../../../../core/floatRGBA","../../../../core/promiseUtils",
"../svgUtils"],function(k,r,p){class e{constructor(n,m=2){this._textureSize=n;this._rasterizationScale=m;this._canvasSize=this._textureSize*this._rasterizationScale;this._svg=null;({_canvasSize:n}=this);m=document.createElement("canvas");m.width=m.height=n;this._context=m.getContext("2d",{willReadFrequently:!1});this._gridOuter=new Float64Array(n*n);this._gridInner=new Float64Array(n*n);this._f=new Float64Array(n);this._d=new Float64Array(n);this._z=new Float64Array(n+1);this._v=new Int16Array(n)}dispose(){this._context=
this._gridOuter=this._gridInner=this._f=this._d=this._z=this._v=null;this._svg=p.destroyHiddenSvg(this._svg)}draw(n,m,l){const {_canvasSize:d,_textureSize:a,_rasterizationScale:b}=this,f=a/4;this._initSVG();const g=this.createSVGString(n,m);return new Promise((q,c)=>{const h=new Image;h.src="data:image/svg+xml; charset\x3dutf8, "+encodeURIComponent(g);h.onload=()=>{h.onload=null;this._context.clearRect(0,0,d,d);this._context.drawImage(h,0,0,d,d);var A=this._context.getImageData(0,0,d,d);const z=new Uint8Array(a*
a*4);for(var t=0;t<d*d;t++){var w=A.data[4*t+3]/255;this._gridOuter[t]=1===w?0:0===w?1E20:Math.max(0,.5-w)**2;this._gridInner[t]=1===w?1E20:0===w?0:Math.max(0,w-.5)**2}this._edt(this._gridOuter,d,d);this._edt(this._gridInner,d,d);for(A=0;A<a*a;A++){t=0;for(w=0;w<b;w++){const x=Math.floor(A/a)*b+w;for(let B=0;B<b;B++){const C=x*d+(A%a*b+B);t+=this._gridOuter[C]-this._gridInner[C]}}t/=b*b;t/=b;k.packFloatRGBA(.5-t/(2*f),z,4*A)}q(z)};const u=l?.signal;if(u)r.onAbort(u,()=>c(r.createAbortError()))})}_initSVG(){this._svg||
(this._svg=p.createHiddenSvg());return this._svg}createSVGString(n,m){const l=this._initSVG(),d=p.createSvgElement("path");d.setAttribute("d",n);l.appendChild(d);n=d.getBBox();var a=n.width/n.height;const b=this._canvasSize/2;let f,g;1<a?(f=b/n.width,g=this._canvasSize/4,a=b-1/a*b/2):(f=b/n.height,g=b-b*a/2,a=this._canvasSize/4);d.setAttribute("style",`transform: matrix(${f}, 0, 0, ${f}, ${-n.x*f+g}, ${-n.y*f+a})`);d.setAttribute("stroke-width",`${.5/f}`);m=`<svg style="fill:${m?"red":"none"}; stroke:${m?
"none":"red"}" height="${this._canvasSize}" width="${this._canvasSize}" xmlns="http://www.w3.org/2000/svg">${l.innerHTML}</svg>`;l.removeChild(d);return m}_edt(n,m,l){const d=this._f,a=this._d,b=this._v,f=this._z;for(var g=0;g<m;g++){for(var q=0;q<l;q++)d[q]=n[q*m+g];this._edt1d(d,a,b,f,l);for(q=0;q<l;q++)n[q*m+g]=a[q]}for(g=0;g<l;g++){for(q=0;q<m;q++)d[q]=n[g*m+q];this._edt1d(d,a,b,f,m);for(q=0;q<m;q++)n[g*m+q]=Math.sqrt(a[q])}}_edt1d(n,m,l,d,a){l[0]=0;d[0]=-1E20;d[1]=1E20;for(let b=1,f=0;b<a;b++){let g=
(n[b]+b*b-(n[l[f]]+l[f]*l[f]))/(2*b-2*l[f]);for(;g<=d[f];)f--,g=(n[b]+b*b-(n[l[f]]+l[f]*l[f]))/(2*b-2*l[f]);f++;l[f]=b;d[f]=g;d[f+1]=1E20}for(let b=0,f=0;b<a;b++){for(;d[f+1]<b;)f++;m[b]=(b-l[f])*(b-l[f])+n[l[f]]}}}return e})},"esri/views/2d/engine/webgl/SpriteMosaic":function(){define("../../../../core/Error ../../../../core/has ./definitions ./GeometryUtils ./Rect ./RectangleBinPack ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),function(k,r,p,e,n,m,l,d,
a){function b(c){return c&&"static"===c.type}function f(c,h){const u=new a.TextureDescriptor;u.width=h[0];u.height=h[1];u.wrapMode=l.TextureWrapMode.CLAMP_TO_EDGE;return new d.Texture(c,u,null)}class g{constructor(c,h,u=0){this._mosaicPages=[];this._pageHeight=this._pageWidth=this._currentPage=this._maxItemSize=0;this._mosaicRects=new Map;this._spriteCopyQueue=[];this.pixelRatio=1;this._pageWidth=c;this._pageHeight=h;0<u&&(this._maxItemSize=u);this.pixelRatio=window.devicePixelRatio||1;this._binPack=
new m(this._pageWidth,this._pageHeight);this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight))},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0})}getWidth(c){return c>=this._mosaicPages.length?-1:this._mosaicPages[c].size[0]}getHeight(c){return c>=this._mosaicPages.length?-1:this._mosaicPages[c].size[1]}getPageTexture(c){return c<this._mosaicPages.length?this._mosaicPages[c].texture:null}has(c){return this._mosaicRects.has(c)}get itemCount(){return this._mosaicRects.size}getSpriteItem(c){return this._mosaicRects.get(c)}addSpriteItem(c,
h,u,A,z,t,w=1,x="Linear",B=.5,C=1){if(this._mosaicRects.has(c))return this._mosaicRects.get(c);let y,v,F;b(u)?[y,v,F]=this._allocateImage(h[0],h[1]):(y=new n(0,0,h[0],h[1]),v=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:u,size:[h[0]+2*p.spritePadding,h[1]+2*p.spritePadding],dirty:!0,texture:void 0}));if(0>=y.width||0>=y.height)return null;t={type:"sprite",rect:y,width:h[0],height:h[1],sdf:z,simplePattern:t,rasterizationScale:w,samplingMode:x,sdfPaddingRatio:B,sdfDecodeCoeff:C,page:v};
this._mosaicRects.set(c,t);b(u)&&(r("esri-mosaic-debug")&&this._showDebugSprite(h,u.data),this._copy({rect:y,spriteSize:h,spriteData:u.data,page:v,pageSize:F,repeat:A,sdf:z}));return t}hasItemsToProcess(){return 0!==this._spriteCopyQueue.length}processNextItem(){const c=this._spriteCopyQueue.pop();c&&this._copy(c)}getMosaicItemPosition(c){c=this.getSpriteItem(c);const h=c?.rect;if(!h)return null;h.width=c.width;h.height=c.height;const u=p.spritePadding,A=this._mosaicPages[c.page].size;return{size:[c.width,
c.height],tl:[(h.x+u)/A[0],(h.y+u)/A[1]],br:[(h.x+u+c.width)/A[0],(h.y+u+c.height)/A[1]],page:c.page}}bind(c,h,u=0,A=0){const z=this._mosaicPages[u],t=z.mosaicsData;let w=z.texture;w||(w=f(c,z.size),z.texture=w);w.setSamplingMode(h);b(t)?(c.bindTexture(w,A),z.dirty&&(w.setData(new Uint8Array(t.data.buffer)),w.generateMipmap(),r("esri-mosaic-debug")&&this._showDebugPage(u))):(t.data.loadFrame(w),c.bindTexture(w,A),w.generateMipmap());z.dirty=!1}getTexture(c,h=0){const u=this._mosaicPages[h],A=u.mosaicsData;
let z=u.texture;z||(z=f(c,u.size),u.texture=z);b(A)?u.dirty&&(z.setData(new Uint8Array(A.data.buffer)),z.generateMipmap(),r("esri-mosaic-debug")&&this._showDebugPage(h)):(A.data.loadFrame(z),z.generateMipmap());u.dirty=!1;return z}dispose(){this._binPack=null;for(const h of this._mosaicPages){var c=h.texture;c&&c.dispose();c=h.mosaicsData;b(c)||c.data.destroy()}this._mosaicPages=null;this._mosaicRects.clear()}static _copyBits(c,h,u,A,z,t,w,x,B,C,y){let v=A*h+u;w=x*t+w;if(y)for(w-=t,y=-1;y<=C;y++,
v=((y+C)%C+A)*h+u,w+=t)for(x=-1;x<=B;x++)z[w+x]=c[v+(x+B)%B];else for(u=0;u<C;u++){for(A=0;A<B;A++)z[w+A]=c[v+A];v+=h;w+=t}}_copy(c){if(!(c.page>=this._mosaicPages.length)){var h=this._mosaicPages[c.page],u=h.mosaicsData;if(!b(h.mosaicsData))throw new k("mapview-invalid-resource","unsuitable data type!");g._copyBits(c.spriteData,c.spriteSize[0],0,0,u.data,c.pageSize[0],c.rect.x+p.spritePadding,c.rect.y+p.spritePadding,c.spriteSize[0],c.spriteSize[1],c.repeat);h.dirty=!0}}_allocateImage(c,h){c+=2*
p.spritePadding;h+=2*p.spritePadding;var u=Math.max(c,h);if(this._maxItemSize&&this._maxItemSize<u){u=2**Math.ceil(e.log2(c));const A=2**Math.ceil(e.log2(h));c=new n(0,0,c,h);this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(u*A)},size:[u,A],dirty:!0,texture:void 0});return[c,this._mosaicPages.length-1,[u,A]]}u=this._binPack.allocate(c,h);return 0>=u.width?(u=this._mosaicPages[this._currentPage],!u.dirty&&b(u.mosaicsData)&&(u.mosaicsData.data=null),this._currentPage=this._mosaicPages.length,
this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(this._pageWidth*this._pageHeight)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0}),this._binPack=new m(this._pageWidth,this._pageHeight),this._allocateImage(c,h)):[u,this._currentPage,[this._pageWidth,this._pageHeight]]}_showDebugSprite([c,h],u){const A=document.createElement("canvas");A.width=c;A.height=h;A.setAttribute("style",`position: absolute; top: ${4+204*q++}px; right: 208px; width: 200px; height: 200px; border: 1px solid black;`);
const z=A.getContext("2d");c=new ImageData(c,h);c.data.set(new Uint8Array(u.buffer));z.putImageData(c,0,0);document.body.appendChild(A)}_showDebugPage(c){const {size:[h,u],mosaicsData:A}=this._mosaicPages[c];if(b(A)){var z=`mosaicDebugPage${c}`,t=document.getElementById(z)??document.createElement("canvas");t.id=z;t.width=h;t.height=u;t.setAttribute("style",`position: absolute; top: ${4+204*c}px; right: 4px; width: 200px; height: 200px; border: 1px solid black;`);c=t.getContext("2d");z=new ImageData(h,
u);z.data.set(new Uint8Array(A.data.buffer));c.putImageData(z,0,0);document.body.appendChild(t)}}}let q=0;return g})},"esri/views/2d/engine/webgl/urlUtils":function(){define(["exports"],function(k){k.discardUrlIfHasUrlHash=function(r){return"url"in r&&"urlHash"in r?{...r,url:""}:r};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/animatedFormats/AnimatableTextureResource":function(){define(["exports","../definitions","./utils"],function(k,r,p){class e{constructor(n,
m,l,d){this._animation=n;this._frameData=null;this.frameCount=this._animation.frameDurations.length;this.width=this._animation.width;this.height=this._animation.height;this._playHandle=p.play(this._animation,l,d,a=>{this._frameData=a;m.requestRender()})}destroy(){this._playHandle.remove()}loadFrame(n){const m=this._frameData;null!=m&&(n.updateData(0,r.spritePadding,r.spritePadding,"width"in m?m.width:m.codedWidth,"height"in m?m.height:m.codedHeight,m),this._frameData=null)}}k.AnimatableTextureResource=
e;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/animatedFormats/utils":function(){define(["exports","../../../../../core/handleUtils","../../../../../core/time","../../../../../symbols/cim/enums","../grouping"],function(k,r,p,e,n){function m(q){return p.Milliseconds(q.frameDurations.reduce((c,h)=>c+h,0))}function l(q){const {width:c,height:h}=q,u=q.frameDurations.reverse();return{frameCount:q.frameCount,duration:q.duration,frameDurations:u,getFrame:A=>
q.getFrame(q.frameDurations.length-1-A),width:c,height:h}}function d(q,c){const {width:h,height:u,getFrame:A}=q,z=c/q.duration;c=q.frameDurations.map(t=>p.Milliseconds(t*z));return{frameCount:q.frameCount,duration:q.duration,frameDurations:c,getFrame:A,width:h,height:u}}function a(q,c){const {width:h,height:u,getFrame:A}=q,z=q.frameDurations.slice(),t=z.shift();z.unshift(p.Milliseconds(t+c));return{frameCount:q.frameCount,duration:q.duration+c,frameDurations:z,getFrame:A,width:h,height:u}}function b(q,
c){const {width:h,height:u,getFrame:A}=q,z=q.frameDurations.slice(),t=z.pop();z.push(p.Milliseconds(t+c));return{frameCount:q.frameCount,duration:q.duration+c,frameDurations:z,getFrame:A,width:h,height:u}}function f(q,c,h,u){let {repeatType:A}=c;null==A&&(A=e.AnimatedSymbolRepeatType.Loop);!0===c.reverseAnimation&&(q=l(q));null!=c.duration&&(q=d(q,p.Milliseconds(1E3*c.duration)));if(null!=c.repeatDelay){const z=1E3*c.repeatDelay;A===e.AnimatedSymbolRepeatType.Loop?q=b(q,p.Milliseconds(z)):A===e.AnimatedSymbolRepeatType.Oscillate&&
(q=a(b(q,p.Milliseconds(z/2)),p.Milliseconds(z/2)))}null!=c.startTimeOffset?c=p.Milliseconds(1E3*c.startTimeOffset):null!=c.randomizeStartTime?(c=n.getRandomValue(h,null!=c.randomizeStartSeed?c.randomizeStartSeed:82749913),c=p.Milliseconds(c*m(q))):c=p.Milliseconds(0);return new g(q,c,A,u)}class g{constructor(q,c,h,u){this._animation=q;this._repeatType=h;this._onFrameData=u;this._direction=1;this._currentFrame=0;this.timeToFrame=this._animation.frameDurations[this._currentFrame];for(q=0;c>q;)q+=this.timeToFrame,
this.nextFrame();c=this._animation.getFrame(this._currentFrame);this._onFrameData(c)}nextFrame(){this._currentFrame+=this._direction;if(0<this._direction){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case e.AnimatedSymbolRepeatType.None:this._currentFrame-=this._direction;break;case e.AnimatedSymbolRepeatType.Loop:this._currentFrame=0;break;case e.AnimatedSymbolRepeatType.Oscillate:this._currentFrame-=this._direction,this._direction=-1}}else if(-1===this._currentFrame)switch(this._repeatType){case e.AnimatedSymbolRepeatType.None:this._currentFrame-=
this._direction;break;case e.AnimatedSymbolRepeatType.Loop:this._currentFrame=this._animation.frameDurations.length-1;break;case e.AnimatedSymbolRepeatType.Oscillate:this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];const q=this._animation.getFrame(this._currentFrame);this._onFrameData(q)}}k.Player=g;k.adjustDuration=d;k.appendDelay=b;k.createPlayer=f;k.getDuration=m;k.play=function(q,c,h,u){function A(){x=z?setTimeout(()=>{t.nextFrame();
w=t.timeToFrame;A()},w):void 0}const z=null!=c.playAnimation?c.playAnimation:!0,t=f(q,c,h,u);let w=t.timeToFrame,x;A();return r.makeHandle(()=>z&&clearTimeout(x))};k.prependDelay=a;k.reverse=l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/grouping":function(){define(["exports","../../../../core/string"],function(k,r){function p(e,n){if("string"===typeof e)e=r.numericHash(e+`-seed(${n})`);else{let m=12;e^=n;do e=107*(e>>8^e)+m|0;while(0!==--m)}return(1+
e/-2147483648)/2}k.getRandomValue=p;k.getStartGroup=function(e){return Math.floor(10*p(e,53290320))};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/animations/store/AnimationStore":function(){define(["exports","../../../../../webgl/enums","../../../../../webgl/Texture","../../../../../webgl/TextureDescriptor","../../../../../webgl/ValidatedTextureDescriptor"],function(k,r,p,e,n){class m{constructor(){this._entries=new d;this._nodes=new Map;this._book=new a}add(f){let g=
this._entries.get(f);if(!g){const q={};g={location:this._book.add(f),references:0,handle:q};f=this._entries.set(f,g);this._nodes.set(q,f)}g.references++;return g}remove(f){const g=this._nodes.get(f.handle);g&&g.payload&&(g.payload.references--,0===g.payload.references&&(this._book.remove(g.payload.location),this._entries.delete(g),this._nodes.delete(f.handle)))}getTexture(f,g){return this._book.getTexture(f,g)}destroy(){this._book.destroy()}}class l{constructor(f,g){this.parent=f;this.key=g;this.payload=
null;this._children=new Map}get(f){return this._children.get(f)}ensure(f){let g=this._children.get(f);g||(g=new l(this,f),this._children.set(f,g));return g}delete(f){this._children.delete(f)}}class d{constructor(){this._root=new l(null,NaN)}set(f,g){let q=this._root;for(const c of f)for(const h of c)q=q.ensure(h);q.payload=g;return q}delete(f){f.parent?.delete(f.key)}get(f){let g=this._root;for(const q of f)for(const c of q){f=g.get(c);if(!f)return;g=f}return g.payload||void 0}}class a{constructor(){this._pages=
[]}add(f){0===this._pages.length&&this._pages.push(new b);let g=this._pages.length-1,q=this._pages[g].add(f);q||(this._pages.push(new b),g=this._pages.length-1,q=this._pages[g].add(f));if(!q)throw Error("Data allocation failed.");return{...q,page:g}}remove(f){this._pages[f.page].remove(f)}getTexture(f,g){return this._pages[g].getTexture(f)}destroy(){}}class b{constructor(){this._cursor={row:0,column:0};this._rows=this._columns=1024;this._data=new Float32Array(this._columns*this._rows*4);this._texture=
null;this._textureCursor={row:0,column:0}}add(f){if(f.length>this._columns)throw Error(`The maximum allocation size is ${this._columns} texels.`);var g={...this._cursor};g.column+=f.length;g.column>=this._columns&&(g.column=f.length,g.row++);if(g.row>=this._rows)return null;this._cursor=g;g={...this._cursor};g.column-=f.length;let q=4*(g.row*this._columns+g.column);for(let c=0;c<f.length;c++)this._data[q++]=f[c][0],this._data[q++]=f[c][1],this._data[q++]=f[c][2],this._data[q++]=f[c][3];return g}remove(f){}getTexture(f){if(!this._texture){var g=
new e.TextureDescriptor(this._columns,this._rows);g.pixelFormat=r.PixelFormat.RGBA;g.dataType=r.PixelType.FLOAT;g.wrapMode=r.TextureWrapMode.CLAMP_TO_EDGE;g.samplingMode=r.TextureSamplingMode.NEAREST;g.hasMipmap=!1;g=new n.ValidatedTextureDescriptor(f,g);this._texture=new p.Texture(f,g)}if(this._cursor.row===this._textureCursor.row&&this._cursor.column===this._textureCursor.column)return this._texture;f=this._textureCursor.row;this._texture.updateData(0,0,f,this._columns,this._cursor.row-f+1,this._data,
f);this._textureCursor.row=this._cursor.row;this._textureCursor.column=this._cursor.column;return this._texture}destroy(){this._texture?.dispose()}}k.AnimationStore=m;k.PrefixMap=d;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TextureUploadManager":function(){define(["exports","../../../../core/has","../../../../core/promiseUtils","./definitions"],function(k,r,p,e){class n{constructor(m){this._queue=[];this._refreshable=m}destroy(){this._queue=[]}enqueueTextureUpdate(m,
l){const d=p.createResolver(),a=e.textureUploadManagerChunkSize,b=Math.ceil(m.height/a);p.throwIfAborted(l);for(let f=0;f<b;f++){const g=f===b-1;this._queue.push({type:"chunk",request:m,resolver:d,chunk:f,chunkOffset:f*a,destHeight:g?m.height-a*f:a,chunkIsLast:g,options:l})}p.onAbortOrThrow(l,f=>d.reject(f));return d.promise}upload(){const m=performance.now();let l=0;for(;this._queue.length;){var d=this._queue.shift();if(d&&(null==d.options.signal||!d.options.signal.aborted)){switch(d.type){case "chunk":this._uploadChunk(d);
break;case "no-chunk":this._uploadNoChunk(d)}++l;d=performance.now()-m;if(d+d/l>=e.textureUploadManagerBudget)break}}this._queue.length&&this._refreshable.requestRender()}_uploadChunk(m){const {request:l,resolver:d,chunkOffset:a,chunkIsLast:b,destHeight:f}=m,{data:g,texture:q,width:c}=l;null!=g&&(q.updateData(0,0,a,c,f,g,a),b&&d.resolve())}_uploadNoChunk(m){const {request:l,resolver:d}=m,{data:a,texture:b}=l;b.setData(a);d.resolve()}}k.TextureUploadManager=n;Object.defineProperty(k,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/WorldExtentClipRenderer":function(){define("exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/math/common ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ./definitions ./VertexStream ./shaders/StencilPrograms ../../../webgl/enums ../../../webgl/ProgramTemplate".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g,q){const c=m.fromValues(-.5,-.5);class h{constructor(){this._centerNdc=d.create();this._pxToNdc=d.create();this._worldDimensionsPx=d.create();this._mat3=n.create();this._initialized=!1}dispose(){this._program=r.disposeMaybe(this._program);this._quad=r.disposeMaybe(this._quad)}render(u,A,z){const {context:t}=u;u=this._updateGeometry(u,z);if(null!=A){const {r:w,g:x,b:B,a:C}=A;t.setClearColor(C*w/255,C*x/255,C*B/255,C)}else t.setClearColor(0,0,0,0);t.setStencilFunction(g.CompareFunction.ALWAYS,
0,255);t.setStencilWriteMask(255);u?(t.setClearStencil(a.backbufferStencilClipped),t.clear(t.gl.STENCIL_BUFFER_BIT|t.gl.COLOR_BUFFER_BIT),this._initialized||this._initialize(t),t.setDepthWriteEnabled(!1),t.setDepthTestEnabled(!1),t.setColorMask(!1,!1,!1,!1),t.setBlendingEnabled(!1),t.setStencilOp(g.StencilOperation.KEEP,g.StencilOperation.KEEP,g.StencilOperation.REPLACE),t.setStencilFunction(g.CompareFunction.ALWAYS,a.backbufferStencilVisible,255),t.setStencilTestEnabled(!0),t.useProgram(this._program),
this._program.setUniformMatrix3fv("u_worldExtent",this._mat3),this._quad.bind(),this._quad.draw(),this._quad.unbind()):(t.setClearStencil(a.backbufferStencilVisible),t.clear(t.gl.STENCIL_BUFFER_BIT|t.gl.COLOR_BUFFER_BIT))}_initialize(u){if(!this._initialized){var A=q.createProgram(u,f.stencil);A&&(this._program=A,this._quad=new b(u,[0,0,1,0,0,1,1,1]),this._initialized=!0)}}_updateGeometry(u,A){const {state:z,pixelRatio:t}=u,{size:w,rotation:x}=z,B=Math.round(w[0]*t),C=Math.round(w[1]*t);if(!z.spatialReference.isWrappable)return!1;
u=p.toRadian(x);const y=Math.abs(Math.cos(u)),v=Math.abs(Math.sin(u)),F=Math.round(t*z.worldScreenWidth);if(Math.round(B*y+C*v)<=F)return!1;const D=(A.left-A.right)*t/B;A=(A.bottom-A.top)*t/C;l.set(this._worldDimensionsPx,F,B*v+C*y,1);l.set(this._pxToNdc,2/B,-2/C,1);l.set(this._centerNdc,D,A,1);A=this._mat3;e.fromTranslation(A,this._centerNdc);e.scale(A,A,this._pxToNdc);0!==x&&e.rotate(A,A,u);e.scale(A,A,this._worldDimensionsPx);e.translate(A,A,c);return!0}}k.WorldExtentRenderer=h;Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/VertexStream":function(){define(["./shaderGraph/techniques/mesh/utils","../../../webgl/BufferObject","../../../webgl/enums","../../../webgl/VertexArrayObject","../../../webgl/VertexElementDescriptor"],function(k,r,p,e,n){class m{constructor(l,d){this._rctx=l;this._attributes=[{name:"position",offset:0,type:p.DataType.SHORT,count:2}];this.layout={hash:k.vertexLayoutHash(this._attributes),attributes:this._attributes,stride:4};this._vertexBuffer=
r.BufferObject.createVertex(l,p.Usage.STATIC_DRAW,new Uint16Array(d));this._vao=new e.VertexArrayObject(l,new Map([["a_position",0]]),new Map([["geometry",[new n.VertexElementDescriptor("a_position",2,p.DataType.SHORT,0,4)]]]),new Map([["geometry",this._vertexBuffer]]));this._count=d.length/2}bind(){this._rctx.bindVAO(this._vao)}unbind(){this._rctx.bindVAO(null)}dispose(){this._vao.dispose()}draw(){this._rctx.bindVAO(this._vao);this._rctx.drawArrays(p.PrimitiveType.TRIANGLE_STRIP,0,this._count)}}
return m})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/utils":function(){define(["exports","../../../../../../../core/string"],function(k,r){function p(e,n,m,l,d,a,b){if(e.primitiveName===n)n=l?.readWithDefault(d,a,e[m]&&b),"text"===e.type&&(n=n.toString()),e[m]=n;else if("type"in e&&null!=e.type){if(e.effects)for(const f of e.effects)p(f,n,m,l,d,a,b);switch(e.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(e.symbolLayers)for(const f of e.symbolLayers)p(f,
n,m,l,d,a,b);break;case "CIMTextSymbol":e.symbol&&p(e.symbol,n,m,l,d,a,b);break;case "CIMHatchFill":e.lineSymbol&&p(e.lineSymbol,n,m,l,d,a,b);break;case "CIMPictureMarker":case "CIMCharacterMarker":case "CIMVectorMarker":if(e.markerPlacement&&p(e.markerPlacement,n,m,l,d,a,b),"CIMVectorMarker"===e.type&&e.markerGraphics)for(const f of e.markerGraphics)p(f,n,m,l,d,a,b),p(f.symbol,n,m,l,d,a,b)}}}k.applyComputedValue=p;k.getLineClippingMargin=function(e){const n=e.width;return null!=e.effects?400:Math.max(1.25*
n,8)};k.vertexLayoutHash=function(e){e=e.map(({name:n,count:m,type:l})=>`${n}.${m}.${l}`).join(",");return r.numericHash(e)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaders/StencilPrograms":function(){define(["exports","./sources/resolver"],function(k,r){r={shaders:{vertexShader:r.resolveIncludes("stencil/stencil.vert"),fragmentShader:r.resolveIncludes("stencil/stencil.frag")},attributes:new Map([["a_pos",0]])};k.stencil=r;Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/BlendEffect":function(){define(["exports","../shaderGraph/techniques/blend/BlendTechnique"],function(k,r){class p{constructor(){this._blendTechnique=new r.BlendTechnique}dispose(e){this._blendTechnique?.shutdown()}draw(e,n,m,l,d){this._blendTechnique.render(e,{colorTexture:n,config:{opacity:d,samplingMode:m},blendMode:l})}}k.BlendEffect=p;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/blend/BlendTechnique":function(){define("exports ../../utils ../Technique ../TechniqueType ../shaders/BlendShader ../shaders/OpacityShader ../../../../../../webgl/enums ../../../../../../webgl/Texture ../../../../../../webgl/TextureDescriptor".split(" "),
function(k,r,p,e,n,m,l,d,a){class b extends p.Technique{constructor(){super(...arguments);this.type=e.TechniqueType.Blend;this._backBufferTexture=null;this.shaders={blend:new n.BlendShader,opacity:new m.OpacityShader}}shutdown(){super.shutdown();null!==this._backBufferTexture&&(this._backBufferTexture.dispose(),this._backBufferTexture=null)}render(f,g){const {context:q,state:c,pixelRatio:h,inFadeTransition:u,painter:A}=f;var {size:z}=c;const t=q.getBoundFramebufferObject();let w;null!=t?(w=t.width,
z=t.height):(w=Math.round(h*z[0]),z=Math.round(h*z[1]));const {blendMode:x}=g;"normal"===x?(g={shader:this.shaders.opacity,uniforms:{config:{layerTexture:{texture:g.colorTexture,unit:0},opacity:g.config.opacity}},defines:null,optionalAttributes:null,useComputeBuffer:!1},A.setPipelineState(r.simplePipelineState),A.submitDrawMesh(q,g,A.quadMesh)):(f=this._createOrResizeTexture(f,w,z),t.copyToTexture(0,0,w,z,0,0,f),A.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"custom",blendParameters:{srcRGB:l.BlendFactor.ONE,
dstRGB:l.BlendFactor.ZERO,srcAlpha:l.BlendFactor.ONE,dstAlpha:l.BlendFactor.ZERO}},depth:!1,stencil:!1}),A.submitDrawMesh(q,{shader:this.shaders.blend,uniforms:{config:{backbufferTexture:{texture:f,unit:0},layerTexture:{texture:g.colorTexture,unit:1},inFadeOpacity:u?1:0,...g.config}},defines:{blendMode:x},optionalAttributes:null,useComputeBuffer:!1},A.quadMesh))}_createOrResizeTexture(f,g,q){({context:f}=f);if(null!==this._backBufferTexture&&this._backBufferTexture.descriptor?.width===g&&this._backBufferTexture.descriptor?.height===
q)return this._backBufferTexture;if(null===this._backBufferTexture){const c=new a.TextureDescriptor;c.internalFormat=l.PixelFormat.RGBA;c.wrapMode=l.TextureWrapMode.CLAMP_TO_EDGE;c.width=g;c.height=q;this._backBufferTexture=new d.Texture(f,c)}else this._backBufferTexture.resize(g,q);return this._backBufferTexture}}k.BlendTechnique=b;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/utils":function(){define(["exports"],function(k){k.getLocations=
function(r){return r.locationsMap};k.simplePipelineState={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/Technique":function(){define(["exports","../../enums"],function(k,r){class p{constructor(){this.drawPhase=r.WGLDrawPhase.MAP|r.WGLDrawPhase.HITTEST|r.WGLDrawPhase.HIGHLIGHT|r.WGLDrawPhase.DEBUG}startup(){}shutdown(e){}}k.Technique=p;Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/TechniqueType":function(){define(["exports"],function(k){k.TechniqueType=void 0;var r=k.TechniqueType||(k.TechniqueType={});r[r.AnimatedMarker=0]="AnimatedMarker";r[r.Blend=1]="Blend";r[r.ComplexFill=2]="ComplexFill";r[r.ComplexOutlineFill=3]="ComplexOutlineFill";r[r.DotDensity=4]="DotDensity";r[r.Fill=5]="Fill";r[r.GradientFill=6]="GradientFill";r[r.GradientStroke=7]="GradientStroke";r[r.Grid=8]="Grid";r[r.Heatmap=
9]="Heatmap";r[r.Label=10]="Label";r[r.Line=11]="Line";r[r.Magnifier=12]="Magnifier";r[r.Marker=13]="Marker";r[r.OutlineFill=14]="OutlineFill";r[r.Overlay=15]="Overlay";r[r.PatternFill=16]="PatternFill";r[r.PatternOutlineFill=17]="PatternOutlineFill";r[r.PieChart=18]="PieChart";r[r.Test=19]="Test";r[r.Text=20]="Text";r[r.TexturedLine=21]="TexturedLine";r[r.Bitmap=22]="Bitmap";Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/BlendShader":function(){define(["exports",
"../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(k,r,p,e,n){function m(v,F,D,G,E){return new e.Vec4(v.multiply(G).multiply(E).add(F.multiply(G).multiply(n.oneMinus(E))).add(D.multiply(E).multiply(n.oneMinus(G))),G.add(E.multiply(n.oneMinus(G))))}function l(v,F){return(new e.Float(1)).subtract(e.step(new e.Float(.5),F)).multiply(n.oneMinus((new e.Float(2)).multiply(n.oneMinus(F).multiply(n.oneMinus(v))))).add(e.step(new e.Float(.5),F).multiply((new e.Float(2)).multiply(F).multiply(v)))}
function d(v,F){return e.ifElse(e.equal(v,new e.Float(0)),new e.Float(0),e.ifElse(e.equal(F,new e.Float(1)),new e.Float(1),e.min(new e.Float(1),v.divide((new e.Float(1)).subtract(F)))))}function a(v,F){return e.ifElse(e.equal(v,new e.Float(1)),new e.Float(1),e.ifElse(e.equal(F,new e.Float(0)),new e.Float(0),n.oneMinus(e.min(new e.Float(1),n.oneMinus(v).divide(F)))))}function b(v,F){return(new e.Float(1)).subtract(e.step(new e.Float(.5),F)).multiply((new e.Float(2)).multiply(F).multiply(v)).add(e.step(new e.Float(.5),
F).multiply(n.oneMinus((new e.Float(2)).multiply(n.oneMinus(F).multiply(n.oneMinus(v))))))}function f(v,F){return e.cond([e.lessThanEqual(F,new e.Float(.5)),()=>{var D=(new e.Float(2)).multiply(F);D=n.oneMinus(D);const G=n.oneMinus(v);return v.subtract(D.multiply(v).multiply(G))}],[e.lessThanEqual(v,new e.Float(.25)),()=>{var D=(new e.Float(2)).multiply(F);D=n.minusOne(D).multiply(v);const G=(new e.Float(16)).multiply(v).subtract(new e.Float(12)).multiply(v).add(new e.Float(3));return v.add(D.multiply(G))}],
[!0,()=>{var D=(new e.Float(2)).multiply(F);D=n.minusOne(D);const G=e.sqrt(v).subtract(v);return v.add(D.multiply(G))}])}function g(v,F){const D=n.oneMinus(e.step(new e.Float(.5),F)).multiply(a(v,(new e.Float(2)).multiply(F)));v=e.step(new e.Float(.5),F).multiply(d(v,(new e.Float(2)).multiply(n.minusScalar(F,.5))));return D.add(v)}function q(v){return e.min(e.min(v.r,v.g),v.b)}function c(v){return e.max(e.max(v.r,v.g),v.b)}function h(v){return e.dot(v,new e.Vec3(.3,.59,.11))}function u(v){return c(v).subtract(q(v))}
function A(v){const F=h(v),D=q(v),G=c(v);return e.cond([e.lessThan(D,new e.Float(0)),()=>{const E=v.subtract(F).multiply(F),H=F.subtract(D);return F.add(E.divide(H))}],[e.greaterThan(G,new e.Float(1)),()=>{var E=v.subtract(F),H=n.oneMinus(F);E=E.multiply(H);H=G.subtract(F);return F.add(E.divide(H))}],[!0,v])}function z(v,F){const D=h(v);F=h(F).subtract(D);v=v.add(new e.Vec3(F));return A(v)}function t(v,F,D){const G=q(v),E=u(v),H=u(F);F=e.ifElse(e.greaterThan(E,new e.Float(0)),()=>v.subtract(G).multiply(H).divide(E),
new e.Vec3(0));return z(F,D)}function w(v,F){return e.ifElse(e.equal(F,new e.Float(1)),F,()=>{var D=n.oneMinus(F);D=v.multiply(v).divide(D);return e.min(D,new e.Float(1))})}class x extends p.VertexInput{}r.__decorate([p.location(0,e.Vec2)],x.prototype,"position",void 0);class B extends p.FragmentInput{}class C extends p.UniformGroup{}r.__decorate([p.uniform(e.Sampler2D)],C.prototype,"layerTexture",void 0);r.__decorate([p.uniform(e.Sampler2D)],C.prototype,"backbufferTexture",void 0);r.__decorate([p.uniform(e.Float)],
C.prototype,"opacity",void 0);r.__decorate([p.uniform(e.Float)],C.prototype,"inFadeOpacity",void 0);class y extends p.GraphShaderModule{constructor(){super(...arguments);this.type="BlendShader"}vertex(v){const F=v.position;v=new e.Vec4(n.uvToClip(v.position),0,1);return{uv:F,glPosition:v}}fragment(v){const F=new p.FragmentOutput;var D=e.texture2D(this.config.layerTexture,v.uv),G=e.texture2D(this.config.backbufferTexture,v.uv),E=e.ifElse(e.equal(D.a,new e.Float(0)),D.rgb,D.rgb.divide(D.a));v=e.ifElse(e.equal(G.a,
new e.Float(0)),G.rgb,G.rgb.divide(G.a));const H=this.config.opacity.multiply(D.a);G=G.a;switch(this.blendMode){case "destination-over":F.fragColor=new e.Vec4(E.multiply(H).multiply(n.oneMinus(G)).add(v.multiply(G)),H.add(G).subtract(H.multiply(G)));break;case "source-in":E=new e.Vec4(E.multiply(H).multiply(G),H.multiply(G));v=(new e.Vec4(v.multiply(G),G)).multiply(n.oneMinus(this.config.opacity)).multiply(this.config.inFadeOpacity);F.fragColor=E.add(v);break;case "destination-in":E=new e.Vec4(v.multiply(G).multiply(H),
G.multiply(H));v=(new e.Vec4(v.multiply(G),G)).multiply(new e.Vec4(n.oneMinus(this.config.opacity).multiply(this.config.inFadeOpacity)));F.fragColor=E.add(v);break;case "source-out":F.fragColor=new e.Vec4(E.multiply(H).multiply(n.oneMinus(G)),H.multiply(n.oneMinus(G)));break;case "destination-out":F.fragColor=new e.Vec4(v.multiply(G).multiply(n.oneMinus(H)),G.multiply(n.oneMinus(H)));break;case "source-atop":F.fragColor=new e.Vec4(E.multiply(H).multiply(G).add(v.multiply(G.multiply(n.oneMinus(H)))),
G);break;case "destination-atop":F.fragColor=new e.Vec4(E.multiply(H.multiply(n.oneMinus(G))).add(v.multiply(G).multiply(H)),H);break;case "xor":F.fragColor=new e.Vec4(E.multiply(H.multiply(n.oneMinus(G))).add(v.multiply(G.multiply(n.oneMinus(H)))),H.multiply(n.oneMinus(G)).add(G.multiply(n.oneMinus(H))));break;case "multiply":F.fragColor=new e.Vec4(E.multiply(H).multiply(v.multiply(G)).add(E.multiply(H).multiply(n.oneMinus(G))).add(v.multiply(G).multiply(n.oneMinus(H))),H.add(G.multiply(n.oneMinus(H))));
break;case "screen":F.fragColor=new e.Vec4(E.add(v).subtract(E.multiply(v)).multiply(H.multiply(G)).add(E.multiply(H).multiply(n.oneMinus(G))).add(v.multiply(G).multiply(n.oneMinus(H))),H.add(G.multiply(n.oneMinus(H))));break;case "overlay":D=new e.Vec3(l(v.r,E.r),l(v.g,E.g),l(v.b,E.b));F.fragColor=m(D,E,v,H,G);break;case "darken":D=e.min(E,v);F.fragColor=m(D,E,v,H,G);break;case "lighter":F.fragColor=new e.Vec4(E.multiply(H).add(v.multiply(G)),H.add(G));break;case "lighten":D=e.max(E,v);F.fragColor=
m(D,E,v,H,G);break;case "color-dodge":D=e.clamp(new e.Vec3(d(v.r,E.r),d(v.g,E.g),d(v.b,E.b)),new e.Vec3(0),new e.Vec3(1));F.fragColor=m(D,E,v,H,G);break;case "color-burn":D=new e.Vec3(a(v.r,E.r),a(v.g,E.g),a(v.b,E.b));F.fragColor=m(D,E,v,H,G);break;case "hard-light":D=new e.Vec3(b(v.r,E.r),b(v.g,E.g),b(v.b,E.b));F.fragColor=m(D,E,v,H,G);break;case "soft-light":D=new e.Vec3(f(v.r,E.r),f(v.g,E.g),f(v.b,E.b));F.fragColor=m(D,E,v,H,G);break;case "difference":D=e.abs(v.subtract(E));F.fragColor=m(D,E,v,
H,G);break;case "exclusion":D=E.add(v).subtract((new e.Float(2)).multiply(E).multiply(v));F.fragColor=m(D,E,v,H,G);break;case "invert":F.fragColor=new e.Vec4((new e.Vec3(1)).subtract(v).multiply(H).multiply(G).add(v.multiply(G).multiply(n.oneMinus(H))),G);break;case "vivid-light":D=new e.Vec3(e.clamp(g(v.r,E.r),new e.Float(0),new e.Float(1)),e.clamp(g(v.g,E.g),new e.Float(0),new e.Float(1)),e.clamp(g(v.b,E.b),new e.Float(0),new e.Float(1)));F.fragColor=m(D,E,v,H,G);break;case "hue":D=t(E,v,v);F.fragColor=
m(D,E,v,H,G);break;case "saturation":D=t(v,E,v);F.fragColor=m(D,E,v,H,G);break;case "color":D=z(E,v);F.fragColor=m(D,E,v,H,G);break;case "luminosity":D=z(v,E);F.fragColor=m(D,E,v,H,G);break;case "plus":F.fragColor=e.clamp(new e.Vec4(D.r.add(v.r),D.g.add(v.g),D.b.add(v.b),H.add(G)),new e.Vec4(0),new e.Vec4(1));break;case "minus":F.fragColor=new e.Vec4(e.clamp(new e.Vec3(v.r.subtract(D.r),v.g.subtract(D.g),v.b.subtract(D.b)),new e.Vec3(0),new e.Vec3(1)),G.multiply(H));break;case "average":D=v.add(E).divide(2);
F.fragColor=m(D,E,v,H,G);break;case "reflect":D=e.clamp(new e.Vec3(w(v.r,E.r),w(v.g,E.g),w(v.b,E.b)),new e.Vec3(0),new e.Vec3(1));F.fragColor=m(D,E,v,H,G);break;default:F.fragColor=D.multiply(this.config.opacity)}return F}}r.__decorate([p.define],y.prototype,"blendMode",void 0);r.__decorate([p.uniform(C)],y.prototype,"config",void 0);r.__decorate([r.__param(0,p.input(x))],y.prototype,"vertex",null);r.__decorate([r.__param(0,p.input(B))],y.prototype,"fragment",null);k.BlendShader=y;Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/GraphShaderModule":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/string ./graph/glsl ./graph/GlslGraphWriter ./graph/ShaderGraphContext ./graph/ShaderGraphNode ./typed/TypedShaderProgram ../../../../webgl/ShaderBuilder".split(" "),function(k,r,p,e,n,m,l,d,a,b,f){function g(w,x,B){const C=w.constructor[x]??[];w.constructor.hasOwnProperty(x)||
Object.defineProperty(w.constructor,x,{value:C.slice()});w.constructor[x].push(B)}p=w=>(x,B)=>{g(x,"builtins",{builtin:w,propertyKey:B})};const q=(w,x)=>(B,C)=>{B.constructor.builtins.push({builtin:w,propertyKey:C,typeCtor:x})};class c{}c.builtins=[];r.__decorate([q("gl_VertexID",m.Int)],c.prototype,"glVertexID",void 0);class h{}class u{}u.builtins=[];r.__decorate([q("gl_FragCoord",m.Vec4)],u.prototype,"glFragCoord",void 0);r.__decorate([q("gl_PointCoord",m.Vec2)],u.prototype,"glPointCoord",void 0);
class A{}r.__decorate([p("gl_FragDepth")],A.prototype,"glFragDepth",void 0);class z{constructor(){this.type="uniform-group"}get _uniforms(){return this.constructor.uniforms??[]}}class t{constructor(){this.logShader=!1;this.computeAttributes={}}get vertexInput(){const w=this._shaderModuleClass.inputs.findLast(x=>"vertex"===x.propertyKey&&0===x.parameterIndex);if(!w)throw Error("Unable to find vertex input parameter");return w}get computeInput(){return this._shaderModuleClass.inputs.findLast(w=>"vertex"===
w.propertyKey&&1===w.parameterIndex)}get fragmentInput(){const w=this._shaderModuleClass.inputs.findLast(x=>"fragment"===x.propertyKey);if(!w)throw Error("Unable to find fragment input parameter");return w}get transformFeedbackBindings(){return this.fragmentInput.inputCtor.transformFeedbackBindings??[]}get locations(){return[...this.vertexInput.inputCtor.locations,...(this.computeInput?.inputCtor.locations??[])]}get locationsMap(){const w=new Map,x=new Set;for(const B of this.locations)x.has(B.index)?
e.getLogger("esri.views.2d.engine.webgl.shaderGraph.GraphShaderModule").warnOnce("mapview-rendering",`Unable to assigned attribute ${B.propertyKey} to ${B.index}. Index already in use`,{locationsMap:w}):(w.set(B.propertyKey,B.index),x.add(B.index));return w}get locationInfo(){if(!this._locationInfo){const w=this.locationsMap,x=Array.from(w.entries()).map(([B,C])=>`${B}.${C}`).join(".");this._locationInfo={hash:n.numericHash(x),stringHash:x,locations:w,computeAttributeMap:this.computeAttributes}}return this._locationInfo}get renamedLocationsMap(){const w=
new Map;for(const x of this.locations)w.set("a_"+x.propertyKey,x.index);return w}get optionPropertyKeys(){if(!this._optionPropertyKeys){const w=new Set;for(const x of this._options)w.add(x.propertyKey);this._optionPropertyKeys=w}return this._optionPropertyKeys}get _shaderModuleClass(){return this.constructor}get _defines(){return this._shaderModuleClass.defines??[]}get _options(){return this._shaderModuleClass.options??[]}get _uniforms(){return this._shaderModuleClass.uniforms??[]}getProgram(w,x,
B,C){try{const {vertex:y,fragment:v,uniformBindings:F}=this._generateShaders(w,x,B,C);return new b.TypedShaderProgram(y,v,this.renamedLocationsMap,this.locationInfo,F,this.transformFeedbackBindings)}catch(y){return new b.TypedShaderProgram("","",this.renamedLocationsMap,this.locationInfo,[],this.transformFeedbackBindings)}}getDebugUniformClassInfo(w){var x=this._options.find(B=>B.propertyKey===w);if(x)return{type:"option",className:x.typeCtor};x=this._uniforms.find(B=>B.propertyKey===w);if(!x)throw Error(`Unable to find uniform class type for property: ${w}`);
return{type:"required",className:x.typeCtor}}getShaderKey(w,x,B,C){const y=Object.keys(w).map(G=>`${G}.${w[G]}`).join("."),v=Object.keys(B).map(G=>`${G}.${B[G]}`).join("."),F=Object.keys(C).map(G=>`${G}.${C[G]}`).join("."),D=Object.keys(x).filter(G=>this.optionPropertyKeys.has(G)&&x[G]).join(".");return`${this.type}.${y}.${v}.${F}.${D}`}_generateShaders(w,x,B,C){const y=[];this._setDefines(B);this._setOptionalUniforms(y,x);this._setRequiredUniforms(y);x=this._hydrateVertexInput(C);C=this._injectPackPrecisionFactor(x,
w);w=(B=this._hydrateComputeInput())&&this._injectComputePackPrecisionFactor(B,w);const v=this.vertex(C,w);w=this._hydrateFragmentInput(v);C=this.fragment(w);const F=new Set;for(var D in C)a.setReachableUids(F,C[D]);D=this._getVertexInputBuiltins();D=d.ShaderGraphContext.createVertex({...x,...B},v,D,y,this.transformFeedbackBindings,F);(new l.GlslShaderWriter).write(D);x=this._getFragmentInputBuiltins(C);x.set("glPointCoord","gl_PointCoord");x=d.ShaderGraphContext.createFragment(w,C,x,y,D,this.transformFeedbackBindings);
(new l.GlslShaderWriter).write(x);x=this._createShaderBuilder(D,x);D=x.generate("vertex");x=x.generate("fragment");this.logShader&&(console.log(D),console.log(x));return{vertex:D,fragment:x,uniformBindings:y}}_setDefines(w){for(const x in w)this[x]=w[x]}_setOptionalUniforms(w,x){for(const B of this._options)this[B.propertyKey]=x[B.propertyKey]?this._hydrateUniformGroup(w,B):null}_setRequiredUniforms(w){for(const x of this._uniforms)this[x.propertyKey]=this._hydrateUniformGroup(w,x)}_hydrateUniformGroup(w,
x){const B=new x.typeCtor;for(const y of B._uniforms??[]){const v=new y.typeCtor,F=`u_${x.propertyKey}_${y.propertyKey}`,D=v.type,G=[x.propertyKey,y.propertyKey].join(".");if("type"in y.typeCtor&&"array"===y.typeCtor.type){var C=v;w.push({shaderModulePath:G,uniformName:F,uniformType:D,uniformArrayLength:C.size,uniformArrayElementType:C.elementType.type,uniformHydrated:v})}else"type"in y.typeCtor&&"array-2d"===y.typeCtor.type?(C=v,w.push({shaderModulePath:G,uniformName:F,uniformType:D,uniformArrayLength:C.size,
uniformArrayElementType:C.elementType.type,uniformHydrated:v})):w.push({shaderModulePath:G,uniformName:F,uniformType:D,uniformHydrated:v});B[y.propertyKey]=v}return B}_hydrateVertexInput(w){var x=this.vertexInput.inputCtor;const B=x.locations.reduce((C,y)=>!1===w[y.propertyKey]?C:{...C,[y.propertyKey]:new y.typeCtor},{});for(const {propertyKey:C,typeCtor:y}of x.builtins)x=new y,B[C]=x;return B}_hydrateComputeInput(){return null==this.computeInput?null:this.computeInput.inputCtor.locations.reduce((w,
x)=>({...w,[x.propertyKey]:new x.typeCtor}),{})}_injectPackPrecisionFactor(w,x){const B={};for(const C in w){const y=w[C],v=x[C];if(v){if("float"!==y.type&&"vec2"!==y.type&&"vec3"!==y.type&&"vec4"!==y.type)throw Error(`InternalError: packPrecisionFactor requires GenType, but found ${y.type}`);B[C]=y.divide(new m.Float(v))}else B[C]=y}return B}_injectComputePackPrecisionFactor(w,x){const B={},C=new Map;for(var y in this.computeAttributes)for(var v of this.computeAttributes[y]??[])C.set(v,y);for(const F in w)if(y=
w[F],v=C.get(F))if(v=x[v]){if("float"!==y.type&&"vec2"!==y.type&&"vec3"!==y.type&&"vec4"!==y.type)throw Error(`InternalError: packPrecisionFactor requires GenType, but found ${y.type}`);B[F]=y.divide(new m.Float(v))}else B[F]=y;return B}_hydrateFragmentInput(w){const x={};for(const B in w)x[B]=w[B];for(const {propertyKey:B,typeCtor:C}of u.builtins)w=new C,x[B]=w;return x}_getVertexInputBuiltins(){const w=this.vertexInput.inputCtor,x=new Map;for(const {builtin:B,propertyKey:C}of w.builtins)x.set(C,
B);return x}_getFragmentInputBuiltins(w){w=w.constructor;const x=new Map;for(const B of w.builtins??[])x.set(B.propertyKey,B.builtin);return x}_createShaderBuilder(w,x){const B=new f.ShaderBuilder;this._insertDebugInfo(B);w.insertVertexShader(B);x.insertFragmentShader(B);return B}_insertDebugInfo(w){w.vertex.code.add("// DEFINES: ");w.vertex.code.add("// --------------------------------------------------------- ");for(const x of this._defines)this[x.propertyKey]?w.vertex.code.add(`//   ${x.propertyKey}: true`):
w.vertex.code.add(`//   ${x.propertyKey}: false`);w.vertex.code.add("");w.vertex.code.add("// OPTIONS: ");w.vertex.code.add("// --------------------------------------------------------- ");for(const x of this._options)this[x.propertyKey]?w.vertex.code.add(`//   ${x.propertyKey}: true`):w.vertex.code.add(`//   ${x.propertyKey}: false`)}}k.ComputeVertexInput=h;k.FragmentInput=u;k.FragmentOutput=A;k.GraphShaderModule=t;k.UniformGroup=z;k.VertexInput=c;k.builtin=p;k.define=(w,x)=>{g(w,"defines",{propertyKey:x})};
k.input=w=>(x,B,C)=>{g(x,"inputs",{inputCtor:w,propertyKey:B,parameterIndex:C})};k.location=function(w,x){return(B,C)=>{g(B,"locations",{typeCtor:x,propertyKey:C,parameterIndex:null,index:w})}};k.option=w=>(x,B)=>{g(x,"options",{typeCtor:w,propertyKey:B})};k.transformFeedback=function(w){return(x,B)=>{g(x,"transformFeedbackBindings",{propertyKey:B,parameterIndex:null,index:w})}};k.uniform=w=>(x,B)=>{g(x,"uniforms",{typeCtor:w,propertyKey:B})};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/shaderGraph/graph/glsl":function(){define(["exports","../../../../../../chunks/tslib.es6","./ShaderGraphNode"],function(k,r,p){function e(O){switch(O.type){case "uint":return ia;case "uvec2":return k.Vec2;case "uvec3":return k.Vec3;case "uvec4":return k.Vec4;default:throw Error("Found unexpected type");}}function n(O){switch(O.type){case "float":return k.UInt;case "vec2":return k.UVec2;case "vec3":return k.UVec3;case "vec4":return k.UVec4;default:throw Error("Found unexpected type");
}}function m(O){switch(O.type){case "int":return ia;case "ivec2":return k.Vec2;case "ivec3":return k.Vec3;case "ivec4":return k.Vec4;default:throw Error("Found unexpected type");}}function l(O){switch(O.type){case "float":return ma;case "vec2":return k.IVec2;case "vec3":return k.IVec3;case "vec4":return k.IVec4;default:throw Error("Found unexpected type");}}function d(O){switch(O.type){case "bool":case "float":case "int":case "uint":return na;case "bvec2":case "vec2":case "ivec2":case "uvec2":return k.BVec2;
case "bvec3":case "vec3":case "ivec3":case "uvec3":return k.BVec3;case "bvec4":case "vec4":case "ivec4":case "uvec4":return k.BVec4;default:throw Error("Unable to handle type");}}function a(O){switch(O.type){case "bool":case "bvec2":case "bvec3":case "bvec4":return na;case "float":case "vec2":case "vec3":case "vec4":return ia;case "int":case "ivec2":case "ivec3":case "ivec4":return ma;case "uint":case "uvec2":case "uvec3":case "uvec4":return k.UInt;default:throw Error("Unable to handle type");}}function b(O){switch(O.type){case "float":case "int":case "uint":case "bool":case "sampler2D":return 1;
case "vec2":case "ivec2":case "uvec2":case "bvec2":return 2;case "vec3":case "ivec3":case "uvec3":case "bvec3":return 3;case "vec4":case "ivec4":case "uvec4":case "bvec4":return 4;case "mat2":return 4;case "mat3":return 9;case "mat4":return 16;case "array":return O.size*b(O.elementType);case "array-2d":return O.size*b(O.elementType)}}function f(O){const V=[["float","vec2","vec3","vec4"],["int","ivec2","ivec3","ivec4"],["uint","uvec2","uvec3","uvec4"],["bool","bvec2","bvec3","bvec4"]];for(const ea of V)if(ea.includes(O))return ea.map(la=>
Ha[la]);throw Error("Unable to find type family");}function g(O){return new Proxy(O,{get(V,ea){if("constructor"===ea)return new Proxy(V.constructor,{construct(la,pa,va){la=new la(...pa);return g(la)}});if(ea in V)return V[ea];if("string"===typeof ea)return V=f(O.type),u(O,ea,V[ea.length-1])}})}function q(O){return new Proxy(O,{construct(V,ea,la){V=new V(...ea);return g(V)}})}function c(O){return new Proxy(O,{get(V,ea){if(ea in V)return V[ea];if("string"===typeof ea&&(V=parseInt(ea,10),!isNaN(V)))return u(O,
`[${V}]`,O.elementType.constructor)}})}function h(O,V){return"number"===typeof O?new V(O):O}function u(O,V,ea){O=new ea(new p.ShaderPropertyAccessNode(V,O,ea));O.isImplicit=!0;return O}function A(O,V,ea,la){O=new la(new p.ShaderPropertyAccess2DNode(V,ea,O,la));O.isImplicit=!0;return O}function z(O,V,ea,la=null){if(la){const pa=new la;O=new la(new p.ShaderFunctionNode(O,[V,ea],!0,!1,pa));O.isImplicit=!0;return O}if("float"===V.type||"int"===V.type||("mat2"===V.type||"mat3"===V.type||"mat4"===V.type)&&
"float"!==ea.type)return O=new ea.constructor(new p.ShaderFunctionNode(O,[V,ea],!0,!1,ea.constructor)),O.isImplicit=!0,O;O=new V.constructor(new p.ShaderFunctionNode(O,[V,ea],!0,!1,V.constructor));O.isImplicit=!0;return O}function t(O,V,ea=V.constructor){O=new ea(new p.ShaderFunctionNode(O,[V],!1,!1,ea));O.isImplicit=!0;return O}function w(O,V,ea,la=V.constructor){O=new la(new p.ShaderFunctionNode(O,[V,ea],!1,!1,la));O.isImplicit=!0;return O}function x(O,V,ea,la,pa=V.constructor){O=new pa(new p.ShaderFunctionNode(O,
[V,ea,la],!1,!1,pa));O.isImplicit=!0;return O}function B(O){return D(O,xa(-1))}function C(O,V,ea,la){return new V(new p.ShaderBlockNode(O,V,ea,la))}function y(O,V,ea=0,la=O.size){ea=(new ma(ea)).setMutable().setDebugName("FindIndexIterator");O=O.get(ea);V=V(O).setDebugName("FindIndexPredicate");return C({iter:ea},ma,V,({out:pa,iter:va,subgraph:Ga})=>`\n${pa} = -1;\n\nfor (; ${va} < ${la}; ${va}++) {\n\n${Ga.body}\n\n  if (${Ga.varName}) {\n    ${pa} = ${va};\n    break;\n  }\n\n}\n`).setDebugName("FindIndexBlock")}
function v(O,V,ea=0,la=O.size){return C({array:O},ma,null,({out:pa,array:va})=>`\n${pa} = -1;\nfor (int i = ${ea}; i < ${la}; i++) {\n  bool condition;\n  ${V({array:va,i:"i",out:"condition"})}\n  if (condition) {\n    ${pa} = i;\n    break;\n  }\n}\n`).setDebugName("GlslFindIndexBlock")}function F(O,V,ea){V="function"===typeof V?V():V;ea="function"===typeof ea?ea():ea;O=new V.constructor(new p.ShaderConditionNode(O,V,ea));O.isImplicit=!0;return O}function D(O,V){return z("*",O,V)}function G(O,V){return z("/",
O,V)}function E(O,V){return z("+",O,V)}function H(O,V){return z("-",O,V)}function K(...O){return 1>=O.length?O[0]:O.slice(1).reduce((V,ea)=>J(V,ea),O[0])}function J(O,V){return z("||",O,V,na)}function L(...O){return 1>=O.length?O[0]:O.slice(1).reduce((V,ea)=>z("\x26\x26",V,ea,na),O[0])}function P(O){return t("all",O,na)}function Q(O){return t("any",O,na)}function S(O){return t("cos",O)}function U(O){return t("sin",O)}var X,aa,ba,fa,I,M,N,R,T,W,Y,Z,da,ca;class ja extends Error{}k.FixedArray=X=class extends p.ShaderPrimitiveNode{constructor(O,
V){super();this.elementType=O;this.size=V;this.children=[];this.type="array"}clone(){const O=new X(this.elementType,this.size);super.cloneInto(O);return O}get(O,V){O=new ma(O);V=null!=V?new ma(V):null;if(null!=V){const ea=a(this.elementType.constructor);return A(this,O,V,ea)}return u(this,O,this.elementType.constructor)}last(){return this.get(this.size-1)}first(){return this.get(0)}findIndex(O,V,ea){return y(this,O,V,ea)}glslFindIndex(O,V,ea){return v(this,O,V,ea)}static ofType(O,V){return new Proxy(X,
{construct(ea,la){return new X(new O,V)}})}};k.FixedArray.type="array";k.FixedArray=X=r.__decorate([function(O){return new Proxy(O,{construct(V,ea,la){V=new V(...ea);return c(V)}})}],k.FixedArray);class ha extends p.ShaderPrimitiveNode{constructor(O,V,ea,la=!1){super();this.elementType=O;this.xSize=V;this.ySize=ea;this.isRowMajor=la;this.children=[];this.type="array-2d"}clone(){const O=new ha(this.elementType,this.xSize,this.ySize,this.isRowMajor);super.cloneInto(O);return O}get size(){return this.xSize*
this.ySize}get(O,V){return this.isRowMajor?this._getRowMajor(O,V):this._getColumnMajor(O,V)}_getColumnMajor(O,V){O=new ma(O);V=(new ma(V)).add(O.multiply(this.xSize));return u(this,V,this.elementType.constructor)}_getRowMajor(O,V){O=new ma(O);V=new ma(V);V=O.add(V.multiply(this.ySize));return u(this,V,this.elementType.constructor)}static ofType(O,V,ea,la=!1){return new Proxy(k.FixedArray,{construct(pa,va){return new ha(new O,V,ea,la)}})}}ha.type="array-2d";class ka extends p.ShaderPrimitiveNode{constructor(){super(...arguments);
this.type="sampler2D";this.children=[]}clone(){const O=new ka;O.children=this.children.map(p.cloneShaderNode);super.cloneInto(O);return O}}ka.type="sampler2D";class ia extends p.ShaderPrimitiveNode{constructor(O){super();this.type="float";this.children=[O]}clone(){const O=new ia(p.cloneShaderNode(this.children[0]));super.cloneInto(O);return O}multiply(O){return"number"===typeof O?D(this,h(O,ia)):D(this,O)}divide(O){return"number"===typeof O?G(this,h(O,ia)):G(this,O)}add(O){return"number"===typeof O?
E(this,h(O,ia)):E(this,O)}subtract(O){return"number"===typeof O?H(this,h(O,ia)):H(this,O)}}ia.type="float";k.Vec2=aa=class extends p.ShaderPrimitiveNode{constructor(O,V){super();this.type="vec2";this.children=[O,V].filter(ea=>null!=ea)}clone(){const O=new aa(p.cloneShaderNode(this.children[0]),p.cloneShaderNode(this.children[1]));super.cloneInto(O);return O}get 0(){return u(this,"[0]",ia)}get 1(){return u(this,"[1]",ia)}get 2(){throw new ja;}get 3(){throw new ja;}multiply(O){return D(this,"number"===
typeof O?h(O,ia):O)}divide(O){return G(this,"number"===typeof O?h(O,ia):O)}add(O){return E(this,"number"===typeof O?h(O,ia):O)}subtract(O){return H(this,"number"===typeof O?h(O,ia):O)}};k.Vec2.type="vec2";k.Vec2=aa=r.__decorate([q],k.Vec2);k.Vec3=ba=class extends p.ShaderPrimitiveNode{constructor(O,V,ea){super();this.type="vec3";this.children=[O,V,ea].filter(la=>null!=la)}get 0(){return u(this,"[0]",ia)}get 1(){return u(this,"[1]",ia)}get 2(){return u(this,"[2]",ia)}get 3(){throw new ja;}clone(){const O=
new ba(p.cloneShaderNode(this.children[0]),p.cloneShaderNode(this.children[1]),p.cloneShaderNode(this.children[2]));super.cloneInto(O);return O}multiply(O){return D(this,"number"===typeof O?h(O,ia):O)}divide(O){return G(this,"number"===typeof O?h(O,ia):O)}add(O){return E(this,"number"===typeof O?h(O,ia):O)}subtract(O){return H(this,"number"===typeof O?h(O,ia):O)}};k.Vec3.type="vec3";k.Vec3=ba=r.__decorate([q],k.Vec3);k.Vec4=fa=class extends p.ShaderPrimitiveNode{constructor(O,V,ea,la){super();this.type=
"vec4";this.children=[O,V,ea,la].filter(pa=>null!=pa)}clone(){const O=new fa(p.cloneShaderNode(this.children[0]),p.cloneShaderNode(this.children[1]),p.cloneShaderNode(this.children[2]),p.cloneShaderNode(this.children[3]));super.cloneInto(O);return O}get 0(){return u(this,"[0]",ia)}get 1(){return u(this,"[1]",ia)}get 2(){return u(this,"[2]",ia)}get 3(){return u(this,"[3]",ia)}multiply(O){return D(this,"number"===typeof O?h(O,ia):O)}divide(O){return G(this,"number"===typeof O?h(O,ia):O)}add(O){return E(this,
"number"===typeof O?h(O,ia):O)}subtract(O){return H(this,"number"===typeof O?h(O,ia):O)}};k.Vec4.type="vec4";k.Vec4=fa=r.__decorate([q],k.Vec4);k.UInt=I=class extends p.ShaderPrimitiveNode{constructor(O){super();this.type="uint";this.children=[O]}clone(){const O=new I(p.cloneShaderNode(this.children[0]));super.cloneInto(O);return O}};k.UInt.type="uint";k.UInt=I=r.__decorate([q],k.UInt);k.UVec2=M=class extends p.ShaderPrimitiveNode{constructor(O,V){super();this.type="uvec2";this.children=[O,V].filter(ea=>
null!=ea)}clone(){const O=new M(p.cloneShaderNode(this.children[0]),p.cloneShaderNode(this.children[1]));super.cloneInto(O);return O}};k.UVec2.type="uvec2";k.UVec2=M=r.__decorate([q],k.UVec2);k.UVec3=N=class extends p.ShaderPrimitiveNode{constructor(O,V,ea){super();this.type="uvec3";this.children=[O,V,ea].filter(la=>null!=la)}clone(){const O=new N(p.cloneShaderNode(this.children[0]),p.cloneShaderNode(this.children[1]),p.cloneShaderNode(this.children[2]));super.cloneInto(O);return O}};k.UVec3.type=
"uvec3";k.UVec3=N=r.__decorate([q],k.UVec3);k.UVec4=R=class extends p.ShaderPrimitiveNode{constructor(O,V,ea,la){super();this.type="uvec4";this.children=[O,V,ea,la].filter(pa=>null!=pa)}clone(){const O=new R(p.cloneShaderNode(this.children[0]),p.cloneShaderNode(this.children[1]),p.cloneShaderNode(this.children[2]),p.cloneShaderNode(this.children[3]));super.cloneInto(O);return O}};k.UVec4.type="uvec4";k.UVec4=R=r.__decorate([q],k.UVec4);class na extends p.ShaderPrimitiveNode{constructor(O){super();
this.type="bool";this.children=[O]}and(O){return L(this,O)}or(O){return K(this,O)}clone(){const O=new na(p.cloneShaderNode(this.children[0]));super.cloneInto(O);return O}}na.type="bool";k.BVec2=T=class extends p.ShaderPrimitiveNode{constructor(O,V){super();this.type="bvec2";this.children=[O,V].filter(ea=>null!=ea)}all(){return P(this)}any(){return Q(this)}clone(){const O=new T(p.cloneShaderNode(this.children[0]),p.cloneShaderNode(this.children[1]));super.cloneInto(O);return O}};k.BVec2.type="bvec2";
k.BVec2=T=r.__decorate([q],k.BVec2);k.BVec3=W=class extends p.ShaderPrimitiveNode{constructor(O,V,ea){super();this.type="bvec3";this.children=[O,V,ea].filter(la=>null!=la)}all(){return P(this)}any(){return Q(this)}clone(){const O=new W(p.cloneShaderNode(this.children[0]),p.cloneShaderNode(this.children[1]),p.cloneShaderNode(this.children[2]));super.cloneInto(O);return O}};k.BVec3.type="bvec3";k.BVec3=W=r.__decorate([q],k.BVec3);k.BVec4=Y=class extends p.ShaderPrimitiveNode{constructor(O,V,ea,la){super();
this.type="bvec4";this.children=[O,V,ea,la].filter(pa=>null!=pa)}all(){return P(this)}any(){return Q(this)}clone(){const O=new Y(p.cloneShaderNode(this.children[0]),p.cloneShaderNode(this.children[1]),p.cloneShaderNode(this.children[2]),p.cloneShaderNode(this.children[3]));super.cloneInto(O);return O}};k.BVec4.type="bvec4";k.BVec4=Y=r.__decorate([q],k.BVec4);class ma extends p.ShaderPrimitiveNode{constructor(O){super();this.type="int";this.children=[O]}multiply(O){return D(this,h(O,ma))}add(O){return E(this,
h(O,ma))}subtract(O){return H(this,h(O,ma))}divide(O){return G(this,h(O,ma))}clone(){const O=new ma(p.cloneShaderNode(this.children[0]));super.cloneInto(O);return O}}ma.type="int";k.IVec2=Z=class extends p.ShaderPrimitiveNode{constructor(O,V){super();this.type="ivec2";this.children=[O,V].filter(ea=>null!=ea)}clone(){const O=new Z(p.cloneShaderNode(this.children[0]),p.cloneShaderNode(this.children[1]));super.cloneInto(O);return O}};k.IVec2.type="ivec2";k.IVec2=Z=r.__decorate([q],k.IVec2);k.IVec3=da=
class extends p.ShaderPrimitiveNode{constructor(O,V,ea){super();this.type="ivec3";this.children=[O,V,ea].filter(la=>null!=la)}clone(){const O=new da(p.cloneShaderNode(this.children[0]),p.cloneShaderNode(this.children[1]),p.cloneShaderNode(this.children[2]));super.cloneInto(O);return O}};k.IVec3.type="ivec3";k.IVec3=da=r.__decorate([q],k.IVec3);k.IVec4=ca=class extends p.ShaderPrimitiveNode{constructor(O,V,ea,la){super();this.type="ivec4";this.children=[O,V,ea,la].filter(pa=>null!=pa)}clone(){const O=
new ca(p.cloneShaderNode(this.children[0]),p.cloneShaderNode(this.children[1]),p.cloneShaderNode(this.children[2]),p.cloneShaderNode(this.children[3]));super.cloneInto(O);return O}};k.IVec4.type="ivec4";k.IVec4=ca=r.__decorate([q],k.IVec4);class qa extends p.ShaderPrimitiveNode{constructor(O,V,ea,la){super();this.type="mat2";this.children=[O,V,ea,la]}clone(){const O=new qa(p.cloneShaderNode(this.children[0]),p.cloneShaderNode(this.children[1]),p.cloneShaderNode(this.children[2]),p.cloneShaderNode(this.children[3]));
super.cloneInto(O);return O}get(O,V){O=new ma(O);V=new ma(V);return A(this,O,V,ia)}multiply(O){return D(this,O)}}qa.type="mat2";class ra extends p.ShaderPrimitiveNode{static identity(){return new ra(1,0,0,0,1,0,0,0,1)}static fromRotation(O){const V=U(O);O=S(O);return new ra(O,V,0,B(V),O,0,0,0,1)}constructor(O,V,ea,la,pa,va,Ga,Ka,Ra){super();this.type="mat3";this.children=[O,V,ea,la,pa,va,Ga,Ka,Ra]}add(O){return E(this,O)}multiply(O){return D(this,O)}get(O,V){O=new ma(O);V=new ma(V);return A(this,
O,V,ia)}clone(){const O=new ra(p.cloneShaderNode(this.children[0]),p.cloneShaderNode(this.children[1]),p.cloneShaderNode(this.children[2]),p.cloneShaderNode(this.children[3]),p.cloneShaderNode(this.children[4]),p.cloneShaderNode(this.children[5]),p.cloneShaderNode(this.children[6]),p.cloneShaderNode(this.children[7]),p.cloneShaderNode(this.children[8]));super.cloneInto(O);return O}}ra.type="mat3";class ta extends p.ShaderPrimitiveNode{static identity(){return new ta(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,
1)}constructor(O,V,ea,la,pa,va,Ga,Ka,Ra,Ia,ab,Sa,yb,La,Ca,Qa){super();this.type="mat4";this.children=[O,V,ea,la,pa,va,Ga,Ka,Ra,Ia,ab,Sa,yb,La,Ca,Qa]}static fromColumns(O,V,ea,la){return new ta(O.x,O.y,O.z,O.w,V.x,V.y,V.z,V.w,ea.x,ea.y,ea.z,ea.w,la.x,la.y,la.z,la.w)}multiply(O){return D(this,O)}get(O,V){O=new ma(O);V=new ma(V);return A(this,O,V,ia)}clone(){const O=new ta(p.cloneShaderNode(this.children[0]),p.cloneShaderNode(this.children[1]),p.cloneShaderNode(this.children[2]),p.cloneShaderNode(this.children[3]),
p.cloneShaderNode(this.children[4]),p.cloneShaderNode(this.children[5]),p.cloneShaderNode(this.children[6]),p.cloneShaderNode(this.children[7]),p.cloneShaderNode(this.children[8]),p.cloneShaderNode(this.children[9]),p.cloneShaderNode(this.children[10]),p.cloneShaderNode(this.children[11]),p.cloneShaderNode(this.children[12]),p.cloneShaderNode(this.children[13]),p.cloneShaderNode(this.children[14]),p.cloneShaderNode(this.children[15]));super.cloneInto(O);return O}}ta.type="mat4";const Ha={float:ia,
vec2:k.Vec2,vec3:k.Vec3,vec4:k.Vec4,int:ma,ivec2:k.IVec2,ivec3:k.IVec3,ivec4:k.IVec4,uint:k.UInt,uvec2:k.UVec2,uvec3:k.UVec3,uvec4:k.UVec4,bool:na,bvec2:k.BVec2,bvec3:k.BVec3,bvec4:k.BVec4},xa=(...O)=>new ia(...O);k.Bool=na;k.FixedArray2D=ha;k.Float=ia;k.Int=ma;k.Mat2=qa;k.Mat3=ra;k.Mat4=ta;k.Sampler2D=ka;k._or=J;k.abs=function(O){return t("abs",O)};k.acos=function(O){return t("acos",O)};k.acosh=function(O){return t("acosh",O)};k.add=E;k.all=P;k.and=L;k.any=Q;k.asin=function(O){return t("asin",O)};
k.asinh=function(O){return t("asinh",O)};k.atan=function(O,V){return null==V?t("atan",O):w("atan",O,V,O.constructor)};k.atanh=function(O){return t("atanh",O)};k.bitAnd=function(O,V){return z("\x26",O,V)};k.bitOr=function(O,V){return z("|",O,V)};k.bitRShift=function(O,V){return z("\x3e\x3e",O,V)};k.bitShift=function(O,V){return z("\x3c\x3c",O,V)};k.bitXor=function(O,V){return z("^",O,V)};k.block=C;k.ceil=function(O){return t("ceil",O)};k.clamp=function(O,V,ea){return x("clamp",O,V,ea,O.constructor)};
k.cond=function(...O){var V=O.map(([la,pa])=>"function"===typeof pa?[la,pa()]:[la,pa]);O=V[0][1].constructor;const ea=V.findIndex(la=>!0===la[0]);if(-1===ea)throw Error("A cond must have a fallthrough case with `true`/; ");V=V.slice(0,ea).reduceRight((la,pa)=>F(pa[0],pa[1],la),V[ea][1]);O=new O(V);O.isImplicit=!0;return O};k.cos=S;k.cosh=function(O){return t("cosh",O)};k.cross=function(O,V){return w("cross",O,V,O.constructor)};k.dFdx=function(O){return t("dFdX",O)};k.dFdy=function(O){return t("dFdY",
O)};k.definePropertyAccess=u;k.definePropertyAccess2D=A;k.degrees=function(O){return t("degrees",O)};k.determinant=function(O){return t("determinant",O,ia)};k.distance=function(O,V){return w("distance",O,V,ia)};k.divide=G;k.dot=function(O,V){return w("dot",O,V,ia)};k.equal=function(O,V){return z("\x3d\x3d",O,V,na)};k.equalComponent=function(O,V){return w("equal",O,V,d(O))};k.exp=function(O){return t("exp",O)};k.exp2=function(O){return t("exp2",O)};k.faceforward=function(O,V,ea){return x("faceforward",
O,V,ea)};k.findIndex=y;k.float=xa;k.floatBitsToInt=function(O){return t("floatBitsToInt",O,l(O))};k.floatBitsToUint=function(O){return t("floatBitsToUint",O,n(O))};k.floor=function(O){return t("floor",O)};k.fract=function(O){return t("fract",O)};k.fwidth=function(O){return t("fwidth",O)};k.getTypeElementLengthForType=b;k.glslFindIndex=v;k.greaterThan=function(O,V){return z("\x3e",O,V,na)};k.greaterThanComponent=function(O,V){return w("greaterThan",O,V,d(O))};k.greaterThanEqual=function(O,V){return z("\x3e\x3d",
O,V,na)};k.greaterThanEqualComponent=function(O,V){return w("greaterThanEqual",O,V,d(O))};k.ifElse=F;k.int=(...O)=>new ma(...O);k.intBitsToFloat=function(O){return t("intBitsToFloat",O,m(O))};k.intMod=function(O,V){return z("%",O,V)};k.inverse=function(O){return t("inverse",O,ia)};k.inversesqrt=function(O){return t("inversesqrt",O)};k.isinf=function(O){return t("isinf",O,d(O))};k.isnan=function(O){return t("isnan",O,d(O))};k.length=function(O){return t("length",O,ia)};k.lessThan=function(O,V){return z("\x3c",
O,V,na)};k.lessThanComponent=function(O,V){return w("lessThan",O,V,d(O))};k.lessThanEqual=function(O,V){return z("\x3c\x3d",O,V,na)};k.lessThanEqualComponent=function(O,V){return w("lessThanEqual",O,V,d(O))};k.log=function(O){return t("log",O)};k.log2=function(O){return t("log2",O)};k.mat2=(...O)=>new qa(...O);k.mat3=(...O)=>new ra(...O);k.mat4=(...O)=>new ta(...O);k.matrixCompMult=function(O,V){return w("matrixCompMult",O,V)};k.max=function(O,V){return w("max",O,V)};k.min=function(O,V){return w("min",
O,V)};k.mix=function(O,V,ea){return x("mix",O,V,ea)};k.mod=function(O,V){return w("mod",O,V)};k.modf=function(O,V){throw Error("modf not implemented");};k.multiply=D;k.namedScope=function(O,V){O="function"===typeof O?O():O;V=new O.constructor((new p.ShaderScopeNode(O)).setDebugName(V));V.isImplicit=!0;return V};k.negate=B;k.normalize=function(O){return t("normalize",O)};k.not=function(O){return"bool"===O.type?t("!",O):t("not",O)};k.notEqual=function(O,V){return z("!\x3d",O,V,na)};k.notEqualComponent=
function(O,V){return w("notEqual",O,V,d(O))};k.or=K;k.outerProduct=function(O,V){throw Error("Impl type?");};k.packHalf2x16=function(O){return t("packHalf2x16",O,k.UInt)};k.packSnorm2x16=function(O){return t("packSnorm2x16",O,k.UInt)};k.packUnorm2x16=function(O){return t("packUnorm2x16",O,k.UInt)};k.pow=function(O,V){return w("pow",O,V)};k.radians=function(O){return t("radians",O)};k.reduce2D=function(O,V){const {initialValue:ea,xRange:la,yRange:pa,callback:va}=V,[Ga,Ka]=la,[Ra,Ia]=pa;V=(new ma(0)).setMutable().setDebugName("iterX");
const ab=(new ma(0)).setMutable().setDebugName("iterY"),Sa=ea.setMutable().setDebugName("accumulator");O=O.get(V,ab);O=va(Sa,O,V,ab).setDebugName("callback");return C({iterX:V,iterY:ab,accumulator:Sa},ea.constructor,O,({out:yb,iterX:La,iterY:Ca,accumulator:Qa,subgraph:zb})=>`\nfor (${Ca} = ${Ra}; ${Ca} < ${Ia}; ${Ca}++) {\n  for (${La} = ${Ga}; ${La} < ${Ka}; ${La}++) {\n\n  ${zb.body}\n\n  ${Qa} = ${zb.varName};\n  }\n}\n${yb} = ${Qa};\n`).setDebugName("reduce2DBody")};k.reflect=function(O,V){return w("reflect",
O,V)};k.refract=function(O,V,ea){return x("refract",O,V,ea)};k.round=function(O){return t("round",O)};k.roundEven=function(O){return t("roundEven",O)};k.sign=function(O){return t("sign",O)};k.sin=U;k.sinh=function(O){return t("sinh",O)};k.smoothstep=function(O,V,ea){return x("smoothstep",O,V,ea)};k.sqrt=function(O){return t("sqrt",O)};k.step=function(O,V){return w("step",O,V,V.constructor)};k.subtract=H;k.tan=function(O){return t("tan",O)};k.tanh=function(O){return t("tanh",O)};k.texelFetch=function(O,
V,ea){throw Error("Impl type");};k.texelFetchOffset=function(O,V,ea,la){throw Error("Impl type");};k.texture=function(O,V,ea){throw Error("Impl type");};k.texture2D=function(O,V){return w("texture",O,V,k.Vec4)};k.textureGrad=function(O,V,ea,la){throw Error("Impl type");};k.textureGradOffset=function(O,V,ea,la,pa){throw Error("Impl type");};k.textureLod=function(O,V,ea){throw Error("Impl type");};k.textureLodOffset=function(O,V,ea,la){throw Error("Impl type");};k.textureOffset=function(O,V,ea,la){throw Error("Impl type");
};k.textureProj=function(O,V,ea){throw Error("Impl type");};k.textureProjGrad=function(O,V,ea,la){throw Error("Impl type");};k.textureProjGradOffset=function(O,V,ea,la,pa){throw Error("Impl type");};k.textureProjLod=function(O,V,ea){throw Error("Impl type");};k.textureProjLodOffset=function(O,V,ea,la){throw Error("Impl type");};k.textureProjOffset=function(O,V,ea,la){throw Error("Impl type");};k.textureSize=function(O,V){throw Error("Impl type");};k.transformFloatToInt=l;k.transformFloatToUInt=n;
k.transformIntToFloat=m;k.transformTypeToBooleanType=d;k.transformUIntToFloat=e;k.transpose=function(O){return t("transpose",O)};k.trunc=function(O){return t("trunc",O)};k.uintBitsToFloat=function(O){return t("uintBitsToFloat",O,e(O))};k.unpackHalf2x16=function(O){return t("unpackHalf2x16",O,k.Vec2)};k.unpackSnorm2x16=function(O){return t("unpackSnorm2x16",O,k.Vec2)};k.unpackUnorm2x16=function(O){return t("unpackUnorm2x16",O,k.Vec2)};k.vec2=(...O)=>new k.Vec2(...O);k.vec3=(...O)=>new k.Vec3(...O);
k.vec4=(...O)=>new k.Vec4(...O);k.when=function(O,V){O=new V.constructor(new p.ShaderConditionNode(O,V,null));O.isImplicit=!0;return O};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/graph/ShaderGraphNode":function(){define(["exports"],function(k){function r(q){return q.split(" ").map((c,h)=>0<h?c.charAt(0).toUpperCase()+c.slice(1):c).join("")}function p(q){return"object"===typeof q?q.clone():q}class e{constructor(){this.uid=e.NodeCount++;this._debugName=
null;this.isImplicit=this._isMutable=!1}get isMutable(){return this._isMutable}setMutable(){this._isMutable=!0;return this}setDebugName(q){this._debugName=q=r(q);this.isImplicit&&this.children[0]instanceof e&&this.children[0].setDebugName(q);return this}get debugInfo(){return{name:this._debugName??""}}cloneInto(q){q._debugName=this._debugName;q._isMutable=this._isMutable;q.isImplicit=this.isImplicit;q.uid=this.uid}}e.NodeCount=0;class n extends e{constructor(){super(...arguments);this.shaderType=
"primitive-node"}}class m extends e{constructor(q){super();this.child=q;this.shaderType="scope-node"}get children(){return[this.child]}clone(){const q=new m(p(this.child));this.cloneInto(q);return q}}class l extends e{constructor(q){super();this.text=q;this.shaderType="text-node"}get children(){return[]}clone(){const q=new l(this.text);this.cloneInto(q);return q}}class d extends e{constructor(q,c,h){super();this.property=q;this.target=c;this.returnType=h;this.shaderType="property-access-node"}get children(){const q=
[this.target];"string"!==typeof this.property&&q.push(this.property);return q}clone(){const q=new d(this.property,p(this.target),this.returnType);this.cloneInto(q);return q}}class a extends e{constructor(q,c,h,u){super();this.x=q;this.y=c;this.target=h;this.returnType=u;this.shaderType="property-access-2d-node"}get children(){return[this.target,this.x,this.y]}clone(){const q=new a(this.x,this.y,p(this.target),this.returnType);this.cloneInto(q);return q}}class b extends e{constructor(q,c,h){super();
this.condition=q;this.ifTrue=c;this.ifFalse=h;this.shaderType="condition-node"}get children(){return[this.condition,this.ifTrue,this.ifFalse]}clone(){var q=p(this.ifTrue);const c=this.ifFalse?p(this.ifFalse):null;q=new b(this.condition,q,c);this.cloneInto(q);return q}}class f extends e{constructor(q,c,h,u){super();this.captureList=q;this.returnType=c;this.generator=u;this.shaderType="block-node";h&&(this.subgraph=new m(h))}get children(){return Object.keys(this.captureList).map(q=>this.captureList[q]).concat(this.subgraph??
[])}clone(){var q={};for(const c in this.captureList)q[c]=p(this.captureList[c]);q=new f(q,this.returnType,this.subgraph?p(this.subgraph.child):this.subgraph,this.generator);this.cloneInto(q);return q}}class g extends e{constructor(q,c,h,u,A,z=!1){super();this.token=q;this._children=c;this.isInfix=h;this.isPropertyAccess=u;this.returnType=A;this.isTernary=z;this.shaderType="function-node"}get children(){return this._children}clone(){const q=new g(this.token,this._children.map(p),this.isInfix,this.isPropertyAccess,
this.returnType,this.isTernary);this.cloneInto(q);return q}}k.ShaderBlockNode=f;k.ShaderConditionNode=b;k.ShaderFunctionNode=g;k.ShaderNode=e;k.ShaderPrimitiveNode=n;k.ShaderPropertyAccess2DNode=a;k.ShaderPropertyAccessNode=d;k.ShaderScopeNode=m;k.ShaderTextNode=l;k.cloneShaderNode=p;k.setReachableUids=function(q,c){const h=[];for(h.push(c);h.length;)if(c=h.pop(),"object"===typeof c&&!q.has(c.uid)){q.add(c.uid);for(const u of c.children)h.push(u)}};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/shaderGraph/graph/GlslGraphWriter":function(){define(["exports"],function(k){function r(e,n,m){n=n.split("\n");for(const l of n)if(l.trim().length){n="";const d=m??"000";null!=m&&(n+=`/*id:${d}*/   `);e.body+=n.padEnd(14);e.body+=" ".repeat(e.indent)+l+"\n"}}class p{write(e){for(const n of e.rootOutputNodes())e.shouldPruneOutputNode(n)||(n.variableName=this._write(e,n.node));return e}_createVarName(e,n){let m="";"boolean"!==typeof n&&"number"!==typeof n&&n.debugInfo.name&&
(m=`${n.debugInfo.name}_`);return`${m}v${e.varCount++}`}_write(e,n,m=!1){if("number"===typeof n||"boolean"===typeof n)return n.toString();let l=e.getEmit(n);if(l)return l;switch(n.shaderType){case "scope-node":l=this._writeScopeNode(e,n);break;case "primitive-node":l=this._writePrimitiveNode(e,n,m);break;case "function-node":l=this._writeFunctionNode(e,n);break;case "property-access-node":l=this._writePropertyAccessNode(e,n);break;case "property-access-2d-node":l=this._writePropertyAccess2DNode(e,
n);break;case "text-node":l=n.text;break;case "block-node":l=this._writeBlockNode(e,n);break;case "condition-node":l=this._writeConditionNode(e,n)}e.setEmit(n,l);return l}_writeScopeNode(e,n){var m=new n.child.constructor;m.setDebugName(n.debugInfo.name);m=this._write(e,m,!0);r(e,`{ /*ScopeStart: ${n.uid} ${n.debugInfo.name}*/`);e.indent+=2;const l=this._write(e,n.child);r(e,`${m} = ${l};`);e.indent-=2;r(e,`} /*ScopeEnd: ${n.uid} ${n.debugInfo.name}*/`);return m}_writeConditionNode(e,n){var m=new n.ifTrue.constructor;
m=this._write(e,m,!0);var l=this._write(e,n.condition);r(e,`if (${l}) {`);e.indent+=2;l=e.createSubgraphContext();const d=this._write(l,n.ifTrue);e.body+=l.body;d&&r(e,`${m} = ${d};`);e.indent-=2;r(e,"}");n.ifFalse&&(r(e,"else {"),e.indent+=2,l=e.createSubgraphContext(),n=this._write(l,n.ifFalse),e.body+=l.body,n&&r(e,`${m} = ${n};`),e.indent-=2,r(e,"}"));return m}_writeBlockNode(e,n){const {captureList:m,generator:l,returnType:d}=n;var a={};for(var b in m)if(m[b]){var f=this._write(e,m[b]);a[b]=
f}b=new d;b=this._write(e,b,!0);a.out=b;n.subgraph&&(f=e.createSubgraphContext(),n=this._write(f,n.subgraph.child),a.subgraph={varName:n,body:f.body});a=l(a);r(e,"{\n");e.indent+=2;r(e,a);e.indent-=2;r(e,"}\n");return b}_writePropertyAccessNode(e,n){const m=this._write(e,n.target);return"string"===typeof n.property&&n.property.includes("[")?`${m}${n.property}`:"string"!==typeof n.property?(e=this._write(e,n.property),`${m}[${e}]`):`${m}.${n.property}`}_writePropertyAccess2DNode(e,n){const m=this._write(e,
n.target),l=this._write(e,n.x);e=this._write(e,n.y);return`${m}[${l}][${e}]`}_writeFunctionNode(e,n){const m=n.returnType.type;if(n.isInfix){const [a,b]=n.children.map(f=>this._write(e,f));var l=this._createVarName(e,n);r(e,`${m.padEnd(5)} ${l} = ${a} ${n.token} ${b};`,n.uid);return l}l=n.children.map(a=>this._write(e,a)).join(", ");const d=this._createVarName(e,n);r(e,`${m.padEnd(5)} ${d} = ${n.token}(${l});`,n.uid);return d}_writePrimitiveNode(e,n,m=!1){var l=e.getInput(n);if(l)return l.isUsed=
!0,l.variableName;l=1===n.children.length&&n.children[0]?.type===n.type;if(!n.isMutable&&(n.isImplicit||l))return this._write(e,n.children[0]);l=this._createVarName(e,n);if(m)return r(e,`${n.type.padEnd(5)} ${l};`,n.uid),l;if((m=!n.debugInfo.name&&!n.isMutable)&&"float"===n.type&&"number"===typeof n.children[0])return Number.isInteger(n.children[0])?n.children[0].toFixed(1):n.children[0].toString();if(m&&"int"===n.type&&"number"===typeof n.children[0]&&Number.isInteger(n.children[0]))return n.children[0].toString();
const d=n.children.map(a=>this._write(e,a)).join(", ");if("array"===n.type)return r(e,`${n.type.padEnd(5)} ${l} = [${d}];`,n.uid),l;if(m)return`${n.type}(${d})`;r(e,`${n.type.padEnd(5)} ${l} = ${n.type}(${d});`,n.uid);return l}}k.GlslShaderWriter=p;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/graph/ShaderGraphContext":function(){define(["exports","./ShaderGraphNode"],function(k,r){class p{constructor(m,l,d){this.variableName=m;this.variableInputType=
l;this.node=d;this.type="shader-input";this.isUsed=!1}clone(){return new p(this.variableName,this.variableInputType,r.cloneShaderNode(this.node))}}class e{constructor(m,l,d){this.outVariableName=m;this.outVariableType=l;this.node=d;this.type="shader-output"}clone(){const m=new e(this.outVariableName,this.outVariableType,r.cloneShaderNode(this.node));m.variableName=this.variableName;return m}}class n{static createVertex(m,l,d,a,b,f){const g=[];for(const q in m){const c=m[q],h=d.get(q);h?g.push(new p(h,
"builtin",c)):g.push(new p("a_"+q,"in",c))}for(const q of a)g.push(new p(q.uniformName,"uniform",q.uniformHydrated));m=[];for(const q in l)d=l[q],"glPosition"===q?m.push(new e("gl_Position","builtin",d)):"glPointSize"===q?m.push(new e("gl_PointSize","builtin",d)):m.push(new e("v_"+q,"out",d));return new n(g,m,b,f)}static createFragment(m,l,d,a,b,f){const g=[];b=Array.from(b.rootOutputNodes());for(var q in m){const h=m[q];var c=d.get(q);c?g.push(new p(c,"builtin",h)):(c=b.find(u=>u.node===h))&&g.push(new p(c.outVariableName,
"in",h))}for(const h of a)g.push(new p(h.uniformName,"uniform",h.uniformHydrated));m=[];for(const h in l)a=l[h],q=d.get(h),"discard"===h?m.push(new e(null,"discard",a)):q?m.push(new e(q,"builtin",a)):m.push(new e(h,"out",a));return new n(g,m,f)}constructor(m,l,d,a){this.type="shader-graph-context";this.indent=0;this.body="";this.varCount=0;this._inputShaderTypesByNodeUid=new Map;this._nodeEmitMap=new Map;for(const b of m)this._inputShaderTypesByNodeUid.set(b.node.uid,b);this._outputShaderTypes=l;
this._transformFeedbackBindings=d;this._transformFeedbackNames=new Set(d.map(b=>"v_"+b.propertyKey));this._usedInFragmentShader=a}shouldPruneOutputNode(m){return!this._usedInFragmentShader||"builtin"===m.outVariableType||this._transformFeedbackNames.has(m.outVariableName)?!1:!this._usedInFragmentShader.has(m.node.uid)}setEmit(m,l){this._nodeEmitMap.set(m.uid,l)}getEmit(m){return this._nodeEmitMap.get(m.uid)}inputs(){return this._inputShaderTypesByNodeUid.values()}getInput(m){return this._inputShaderTypesByNodeUid.get(m.uid)}*rootOutputNodes(){for(const m of this._outputShaderTypes)yield m}*nodes(){const m=
[];for(var l of this._outputShaderTypes.values())m.push(l.node);for(;m.length;)l=m.pop(),"number"!==typeof l&&"boolean"!==typeof l&&m.push(...l.children.filter(Boolean)),yield l}*nodesOfTypeOrFunction(){for(const m of this.nodes())"number"!==typeof m&&"boolean"!==typeof m&&(yield m)}createSubgraphContext(){const m=this.clone();m.body="";m.indent=this.indent+2;m._nodeEmitMap=new Map(this._nodeEmitMap);return m}clone(){const m=new n([],this._outputShaderTypes,this._transformFeedbackBindings,this._usedInFragmentShader);
m._inputShaderTypesByNodeUid=this._inputShaderTypesByNodeUid;m.indent=this.indent;m.body=this.body;m.varCount=this.varCount;m._nodeEmitMap=this._nodeEmitMap;return m}insertVertexShader(m){m.vertex.code.add("");this._insertInputs(m,"vertex");m.vertex.code.add("");m.vertex.code.add("// OUTPUTS: ");m.vertex.code.add("// --------------------------------------------------------- ");for(const l of this.rootOutputNodes()){const d="builtin"===l.outVariableType;this.shouldPruneOutputNode(l)||(d?m.vertex.code.add(`// ${l.outVariableType.padEnd(7)} ${l.node.type.padEnd(9)} ${l.outVariableName};`):
m.vertex.code.add(`${l.outVariableType.padEnd(10)} ${l.node.type.padEnd(9)} ${l.outVariableName};`))}m.vertex.code.add("");m.vertex.code.add("void main() {");m.vertex.code.add("  "+this.body.split("\n").join("\n  "));for(const l of this.rootOutputNodes())this.shouldPruneOutputNode(l)||m.vertex.code.add("  "+`${l.outVariableName} = ${l.variableName};`);m.vertex.code.add("}")}insertFragmentShader(m){this._insertInputs(m,"fragment");m.fragment.code.add("");m.fragment.code.add("// OUTPUTS: ");m.fragment.code.add("// --------------------------------------------------------- ");
let l=0;for(const d of this.rootOutputNodes())"builtin"===d.outVariableType?m.fragment.code.add(`// ${d.outVariableType.padEnd(7)} ${d.node.type.padEnd(9)} ${d.outVariableName};`):m.outputs.add(d.outVariableName,d.node.type,l++);m.fragment.code.add("");m.fragment.code.add("void main() {");m.fragment.code.add("  "+this.body.split("\n").join("\n  "));for(const d of this.rootOutputNodes())"discard"===d.outVariableType?(m.fragment.code.add("  // TODO: Should ensure codegen for discard appears first in fragment shader"),
m.fragment.code.add("  "+`if (${d.variableName}) {`),m.fragment.code.add("    discard;"),m.fragment.code.add("  }"),m.fragment.code.add("  ")):m.fragment.code.add("  "+`${d.outVariableName} = ${d.variableName};`);m.fragment.code.add("}")}_insertInputs(m,l){m[l].code.add("// INPUTS: ");m[l].code.add("// --------------------------------------------------------- ");for(const d of this.inputs())d.isUsed&&"builtin"!==d.variableInputType&&("array"===d.node.type?m[l].code.add(`${d.variableInputType.padEnd(10)} ${d.node.elementType.type.padEnd(9)} ${d.variableName}[${d.node.size}];`):
"array-2d"===d.node.type?m[l].code.add(`${d.variableInputType.padEnd(10)} ${d.node.elementType.type.padEnd(9)} ${d.variableName}[${d.node.size}]; // Emulated 2D Array. Not supported by ES3.0`):m[l].code.add(`${d.variableInputType.padEnd(10)} ${d.node.type.padEnd(9)} ${d.variableName};`))}}k.ShaderGraphContext=n;k.ShaderInput=p;k.ShaderOutput=e;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/typed/TypedShaderProgram":function(){define("exports ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/object ../../../../../../core/has ../../../../../../core/RandomLCG ../../../../../webgl/checkWebGLError ../../../../../webgl/enums ../../../../../webgl/FramebufferObject ../../../../../webgl/Program ../../../../../webgl/GLObjectType ../../../../../webgl/Texture ../../textureUtils".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g,q){function c(u,A,z){const t=A.length;t!==z&&(u=new r("Invalid Uniform",`Invalid length, expected ${z} but got ${t}`,{uniformName:u,values:A}),p.getLogger("esri.views.2d.engine.webgl.shaderGraph.typed.TypedShaderProgram").errorOnce(u))}class h{constructor(u,A,z,t,w,x){this._vao=this._program=null;this._temporaryTextures=[];this.vertexShader=u;this.fragmentShader=A;this._locations=z;this._locationInfo=t;this._uniformBindings=w;this._transformFeedbackBindings=x}destroy(){this._program&&
this._program.dispose();this.cleanupTemporaryTextures()}get locations(){return this._locations}get locationInfo(){return this._locationInfo}setUniforms(u){this._uniforms=u}cleanupTemporaryTextures(){for(const u of this._temporaryTextures)u.dispose();this._temporaryTextures=[]}bind(u){const A=this._uniforms;if(!this._program){var z=new Map;for(const [w,x]of this._locations)z.set(w,x);var t=[];for(const w of this._transformFeedbackBindings??[]){const {index:x,propertyKey:B}=w;t[x]=`v_${B}`}this._program=
new b.Program(u,this.vertexShader,this.fragmentShader,z,new Map,t)}z=this._program;u.useProgram(z);for(const w of this._uniformBindings){const {shaderModulePath:x,uniformName:B,uniformType:C,uniformArrayLength:y}=w;t=e.getDeepValue(x,A);if(null==t){if("sampler2D"===C)continue;throw Error(`Failed to find uniform value for ${x}`);}switch("array"===C||"array-2d"===C?w.uniformArrayElementType:C){case "sampler2D":const {unit:v,texture:F}=t;z.setUniform1i(B,v);"type"in F?u.bindTexture(F,v):(t=q.createTexture(u,
F.descriptor,F.data),u.bindTexture(t,v));break;case "int":if(!y){z.setUniform1i(B,t);break}c(w.uniformName,t,y);z.setUniform1iv(B,t);break;case "float":if(!y){z.setUniform1f(B,t);break}c(w.uniformName,t,y);z.setUniform1fv(B,t);break;case "vec2":if(!y){z.setUniform2f(B,t[0],t[1]);break}c(w.uniformName,t,y);z.setUniform2fv(B,t.flat());break;case "vec3":if(!y){z.setUniform3f(B,t[0],t[1],t[2]);break}c(w.uniformName,t,y);z.setUniform3fv(B,t.flat());break;case "vec4":if(!y){z.setUniform4f(B,t[0],t[1],t[2],
t[3]);break}c(w.uniformName,t,y);z.setUniform4fv(B,t.flat());break;case "mat3":z.setUniformMatrix3fv(B,t);break;case "mat4":z.setUniformMatrix4fv(B,t);break;default:throw Error(`Unable to set uniform for type ${C}`);}}}}k.TypedShaderProgram=h;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/textureUtils":function(){define("exports ../../../../core/has ../../../../core/RandomLCG ../../../../core/Logger ../../../webgl/checkWebGLError ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/GLObjectType ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(k,r,p,e,n,m,l,d,a,b){k.createTexture=function(f,g,q){const c=new b.TextureDescriptor(g.width,g.height);c.dataType=g.dataType;g.depth&&(c.depth=g.depth);g.flipped&&(c.flipped=g.flipped);g.hasMipmap&&(c.hasMipmap=g.hasMipmap);c.internalFormat=g.internalFormat;g.isImmutable&&(c.isImmutable=g.isImmutable);g.isOpaque&&(c.isOpaque=g.isOpaque);g.maxAnisotropy&&(c.maxAnisotropy=g.maxAnisotropy);c.pixelFormat=g.pixelFormat;g.preMultiplyAlpha&&(c.preMultiplyAlpha=g.preMultiplyAlpha);g.samplingMode&&
(c.samplingMode=g.samplingMode);g.target&&(c.target=g.target);c.uniform=g.uniform;g.unpackAlignment&&(c.unpackAlignment=g.unpackAlignment);g.wrapMode&&(c.wrapMode=g.wrapMode);return new a.Texture(f,c,q)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ShaderBuilder":function(){define(["exports","../../core/Error","../../core/has","../../core/Logger","./BindType"],function(k,r,p,e,n){const m=()=>e.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");
class l{constructor(){this._includedModules=new Map}include(z,t){this._includedModules.has(z)?this._includedModules.get(z):(this._includedModules.set(z,t),z(this.builder,t))}}class d extends l{constructor(){super(...arguments);this.vertex=new g;this.fragment=new g;this.attributes=new q;this.varyings=new c;this.extensions=new h;this.outputs=new u}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(z,t=!1){const w=this.extensions.generateSource(z),x=this.attributes.generateSource(z),
B=this.varyings.generateSource(z);var C="vertex"===z?this.vertex:this.fragment;const y=C.uniforms.generateSource(),v=C.code.generateSource();t=C.main.generateSource(t);const F="vertex"===z?"precision highp float;\nprecision highp sampler2D;":"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp int;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump int;\n  precision mediump sampler2D;\n#endif";C=C.constants.generateSource();z=this.outputs.generateSource(z);
return`#version 300 es\n${w.join("\n")}\n${F}\n${C.join("\n")}\n${y.join("\n")}\n${x.join("\n")}\n${B.join("\n")}\n${z.join("\n")}\n${v.join("\n")}\n${t.join("\n")}`}generateBind(z){const t=new Map;this.vertex.uniforms.entries.forEach(B=>{const C=B.bind[n.BindType.Bind];C&&t.set(B.name,C)});this.fragment.uniforms.entries.forEach(B=>{const C=B.bind[n.BindType.Bind];C&&t.set(B.name,C)});const w=Array.from(t.values()),x=w.length;return B=>{for(let C=0;C<x;++C)w[C](z,B)}}generateBindPass(z){const t=new Map;
this.vertex.uniforms.entries.forEach(B=>{const C=B.bind[n.BindType.Pass];C&&t.set(B.name,C)});this.fragment.uniforms.entries.forEach(B=>{const C=B.bind[n.BindType.Pass];C&&t.set(B.name,C)});const w=Array.from(t.values()),x=w.length;return(B,C)=>{for(let y=0;y<x;++y)w[y](z,B,C)}}generateBindDraw(z){const t=new Map;this.vertex.uniforms.entries.forEach(B=>{const C=B.bind[n.BindType.Draw];C&&t.set(B.name,C)});this.fragment.uniforms.entries.forEach(B=>{const C=B.bind[n.BindType.Draw];C&&t.set(B.name,C)});
const w=Array.from(t.values()),x=w.length;return(B,C,y)=>{for(let v=0;v<x;++v)w[v](z,y,B,C)}}}class a{constructor(z){this._stage=z;this._entries=new Map}add(...z){for(const t of z)this._add(t);return this._stage}get(z){return this._entries.get(z)}_add(z){if(null==z)m().error(`Trying to add null Uniform from ${Error().stack}.`);else{if(this._entries.has(z.name)&&!this._entries.get(z.name).equals(z))throw new r(`Duplicate uniform name ${z.name} for different uniform type`);this._entries.set(z.name,
z)}}generateSource(){return Array.from(this._entries.values()).map(z=>null!=z.arraySize?`uniform ${z.type} ${z.name}[${z.arraySize}];`:`uniform ${z.type} ${z.name};`)}get entries(){return Array.from(this._entries.values())}}class b{constructor(z){this._stage=z;this._bodies=[]}add(z){this._bodies.push(z);return this._stage}generateSource(z){if(0<this._bodies.length)return[`void main() {\n ${this._bodies.join("\n")||""} \n}`];if(z)throw new r("Shader does not contain main function body.");return[]}}
class f{constructor(z){this._stage=z;this._entries=[]}add(z){this._entries.push(z);return this._stage}generateSource(){return this._entries}}class g extends l{constructor(){super(...arguments);this.uniforms=new a(this);this.main=new b(this);this.code=new f(this);this.constants=new A(this)}get builder(){return this}}class q{constructor(){this._entries=[]}add(z,t){this._entries.push([z,t])}generateSource(z){return"fragment"===z?[]:this._entries.map(t=>`in ${t[1]} ${t[0]};`)}}class c{constructor(){this._entries=
new Map}add(z,t){this._entries.has(z)?m().warn(`Ignoring duplicate varying ${t} ${z}`):this._entries.set(z,t)}generateSource(z){const t=[];this._entries.forEach((w,x)=>t.push("vertex"===z?`out ${w} ${x};`:`in ${w} ${x};`));return t}}class h{constructor(){this._entries=new Set}add(z){this._entries.add(z)}generateSource(z){const t="vertex"===z?h.ALLOWLIST_VERTEX:h.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(w=>t.includes(w)).map(w=>`#extension ${w} : enable`)}}h.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod",
"GL_OES_standard_derivatives"];h.ALLOWLIST_VERTEX=[];class u{constructor(){this._entries=new Map}add(z,t,w=0){const x=this._entries.get(w);x?.name===z&&x?.type===t?m().warn(`Fragment shader output location ${w} occupied`):this._entries.set(w,{name:z,type:t})}generateSource(z){if("vertex"===z)return[];0===this._entries.size&&this._entries.set(0,{name:u.DEFAULT_NAME,type:u.DEFAULT_TYPE});const t=[];this._entries.forEach((w,x)=>t.push(`layout(location = ${x}) out ${w.type} ${w.name};`));return t}}u.DEFAULT_TYPE=
"vec4";u.DEFAULT_NAME="fragColor";class A{constructor(z){this._stage=z;this._entries=new Set}add(z,t,w){let x="ERROR_CONSTRUCTOR_STRING";switch(t){case "float":x=A._numberToFloatStr(w);break;case "int":x=A._numberToIntStr(w);break;case "bool":x=w.toString();break;case "vec2":x=`vec2(${A._numberToFloatStr(w[0])},                            ${A._numberToFloatStr(w[1])})`;break;case "vec3":x=`vec3(${A._numberToFloatStr(w[0])},                            ${A._numberToFloatStr(w[1])},                            ${A._numberToFloatStr(w[2])})`;
break;case "vec4":x=`vec4(${A._numberToFloatStr(w[0])},                            ${A._numberToFloatStr(w[1])},                            ${A._numberToFloatStr(w[2])},                            ${A._numberToFloatStr(w[3])})`;break;case "ivec2":x=`ivec2(${A._numberToIntStr(w[0])},                             ${A._numberToIntStr(w[1])})`;break;case "ivec3":x=`ivec3(${A._numberToIntStr(w[0])},                             ${A._numberToIntStr(w[1])},                             ${A._numberToIntStr(w[2])})`;
break;case "ivec4":x=`ivec4(${A._numberToIntStr(w[0])},                             ${A._numberToIntStr(w[1])},                             ${A._numberToIntStr(w[2])},                             ${A._numberToIntStr(w[3])})`;break;case "mat2":case "mat3":case "mat4":x=`${t}(${Array.prototype.map.call(w,B=>A._numberToFloatStr(B)).join(", ")})`}this._entries.add(`const ${t} ${z} = ${x};`);return this._stage}static _numberToIntStr(z){return z.toFixed(0)}static _numberToFloatStr(z){return Number.isInteger(z)?
z.toFixed(1):z.toString()}generateSource(){return Array.from(this._entries)}}k.Code=f;k.Includes=l;k.Main=b;k.ShaderBuilder=d;k.Stage=g;k.Uniforms=a;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/BindType":function(){define(["exports"],function(k){k.BindType=void 0;var r=k.BindType||(k.BindType={});r[r.Bind=0]="Bind";r[r.Pass=1]="Pass";r[r.Draw=2]="Draw";Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/utils":function(){define(["exports",
"../../../definitions","../../graph/glsl","./constants"],function(k,r,p,e){function n(m,l){l=p.float(2**l);return p.mod(p.floor(m.divide(l)),p.float(2))}k.clipToUv=function(m){return m.multiply(.5).add(.5)};k.cross2=function(m,l){return m.x.multiply(l.y).subtract(l.x.multiply(m.y))};k.getBit=n;k.getBitBool=function(m,l){return p.greaterThan(n(m,l),p.float(.5))};k.getFilterBit=function(m,l){return n(m,l+r.maxHighlightReasons)};k.getHighlightBit=function(m,l){return n(m,l)};k.isNan=function(m){return p.equal(m,
p.float(e.nanMagicNumber))};k.max4=function(m){return p.max(p.max(p.max(m.x,m.y),m.z),m.w)};k.minusOne=function(m){return m.subtract(new p.Float(1))};k.minusScalar=function(m,l){return m.subtract(new p.Float(l))};k.norm=function(m){return p.divide(m,p.float(255))};k.oneMinus=function(m){return(new p.Float(1)).subtract(m)};k.oneOver=function(m){return(new p.Float(1)).divide(m)};k.rand=function(m){const l=p.float(12.9898),d=p.float(78.233),a=p.float(43758.5453);m=p.dot(m,p.vec2(l,d));m=p.mod(m,p.float(3.14));
return p.fract(p.sin(m).multiply(a))};k.rgba2float=function(m){const l=p.vec4(.99609375,255/65536,255/16777216,255/4294967296);return p.dot(m,l)};k.scalarMinus=function(m,l){return(new p.Float(m)).subtract(l)};k.unpackDisplayIdTexel=function(m){const l=n(m.z,7),d=p.float(1).subtract(l),a=m.xyz.subtract(p.vec3(0,0,p.float(128)));return d.multiply(m).add(l.multiply(a))};k.uvToClip=function(m){return m.multiply(2).subtract(1)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/constants":function(){define(["exports"],
function(k){k.RotationType=void 0;var r=k.RotationType||(k.RotationType={});r[r.Geographic=0]="Geographic";r[r.Arithmatic=1]="Arithmatic";k.attrVvColor=1;k.attrVvOpacity=2;k.attrVvRotation=3;k.attrVvSize=0;k.bitsetFillRandomPatternOffset=2;k.bitsetGenericConsiderAlphaOnly=4;k.bitsetGenericLockColor=1;k.bitsetLineIsSdf=3;k.bitsetLineScaleDash=2;k.bitsetMarkerAlignmentMap=0;k.bitsetMarkerOutlineAllowColorOverride=2;k.bitsetMarkerScaleSymbolsProportionally=3;k.bitsetTextIsBackground=0;k.bitsetTextIsMapAligned=
3;k.bitsetTypeFillOutline=0;k.c256ToRad=3.14159265359/128;k.cDegToRad=3.14159265359/180;k.cRadToDeg=57.29577950560105;k.epsilon=1E-5;k.epsilonHitTest=.05;k.extrudeScalePlacementPadding=.25;k.fillPositionPrecision=1;k.magnifierBarrelFactor=1.1;k.maxFilterCount=2;k.maxRepresentableInt=16777216;k.maxSdfDistance=8;k.nanMagicNumber=1E-30;k.offsetPrecision=.125;k.outlineScale=.2;k.packPrecision=16;k.placementPadding=8;k.positionPrecision=.125;k.sdfFontSize=24;k.signedToUnsignedByte=128;k.softEdgeRatio=
1;k.thinLineHalfWidth=1;k.thinLineWidthFactor=1.1;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/OpacityShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(k,r,p,e){class n extends p.VertexInput{}r.__decorate([p.location(0,e.Vec2)],n.prototype,"position",void 0);class m extends p.FragmentInput{}class l extends p.UniformGroup{}r.__decorate([p.uniform(e.Sampler2D)],
l.prototype,"layerTexture",void 0);r.__decorate([p.uniform(e.Float)],l.prototype,"opacity",void 0);class d extends p.GraphShaderModule{constructor(){super(...arguments);this.type="OpacityShader"}vertex(a){const b=a.position;a=new e.Vec4(a.position.subtract(new e.Vec2(.5)).multiply(2),0,1);return{uv:b,glPosition:a}}fragment(a){const b=new p.FragmentOutput;b.fragColor=e.texture2D(this.config.layerTexture,a.uv).multiply(this.config.opacity);return b}}r.__decorate([p.uniform(l)],d.prototype,"config",
void 0);r.__decorate([r.__param(0,p.input(n))],d.prototype,"vertex",null);r.__decorate([r.__param(0,p.input(m))],d.prototype,"fragment",null);k.OpacityShader=d;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/FeatureEffect":function(){define(["exports","./Effect","../../../../webgl/enums"],function(k,r,p){class e extends r.Effect{constructor(n){super();this.name=this.constructor.name;this.defines=[n]}dispose(){}bind({context:n,painter:m}){this._prev=
n.getBoundFramebufferObject();m=m.getFbos().effect0;n.bindFramebuffer(m);n.setColorMask(!0,!0,!0,!0);n.setClearColor(0,0,0,0);n.clear(n.gl.COLOR_BUFFER_BIT)}unbind(){}draw(n,m){const {context:l,painter:d}=n;m=d.getPostProcessingEffects(m);const a=l.getBoundFramebufferObject();for(const {postProcessingEffect:b,effect:f}of m)b.draw(n,a,f);l.bindFramebuffer(this._prev);l.setStencilTestEnabled(!1);d.blitTexture(l,a.colorTexture,p.TextureSamplingMode.NEAREST);l.setStencilTestEnabled(!0)}}k.FeatureEffect=
e;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/Effect":function(){define(["exports"],function(k){class r{constructor(){this.name=this.constructor.name}createOptions(p,e){return null}}k.Effect=r;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/HighlightEffect":function(){define("../../../../../core/has ../BitBlitRenderer ./Effect ./highlight/HighlightRenderer ./highlight/HighlightSurfaces ../../../../webgl/enums".split(" "),
function(k,r,p,e,n,m){class l extends p.Effect{constructor(){super(...arguments);this.defines=["highlight"];this._hlRenderer=new e;this._height=this._width=void 0;this._boundFBO=null;this._hlSurfaces=new n;this._adjustedHeight=this._adjustedWidth=void 0;this._blitRenderer=new r.BitBlitRenderer}dispose(){this._hlSurfaces?.dispose();this._hlRenderer?.dispose();this._boundFBO=null}bind(d){const {context:a,painter:b}=d,{width:f,height:g}=a.getViewport(),q=b.getFbos().effect0;this.setup(d,f,g);a.bindFramebuffer(q);
a.setColorMask(!0,!0,!0,!0);a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT)}unbind(){}setup({context:d},a,b){this._width=a;this._height=b;const f=a%4,g=b%4;a+=2>f?-f:4-f;b+=2>g?-g:4-g;this._adjustedWidth=a;this._adjustedHeight=b;this._boundFBO=d.getBoundFramebufferObject();a=Math.round(1*a);b=Math.round(1*b);this._hlRenderer.setup(d,a,b);this._hlSurfaces.setup(d,a,b)}draw(d){const {context:a,passOptions:b}=d;d=b.activeGradient;const f=a.getBoundFramebufferObject();a.setViewport(0,0,1*this._adjustedWidth,
1*this._adjustedHeight);a.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo);a.setStencilTestEnabled(!1);a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT);this._blitRenderer.render(a,f.colorTexture,m.TextureSamplingMode.NEAREST,1);a.setStencilTestEnabled(!1);a.setBlendingEnabled(!1);a.setColorMask(!1,!1,!1,!0);a.bindFramebuffer(this._hlSurfaces.sharedBlur2Fbo);a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT);this._hlRenderer.preBlur(a,this._hlSurfaces.sharedBlur1Tex);a.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo);
a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT);this._hlRenderer.finalBlur(a,this._hlSurfaces.sharedBlur2Tex);a.bindFramebuffer(this._boundFBO);a.setBlendingEnabled(!0);a.setColorMask(!0,!0,!0,!0);a.setViewport(0,0,this._width,this._height);this._hlRenderer.renderHighlight(a,this._hlSurfaces.sharedBlur1Tex,d);this._boundFBO=null}}return l})},"esri/views/2d/engine/webgl/effects/highlight/HighlightRenderer":function(){define("../../definitions ./parameters ../../shaders/HighlightPrograms ../../../../../webgl/BufferObject ../../../../../webgl/enums ../../../../../webgl/ProgramTemplate ../../../../../webgl/VertexArrayObject ../../../../../webgl/VertexElementDescriptor".split(" "),
function(k,r,p,e,n,m,l,d){class a{constructor(){this._height=this._width=void 0;this._resources=null}dispose(){this._resources&&(this._resources.quadGeometry.dispose(),this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),this._resources.blurProgram.dispose(),this._resources=null)}preBlur(b,f){b.bindTexture(f,k.textureBindingHighlight0);b.useProgram(this._resources.blurProgram);this._resources.blurProgram.setUniform4fv("u_direction",[1,0,1/this._width,0]);this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",
r.alphaToRgbaChannelSelectorMatrix);b.bindVAO(this._resources.quadVAO);b.drawArrays(n.PrimitiveType.TRIANGLE_STRIP,0,4);b.bindVAO()}finalBlur(b,f){b.bindTexture(f,k.textureBindingHighlight0);b.useProgram(this._resources.blurProgram);this._resources.blurProgram.setUniform4fv("u_direction",[0,1,0,1/this._height]);this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",r.rgbaToRgbaChannelSelectorMatrix);b.bindVAO(this._resources.quadVAO);b.drawArrays(n.PrimitiveType.TRIANGLE_STRIP,0,4);b.bindVAO()}renderHighlight(b,
f,g){b.bindTexture(f,k.textureBindingHighlight0);b.useProgram(this._resources.highlightProgram);g.applyHighlightOptions(b,this._resources.highlightProgram);b.bindVAO(this._resources.quadVAO);b.setBlendingEnabled(!0);b.setBlendFunction(n.BlendFactor.ONE,n.BlendFactor.ONE_MINUS_SRC_ALPHA);b.drawArrays(n.PrimitiveType.TRIANGLE_STRIP,0,4);b.bindVAO()}_initialize(b,f,g){this._width=f;this._height=g;f=e.BufferObject.createVertex(b,n.Usage.STATIC_DRAW,(new Int8Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1])).buffer);
g=new l.VertexArrayObject(b,new Map([["a_position",0],["a_texcoord",1]]),new Map([["geometry",[new d.VertexElementDescriptor("a_position",2,n.DataType.BYTE,0,4),new d.VertexElementDescriptor("a_texcoord",2,n.DataType.UNSIGNED_BYTE,2,4)]]]),new Map([["geometry",f]]));const q=m.createProgram(b,p.highlight),c=m.createProgram(b,p.blur);b.useProgram(q);q.setUniform1i("u_texture",k.textureBindingHighlight0);q.setUniform1i("u_shade",k.textureBindingHighlight1);q.setUniform1f("u_sigma",r.sigma);b.useProgram(c);
c.setUniform1i("u_texture",k.textureBindingHighlight0);c.setUniform1f("u_sigma",r.sigma);this._resources={quadGeometry:f,quadVAO:g,highlightProgram:q,blurProgram:c}}setup(b,f,g){this._resources?(this._width=f,this._height=g):this._initialize(b,f,g)}}return a})},"esri/views/2d/engine/webgl/shaders/HighlightPrograms":function(){define(["exports","./sources/resolver"],function(k,r){const p={shaders:{vertexShader:r.resolveIncludes("highlight/textured.vert"),fragmentShader:r.resolveIncludes("highlight/highlight.frag")},
attributes:new Map([["a_position",0],["a_texcoord",1]])};r={shaders:{vertexShader:r.resolveIncludes("highlight/textured.vert"),fragmentShader:r.resolveIncludes("highlight/blur.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])};k.blur=r;k.highlight=p;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/highlight/HighlightSurfaces":function(){define(["../../../../../webgl/enums","../../../../../webgl/FramebufferObject","../../../../../webgl/RenderbufferDescriptor",
"../../../../../webgl/TextureDescriptor"],function(k,r,p,e){function n(l,d,a){const b=new e.TextureDescriptor(d,a);b.wrapMode=k.TextureWrapMode.CLAMP_TO_EDGE;return new r.FramebufferObject(l,b,new p.RenderbufferDescriptor(k.RenderbufferFormat.STENCIL_INDEX8,d,a))}class m{constructor(){this._height=this._width=void 0;this._resources=null}dispose(){this._resources&&(this._resources.sharedBlur1Fbo.dispose(),this._resources.sharedBlur2Fbo.dispose(),this._resources=null)}_initialize(l,d,a){this._width=
d;this._height=a;const b=n(l,d,a);l=n(l,d,a);this._resources={sharedBlur1Fbo:b,sharedBlur2Fbo:l}}setup(l,d,a){!this._resources||this._width===d&&this._height===a||this.dispose();this._resources||this._initialize(l,d,a)}get sharedBlur1Tex(){return this._resources.sharedBlur1Fbo.colorTexture}get sharedBlur1Fbo(){return this._resources.sharedBlur1Fbo}get sharedBlur2Tex(){return this._resources.sharedBlur2Fbo.colorTexture}get sharedBlur2Fbo(){return this._resources.sharedBlur2Fbo}}return m})},"esri/views/2d/engine/webgl/effects/HittestEffect":function(){define(["exports",
"../../../../../core/has","../definitions","./Effect","../../../../webgl/enums"],function(k,r,p,e,n){class m extends e.Effect{constructor(){super(...arguments);this.name=this.constructor.name;this.defines=["hittest"]}dispose(){null!=this._fbo&&this._fbo.dispose()}createOptions({pixelRatio:l},d){if(!d.length)return null;var a=d.shift();d=a.x;const b=a.y;this._outstanding=a;a=r("esri-mobile");return{type:"hittest",distance:(a?p.hittestToleranceMobile:p.hittestToleranceDesktop)*l,smallSymbolDistance:(a?
p.hittestToleranceMobile:p.hittestToleranceSmallSymbol)*l,smallSymbolSizeThreshold:p.hittestSmallSymbolThreshold,position:[d,b]}}bind(l){const {context:d,attributeView:a}=l;a.size&&(l=a.getBlock(p.AttributeDataType.GPGPU),null!=l&&(l=l.getFBO(d),d.setViewport(0,0,a.size,a.size),d.bindFramebuffer(l),d.setColorMask(!0,!0,!0,!0),d.setClearColor(0,0,0,0),d.clear(d.gl.COLOR_BUFFER_BIT|d.gl.DEPTH_BUFFER_BIT)))}unbind(){}draw(l){if(null!=this._outstanding){var d=this._outstanding;this._outstanding=null;
this._resolve(l,d.resolvers)}}async _resolve(l,d){const {context:a,attributeView:b}=l;l=b.getBlock(p.AttributeDataType.GPGPU);if(null==l)d.forEach(q=>q.resolve([]));else{var f=l.getFBO(a);l=new Uint8Array(f.width*f.height*4);try{await f.readPixelsAsync(0,0,f.width,f.height,n.PixelFormat.RGBA,n.PixelType.UNSIGNED_BYTE,l)}catch(q){d.forEach(c=>c.resolve([]));return}var g=[];for(f=0;f<l.length;f+=4){const q=f/4;l[f]&&g.push(q)}d.forEach(q=>q.resolve(g))}}}k.HittestEffect=m;Object.defineProperty(k,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/EffectManager":function(){define("exports ./Bloom ./Blur ./Colorize ./DropShadow ./Opacity".split(" "),function(k,r,p,e,n,m){const l={colorize:()=>new e.Colorize,blur:()=>new p.Blur,bloom:()=>new r.Bloom,opacity:()=>new m.Opacity,"drop-shadow":()=>new n.DropShadow};class d{constructor(){this._effectMap=new Map}dispose(){this._effectMap.forEach(a=>a.dispose());this._effectMap.clear()}getPostProcessingEffects(a){if(!a||0===a.length)return[];
const b=[];for(const f of a){a:switch(a=f.type,a){case "bloom":case "blur":case "opacity":case "drop-shadow":break a;default:a="colorize"}let g=this._effectMap.get(a);g||(g=l[a](),this._effectMap.set(a,g));b.push({postProcessingEffect:g,effect:f})}return b}}k.EffectManager=d;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/Bloom":function(){define("exports ../../../../../../core/maybe ../../VertexStream ../../../../../webgl/enums ../../../../../webgl/FramebufferObject ../../../../../webgl/TextureDescriptor".split(" "),
function(k,r,p,e,n,m){const l=[1,0],d=[0,1],a=[1,.8,.6,.4,.2],b=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];class f{constructor(){this._compositeFBO=this._intensityFBO=null;this._mipsFBOs=Array(5);this._nMips=5;this._kernelSizeArray=[3,5,7,9,11];this._size=[0,0];this._programDesc={luminosityHighPass:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/luminosityHighPass",attributes:new Map([["a_position",0]])},gaussianBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/gaussianBlur",attributes:new Map([["a_position",
0]])},composite:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/composite",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}dispose(){this._quad=r.disposeMaybe(this._quad);this._intensityFBO=r.disposeMaybe(this._intensityFBO);this._compositeFBO=r.disposeMaybe(this._compositeFBO);if(this._mipsFBOs){for(let g=0;g<this._nMips;g++)this._mipsFBOs[g]&&(this._mipsFBOs[g].horizontal.dispose(),this._mipsFBOs[g].vertical.dispose());
this._mipsFBOs=null}}draw(g,q,c){const {width:h,height:u}=q,{context:A,painter:z}=g,{materialManager:t}=z;var w=A.gl;const x=this._programDesc,{strength:B,radius:C,threshold:y}=c;this._quad||(this._quad=new p(A,[-1,-1,1,-1,-1,1,1,1]));this._createOrResizeResources(g,h,u);A.setStencilTestEnabled(!1);A.setBlendingEnabled(!0);A.setBlendFunction(e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA);A.setStencilWriteMask(0);g=this._quad;g.bind();A.bindFramebuffer(this._intensityFBO);c=t.getProgram(x.luminosityHighPass);
A.useProgram(c);A.bindTexture(q.colorTexture,0);c.setUniform1i("u_texture",0);c.setUniform3fv("u_defaultColor",[0,0,0]);c.setUniform1f("u_defaultOpacity",0);c.setUniform1f("u_luminosityThreshold",y);c.setUniform1f("u_smoothWidth",.01);c=[Math.round(h/2),Math.round(u/2)];A.setViewport(0,0,c[0],c[1]);A.setClearColor(0,0,0,0);A.clear(w.COLOR_BUFFER_BIT);g.draw();A.setBlendingEnabled(!1);w=this._intensityFBO.colorTexture;for(let v=0;v<this._nMips;v++){const F=t.getProgram(x.gaussianBlur,[{name:"radius",
value:this._kernelSizeArray[v]}]);A.useProgram(F);A.bindTexture(w,v+1);F.setUniform1i("u_colorTexture",v+1);F.setUniform2fv("u_texSize",c);F.setUniform2fv("u_direction",l);A.setViewport(0,0,c[0],c[1]);const D=this._mipsFBOs[v];A.bindFramebuffer(D.horizontal);g.draw();w=D.horizontal.colorTexture;A.bindFramebuffer(D.vertical);A.bindTexture(w,v+1);F.setUniform2fv("u_direction",d);g.draw();w=D.vertical.colorTexture;c[0]=Math.round(c[0]/2);c[1]=Math.round(c[1]/2)}A.setViewport(0,0,h,u);c=t.getProgram(x.composite,
[{name:"nummips",value:5}]);A.bindFramebuffer(this._compositeFBO);A.useProgram(c);c.setUniform1f("u_bloomStrength",B);c.setUniform1f("u_bloomRadius",C);c.setUniform1fv("u_bloomFactors",a);c.setUniform3fv("u_bloomTintColors",b);A.bindTexture(this._mipsFBOs[0].vertical.colorTexture,1);c.setUniform1i("u_blurTexture1",1);A.bindTexture(this._mipsFBOs[1].vertical.colorTexture,2);c.setUniform1i("u_blurTexture2",2);A.bindTexture(this._mipsFBOs[2].vertical.colorTexture,3);c.setUniform1i("u_blurTexture3",3);
A.bindTexture(this._mipsFBOs[3].vertical.colorTexture,4);c.setUniform1i("u_blurTexture4",4);A.bindTexture(this._mipsFBOs[4].vertical.colorTexture,5);c.setUniform1i("u_blurTexture5",5);g.draw();A.bindFramebuffer(q);A.setBlendingEnabled(!0);q=t.getProgram(x.blit);A.useProgram(q);A.bindTexture(this._compositeFBO.colorTexture,6);q.setUniform1i("u_texture",6);A.setBlendFunction(e.BlendFactor.ONE,e.BlendFactor.ONE);g.draw();g.unbind();A.setBlendFunction(e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA);
A.setStencilTestEnabled(!0)}_createOrResizeResources(g,q,c){({context:g}=g);if(!this._compositeFBO||this._size[0]!==q||this._size[1]!==c){this._size[0]=q;this._size[1]=c;var h=[Math.round(q/2),Math.round(c/2)];this._compositeFBO?this._compositeFBO.resize(q,c):(q=new m.TextureDescriptor(q,c),q.internalFormat=e.PixelFormat.RGBA,q.wrapMode=e.TextureWrapMode.CLAMP_TO_EDGE,this._compositeFBO=new n.FramebufferObject(g,q));this._intensityFBO?this._intensityFBO.resize(h[0],h[1]):(q=new m.TextureDescriptor(h[0],
h[1]),q.internalFormat=e.PixelFormat.RGBA,q.wrapMode=e.TextureWrapMode.CLAMP_TO_EDGE,this._intensityFBO=new n.FramebufferObject(g,q));for(q=0;q<this._nMips;q++)this._mipsFBOs[q]?(this._mipsFBOs[q].horizontal.resize(h[0],h[1]),this._mipsFBOs[q].vertical.resize(h[0],h[1])):(c=new m.TextureDescriptor(h[0],h[1]),c.internalFormat=e.PixelFormat.RGBA,c.wrapMode=e.TextureWrapMode.CLAMP_TO_EDGE,this._mipsFBOs[q]={horizontal:new n.FramebufferObject(g,c),vertical:new n.FramebufferObject(g,c)}),h[0]=Math.round(h[0]/
2),h[1]=Math.round(h[1]/2)}}}k.Bloom=f;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/Blur":function(){define(["exports","../../VertexStream","../../../../../webgl/enums","../../../../../webgl/FramebufferObject","../../../../../webgl/TextureDescriptor"],function(k,r,p,e,n){const m=[1,0],l=[0,1];class d{constructor(){this._blurFBO=null;this._size=[0,0];this._programDesc={gaussianBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/gaussianBlur",
attributes:new Map([["a_position",0]])},radialBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/radial-blur",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}dispose(){this._blurFBO&&(this._blurFBO.dispose(),this._blurFBO=null)}draw(a,b,f){const {context:g}=a,{type:q,radius:c}=f;0!==c&&(this._createOrResizeResources(a),this._quad||(this._quad=new r(g,[-1,-1,1,-1,-1,1,1,1])),f=this._quad,f.bind(),
"blur"===q?this._gaussianBlur(a,b,c):this._radialBlur(a,b),f.unbind())}_gaussianBlur(a,b,f){const {context:g,state:q,painter:c,pixelRatio:h}=a;var {size:u}=q,{materialManager:A}=c;a=this._quad;u=[Math.round(h*u[0]),Math.round(h*u[1])];const z=this._blurFBO;A=A.getProgram(this._programDesc.gaussianBlur,[{name:"radius",value:Math.ceil(f)}]);g.useProgram(A);g.setBlendingEnabled(!1);g.bindFramebuffer(z);g.bindTexture(b.colorTexture,4);A.setUniform1i("u_colorTexture",4);A.setUniform2fv("u_texSize",u);
A.setUniform2fv("u_direction",m);A.setUniform1f("u_sigma",f);a.draw();g.bindFramebuffer(b);g.setStencilWriteMask(0);g.setStencilTestEnabled(!1);g.setDepthWriteEnabled(!1);g.setDepthTestEnabled(!1);g.bindTexture(z?.colorTexture,5);A.setUniform1i("u_colorTexture",5);A.setUniform2fv("u_direction",l);a.draw();g.setBlendingEnabled(!0);g.setBlendFunction(p.BlendFactor.ONE,p.BlendFactor.ONE_MINUS_SRC_ALPHA);g.setStencilTestEnabled(!0)}_radialBlur(a,b){const {context:f,painter:g}=a,{materialManager:q}=g,
c=this._programDesc;a=this._quad;const h=this._blurFBO;f.bindFramebuffer(h);const u=q.getProgram(c.radialBlur);f.useProgram(u);f.setBlendingEnabled(!1);f.bindTexture(b.colorTexture,4);u.setUniform1i("u_colorTexture",4);a.draw();f.bindFramebuffer(b);f.setStencilWriteMask(0);f.setStencilTestEnabled(!1);f.setDepthWriteEnabled(!1);f.setDepthTestEnabled(!1);f.setBlendingEnabled(!0);b=q.getProgram(c.blit);f.useProgram(b);f.bindTexture(h?.colorTexture,5);b.setUniform1i("u_texture",5);f.setBlendFunction(p.BlendFactor.ONE,
p.BlendFactor.ONE_MINUS_SRC_ALPHA);a.draw()}_createOrResizeResources(a){const {context:b,state:f,pixelRatio:g}=a;var {size:q}=f;a=Math.round(g*q[0]);q=Math.round(g*q[1]);this._blurFBO&&this._size[0]===a&&this._size[1]===q||(this._size[0]=a,this._size[1]=q,this._blurFBO?this._blurFBO.resize(a,q):(a=new n.TextureDescriptor(a,q),a.internalFormat=p.PixelFormat.RGBA,a.wrapMode=p.TextureWrapMode.CLAMP_TO_EDGE,this._blurFBO=new e.FramebufferObject(b,a)))}}k.Blur=d;Object.defineProperty(k,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/Colorize":function(){define("exports ../../../../../../core/maybe ../../VertexStream ../../../../../webgl/enums ../../../../../webgl/Texture ../../../../../webgl/TextureDescriptor".split(" "),function(k,r,p,e,n,m){class l{constructor(){this._layerFBOTexture=null;this._size=[0,0];this._programDesc={vsPath:"post-processing/pp",fsPath:"post-processing/filterEffect",attributes:new Map([["a_position",0]])}}dispose(){this._layerFBOTexture=
r.disposeMaybe(this._layerFBOTexture)}draw(d,a,b){const {width:f,height:g}=a;this._createOrResizeResources(d,f,g);const {context:q,painter:c}=d,{materialManager:h}=c,u=this._programDesc;d=this._quad;b=b.colorMatrix;d.bind();const A=this._layerFBOTexture;q.bindFramebuffer(a);a.copyToTexture(0,0,f,g,0,0,A);q.setBlendingEnabled(!1);q.setStencilTestEnabled(!1);a=h.getProgram(u);q.useProgram(a);q.bindTexture(A,2);a.setUniformMatrix4fv("u_coefficients",b);a.setUniform1i("u_colorTexture",2);d.draw();q.setBlendingEnabled(!0);
q.setBlendFunction(e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA);q.setStencilTestEnabled(!0);d.unbind()}_createOrResizeResources(d,a,b){({context:d}=d);if(!this._layerFBOTexture||this._size[0]!==a||this._size[1]!==b){this._size[0]=a;this._size[1]=b;if(this._layerFBOTexture)this._layerFBOTexture.resize(a,b);else{const f=new m.TextureDescriptor;f.internalFormat=e.PixelFormat.RGBA;f.wrapMode=e.TextureWrapMode.CLAMP_TO_EDGE;f.width=a;f.height=b;this._layerFBOTexture=new n.Texture(d,f)}this._quad||
(this._quad=new p(d,[-1,-1,1,-1,-1,1,1,1]))}}}k.Colorize=l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/DropShadow":function(){define("exports ../../../../../../core/maybe ../../../../../../core/screenUtils ../../VertexStream ../../../../../webgl/enums ../../../../../webgl/FramebufferObject ../../../../../webgl/Texture ../../../../../webgl/TextureDescriptor".split(" "),function(k,r,p,e,n,m,l,d){const a=[1,0],b=[0,1];class f{constructor(){this._verticalBlurFBO=
this._horizontalBlurFBO=this._layerFBOTexture=null;this._size=[0,0];this._quad=null;this._programDesc={blur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/gaussianBlur",attributes:new Map([["a_position",0]])},composite:{vsPath:"post-processing/pp",fsPath:"post-processing/drop-shadow/composite",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}dispose(){this._layerFBOTexture=r.disposeMaybe(this._layerFBOTexture);
this._horizontalBlurFBO=r.disposeMaybe(this._horizontalBlurFBO);this._verticalBlurFBO=r.disposeMaybe(this._verticalBlurFBO)}draw(g,q,c){const {context:h,state:u,painter:A}=g,{materialManager:z}=A,t=this._programDesc,w=q.width,x=q.height,B=[Math.round(w),Math.round(x)],{blurRadius:C,offsetX:y,offsetY:v,color:F}=c;c=[p.pt2px(y),p.pt2px(v)];this._createOrResizeResources(g,w,x,B);const D=this._horizontalBlurFBO;g=this._verticalBlurFBO;h.setStencilWriteMask(0);h.setStencilTestEnabled(!1);h.setDepthWriteEnabled(!1);
h.setDepthTestEnabled(!1);const G=this._layerFBOTexture;q.copyToTexture(0,0,w,x,0,0,G);this._quad||(this._quad=new e(h,[-1,-1,1,-1,-1,1,1,1]));h.setViewport(0,0,B[0],B[1]);const E=this._quad;E.bind();h.setBlendingEnabled(!1);const H=z.getProgram(t.blur,[{name:"radius",value:Math.ceil(C)}]);h.useProgram(H);h.bindFramebuffer(D);h.bindTexture(q.colorTexture,4);H.setUniform1i("u_colorTexture",4);H.setUniform2fv("u_texSize",B);H.setUniform2fv("u_direction",a);H.setUniform1f("u_sigma",C);E.draw();h.bindFramebuffer(g);
h.bindTexture(D?.colorTexture,5);H.setUniform1i("u_colorTexture",5);H.setUniform2fv("u_direction",b);E.draw();h.bindFramebuffer(q);h.setViewport(0,0,w,x);q=z.getProgram(t.composite);h.useProgram(q);h.bindTexture(g?.colorTexture,2);q.setUniform1i("u_blurTexture",2);h.bindTexture(G,3);q.setUniform1i("u_layerFBOTexture",3);q.setUniform4fv("u_shadowColor",[F[0]/255*F[3],F[1]/255*F[3],F[2]/255*F[3],F[3]]);q.setUniformMatrix3fv("u_displayViewMat3",u.displayMat3);q.setUniform2fv("u_shadowOffset",c);E.draw();
h.setBlendingEnabled(!0);h.setStencilTestEnabled(!0);h.setBlendFunction(n.BlendFactor.ONE,n.BlendFactor.ONE_MINUS_SRC_ALPHA);E.unbind()}_createOrResizeResources(g,q,c,h){({context:g}=g);if(!this._horizontalBlurFBO||this._size[0]!==q||this._size[1]!==c){this._size[0]=q;this._size[1]=c;if(this._horizontalBlurFBO)this._horizontalBlurFBO.resize(h[0],h[1]);else{const u=new d.TextureDescriptor(h[0],h[1]);u.internalFormat=n.PixelFormat.RGBA;u.wrapMode=n.TextureWrapMode.CLAMP_TO_EDGE;this._horizontalBlurFBO=
new m.FramebufferObject(g,u)}this._verticalBlurFBO?this._verticalBlurFBO.resize(h[0],h[1]):(h=new d.TextureDescriptor(h[0],h[1]),h.internalFormat=n.PixelFormat.RGBA,h.wrapMode=n.TextureWrapMode.CLAMP_TO_EDGE,this._verticalBlurFBO=new m.FramebufferObject(g,h));this._layerFBOTexture?this._layerFBOTexture.resize(q,c):(h=new d.TextureDescriptor,h.internalFormat=n.PixelFormat.RGBA,h.wrapMode=n.TextureWrapMode.CLAMP_TO_EDGE,h.width=q,h.height=c,this._layerFBOTexture=new l.Texture(g,h))}}}k.DropShadow=f;
Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/Opacity":function(){define(["exports","../../../../../../core/maybe","../../../../../webgl/enums","../../../../../webgl/Texture","../../../../../webgl/TextureDescriptor"],function(k,r,p,e,n){class m{constructor(){this._size=[0,0];this._layerFBOTexture=null}dispose(){this._layerFBOTexture=r.disposeMaybe(this._layerFBOTexture)}draw(l,d,a){const {width:b,height:f}=d;this._createOrResizeResources(l,
b,f);const {context:g,painter:q}=l;({amount:l}=a);a=g.gl;const c=this._layerFBOTexture;g.bindFramebuffer(d);d.copyToTexture(0,0,b,f,0,0,c);g.setBlendingEnabled(!0);g.setStencilTestEnabled(!1);g.setDepthTestEnabled(!1);g.setClearColor(0,0,0,0);g.clear(a.COLOR_BUFFER_BIT);q.blitTexture(g,c,p.TextureSamplingMode.NEAREST,l)}_createOrResizeResources(l,d,a){({context:l}=l);if(!this._layerFBOTexture||this._size[0]!==d||this._size[1]!==a)if(this._size[0]=d,this._size[1]=a,this._layerFBOTexture)this._layerFBOTexture.resize(d,
a);else{const b=new n.TextureDescriptor;b.internalFormat=p.PixelFormat.RGBA;b.wrapMode=p.TextureWrapMode.CLAMP_TO_EDGE;b.samplingMode=p.TextureSamplingMode.NEAREST;b.width=d;b.height=a;this._layerFBOTexture=new e.Texture(l,b)}}}k.Opacity=m;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/meshing/SimpleMesh":function(){define(["exports","./definitions","./Mesh","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(k,r,p,e,n){const m=
{position:{type:e.DataType.SHORT,count:2}};class l extends p.Mesh{static create(d,a){var b=[];let {stride:f}=a;if(null==f){f=0;for(const [,{count:c,type:h,offset:u}]of Object.entries(a.layout)){if(null!=u)throw Error("Stride cannot be computed automatically when attribute offsets are supplied explicitly.");f+=c*r.dataSizeInBytes[h]}}var g=0;for(const [c,{count:h,offset:u,type:A,normalized:z}]of Object.entries(a.layout)){null!=u&&(g=u);var q=new n.VertexElementDescriptor(c,h,A,g,f,null!=z?z:!1,0);
b.push(q);g+=h*r.dataSizeInBytes[A]}g={primitive:a.primitive};null!=a.index&&(g.index="indexData");({count:q}=a);if(null==q&&(q=a.index?a.index.length:a.vertex.byteLength/f,Math.floor(q)!==q))throw Error(`The byte length of vertex data must be an exact multiple of the stride, which is ${f}.`);b={vertex:{vertexData:{data:a.vertex,attributes:b}},parts:[{start:0,count:q,group:0,primitive:a.primitive}],groups:[g]};null!=a.index&&(b.index={indexData:{data:a.index}});return new l(d,b,a.layout)}static fromVertexStream(d,
a){return l.create(d,{primitive:e.PrimitiveType.TRIANGLE_STRIP,vertex:new Uint16Array(a),layout:m})}constructor(d,a,b){super(d,a);this._spec=b}bind(d,a,b=0){super.bind(d,a,b)}}k.SimpleMesh=l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/meshing/definitions":function(){define(["exports","../../../../webgl/enums"],function(k,r){k.dataSizeInBytes={[r.DataType.BYTE]:1,[r.DataType.UNSIGNED_BYTE]:1,[r.DataType.SHORT]:2,[r.DataType.UNSIGNED_SHORT]:2,[r.DataType.HALF_FLOAT]:2,
[r.DataType.INT]:4,[r.DataType.UNSIGNED_INT]:4,[r.DataType.FLOAT]:4};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/meshing/Mesh":function(){define("exports ../../../../webgl/BufferObject ../../../../webgl/FramebufferObject ../../../../../core/has ../../../../webgl/checkWebGLError ../../../../webgl/enums ../../../../webgl/GLObjectType ../../../../webgl/Texture ../../../../webgl/VertexArrayObject ./definitions".split(" "),function(k,r,p,e,n,m,l,d,a,b){class f{constructor(g,
q){this._boundPart=null;this.vertexBuffers=new Map;this.indexBuffers=new Map;this.groups=[];for(var c in q.vertex){const {data:h,attributes:u}=q.vertex[c],A=r.BufferObject.createVertex(g,m.Usage.STATIC_DRAW,h);this.vertexBuffers.set(c,{buffer:A,attributes:u})}for(const h in q.index)({data:c}=q.index[h]),c=r.BufferObject.createIndex(g,m.Usage.STATIC_DRAW,c),this.indexBuffers.set(h,{buffer:c});for(const h of q.groups)this.groups.push({...h,vertexArrays:new Map});this.parts=q.parts}bind(g,q,c){this._boundPart=
c;var {group:h}=this.parts[this._boundPart];c=this.groups[h];if(!c)throw Error(`Missing group ${h}.`);h=c.vertexArrays.get(q.stringHash);if(!h){const u=new Set(q.locations.keys());h=c.index?this.indexBuffers.get(c.index)?.buffer:null;const A=new Map,z=new Map;for(const [t,{buffer:w,attributes:x}]of this.vertexBuffers){const B=x.filter(C=>u.has(C.name));0<B.length&&(A.set(t,B),z.set(t,w))}h=new a.VertexArrayObject(g,q.locations,A,z,h);c.vertexArrays.set(q.stringHash,h)}g.bindVAO(h)}draw(g){if(null==
this._boundPart)throw Error("Mesh.bind() has not been called.");const {start:q,count:c}=this.parts[this._boundPart];var {group:h}=this.parts[this._boundPart];const {primitive:u,index:A}=this.groups[h];if(A){h=this.indexBuffers.get(A);if(!h)throw Error(`Missing index buffer "${A}".`);({indexType:h}=h.buffer);if(!h)throw Error("Buffer type error.");g.drawElements(u,c,h,q*b.dataSizeInBytes[h])}else g.drawArrays(u,q,c)}unbind(g){this._boundPart=null;g.bindVAO(null)}destroy(){for(const {vertexArrays:g}of this.groups)for(const [,
q]of g)q.disposeVAOOnly();for(const {buffer:g}of this.vertexBuffers.values())g.dispose();for(const {buffer:g}of this.indexBuffers.values())g.dispose()}}k.Mesh=f;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/painter/RenderPass":function(){define(["../../../../../core/arrayUtils","../enums"],function(k,r){class p{constructor(e,n){this.brushes=e;this.name=n.name;this.drawPhase=n.drawPhase||r.WGLDrawPhase.MAP;this._targetFn=n.target;this.effects=n.effects||
[];this.enableDefaultDraw=n.enableDefaultDraw??(()=>!0);this.forceDrawByDisplayOrder=!!n.forceDrawByDisplayOrder}render(e){const {context:n,profiler:m}=e,l=this._targetFn();var d=this.drawPhase&e.drawPhase;m.recordPassStart(this.name);if(d){this.enableDefaultDraw()&&this._doRender(e,l);m.recordPassEnd();for(const a of this.effects){if(!a.enable())continue;d=a.apply;const b=a.args?.(),f=n.getViewport(),g=n.getBoundFramebufferObject(),q=e.passOptions;this._bindEffect(e,d,b);this._doRender(e,l,d.defines);
this._drawAndUnbindEffect(e,d,f,g,q,b)}}}_doRender(e,n,m){if(null!=n){var {profiler:l,context:d}=e;for(const a of this.brushes){l.recordBrushStart(a.name);if(null!=a.brushEffect){const b=d.getViewport(),f=d.getBoundFramebufferObject(),g=e.passOptions;this._bindEffect(e,a.brushEffect);this._drawWithBrush(a,e,n,m);this._drawAndUnbindEffect(e,a.brushEffect,b,f,g)}else this._drawWithBrush(a,e,n,m);l.recordBrushEnd()}}}_drawWithBrush(e,n,m,l){k.isArrayLike(m)?(e.prepareState(n,l),e.drawMany(n,m,l)):m.visible&&
(e.prepareState(n,l),e.draw(n,m,l))}_bindEffect(e,n,m){const {profiler:l}=e;l.recordPassStart(this.name+"."+n.name);n.bind(e,m);n=n.createOptions(e,m);e.passOptions=n}_drawAndUnbindEffect(e,n,m,l,d,a){const {profiler:b,context:f}=e;e.passOptions=d;b.recordBrushStart(n.name);n.draw(e,a);n.unbind(e,a);f.bindFramebuffer(l);const {x:g,y:q,width:c,height:h}=m;f.setViewport(g,q,c,h);b.recordBrushEnd();b.recordPassEnd()}}return p})},"esri/views/2d/engine/webgl/shaderGraph/techniques/TechniqueProgramCache":function(){define(["exports"],
function(k){class r{constructor(){this._programCache=new Map}destroy(){for(const p of this._programCache.values())p.destroy();this._programCache.clear()}getProgram(p,e,n,m,l){const d=p.getShaderKey(e,n,m,l);let a=this._programCache.get(d);a||(a=p.getProgram(e,n,m,l),this._programCache.set(d,a));return a}}k.TechniqueProgramCache=r;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/Profiler":function(){define(["exports","../../../../core/CircularArray","../../../../core/Evented",
"../../../../core/has","../../../webgl/capabilities/DisjointTimerQuery"],function(k,r,p,e,n){const m=!!e("esri-2d-profiler");class l{constructor(d,a){this._events=new p;this._entries=new Map;this._timings=new r(10);this._currentSummary=this._currentBrush=this._currentPass=this._currentContainer=null;if(m){this._ext=n.createDisjointTimerQuery(d.gl,{});this._debugOutput=a;var b=d.gl;if(this.enableCommandLogging)for(var f in b)if("function"===typeof b[f]){const g=b[f],q=f.includes("draw");b[f]=(...c)=>
{this._events.emit("command",{container:this._currentContainer,pass:this._currentPass,brush:this._currentBrush,method:f,args:c,isDrawCommand:q});this._currentSummary&&(this._currentSummary.commands++,q&&this._currentSummary.drawCommands++);return g.apply(b,c)}}}}get enableCommandLogging(){return!("object"===typeof m&&m.disableCommands)}recordContainerStart(d){m&&(this._currentContainer=d)}recordContainerEnd(){m&&(this._currentContainer=null)}recordPassStart(d){m&&(this._currentPass=d,this._initSummary())}recordPassEnd(){m&&
(this._currentPass=null,this._emitSummary())}recordBrushStart(d){m&&(this._currentBrush=d)}recordBrushEnd(){m&&(this._currentBrush=null)}recordStart(d){if(m&&null!=this._ext){if(this._entries.has(d)){const q=this._entries.get(d);var a=this._ext.resultAvailable(q.query),b=this._ext.disjoint();if(a&&!b){a=this._ext.getResult(q.query)/1E6;b=0;if(null!=this._timings.enqueue(a)){b=this._timings.entries;const c=b.length;let h=0;for(var f of b)h+=f;b=h/c}f=a.toFixed(2);a=b?b.toFixed(2):"--";this.enableCommandLogging?
(console.groupCollapsed(`Frame report for ${d}, ${f} ms (${a} last 10 avg)\n${q.commandsLen} Commands (${q.drawCommands} draw)`),console.log("RenderPass breakdown: "),console.table(q.summaries),console.log("Commands: ",q.commands),console.groupEnd()):console.log(`Frame report for ${d}, ${f} ms (${a} last 10 avg)`);this._debugOutput.innerHTML=`${f} (${a})`}for(const c of q.handles)c.remove();this._ext.deleteQuery(q.query);this._entries.delete(d)}const g={name:d,query:this._ext.createQuery(),commands:[],
commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(g.handles.push(this._events.on("command",q=>{g.commandsLen++;g.commands.push(q);q.isDrawCommand&&g.drawCommands++})),g.handles.push(this._events.on("summary",q=>{g.summaries.push(q)})));this._ext.beginTimeElapsed(g.query);this._entries.set(d,g)}}recordEnd(d){m&&null!=this._ext&&this._entries.has(d)&&this._ext.endTimeElapsed()}_initSummary(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,
pass:this._currentPass,drawCommands:0,commands:0})}_emitSummary(){this.enableCommandLogging&&this._currentSummary&&this._events.emit("summary",this._currentSummary)}}k.Profiler=l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/core/CircularArray":function(){define(function(){class k{constructor(r){this._start=this.size=0;this.maxSize=r;this._buffer=Array(r)}get entries(){return this._buffer}enqueue(r){if(this.size===this.maxSize){const p=this._buffer[this._start];this._buffer[this._start]=
r;this._start=(this._start+1)%this.maxSize;return p}this._buffer[(this._start+this.size++)%this.maxSize]=r;return null}dequeue(){if(0===this.size)return null;const r=this._buffer[this._start];this._buffer[this._start]=null;this.size--;this._start=(this._start+1)%this.maxSize;return r}peek(){return 0===this.size?null:this._buffer[this._start]}peekLast(){return 0===this.size?null:this._buffer[(this._start+(this.size-1))%this.maxSize]}find(r){if(0===this.size)return null;for(const p of this._buffer)if(null!=
p&&r(p))return p;return null}clear(r){let p=this.dequeue();for(;null!=p;)r&&r(p),p=this.dequeue()}}return k})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["exports"],function(k){class r{constructor(p,e,n,m,l,d,a,b,f){this.createQuery=p;this.deleteQuery=e;this.resultAvailable=n;this.getResult=m;this.disjoint=l;this.beginTimeElapsed=d;this.endTimeElapsed=a;this.createTimestamp=b;this.timestampBits=f}}k.hasRunningElapsedTimer=!1;k.DisjointTimerQuery=r;k.createDisjointTimerQuery=
function(p,e){if(e.disjointTimerQuery)return null;let n=p.getExtension("EXT_disjoint_timer_query_webgl2");return n?new r(()=>p.createQuery(),m=>{p.deleteQuery(m);k.hasRunningElapsedTimer=!1},m=>p.getQueryParameter(m,p.QUERY_RESULT_AVAILABLE),m=>p.getQueryParameter(m,p.QUERY_RESULT),()=>p.getParameter(n.GPU_DISJOINT_EXT),m=>{k.hasRunningElapsedTimer||(k.hasRunningElapsedTimer=!0,p.beginQuery(n.TIME_ELAPSED_EXT,m))},()=>{p.endQuery(n.TIME_ELAPSED_EXT);k.hasRunningElapsedTimer=!1},m=>n.queryCounterEXT(m,
n.TIMESTAMP_EXT),()=>p.getQuery(n.TIMESTAMP_EXT,n.QUERY_COUNTER_BITS_EXT)):(n=p.getExtension("EXT_disjoint_timer_query"))?new r(()=>n.createQueryEXT(),m=>{n.deleteQueryEXT(m);k.hasRunningElapsedTimer=!1},m=>n.getQueryObjectEXT(m,n.QUERY_RESULT_AVAILABLE_EXT),m=>n.getQueryObjectEXT(m,n.QUERY_RESULT_EXT),()=>p.getParameter(n.GPU_DISJOINT_EXT),m=>{k.hasRunningElapsedTimer||(k.hasRunningElapsedTimer=!0,n.beginQueryEXT(n.TIME_ELAPSED_EXT,m))},()=>{n.endQueryEXT(n.TIME_ELAPSED_EXT);k.hasRunningElapsedTimer=
!1},m=>n.queryCounterEXT(m,n.TIMESTAMP_EXT),()=>n.getQueryEXT(n.TIMESTAMP_EXT,n.QUERY_COUNTER_BITS_EXT)):null};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TileReshuffleManager":function(){define(["exports"],function(k){class r{constructor(){this._candidateTiles=[]}schedule(p){this._candidateTiles.includes(p)||this._candidateTiles.push(p)}reshuffle(p){const e=[];for(const n of this._candidateTiles)0<p?(n.reshuffle(),p--):e.push(n);this._candidateTiles=
e}}k.TileReshuffleManager=r;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/TechniqueRegistry":function(){define("exports ./animated/AnimatedMarkerTechnique ./dotDensity/DotDensityTechnique ./fill/ComplexFillTechnique ./fill/ComplexOutlineFillTechnique ./fill/FillTechnique ./fill/GradientFillTechnique ./fill/OutlineFillTechnique ./fill/PatternFillTechnique ./fill/PatternOutlineFillTechnique ./heatmap/HeatmapTechnique ./labels/LabelTechnique ./line/GradientStrokeTechnique ./line/LineTechnique ./line/TexturedLineTechnique ./markers/MarkerTechnique ./pieChart/PieChartTechnique ./text/TextTechnique".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g,q,c,h,u,A,z){const t={fill:new m.FillTechnique,patternFill:new a.PatternFillTechnique,complexFill:new e.ComplexFillTechnique,gradientFill:new l.GradientFillTechnique,outlineFill:new d.OutlineFillTechnique,patternOutlineFill:new b.PatternOutlineFillTechnique,complexOutlineFill:new n.ComplexOutlineFillTechnique,marker:new u.MarkerTechnique,pieChart:new A.PieChartTechnique,line:new c.LineTechnique,texturedLine:new h.TexturedLineTechnique,gradientStroke:new q.GradientStrokeTechnique,
text:new z.TextTechnique,label:new g.LabelTechnique,heatmap:new f.HeatmapTechnique,dotDensity:new p.DotDensityTechnique,animatedMarker:new r.AnimatedMarkerTechnique};k.Techniques=t;k.shutdown=function(w){for(const x in t)t[x].shutdown(w)};k.startup=function(){for(const w in t)t[w].startup()};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/AnimatedMarkerTechnique":function(){define(["exports","../../../enums","../TechniqueType",
"./AnimatedMarkerShader","./AnimatedTechnique"],function(k,r,p,e,n){class m extends n.AnimatedTechnique{constructor(){super(...arguments);this.type=p.TechniqueType.AnimatedMarker;this.symbologyPlane=r.FeatureSymbologyDrawOrder.MARKER;this.shaders={geometry:new e.AnimatedMarkerShader}}}k.AnimatedMarkerTechnique=m;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/AnimatedMarkerShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../../../../../../symbols/cim/animationDebugFlags ../../GraphShaderModule ../../graph/glsl ./AnimatedShader ./enums ../markers/markerConstants ../shaders/constants ../shaders/hittestUtils ../shaders/utils ../shaders/vvUtils".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g){function q(z,t,w,x){return t.multiply(z.x).add(w.multiply(z.y)).add(x.multiply(z.z))}class c extends m.AAnimatedVertexInput{}r.__decorate([e.location(5,n.Vec2)],c.prototype,"offset",void 0);r.__decorate([e.location(6,n.Vec2)],c.prototype,"uv",void 0);r.__decorate([e.location(7,n.Vec4)],c.prototype,"sizing",void 0);r.__decorate([e.location(8,n.Float)],c.prototype,"angle",void 0);class h extends e.ComputeVertexInput{}r.__decorate([e.location(12,n.Vec2)],h.prototype,
"offsetNextVertex1",void 0);r.__decorate([e.location(13,n.Vec2)],h.prototype,"offsetNextVertex2",void 0);r.__decorate([e.location(14,n.Vec2)],h.prototype,"textureUVNextVertex1",void 0);r.__decorate([e.location(15,n.Vec2)],h.prototype,"textureUVNextVertex2",void 0);class u extends m.AAnimatedFragmentInput{}class A extends m.AAnimatedShader{constructor(){super(...arguments);this.type="AnimatedMarkerShader";this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],uv:["textureUVNextVertex1",
"textureUVNextVertex2"]}}_vertexPreamble(z){const {id:t,pos:w,offset:x,animationPointerAndBaseSizeAndReferenceSize:B,uv:C,sizing:y,angle:v}=z,F=B.xy,D=B.z;var G=B.w,E=y.xy;const H=y.z,K=f.getBit(z.bitset,d.MarkerConstants.bitset.isStroke),J=y.w,L=f.getBit(z.bitset,d.MarkerConstants.bitset.scaleSymbolsProportionally);E=this._getEvalParams(z,E);var P=m.getValue(F,l.AnimationParamIndex.transform,E),Q=n.cond([n.equal(f.getBit(z.bitset,d.MarkerConstants.bitset.isMapAligned),new n.Float(1)),this.view.rotation.divide(180).multiply(Math.PI)],
[!0,new n.Float(0)]);const S=(new n.Mat2(n.cos(Q),n.sin(Q.multiply(-1)),n.sin(Q),n.cos(Q))).multiply(P.xy);Q=P.z.subtract(Q).subtract(v.multiply(a.c256ToRad));P=P.w;z=f.getBit(z.bitset,d.MarkerConstants.bitset.isSDF);const U=g.getVisualVariableSize(this,t,new n.Float(G)).divide(new n.Float(G));G=this._getScreenPosition({id:t,pos:w,offset:x,referenceSize:G,translation:S,rotation:Q,scale:P,vvScale:U});return{baseSize:D,animationPointer:F,strokeWidth:H,isOutline:K,unscaledDistanceToPx:J,scaleSymbolsProportionally:L,
isSDF:z,position:G,uv:C,evalParams:E,vvScale:U,scale:P}}vertex(z,t){const {position:w,animationPointer:x,evalParams:B,isOutline:C,unscaledDistanceToPx:y,vvScale:v,uv:F,strokeWidth:D,scaleSymbolsProportionally:G,scale:E,isSDF:H,baseSize:K}=this._vertexPreamble(z),J=this._toNdc(w);var L=m.getValue(x,l.AnimationParamIndex.fromColor,B);L=new n.Vec4(L.rgb.multiply(L.a),L.a);var P=m.getValue(x,l.AnimationParamIndex.toColor,B);P=new n.Vec4(P.rgb.multiply(P.a),P.a);var Q=m.getValue(x,l.AnimationParamIndex.colorMix,
B);Q=new n.Vec4(Q.rgb.multiply(Q.a),Q.a);var S=m.getValue(x,l.AnimationParamIndex.toOpacity,B).a,U=m.getValue(x,l.AnimationParamIndex.opacityMix,B).a;L=g.getVisualVariableColor(this,z.id,L,n.or(f.getBitBool(z.bitset,d.MarkerConstants.bitset.colorLocked),new n.Bool(C)));P=n.mix(L,P,Q);Q=g.getVisualVariableOpacity(this,z.id);S=n.mix(Q,S,U);S=P.multiply(S);U=this.clip(z.id,z.zoomRange);P=y.multiply(v);return{glPosition:new n.Vec4(J,U,1),uv:F.divide(this.mosaicInfo.size),color:S.multiply((new n.Float(1)).subtract(C)),
outlineColor:S.multiply(C),distanceToPx:P,strokeWidth:D.multiply(n.mix(new n.Float(1),E,G)),isOutline:C,isSDF:H,...this.maybeRunHittest(z,t,{pos:z.pos,size:K,sizeCorrection:new n.Float(1),isMapAligned:new n.Float(1),vvRotationMat3:new n.Mat3(1,0,0,0,1,0,0,0,1),placementMat3:new n.Mat3(1,0,0,0,1,0,0,0,1),outlineSize:new n.Float(1),distanceToPx:P,isSDF:H})}}fragment(z){let t=this._getColor(z.uv,{color:z.color,distanceToPx:z.distanceToPx,isSDF:z.isSDF,outlineColor:z.outlineColor,outlineSize:z.strokeWidth});
p.animationDebugFlags.spotlightAnimatedSymbols&&(t=t.add(new n.Vec4(0,.3,0,.3)));return this.getFragmentOutput(t,z)}hittest(z,t,w){return n.ifElse(n.lessThan(w.size,this.hittestRequest.smallSymbolSizeThreshold),this._hittestSmallMarker(z,t,w),this._hittestMarker(z,t,w))}_hittestSmallMarker(z,t,w){const {position:x,distance:B,smallSymbolDistance:C}=this.hittestRequest;z=B.subtract(C);const {viewMat3:y,tileMat3:v}=this.view;t=y.multiply(v).multiply(new n.Vec3(w.pos,1)).xy;w=w.size.multiply(.5);return n.distance(t,
x).subtract(w).add(z)}_hittestMarker(z,t,w){const x=this._vertexPreamble({...z}).position,B=this._vertexPreamble({...z,offset:t.offsetNextVertex1,uv:t.textureUVNextVertex1}).position,C=this._vertexPreamble({...z,offset:t.offsetNextVertex2,uv:t.textureUVNextVertex2}).position,y=this.hittestRequest.distance,v=b.distPointTriangle(this.hittestRequest.position,x,B,C);return n.ifElse(n.greaterThan(v,y),v,this._hittestSamples(x,B,C,z,t,w))}_hittestSamples(z,t,w,x,B,C){const {outlineSize:y,isSDF:v,distanceToPx:F}=
C;var D=this.hittestRequest.position;const G=this.hittestRequest.distance;C=b.xyToBarycentric(D.add(new n.Vec2(n.negate(G),n.negate(G))),z,t,w);const E=b.xyToBarycentric(D.add(new n.Vec2(0,n.negate(G))),z,t,w),H=b.xyToBarycentric(D.add(new n.Vec2(G,n.negate(G))),z,t,w),K=b.xyToBarycentric(D.add(new n.Vec2(n.negate(G),0)),z,t,w),J=b.xyToBarycentric(D,z,t,w),L=b.xyToBarycentric(D.add(new n.Vec2(G,0)),z,t,w),P=b.xyToBarycentric(D.add(new n.Vec2(n.negate(G),G)),z,t,w),Q=b.xyToBarycentric(D.add(new n.Vec2(0,
G)),z,t,w);z=b.xyToBarycentric(D.add(new n.Vec2(G,G)),z,t,w);x=x.uv.divide(this.mosaicInfo.size);t=B.textureUVNextVertex1.divide(this.mosaicInfo.size);B=B.textureUVNextVertex2.divide(this.mosaicInfo.size);w={color:new n.Vec4(1,1,1,1),outlineSize:y,outlineColor:new n.Vec4(1,1,1,1),isSDF:v,distanceToPx:F};D=new n.Float(0);D=D.add(b.inTriangle(C).multiply(this._getColor(q(C,x,t,B),w).a));D=D.add(b.inTriangle(E).multiply(this._getColor(q(E,x,t,B),w).a));D=D.add(b.inTriangle(H).multiply(this._getColor(q(H,
x,t,B),w).a));D=D.add(b.inTriangle(K).multiply(this._getColor(q(K,x,t,B),w).a));D=D.add(b.inTriangle(J).multiply(this._getColor(q(J,x,t,B),w).a));D=D.add(b.inTriangle(L).multiply(this._getColor(q(L,x,t,B),w).a));D=D.add(b.inTriangle(P).multiply(this._getColor(q(P,x,t,B),w).a));D=D.add(b.inTriangle(Q).multiply(this._getColor(q(Q,x,t,B),w).a));D=D.add(b.inTriangle(z).multiply(this._getColor(q(z,x,t,B),w).a));return n.step(D,new n.Float(.05)).multiply(b.failHittest(this.hittestRequest))}}r.__decorate([r.__param(0,
e.input(c)),r.__param(1,e.input(h))],A.prototype,"vertex",null);r.__decorate([r.__param(0,e.input(u))],A.prototype,"fragment",null);k.AnimatedMarkerFragmentInput=u;k.AnimatedMarkerShader=A;k.AnimatedMarkerVertexInput=c;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/AnimatedShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../../../../../../symbols/cim/animationDebugFlags ../../../animations/instructions ../../GraphShaderModule ../../graph/glsl ./AnimationUniformInfo ../shaders/AFeatureShader ../shaders/constants ../shaders/MosaicInfo ../shaders/utils ../shaders/VisualVariableColor ../shaders/VisualVariableOpacity ../shaders/VisualVariableRotation ../shaders/VisualVariableSizeMinMaxValue ../shaders/VisualVariableSizeScaleStops ../shaders/VisualVariableSizeStops ../shaders/VisualVariableSizeUnitValue ../shaders/vvUtils".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g,q,c,h,u,A,z,t){class w extends d.FeatureVertexInput{}r.__decorate([n.location(3,m.Vec4)],w.prototype,"animationPointerAndBaseSizeAndReferenceSize",void 0);r.__decorate([n.location(4,m.Vec2)],w.prototype,"zoomRange",void 0);class x extends d.FeatureFragmentInput{}class B extends d.AFeatureShader{_getScreenPosition(C){const {pos:y,translation:v,rotation:F,scale:D,offset:G,id:E,vvScale:H}=C;var K=t.getVisualVariableAngle(this,E).multiply(Math.PI/180),J=v.x.multiply(4/
3),L=v.y.multiply(-1).multiply(4/3),P=m.sin(K),Q=m.cos(K);C=Q.multiply(J).add(m.negate(P).multiply(L));L=P.multiply(J).add(Q.multiply(L));J=m.sin(F.subtract(K));P=m.cos(F.subtract(K));Q=new m.Float(0);const S=new m.Float(1);({pixelRatio:K}=this.animationInfo);C=new m.Mat3(S,Q,Q,Q,S,Q,C.multiply(K),L.multiply(K),S);J=new m.Mat3(P,J.multiply(-1),Q,J,P,Q,0,0,S);K=D.multiply(H).multiply(K).multiply(4/3);J=J.multiply(K);K=this.animationInfo.toScreen.multiply(new m.Vec3(y,1));C=C.multiply(K).xy;J=J.multiply(new m.Vec3(G,
0)).xy;return C.add(J)}_clip(C,y){y=super.clip(C,y);C=m.lessThanEqual(this._getLocalTimeOrigin(C),new m.Float(0));p.animationDebugFlags.forceGlobalTimeOrigin||(y=y.add(m.cond([C,()=>new m.Float(2)],[!0,()=>new m.Float(0)])));return y}_getLocalTimeOrigin(C){return this.storage.getLocalTimeOrigin(C)}_toNdc(C){return this.animationInfo.toNdc.multiply(new m.Vec3(C,1)).xy}_getEvalParams(C,y){const {globalTime:v,animationTextureSize:F,animationTexture:D}=this.animationInfo;return{globalTime:v,localTimeOrigin:this._getLocalTimeOrigin(C.id),
animationTextureSize:F,animationTexture:D,pixelDimensions:y}}_getColor(C,y){return m.ifElse(m.equal(y.isSDF,new m.Float(1)),this._getSDFColor(C,y),this._getSpriteColor(C,y))}_getSpriteColor(C,y){return m.texture2D(this.mosaicInfo.texture,C).multiply(y.color)}_getSDFColor(C,y){C=m.texture2D(this.mosaicInfo.texture,C);var v=(new m.Float(.5)).subtract(f.rgba2float(C)).multiply(y.distanceToPx).multiply(a.softEdgeRatio);C=m.clamp((new m.Float(.5)).subtract(v),new m.Float(0),new m.Float(1));C=y.color.multiply(C);
const F=y.outlineSize.multiply(.5);v=m.abs(v).subtract(F);v=m.clamp((new m.Float(.5)).subtract(v),new m.Float(0),new m.Float(1));y=y.outlineColor.multiply(v);return(new m.Float(1)).subtract(y.a).multiply(C).add(y)}}r.__decorate([n.uniform(b.MosaicInfo)],B.prototype,"mosaicInfo",void 0);r.__decorate([n.uniform(l.AnimationUniformInfo)],B.prototype,"animationInfo",void 0);r.__decorate([n.option(g.VisualVariableColor)],B.prototype,"visualVariableColor",void 0);r.__decorate([n.option(q.VisualVariableOpacity)],
B.prototype,"visualVariableOpacity",void 0);r.__decorate([n.option(h.VisualVariableSizeMinMaxValue)],B.prototype,"visualVariableSizeMinMaxValue",void 0);r.__decorate([n.option(u.VisualVariableSizeScaleStops)],B.prototype,"visualVariableSizeScaleStops",void 0);r.__decorate([n.option(A.VisualVariableSizeStops)],B.prototype,"visualVariableSizeStops",void 0);r.__decorate([n.option(z.VisualVariableSizeUnitValue)],B.prototype,"visualVariableSizeUnitValue",void 0);r.__decorate([n.option(c.VisualVariableRotation)],
B.prototype,"visualVariableRotation",void 0);k.AAnimatedFragmentInput=x;k.AAnimatedShader=B;k.AAnimatedVertexInput=w;k.getValue=function(C,y,v){y=C.add(new m.Vec2(y,0));y=m.texture2D(v.animationTexture,y.add(.5).divide(v.animationTextureSize)).xy;C=C.add(y);return m.block({animationPointer:C,...v},m.Vec4,null,F=>{const {out:D}=F;if(!D)throw Error("out is null");return e.generateVirtualMachineSource({...F,out:D})})};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/AnimationUniformInfo":function(){define(["exports",
"../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(k,r,p,e){class n extends p.UniformGroup{}r.__decorate([p.uniform(e.Float)],n.prototype,"globalTime",void 0);r.__decorate([p.uniform(e.Vec2)],n.prototype,"animationTextureSize",void 0);r.__decorate([p.uniform(e.Sampler2D)],n.prototype,"animationTexture",void 0);r.__decorate([p.uniform(e.Mat3)],n.prototype,"toScreen",void 0);r.__decorate([p.uniform(e.Mat3)],n.prototype,"toNdc",void 0);r.__decorate([p.uniform(e.Float)],
n.prototype,"mapRotation",void 0);r.__decorate([p.uniform(e.Float)],n.prototype,"pixelRatio",void 0);k.AnimationUniformInfo=n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/AFeatureShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../../definitions ../../GraphShaderModule ../../graph/glsl ./EntityStorage ./ShaderHighlight ./ShaderHittest ./utils ./ViewInfo".split(" "),function(k,r,p,e,n,m,l,d,a,b){class f extends e.VertexInput{}
r.__decorate([e.location(0,n.Vec3)],f.prototype,"id",void 0);r.__decorate([e.location(1,n.Float)],f.prototype,"bitset",void 0);r.__decorate([e.location(2,n.Vec2)],f.prototype,"pos",void 0);class g extends e.ComputeVertexInput{}r.__decorate([e.location(14,n.Vec2)],g.prototype,"nextPos1",void 0);r.__decorate([e.location(15,n.Vec2)],g.prototype,"nextPos2",void 0);class q extends e.FragmentInput{}class c extends e.GraphShaderModule{clip(h,u){let A=new n.Float(0);h=this.storage.getFilterFlags(h);A=A.add(n.float(2).multiply(n.float(1).subtract(a.getFilterBit(h,
0))));this.inside?A=A.add(n.float(2).multiply(n.float(1).subtract(a.getFilterBit(h,1)))):this.outside?A=A.add(n.float(2).multiply(a.getFilterBit(h,1))):this.highlight&&(A=A.add(n.float(2).multiply(n.float(1).subtract(this._checkHighlight(h)))));null!=u&&(h=(new n.Float(1)).subtract(n.step(u.x,this.view.currentZoom)),u=n.step(u.y,this.view.currentZoom),A=A.add((new n.Float(2)).multiply(h.add(u))));return A}getFragmentOutput(h,u,A=new n.Float(1/255)){const z=new e.FragmentOutput;z.fragColor=this._maybeWriteHittest(u)??
this._maybeHighlight(h,A)??h;return z}_maybeHighlight(h,u){return this.highlight?new n.Vec4(h.rgb,n.step(u,h.a)):null}_checkHighlight(h){let u=this._checkHighlightBit(h,0);for(let A=1;A<p.maxHighlightReasons;A++)u=u.add(this._checkHighlightBit(h,A));return n.step(new n.Float(.1),u.add(this.highlight.highlightAll))}_checkHighlightBit(h,u){return a.getHighlightBit(h,u).multiply(a.getBit(this.highlight.activeReasons,u))}maybeRunHittest(h,u,A){if(null==this.hittestRequest)return null;u=this.hittest(h,
u,A);u=n.ifElse(n.greaterThan(u,this.hittestRequest.distance),new n.Float(2),new n.Float(0));A=this.storage.getAttributeDataCoords(h.id);A=a.uvToClip(A);u=u.add(this.clip(h.id,h.zoomRange));h=new n.Vec4(new n.Float(1/255),0,0,0);return{glPointSize:new n.Float(1),glPosition:new n.Vec4(A,u,1),color:h}}_maybeWriteHittest(h){return null!=this.hittestRequest?h.color:null}}r.__decorate([e.define],c.prototype,"inside",void 0);r.__decorate([e.define],c.prototype,"outside",void 0);r.__decorate([e.option(l.ShaderHighlight)],
c.prototype,"highlight",void 0);r.__decorate([e.uniform(m.EntityStorage)],c.prototype,"storage",void 0);r.__decorate([e.uniform(b.ViewInfo)],c.prototype,"view",void 0);r.__decorate([e.option(d.ShaderHittest)],c.prototype,"hittestRequest",void 0);k.AFeatureShader=c;k.BaseHittestVertexInput=g;k.FeatureFragmentInput=q;k.FeatureVertexInput=f;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/EntityStorage":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../../../../../../core/has ../../GraphShaderModule ../../graph/glsl ./utils".split(" "),
function(k,r,p,e,n,m){class l extends e.UniformGroup{getVisualVariableData(d){this._vvData||(d=this.getAttributeDataCoords(d),this._vvData=n.texture2D(this.visualVariableData,d).setDebugName("storage2"));return this._vvData}getAttributeDataCoords(d){if(!this._uv){var a=m.unpackDisplayIdTexel(d);d=this.size;var b=n.int(a.x),f=n.int(a.y).multiply(n.int(256));a=n.int(a.z).multiply(n.int(256)).multiply(n.int(256));f=n.float(b.add(f).add(a));b=n.mod(f,d);f=f.subtract(b).divide(d);this._uv=(new n.Vec2(b,
f)).add(.5).divide(d)}return this._uv}getFilterData(d){d=this.getAttributeDataCoords(d);return n.texture2D(this.filterFlags,d).setDebugName("storage0")}getAnimationData(d){d=this.getAttributeDataCoords(d);return n.texture2D(this.animation,d).setDebugName("storage1")}getVVData(d){return this.getVisualVariableData(d)}getDataDrivenData0(d){d=this.getAttributeDataCoords(d);return n.texture2D(this.dataDriven0,d).setDebugName("storage30")}getDataDrivenData1(d){d=this.getAttributeDataCoords(d);return n.texture2D(this.dataDriven1,
d).setDebugName("storage31")}getDataDrivenData2(d){d=this.getAttributeDataCoords(d);return n.texture2D(this.dataDriven2,d).setDebugName("storage32")}getGPGPUData(d){d=this.getAttributeDataCoords(d);return n.texture2D(this.gpgpu,d).setDebugName("storage4")}getLocalTimeOrigin(d){d=this.getAttributeDataCoords(d);return n.texture2D(this.localTimeOrigin,d).x.setDebugName("storage5")}getFilterFlags(d){return p("webgl-ignores-sampler-precision")?n.ceil(this.getFilterData(d).x.multiply(n.float(255))):this.getFilterData(d).x.multiply(n.float(255))}getLabelVisibility(d){d=
this.getFilterData(d).y.multiply(255);return(new n.Float(1)).subtract(d)}getAnimationValue(d){return this.getAnimationData(d).x}getSizeValue(d){return this.getVisualVariableData(d).x}getColorValue(d){return this.getVisualVariableData(d).y}getOpacityValue(d){return this.getVisualVariableData(d).z}getRotationValue(d){return this.getVisualVariableData(d).w}}r.__decorate([e.uniform(n.Sampler2D)],l.prototype,"filterFlags",void 0);r.__decorate([e.uniform(n.Sampler2D)],l.prototype,"animation",void 0);r.__decorate([e.uniform(n.Sampler2D)],
l.prototype,"gpgpu",void 0);r.__decorate([e.uniform(n.Sampler2D)],l.prototype,"localTimeOrigin",void 0);r.__decorate([e.uniform(n.Sampler2D)],l.prototype,"visualVariableData",void 0);r.__decorate([e.uniform(n.Sampler2D)],l.prototype,"dataDriven0",void 0);r.__decorate([e.uniform(n.Sampler2D)],l.prototype,"dataDriven1",void 0);r.__decorate([e.uniform(n.Sampler2D)],l.prototype,"dataDriven2",void 0);r.__decorate([e.uniform(n.Float)],l.prototype,"size",void 0);k.EntityStorage=l;Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ShaderHighlight":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(k,r,p,e){class n extends p.UniformGroup{}r.__decorate([p.uniform(e.Float)],n.prototype,"activeReasons",void 0);r.__decorate([p.uniform(e.Float)],n.prototype,"highlightAll",void 0);k.ShaderHighlight=n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ShaderHittest":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(k,r,p,e){class n extends p.UniformGroup{}r.__decorate([p.uniform(e.Vec2)],n.prototype,"position",void 0);r.__decorate([p.uniform(e.Float)],n.prototype,"distance",void 0);r.__decorate([p.uniform(e.Float)],n.prototype,"smallSymbolDistance",void 0);r.__decorate([p.uniform(e.Float)],n.prototype,"smallSymbolSizeThreshold",
void 0);k.ShaderHittest=n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ViewInfo":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(k,r,p,e){class n extends p.UniformGroup{}r.__decorate([p.uniform(e.Mat3)],n.prototype,"displayViewScreenMat3",void 0);r.__decorate([p.uniform(e.Mat3)],n.prototype,"displayViewMat3",void 0);r.__decorate([p.uniform(e.Mat3)],
n.prototype,"displayMat3",void 0);r.__decorate([p.uniform(e.Mat3)],n.prototype,"viewMat3",void 0);r.__decorate([p.uniform(e.Mat3)],n.prototype,"tileMat3",void 0);r.__decorate([p.uniform(e.Float)],n.prototype,"displayZoomFactor",void 0);r.__decorate([p.uniform(e.Float)],n.prototype,"requiredZoomFactor",void 0);r.__decorate([p.uniform(e.Vec2)],n.prototype,"tileOffset",void 0);r.__decorate([p.uniform(e.Float)],n.prototype,"currentScale",void 0);r.__decorate([p.uniform(e.Float)],n.prototype,"currentZoom",
void 0);r.__decorate([p.uniform(e.Float)],n.prototype,"metersPerSRUnit",void 0);r.__decorate([p.uniform(e.Float)],n.prototype,"rotation",void 0);r.__decorate([p.uniform(e.Float)],n.prototype,"pixelRatio",void 0);k.ViewInfo=n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/MosaicInfo":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(k,r,p,e){class n extends p.UniformGroup{}
r.__decorate([p.uniform(e.Vec2)],n.prototype,"size",void 0);r.__decorate([p.uniform(e.Sampler2D)],n.prototype,"texture",void 0);k.MosaicInfo=n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableColor":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(k,r,p,e,n){class m extends p.UniformGroup{getColor(l,d,a){return e.cond([e.or(n.isNan(l),
a),d],[e.lessThanEqual(l,this.values.first()),this.colors.first()],[e.greaterThanEqual(l,this.values.last()),this.colors.last()],[!0,()=>{const b=this.values.findIndex(c=>e.greaterThan(c,l));var f=this.values.get(b);const g=b.subtract(1),q=this.values.get(g);f=l.subtract(q).divide(f.subtract(q));return e.mix(this.colors.get(g),this.colors.get(b),f)}])}}r.__decorate([p.uniform(e.FixedArray.ofType(e.Vec4,8))],m.prototype,"colors",void 0);r.__decorate([p.uniform(e.FixedArray.ofType(e.Float,8))],m.prototype,
"values",void 0);k.VisualVariableColor=m;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableOpacity":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(k,r,p,e,n){class m extends p.UniformGroup{getOpacity(l){return e.cond([n.isNan(l),new e.Float(1)],[e.lessThanEqual(l,this.opacityValues.first()),this.opacities.first()],[e.greaterThanEqual(l,
this.opacityValues.last()),this.opacities.last()],[!0,()=>{const d=this.opacityValues.findIndex(g=>e.greaterThan(g,l));var a=this.opacityValues.get(d);const b=d.subtract(1),f=this.opacityValues.get(b);a=l.subtract(f).divide(a.subtract(f));return e.mix(this.opacities.get(b),this.opacities.get(d),a)}])}}r.__decorate([p.uniform(e.FixedArray.ofType(e.Float,8))],m.prototype,"opacities",void 0);r.__decorate([p.uniform(e.FixedArray.ofType(e.Float,8))],m.prototype,"opacityValues",void 0);k.VisualVariableOpacity=
m;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableRotation":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./constants ./utils".split(" "),function(k,r,p,e,n,m){class l extends p.UniformGroup{getVVRotationMat4(d){return e.ifElse(m.isNan(d),e.Mat4.identity(),()=>{var a=this.getNormalizedAngle(d).multiply(n.cDegToRad);const b=e.sin(a);a=e.cos(a);return new e.Mat4(a,
b,0,0,b.multiply(new e.Float(-1)),a,0,0,0,0,1,0,0,0,0,1)})}getVVRotationMat3(d){return e.ifElse(m.isNan(d),e.Mat3.identity(),()=>{var a=this.getNormalizedAngle(d).multiply(n.cDegToRad);const b=e.sin(a);a=e.cos(a);return new e.Mat3(a,b,0,b.multiply(new e.Float(-1)),a,0,0,0,1)})}getNormalizedAngle(d){const a=e.equal(this.rotationType,new e.Float(n.RotationType.Arithmatic));return e.ifElse(a,(new e.Float(90)).subtract(d),d)}}r.__decorate([p.uniform(e.Float)],l.prototype,"rotationType",void 0);k.VisualVariableRotation=
l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableSizeMinMaxValue":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(k,r,p,e,n){class m extends p.UniformGroup{getSize(l,d){const a=this.minMaxValueAndSize.xy,b=this.minMaxValueAndSize.zw;return e.ifElse(n.isNan(l),d,()=>{var f=l.subtract(a.x).divide(a.y.subtract(a.x));f=e.clamp(f,
new e.Float(0),new e.Float(1));return b.x.add(f.multiply(b.y.subtract(b.x)))})}}r.__decorate([p.uniform(e.Vec4)],m.prototype,"minMaxValueAndSize",void 0);k.VisualVariableSizeMinMaxValue=m;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableSizeScaleStops":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(k,r,p,e){class n extends p.UniformGroup{getSizeForViewScale(m){return e.cond([e.lessThanEqual(m,
this.values.first()),this.sizes.first()],[e.greaterThanEqual(m,this.values.last()),this.sizes.last()],[!0,()=>{const l=this.values.findIndex(f=>e.greaterThan(f,m));var d=this.values.get(l);const a=l.subtract(1),b=this.values.get(a);d=m.subtract(b).divide(d.subtract(b));return e.mix(this.sizes.get(a),this.sizes.get(l),d)}])}}r.__decorate([p.uniform(e.FixedArray.ofType(e.Float,8))],n.prototype,"sizes",void 0);r.__decorate([p.uniform(e.FixedArray.ofType(e.Float,8))],n.prototype,"values",void 0);k.VisualVariableSizeScaleStops=
n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableSizeStops":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(k,r,p,e,n){class m extends p.UniformGroup{getSize(l,d){const a=e.cond([n.isNan(l),d],[e.lessThanEqual(l,this.values.first()),this.sizes.first()],[e.greaterThanEqual(l,this.values.last()),this.sizes.last()],[!0,()=>{const b=
this.values.findIndex(c=>e.greaterThan(c,l));var f=this.values.get(b);const g=b.subtract(1),q=this.values.get(g);f=l.subtract(q).divide(f.subtract(q));return e.mix(this.sizes.get(g),this.sizes.get(b),f)}]);return e.ifElse(n.isNan(a),d,a)}}r.__decorate([p.uniform(e.FixedArray.ofType(e.Float,8))],m.prototype,"sizes",void 0);r.__decorate([p.uniform(e.FixedArray.ofType(e.Float,8))],m.prototype,"values",void 0);k.VisualVariableSizeStops=m;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableSizeUnitValue":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(k,r,p,e,n){class m extends p.UniformGroup{getSize(l,d){return e.ifElse(n.isNan(l),d,l.multiply(this.unitValueToPixelsRatio))}}r.__decorate([p.uniform(e.Float)],m.prototype,"unitValueToPixelsRatio",void 0);k.VisualVariableSizeUnitValue=m;Object.defineProperty(k,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/vvUtils":function(){define(["exports","../../graph/glsl"],function(k,r){function p(e){return null!=e.visualVariableSizeMinMaxValue||null!=e.visualVariableSizeScaleStops||null!=e.visualVariableSizeStops||null!=e.visualVariableSizeUnitValue}k.getVisualVariableAngle=function(e,n){if(null==e.visualVariableRotation)return new r.Float(0);n=e.storage.getRotationValue(n);return e.visualVariableRotation.getNormalizedAngle(n)};
k.getVisualVariableColor=function(e,n,m,l=new r.Bool(!1)){if(null==e.visualVariableColor)return m;n=e.storage.getColorValue(n);return e.visualVariableColor.getColor(n,m,l)};k.getVisualVariableOpacity=function(e,n){if(null==e.visualVariableOpacity)return new r.Float(1);n=e.storage.getOpacityValue(n);return e.visualVariableOpacity.getOpacity(n)};k.getVisualVariableRotation=function(e,n){if(null==e.visualVariableRotation)return r.Mat3.identity();n=e.storage.getRotationValue(n);return e.visualVariableRotation.getVVRotationMat3(n)};
k.getVisualVariableSize=function(e,n,m){return p(e)?(n=e.storage.getSizeValue(n),e.visualVariableSizeMinMaxValue?.getSize(n,m)??e.visualVariableSizeScaleStops?.getSizeForViewScale(e.view.currentScale)??e.visualVariableSizeStops?.getSize(n,m)??e.visualVariableSizeUnitValue?.getSize(n,m)):m};k.hasVisualVariableSize=p;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/enums":function(){define(["exports"],function(k){k.AnimationParamIndex=
void 0;var r=k.AnimationParamIndex||(k.AnimationParamIndex={});r[r.transform=0]="transform";r[r.fromColor=1]="fromColor";r[r.toColor=2]="toColor";r[r.colorMix=3]="colorMix";r[r.toOpacity=4]="toOpacity";r[r.opacityMix=5]="opacityMix";Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/markers/markerConstants":function(){define(["exports"],function(k){k.MarkerConstants={bitset:{isSDF:0,isMapAligned:1,scaleSymbolsProportionally:2,overrideOutlineColor:3,
colorLocked:4,isStroke:5}};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/hittestUtils":function(){define(["exports","../../graph/glsl","./constants","./utils"],function(k,r,p,e){function n(b,f){return r.dot(b,r.normalize(f))}function m(b,f,g){var q=g.subtract(f),c=b.subtract(f);c=n(c,q);q=r.clamp(c.divide(r.length(q)),new r.Float(0),new r.Float(1));return r.distance(b,f.add(q.multiply(g.subtract(f))))}function l(b){b=r.abs(b);
return r.step(b.x.add(b.y).add(b.z),new r.Float(1.05))}function d(b,f,g,q){const c=new r.Mat3(g.x.multiply(q.y).subtract(q.x.multiply(g.y)),q.x.multiply(f.y).subtract(f.x.multiply(q.y)),f.x.multiply(g.y).subtract(g.x.multiply(f.y)),g.y.subtract(q.y),q.y.subtract(f.y),f.y.subtract(g.y),q.x.subtract(g.x),f.x.subtract(q.x),g.x.subtract(f.x));var h=f.x.multiply(g.y.subtract(q.y));const u=g.x.multiply(q.y.subtract(f.y));f=q.x.multiply(f.y.subtract(g.y));h=h.add(u).add(f);return(new r.Float(1)).divide(h).multiply(c.multiply(new r.Vec3(1,
b)))}function a(b,f,g,q){var c=g.subtract(f);const h=q.subtract(f);c=e.cross2(c,h);c=r.and(r.lessThan(c,new r.Float(p.epsilonHitTest)),r.greaterThan(c,new r.Float(-.05)));return r.cond([r.and(r.not(c),r.equal(l(d(b.xy,f,g,q)),new r.Float(1))),new r.Float(-1)],[!0,()=>{const u=m(b,f,g),A=m(b,g,q),z=m(b,q,f);return r.min(r.min(u,A),z)}])}k.distPointSegment=m;k.distPointTriangle=a;k.failHittest=function(b){return b.distance.add(1)};k.hittestFill=function(b,f,g){const {viewMat3:q,tileMat3:c}=b.view,h=
q.multiply(c);f=h.multiply(new r.Vec3(f.pos,1));const u=h.multiply(new r.Vec3(g.nextPos1,1));g=h.multiply(new r.Vec3(g.nextPos2,1));return a(b.hittestRequest.position,f.xy,u.xy,g.xy)};k.hittestMarker=function(b,f,g){return r.distance(b,g).subtract(f)};k.inTriangle=l;k.projectScalar=n;k.xyToBarycentric=d;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/AnimatedTechnique":function(){define("exports ../../../../../../../core/libs/gl-matrix-2/math/mat3 ../../../../../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../../../../../symbols/cim/animationDebugFlags ../FeatureTechnique ../featureTechniqueUtils".split(" "),
function(k,r,p,e,n,m){class l extends n.FeatureTechnique{render(d,a){const {context:b,painter:f}=d,{target:g}=a,{freezeGlobalTime:q}=e.animationDebugFlags,c=f.textureManager.animationStore.getTexture(b,0),h=[2/d.state.size[0],0,0,0,-2/d.state.size[1],0,-1,1,1];var u=Array.from(r.invert(p.create(),h));u=Array.from(r.multiply(p.create(),u,g.transforms.displayViewScreenMat3));const A=a.instance.getInput();f.setShader({shader:this.shaders.geometry,uniforms:{...m.resolveDynamicUniforms(d,a.target,A.uniforms),
...m.getFeatureUniforms(d,a.target),mosaicInfo:f.textureManager.getMosaicInfo(b,a.textureKey,!0),animationInfo:{globalTime:!1===q?d.time/1E3:q,animationTextureSize:[c.descriptor.width,c.descriptor.height],animationTexture:{unit:6,texture:c},toScreen:u,toNdc:h,mapRotation:d.state.rotation,pixelRatio:d.state.pixelRatio}},defines:{...m.getSelectionDefines(d)},optionalAttributes:{zoomRange:!0},useComputeBuffer:!0});f.setPipelineState({...m.getFeaturePipelineState(d)});f.submitDraw(d,a);!1===q&&g.requestRender()}}
k.AnimatedTechnique=l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/FeatureTechnique":function(){define(["exports","../../enums","./Technique"],function(k,r,p){class e extends p.Technique{constructor(){super(...arguments);this.symbologyPlane=r.FeatureSymbologyDrawOrder.FILL;this._input=null}}k.FeatureTechnique=e;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/dotDensity/DotDensityTechnique":function(){define("exports ../../../definitions ../FeatureTechnique ../featureTechniqueUtils ../TechniqueType ./DotDensityPointShader ./DotDensityPolygonShader ./DotDensityResources ../shaders/FillShader ../../../../../../webgl/enums".split(" "),
function(k,r,p,e,n,m,l,d,a,b){class f extends p.FeatureTechnique{constructor(){super(...arguments);this.type=n.TechniqueType.DotDensity;this.shaders={polygon:new l.DotDensityPolygonShader,point:new m.DotDensityPointShader,fill:new a.FillShader};this._resources=new Map}render(g,q){e.isHighlight(g)||e.isHittest(g)?this._renderPolygons(g,q):this._renderDotDensity(g,q)}_renderPolygons(g,q){const {painter:c}=g;c.setShader({shader:this.shaders.fill,uniforms:{...e.getFeatureUniforms(g,q.target),visualVariableColor:null,
visualVariableOpacity:null},defines:{...e.getSelectionDefines(g)},optionalAttributes:{zoomRange:!1},useComputeBuffer:e.isHittest(g)});c.setPipelineState(e.getFeaturePipelineState(g));c.submitDraw(g,q)}_renderDotDensity(g,q){const {context:c,painter:h,requiredLevel:u}=g,A=q.instance.getInput().uniforms,z=this._getOrCreateResourcesRecord(c);var t=z.getDotDensityTextures(c,r.tileSize,A.seed),w=1/2**(u-q.target.key.level),x=r.tileSize;x=x*window.devicePixelRatio*x*window.devicePixelRatio;const B=1/w*
(A.dotScale?g.state.scale/A.dotScale:1)*A.dotValue*(1/w);h.setShader({shader:this.shaders.polygon,uniforms:{...e.getFeatureUniforms(g,q.target),instance:{isActive:A.isActive,colors:A.colors,dotValue:Math.max(1,B)},draw:{dotTexture0:{unit:r.textureBindingRenderer0,texture:t[0]},dotTexture1:{unit:r.textureBindingRenderer1,texture:t[1]},tileZoomFactor:w,pixelRatio:window.devicePixelRatio,tileDotsOverArea:x/(r.tileSize*window.devicePixelRatio*r.tileSize*window.devicePixelRatio)}},defines:{...e.getSelectionDefines(g),
blending:A.blending},optionalAttributes:{},useComputeBuffer:!1});t=c.getViewport();c.setViewport(0,0,r.tileSize,r.tileSize);w=c.getBoundFramebufferObject();x=z.getFBO(c);c.bindFramebuffer(x);c.setClearColor(0,0,0,0);c.clear(b.FramebufferBit.COLOR);h.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1});h.updatePipelineState(c);h.submitDraw(g,q);c.bindFramebuffer(w);c.setViewport(t.x,t.y,t.width,t.height);t=z.getFBO(c).colorTexture;q={shader:this.shaders.point,uniforms:{view:e.getViewUniforms(g,
q.target),instance:{dotSize:A.dotSize},draw:{locations:{unit:r.textureBindingRenderer0,texture:t},tileZoomFactor:1,pixelRatio:window.devicePixelRatio}},defines:{...e.getSelectionDefines(g)},optionalAttributes:{},useComputeBuffer:!1};h.setPipelineState(e.getFeaturePipelineState(g));h.submitDrawMesh(c,q,z.getDotDensityMesh(c))}shutdown(g){super.shutdown(g);this._resources.get(g)?.destroy();this._resources.delete(g)}_getOrCreateResourcesRecord(g){let q=this._resources.get(g);null==q&&(q=new d.DotDensityResources,
this._resources.set(g,q));return q}}k.DotDensityTechnique=f;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/dotDensity/DotDensityPointShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../../definitions ../../GraphShaderModule ../../graph/glsl ../shaders/AFeatureShader ../shaders/ViewInfo".split(" "),function(k,r,p,e,n,m,l){class d extends e.VertexInput{}r.__decorate([e.location(0,n.Vec2)],d.prototype,"pos",
void 0);class a extends m.FeatureFragmentInput{}class b extends e.UniformGroup{}r.__decorate([e.uniform(n.Float)],b.prototype,"dotSize",void 0);class f extends e.UniformGroup{}r.__decorate([e.uniform(n.Sampler2D)],f.prototype,"locations",void 0);r.__decorate([e.uniform(n.Float)],f.prototype,"pixelRatio",void 0);r.__decorate([e.uniform(n.Float)],f.prototype,"tileZoomFactor",void 0);class g extends e.GraphShaderModule{constructor(){super(...arguments);this.type="DotDensityPointShader"}vertex(q){var c=
(new n.Mat3(1,0,0,0,-1,0,0,1,1)).multiply(new n.Vec3(q.pos.xy.divide(p.tileSize),1));c=n.texture2D(this.draw.locations,c.xy);var h=n.max(this.instance.dotSize.divide(2),new n.Float(1)),u=new n.Float(0);u=u.add(n.step(c.a,new n.Float(1E-6)).multiply(2));let A=h.add(this.instance.dotSize);q=this.view.displayViewScreenMat3.multiply(new n.Vec3(q.pos.add(.5),1));q=new n.Vec4(q.xy,u,1);u=this.instance.dotSize.divide(A);h=(new n.Float(-1)).divide(h.divide(A));A=A.multiply(this.draw.pixelRatio.multiply(this.draw.tileZoomFactor));
return{glPosition:q,glPointSize:A,color:c,ratio:u,invEdgeRatio:h}}fragment(q){var c=n.length(q.glPointCoord.subtract(.5)).multiply(2);c=n.smoothstep(new n.Float(0),new n.Float(1),q.invEdgeRatio.multiply(c.subtract(q.ratio)).add(1));const h=new e.FragmentOutput;h.fragColor=q.color.multiply(c);return h}}r.__decorate([e.uniform(b)],g.prototype,"instance",void 0);r.__decorate([e.uniform(f)],g.prototype,"draw",void 0);r.__decorate([e.uniform(l.ViewInfo)],g.prototype,"view",void 0);r.__decorate([r.__param(0,
e.input(d))],g.prototype,"vertex",null);r.__decorate([r.__param(0,e.input(a))],g.prototype,"fragment",null);k.DotDensityPointDrawUniforms=f;k.DotDensityPointFragmentInput=a;k.DotDensityPointInstanceUniforms=b;k.DotDensityPointShader=g;k.DotDensityPointVertexInput=d;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/dotDensity/DotDensityPolygonShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../../definitions ../../GraphShaderModule ../../graph/glsl ../shaders/AFeatureShader ../shaders/hittestUtils ../shaders/utils".split(" "),
function(k,r,p,e,n,m,l,d){class a extends m.FeatureVertexInput{}r.__decorate([e.location(3,n.Float)],a.prototype,"inverseArea",void 0);class b extends m.FeatureFragmentInput{}class f extends e.UniformGroup{}r.__decorate([e.uniform(n.FixedArray.ofType(n.Vec4,2))],f.prototype,"isActive",void 0);r.__decorate([e.uniform(n.FixedArray.ofType(n.Vec4,8))],f.prototype,"colors",void 0);r.__decorate([e.uniform(n.Float)],f.prototype,"dotValue",void 0);class g extends e.UniformGroup{}r.__decorate([e.uniform(n.Sampler2D)],
g.prototype,"dotTexture0",void 0);r.__decorate([e.uniform(n.Sampler2D)],g.prototype,"dotTexture1",void 0);r.__decorate([e.uniform(n.Float)],g.prototype,"tileZoomFactor",void 0);r.__decorate([e.uniform(n.Float)],g.prototype,"pixelRatio",void 0);r.__decorate([e.uniform(n.Float)],g.prototype,"tileDotsOverArea",void 0);class q extends m.AFeatureShader{constructor(){super(...arguments);this.type="DotDensityPolygonShader"}_dotThreshold(c,h,u){return c.divide(h).divide(u)}vertex(c){var h=(new n.Mat3(2/p.tileSize,
0,0,0,-2/p.tileSize,0,-1,1,1)).multiply(new n.Vec3(c.pos,1)),u=this.clip(c.id);h=new n.Vec4(h.xy,u,1);var A=this.storage.getVVData(c.id).multiply(this.instance.isActive.get(0)).multiply(c.inverseArea),z=this.storage.getDataDrivenData0(c.id).multiply(this.instance.isActive.get(1)).multiply(c.inverseArea);u=this.draw.tileZoomFactor.multiply(p.tileSize).divide(this.draw.pixelRatio);A=this._dotThreshold(A,this.instance.dotValue,this.draw.tileDotsOverArea);z=this._dotThreshold(z,this.instance.dotValue,
this.draw.tileDotsOverArea);c=c.pos.add(.5).divide(u);return{glPosition:h,color:new n.Vec4(0,0,0,0),textureCoords:c,thresholds0:A,thresholds1:z}}fragment(c){const h=new e.FragmentOutput;var u=n.texture2D(this.draw.dotTexture0,c.textureCoords),A=n.texture2D(this.draw.dotTexture1,c.textureCoords);u=c.thresholds0.subtract(u);var z=c.thresholds1.subtract(A);c=n.Mat4.fromColumns(this.instance.colors[0],this.instance.colors[1],this.instance.colors[2],this.instance.colors[3]);A=n.Mat4.fromColumns(this.instance.colors[4],
this.instance.colors[5],this.instance.colors[6],this.instance.colors[7]);if(this.blending){const B=n.step(new n.Float(0),u);var t=n.step(new n.Float(0),z),w=n.dot(B,u).add(n.dot(t,z));const C=n.step(w,new n.Float(0));var x=(new n.Float(1)).subtract(C);w=w.add(C);u=u.multiply(B).divide(w);z=z.multiply(t).divide(w);c=c.multiply(u).add(A.multiply(z));c=x.multiply(c)}else t=n.max(d.max4(u),d.max4(z)),x=n.step(t,new n.Float(0)),x=(new n.Float(1)).subtract(x),u=n.step(t,u),z=n.step(t,z),c=c.multiply(u).add(A.multiply(z)),
c=x.multiply(c);h.fragColor=c;return h}hittest(c){return l.failHittest(this.hittestRequest)}}r.__decorate([e.define],q.prototype,"blending",void 0);r.__decorate([e.uniform(f)],q.prototype,"instance",void 0);r.__decorate([e.uniform(g)],q.prototype,"draw",void 0);r.__decorate([r.__param(0,e.input(a))],q.prototype,"vertex",null);r.__decorate([r.__param(0,e.input(m.FeatureFragmentInput))],q.prototype,"fragment",null);k.DotDensityPolygonDrawUniforms=g;k.DotDensityPolygonFragmentInput=b;k.DotDensityPolygonInstanceUniforms=
f;k.DotDensityPolygonShader=q;k.DotDensityPolygonVertexInput=a;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/dotDensity/DotDensityResources":function(){define("exports ../../../../../../../core/RandomLCG ../../../definitions ../../../meshing/SimpleMesh ../../../../../../webgl/enums ../../../../../../webgl/FramebufferObject ../../../../../../webgl/Renderbuffer ../../../../../../webgl/RenderbufferDescriptor ../../../../../../webgl/Texture ../../../../../../webgl/TextureDescriptor".split(" "),
function(k,r,p,e,n,m,l,d,a,b){const f={pos:{count:2,type:n.DataType.UNSIGNED_SHORT}};class g{constructor(){this._dotTextureSize=0;this._dotMesh=this._dotTextures=null}destroy(){this._disposeTextures();this._dotFBO&&this._dotFBO.dispose();this._dotMesh&&this._dotMesh.destroy()}getFBO(q){if(null==this._dotFBO){var c=p.tileSize;const h=p.tileSize,u=new b.TextureDescriptor(c,h);u.samplingMode=n.TextureSamplingMode.NEAREST;u.wrapMode=n.TextureWrapMode.CLAMP_TO_EDGE;c=new l.Renderbuffer(q,new d.RenderbufferDescriptor(n.RenderbufferFormat.DEPTH_STENCIL,
c,h));this._dotFBO=new m.FramebufferObject(q,u,c)}return this._dotFBO}getDotDensityMesh(q){if(null==this._dotMesh){const c=p.tileSize,h=c*c,u=new Int16Array(2*h);for(let A=0;A<c;A++)for(let z=0;z<c;z++)u[2*(z+A*c)]=z,u[2*(z+A*c)+1]=A;this._dotMesh=e.SimpleMesh.create(q,{primitive:n.PrimitiveType.POINTS,vertex:u,count:h,layout:f})}return this._dotMesh}getDotDensityTextures(q,c,h){if(this._dotTextureSize!==c||this._seed!==h)this._disposeTextures(),this._dotTextureSize=c,this._seed=h;null===this._dotTextures&&
(h=new r(h),this._dotTextures=[this._allocDotDensityTexture(q,c,h),this._allocDotDensityTexture(q,c,h)]);return this._dotTextures}_disposeTextures(){if(this._dotTextures){for(let q=0;q<this._dotTextures.length;q++)this._dotTextures[q].dispose();this._dotTextures=null}}_allocDotDensityTexture(q,c,h){const u=new Float32Array(c*c*4);for(let A=0;A<u.length;A++)u[A]=h.getFloat();h=new b.TextureDescriptor;h.dataType=n.PixelType.FLOAT;h.samplingMode=n.TextureSamplingMode.NEAREST;h.width=c;h.height=c;return new a.Texture(q,
h,u)}}k.DotDensityResources=g;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/FillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./hittestUtils ./VisualVariableColor ./VisualVariableOpacity ./vvUtils".split(" "),function(k,r,p,e,n,m,l,d,a){class b extends n.FeatureVertexInput{}r.__decorate([p.location(3,e.Vec4)],b.prototype,"color",void 0);
r.__decorate([p.location(4,e.Vec2)],b.prototype,"zoomRange",void 0);class f extends n.AFeatureShader{constructor(){super(...arguments);this.type="FillShader";this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(g,q){var c=a.getVisualVariableOpacity(this,g.id);c=a.getVisualVariableColor(this,g.id,g.color).multiply(c);const h=this.view.displayViewScreenMat3.multiply(new e.Vec3(g.pos.xy,1)),u=this.clip(g.id,g.zoomRange);return{glPosition:new e.Vec4(h.xy,u,1),color:c,...this.maybeRunHittest(g,
q,null)}}fragment(g){return this.getFragmentOutput(g.color,g,new e.Float(0))}hittest(g,q){return m.hittestFill(this,g,q)}}r.__decorate([p.option(l.VisualVariableColor)],f.prototype,"visualVariableColor",void 0);r.__decorate([p.option(d.VisualVariableOpacity)],f.prototype,"visualVariableOpacity",void 0);r.__decorate([r.__param(0,p.input(b)),r.__param(1,p.input(n.BaseHittestVertexInput))],f.prototype,"vertex",null);r.__decorate([r.__param(0,p.input(n.FeatureFragmentInput))],f.prototype,"fragment",null);
k.FillShader=f;k.FillVertexInput=b;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/ComplexFillTechnique":function(){define(["exports","../FeatureTechnique","../featureTechniqueUtils","../TechniqueType","../shaders/ComplexFillShader"],function(k,r,p,e,n){class m extends r.FeatureTechnique{constructor(){super(...arguments);this.type=e.TechniqueType.ComplexFill;this.shaders={geometry:new n.ComplexFillShader}}render(l,d){const {context:a,
painter:b}=l,f=d.instance.getInput();b.setShader({shader:this.shaders.geometry,uniforms:{...p.resolveDynamicUniforms(l,d.target,f.uniforms),...p.getFeatureUniforms(l,d.target),mosaicInfo:b.textureManager.getMosaicInfo(a,d.textureKey),localTileOffset:p.getLocalTileOffset(d.target)},defines:{...p.getSelectionDefines(l)},optionalAttributes:f.optionalAttributes,useComputeBuffer:p.isHittest(l)});b.setPipelineState(p.getFeaturePipelineState(l));b.submitDraw(l,d)}}k.ComplexFillTechnique=m;Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ComplexFillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./constants ./FillShader ./LocalTileOffset ./MosaicInfo ./utils".split(" "),function(k,r,p,e,n,m,l,d,a,b){function f(u,A){var z=u.view.requiredZoomFactor,t=new e.Vec2(A.width,A.height),w=t.multiply(A.scale).multiply(z),x=A.angle.multiply(m.c256ToRad);const B=e.sin(x);
x=e.cos(x);var C=A.id;var y=e.equal(b.getBit(A.bitset,m.bitsetFillRandomPatternOffset),e.float(1));C=b.rgba2float(new e.Vec4(C,0));y=e.ifElse(y,e.mat3(x.divide(w.x),B.divide(w.y),0,e.negate(B.divide(w.x)),x.divide(w.y),0,b.rand(e.vec2(C,0)),b.rand(e.vec2(0,C)),1),e.mat3(x.divide(w.x),B.divide(w.y),0,e.negate(B.divide(w.x)),x.divide(w.y),0,0,0,1));t=u.localTileOffset.getPatternOffsetAtTileOrigin(t,B,x);z=z.multiply(A.scale).multiply(A.offset.subtract(t)).divide(w);w=new e.Vec3(A.pos,1);z=y.multiply(w).xy.subtract(z);
w=A.tlbr.divide(u.mosaicInfo.size.xyxy);t=b.getBit(A.bitset,m.bitsetGenericConsiderAlphaOnly);null!=u.visualVariableColor&&(t=e.ifElse(b.isNan(u.storage.getColorValue(A.id)),new e.Float(0),t));return{tileTextureCoord:z,tlbr:w,sampleAlphaOnly:t}}function g(u,A){var z=e.mod(A.tileTextureCoord,new e.Float(1));z=e.mix(A.tlbr.xy,A.tlbr.zw,z);u=e.texture2D(u.mosaicInfo.texture,z);u=e.ifElse(e.greaterThan(A.sampleAlphaOnly,new e.Float(.5)),u.aaaa,u);return A.color.multiply(u)}class q extends l.FillVertexInput{}
r.__decorate([p.location(5,e.Vec4)],q.prototype,"tlbr",void 0);r.__decorate([p.location(6,e.Float)],q.prototype,"width",void 0);r.__decorate([p.location(7,e.Float)],q.prototype,"height",void 0);r.__decorate([p.location(8,e.Vec2)],q.prototype,"offset",void 0);r.__decorate([p.location(9,e.Vec2)],q.prototype,"scale",void 0);r.__decorate([p.location(10,e.Float)],q.prototype,"angle",void 0);class c extends n.FeatureFragmentInput{}class h extends l.FillShader{constructor(){super(...arguments);this.type=
"ComplexFillShader"}vertex(u,A){return{...super.vertex(u,A),...f(this,u)}}fragment(u){const A=g(this,u);return this.getFragmentOutput(A,u,new e.Float(0))}}r.__decorate([p.uniform(a.MosaicInfo)],h.prototype,"mosaicInfo",void 0);r.__decorate([p.uniform(d.LocalTileOffset)],h.prototype,"localTileOffset",void 0);r.__decorate([r.__param(0,p.input(q)),r.__param(1,p.input(n.BaseHittestVertexInput))],h.prototype,"vertex",null);r.__decorate([r.__param(0,p.input(c))],h.prototype,"fragment",null);k.ComplexFillFragmentInput=
c;k.ComplexFillShader=h;k.ComplexFillVertexInput=q;k.getComplexFillFragmentColor=g;k.getComplexFillVertexData=f;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/LocalTileOffset":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./constants"],function(k,r,p,e,n){class m extends p.UniformGroup{getPatternOffsetAtTileOrigin(l,d=new e.Float(0),a=new e.Float(1)){var b=
(new e.Vec2(n.maxRepresentableInt)).divide(l);b=l.multiply(e.fract(this.maxIntsToLocalOrigin.multiply(b))).add(this.tileOffsetFromLocalOrigin).subtract((new e.Float(.5)).multiply(l));b=new e.Vec2(b.x.multiply(a).subtract(b.y.multiply(d)),b.x.multiply(d).add(b.y.multiply(a)));return e.mod(b,l)}}r.__decorate([p.uniform(e.Vec2)],m.prototype,"tileOffsetFromLocalOrigin",void 0);r.__decorate([p.uniform(e.Vec2)],m.prototype,"maxIntsToLocalOrigin",void 0);k.LocalTileOffset=m;Object.defineProperty(k,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/ComplexOutlineFillTechnique":function(){define("exports ../FeatureTechnique ../featureTechniqueUtils ../TechniqueType ../line/utils ../shaders/ComplexOutlineFillShader".split(" "),function(k,r,p,e,n,m){class l extends r.FeatureTechnique{constructor(){super(...arguments);this.type=e.TechniqueType.ComplexOutlineFill;this.shaders={geometry:new m.ComplexOutlineFillShader}}render(d,a){const {context:b,painter:f,pixelRatio:g}=
d,q=a.instance.getInput();f.setShader({shader:this.shaders.geometry,uniforms:{...p.resolveDynamicUniforms(d,a.target,q.uniforms),...p.getFeatureUniforms(d,a.target),antialiasingControls:n.getAntialiasingControls(g),mosaicInfo:f.textureManager.getMosaicInfo(b,a.textureKey),localTileOffset:p.getLocalTileOffset(a.target)},defines:{...p.getSelectionDefines(d)},optionalAttributes:q.optionalAttributes,useComputeBuffer:p.isHittest(d)});f.setPipelineState(p.getFeaturePipelineState(d));f.submitDraw(d,a)}}
k.ComplexOutlineFillTechnique=l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/utils":function(){define(["exports"],function(k){k.getAntialiasingControls=function(r){r=1/r;return{antialiasing:r,blur:0+r}};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ComplexOutlineFillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./ComplexFillShader ./constants ./hittestUtils ./LineShader ./LocalTileOffset ./MosaicInfo ./OutlineFillShader ./PatternOutlineFillShader".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g,q){const c=1/l.packPrecision;class h extends n.FeatureVertexInput{}r.__decorate([p.location(3,e.Vec4)],h.prototype,"color",void 0);r.__decorate([p.location(4,e.Vec4)],h.prototype,"tlbr",void 0);r.__decorate([p.location(5,e.Float)],h.prototype,"angle",void 0);r.__decorate([p.location(6,e.Float)],h.prototype,"aux1",void 0);r.__decorate([p.location(7,e.Float)],h.prototype,"aux2",void 0);r.__decorate([p.location(8,e.Vec2)],h.prototype,"aux3",void 0);r.__decorate([p.location(9,
e.Vec2)],h.prototype,"aux4",void 0);r.__decorate([p.location(10,e.Vec2)],h.prototype,"zoomRange",void 0);class u extends q.PatternOutlineFillFragmentInput{}class A extends g.AOutlineFillShader{constructor(){super(...arguments);this.type="ComplexOutlineFillShader"}vertex(z,t){const {aux1:w,aux2:x,aux3:B,aux4:C}=z;var y={...z,width:w,height:x,offset:B,scale:C.multiply(c)},v={...z,halfWidth:w,referenceHalfWidth:x,offset:B,normal:C.subtract(l.signedToUnsignedByte).multiply(c)};v=g.getOutlineFillVertexData(this,
v);y=m.getComplexFillVertexData(this,y);const F=e.greaterThan(v.isOutline,new e.Float(.5));return{...v,...y,...this.maybeRunHittest(z,t,F)}}fragment(z){var {isOutline:t}=z;t=e.greaterThan(t,new e.Float(.5));var w=a.getLineFragmentColor(z,this.antialiasingControls.blur);const x=m.getComplexFillFragmentColor(this,z);w=e.ifElse(t,w,x);t=e.ifElse(t,new e.Float(1/255),new e.Float(0));return this.getFragmentOutput(w,z,t)}hittest(z,t,w){return e.ifElse(w,d.failHittest(this.hittestRequest),d.hittestFill(this,
z,t))}}r.__decorate([p.uniform(f.MosaicInfo)],A.prototype,"mosaicInfo",void 0);r.__decorate([p.uniform(b.LocalTileOffset)],A.prototype,"localTileOffset",void 0);r.__decorate([r.__param(0,p.input(h)),r.__param(1,p.input(n.BaseHittestVertexInput))],A.prototype,"vertex",null);r.__decorate([r.__param(0,p.input(u))],A.prototype,"fragment",null);k.ComplexOutlineFillShader=A;k.ComplexOutlineFillVertexInput=h;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/LineShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./constants ./hittestUtils ./VisualVariableColor ./VisualVariableOpacity ./VisualVariableSizeMinMaxValue ./VisualVariableSizeScaleStops ./VisualVariableSizeStops ./VisualVariableSizeUnitValue ./vvUtils".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g,q,c){function h(C){return e.max((new e.Float(m.thinLineWidthFactor)).multiply(e.step(C,new e.Float(m.thinLineHalfWidth))),new e.Float(1))}function u(C,y){const {halfWidth:v,normal:F}=C;C=h(v);const D=e.length(F).multiply(v);return e.clamp(C.multiply(v.subtract(D)).divide(y.add(C).subtract(new e.Float(1))),new e.Float(0),new e.Float(1))}function A(C,y){const {id:v,offset:F,pos:D,normal:G,zoomRange:E}=y,{displayViewScreenMat3:H,displayViewMat3:K}=C.view,J=c.getVisualVariableColor(C,
v,y.color),L=c.getVisualVariableOpacity(C,v);{const {id:U,halfWidth:X,referenceHalfWidth:aa}=y;c.hasVisualVariableSize(C)?(y=(new e.Float(2)).multiply(aa),y=c.getVisualVariableSize(C,U,y),y=(new e.Float(.5)).multiply(X.divide(e.max(aa,new e.Float(m.epsilon)))).multiply(y)):y=X}var P=(new e.Float(.5)).multiply(C.antialiasingControls.antialiasing);P=e.max(y.add(P),new e.Float(.45)).add((new e.Float(.1)).multiply(P));const Q=h(P).multiply(P).multiply(F);var S=K.multiply(new e.Vec3(Q,new e.Float(0)));
S=H.multiply(new e.Vec3(D,new e.Float(1))).add(S);C=(new e.Float(2)).multiply(e.step(y,new e.Float(0))).add(C.clip(v,E));S=new e.Vec4(S.xy,C,1);C=new e.Vec4(S.xy,C,1);return{color:J,opacity:L,halfWidth:P,normal:G,scaledOffset:Q,scaledHalfWidth:y,glPosition:C}}function z(C,y){const {opacity:v,color:F}=C;C=u(C,y);return v.multiply(F).multiply(C)}class t extends n.FeatureVertexInput{}r.__decorate([p.location(3,e.Vec4)],t.prototype,"color",void 0);r.__decorate([p.location(4,e.Vec2)],t.prototype,"offset",
void 0);r.__decorate([p.location(5,e.Vec2)],t.prototype,"normal",void 0);r.__decorate([p.location(6,e.Float)],t.prototype,"halfWidth",void 0);r.__decorate([p.location(7,e.Float)],t.prototype,"referenceHalfWidth",void 0);r.__decorate([p.location(8,e.Vec2)],t.prototype,"zoomRange",void 0);class w extends n.FeatureFragmentInput{}class x extends p.UniformGroup{}r.__decorate([p.uniform(e.Float)],x.prototype,"antialiasing",void 0);r.__decorate([p.uniform(e.Float)],x.prototype,"blur",void 0);class B extends n.AFeatureShader{constructor(){super(...arguments);
this.type="LineShader";this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(C,y){const v=A(this,C);return{...v,...this.maybeRunHittest(C,y,v.halfWidth)}}fragment(C){const y=z(C,this.antialiasingControls.blur);return this.getFragmentOutput(y,C)}hittest(C,y,v){const {viewMat3:F,tileMat3:D}=this.view;var G=F.multiply(D);C=G.multiply(new e.Vec3(C.pos,1));const E=G.multiply(new e.Vec3(y.nextPos1,1));y=G.multiply(new e.Vec3(y.nextPos2,1));const {distance:H,smallSymbolDistance:K,smallSymbolSizeThreshold:J}=
this.hittestRequest;G=e.step(v,J.multiply(.5)).multiply(H.subtract(K));const L=this.hittestRequest.position;return e.min(l.distPointSegment(L,C.xy,E.xy),l.distPointSegment(L,C.xy,y.xy)).subtract(v).add(G)}}r.__decorate([p.uniform(x)],B.prototype,"antialiasingControls",void 0);r.__decorate([p.option(d.VisualVariableColor)],B.prototype,"visualVariableColor",void 0);r.__decorate([p.option(a.VisualVariableOpacity)],B.prototype,"visualVariableOpacity",void 0);r.__decorate([p.option(b.VisualVariableSizeMinMaxValue)],
B.prototype,"visualVariableSizeMinMaxValue",void 0);r.__decorate([p.option(f.VisualVariableSizeScaleStops)],B.prototype,"visualVariableSizeScaleStops",void 0);r.__decorate([p.option(g.VisualVariableSizeStops)],B.prototype,"visualVariableSizeStops",void 0);r.__decorate([p.option(q.VisualVariableSizeUnitValue)],B.prototype,"visualVariableSizeUnitValue",void 0);r.__decorate([r.__param(0,p.input(t)),r.__param(1,p.input(n.BaseHittestVertexInput))],B.prototype,"vertex",null);r.__decorate([r.__param(0,p.input(w))],
B.prototype,"fragment",null);k.AntialiasingControls=x;k.LineFragmentInput=w;k.LineShader=B;k.LineVertexInput=t;k.getLineAntialiasing=u;k.getLineFragmentColor=z;k.getLineVertexData=A;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/OutlineFillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./constants ./hittestUtils ./LineShader ./utils ./VisualVariableColor ./VisualVariableOpacity ./VisualVariableSizeMinMaxValue ./VisualVariableSizeScaleStops ./VisualVariableSizeStops ./VisualVariableSizeUnitValue ./vvUtils".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g,q,c,h,u){function A(B,C,y){const {id:v,bitset:F}=C,D=a.getBit(F,m.bitsetTypeFillOutline),G=e.greaterThan(D,new e.Float(.5)),E=d.getLineVertexData(B,C),H=e.ifElse(G,E.halfWidth,new e.Float(0));var K=u.getVisualVariableOpacity(B,v),J=u.getVisualVariableColor(B,v,C.color);K=e.ifElse(G,C.color,J.multiply(K));J=B.view.displayViewScreenMat3.multiply(new e.Vec3(C.pos.xy,1));const L=B.clip(C.id);J=new e.Vec4(J.xy,L,1);J=e.ifElse(G,E.glPosition,J);B=y&&B.maybeRunHittest(C,
y,G);return{isOutline:D,color:K,opacity:new e.Float(1),halfWidth:H,normal:E.normal,glPosition:J,...B}}class z extends n.FeatureVertexInput{}r.__decorate([p.location(3,e.Vec2)],z.prototype,"offset",void 0);r.__decorate([p.location(4,e.Vec4)],z.prototype,"color",void 0);r.__decorate([p.location(5,e.Vec2)],z.prototype,"normal",void 0);r.__decorate([p.location(6,e.Float)],z.prototype,"halfWidth",void 0);r.__decorate([p.location(7,e.Float)],z.prototype,"referenceHalfWidth",void 0);r.__decorate([p.location(8,
e.Vec2)],z.prototype,"zoomRange",void 0);class t extends d.LineFragmentInput{}class w extends n.AFeatureShader{constructor(){super(...arguments);this.computeAttributes={pos:["nextPos1","nextPos2"]}}}r.__decorate([p.uniform(d.AntialiasingControls)],w.prototype,"antialiasingControls",void 0);r.__decorate([p.option(b.VisualVariableColor)],w.prototype,"visualVariableColor",void 0);r.__decorate([p.option(f.VisualVariableOpacity)],w.prototype,"visualVariableOpacity",void 0);r.__decorate([p.option(g.VisualVariableSizeMinMaxValue)],
w.prototype,"visualVariableSizeMinMaxValue",void 0);r.__decorate([p.option(q.VisualVariableSizeScaleStops)],w.prototype,"visualVariableSizeScaleStops",void 0);r.__decorate([p.option(c.VisualVariableSizeStops)],w.prototype,"visualVariableSizeStops",void 0);r.__decorate([p.option(h.VisualVariableSizeUnitValue)],w.prototype,"visualVariableSizeUnitValue",void 0);class x extends w{constructor(){super(...arguments);this.type="OutlineFillShader"}vertex(B,C){return A(this,B,C)}fragment(B){const {color:C,
isOutline:y}=B;var v=e.greaterThan(y,new e.Float(.5)),F=d.getLineFragmentColor(B,this.antialiasingControls.blur);F=e.ifElse(v,F,C);v=e.ifElse(v,new e.Float(1/255),new e.Float(0));return this.getFragmentOutput(F,B,v)}hittest(B,C,y){return e.ifElse(y,l.failHittest(this.hittestRequest),l.hittestFill(this,B,C))}}r.__decorate([r.__param(0,p.input(z)),r.__param(1,p.input(n.BaseHittestVertexInput))],x.prototype,"vertex",null);r.__decorate([r.__param(0,p.input(t))],x.prototype,"fragment",null);k.AOutlineFillShader=
w;k.OutlineFillFragmentInput=t;k.OutlineFillShader=x;k.OutlineFillVertexInput=z;k.getOutlineFillVertexData=A;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/PatternOutlineFillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./LineShader ./LocalTileOffset ./MosaicInfo ./OutlineFillShader ./PatternFillShader".split(" "),function(k,r,p,e,n,m,l,d,
a,b){class f extends a.OutlineFillVertexInput{}r.__decorate([p.location(9,e.Vec4)],f.prototype,"tlbr",void 0);r.__decorate([p.location(10,e.Float)],f.prototype,"inverseRasterizationScale",void 0);class g extends a.OutlineFillFragmentInput{}class q extends a.OutlineFillShader{constructor(){super(...arguments);this.type="PatternOutlineFillShader"}vertex(c,h){return{...a.getOutlineFillVertexData(this,c,h),...b.getPatternFillVertexData(this,c)}}fragment(c){var {isOutline:h}=c;h=e.greaterThan(h,new e.Float(.5));
var u=m.getLineFragmentColor(c,this.antialiasingControls.blur);const A=b.getPatternFillFragmentColor(c,this.mosaicInfo);u=e.ifElse(h,u,A);h=e.ifElse(h,new e.Float(1/255),new e.Float(0));return this.getFragmentOutput(u,c,h)}}r.__decorate([p.uniform(d.MosaicInfo)],q.prototype,"mosaicInfo",void 0);r.__decorate([p.uniform(l.LocalTileOffset)],q.prototype,"localTileOffset",void 0);r.__decorate([r.__param(0,p.input(f)),r.__param(1,p.input(n.BaseHittestVertexInput))],q.prototype,"vertex",null);r.__decorate([r.__param(0,
p.input(g))],q.prototype,"fragment",null);k.PatternOutlineFillFragmentInput=g;k.PatternOutlineFillShader=q;k.PatternOutlineFillVertexInput=f;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/PatternFillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./FillShader ./LocalTileOffset ./MosaicInfo".split(" "),function(k,r,p,e,n,m,l,d){function a(c,
h){var u=h.tlbr.xy,A=h.tlbr.zw,z=A.x.subtract(u.x);u=u.y.subtract(A.y);z=(new e.Vec2(z,u)).multiply(h.inverseRasterizationScale);u=z.multiply(c.view.requiredZoomFactor);A=new e.Float(1);const t=new e.Float(0);A=new e.Mat3(A.divide(u.x),t.divide(u.y),0,e.negate(t.divide(u.x)),A.divide(u.y),0,0,0,1);z=c.localTileOffset.getPatternOffsetAtTileOrigin(z).divide(u);u=new e.Vec3(h.pos,1);z=A.multiply(u).xy.subtract(z);c=h.tlbr.divide(c.mosaicInfo.size.xyxy);return{tileTextureCoord:z,tlbr:c}}function b(c,
h){var u=e.mod(c.tileTextureCoord,new e.Float(1));u=e.mix(c.tlbr.xy,c.tlbr.zw,u);h=e.texture2D(h.texture,u);return c.color.multiply(h)}class f extends m.FillVertexInput{}r.__decorate([p.location(5,e.Vec4)],f.prototype,"tlbr",void 0);r.__decorate([p.location(6,e.Float)],f.prototype,"inverseRasterizationScale",void 0);class g extends n.FeatureFragmentInput{}class q extends m.FillShader{constructor(){super(...arguments);this.type="PatternFillShader"}vertex(c,h){return{...super.vertex(c,h),...a(this,
c)}}fragment(c){const h=b(c,this.mosaicInfo);return this.getFragmentOutput(h,c,new e.Float(0))}}r.__decorate([p.uniform(d.MosaicInfo)],q.prototype,"mosaicInfo",void 0);r.__decorate([p.uniform(l.LocalTileOffset)],q.prototype,"localTileOffset",void 0);r.__decorate([r.__param(0,p.input(f)),r.__param(1,p.input(n.BaseHittestVertexInput))],q.prototype,"vertex",null);r.__decorate([r.__param(0,p.input(g))],q.prototype,"fragment",null);k.PatternFillFragmentInput=g;k.PatternFillShader=q;k.PatternFillVertexInput=
f;k.getPatternFillFragmentColor=b;k.getPatternFillVertexData=a;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/FillTechnique":function(){define(["exports","../FeatureTechnique","../featureTechniqueUtils","../TechniqueType","../shaders/FillShader"],function(k,r,p,e,n){class m extends r.FeatureTechnique{constructor(){super(...arguments);this.type=e.TechniqueType.Fill;this.shaders={geometry:new n.FillShader}}render(l,d){const {painter:a}=
l,b=d.instance.getInput();a.setShader({shader:this.shaders.geometry,uniforms:{...p.resolveDynamicUniforms(l,d.target,b.uniforms),...p.getFeatureUniforms(l,d.target)},defines:p.getSelectionDefines(l),optionalAttributes:b.optionalAttributes,useComputeBuffer:p.isHittest(l)});a.setPipelineState(p.getFeaturePipelineState(l));a.submitDraw(l,d)}}k.FillTechnique=m;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/GradientFillTechnique":function(){define("exports ../../../enums ../FeatureTechnique ../featureTechniqueUtils ../TechniqueType ../shaders/GradientFillShader".split(" "),
function(k,r,p,e,n,m){class l extends p.FeatureTechnique{constructor(){super(...arguments);this.type=n.TechniqueType.GradientFill;this.shaders={geometry:new m.GradientFillShader};this.symbologyPlane=r.FeatureSymbologyDrawOrder.FILL}render(d,a){const {context:b,painter:f}=d,g=a.instance.getInput();f.setShader({shader:this.shaders.geometry,uniforms:{...e.resolveDynamicUniforms(d,a.target,g.uniforms),...e.getFeatureUniforms(d,a.target),mosaicInfo:f.textureManager.getMosaicInfo(b,a.textureKey)},defines:{...e.getSelectionDefines(d)},
optionalAttributes:g.optionalAttributes,useComputeBuffer:e.isHittest(d)});f.setPipelineState(e.getFeaturePipelineState(d));f.submitDraw(d,a)}}k.GradientFillTechnique=l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/GradientFillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ../fill/gradientFillConstants ./AFeatureShader ./FillShader ./MosaicInfo ./utils".split(" "),
function(k,r,p,e,n,m,l,d,a){class b extends l.FillVertexInput{}r.__decorate([p.location(5,e.Vec4)],b.prototype,"tlbr",void 0);r.__decorate([p.location(6,e.Vec2)],b.prototype,"relativePosition",void 0);r.__decorate([p.location(7,e.Float)],b.prototype,"gradientMethod",void 0);r.__decorate([p.location(8,e.Vec2)],b.prototype,"relativeGradientSize",void 0);class f extends m.FeatureFragmentInput{}class g extends l.FillShader{constructor(){super(...arguments);this.type="GradientFillShader"}vertex(q,c){const {tlbr:h,
relativePosition:u,gradientMethod:A,relativeGradientSize:z}=q,t=e.ifElse(a.getBitBool(q.bitset,n.bitset.isAbsolute),this.view.displayZoomFactor,new e.Float(1));return{...super.vertex(q,c),tlbr:h,relativePosition:u,gradientMethod:A,gradientSize:z.multiply(t),isDiscrete:a.getBit(q.bitset,n.bitset.isDiscrete)}}fragment(q){const {tlbr:c,relativePosition:h,gradientMethod:u,gradientSize:A,isDiscrete:z}=q,t=e.ifElse(e.greaterThan(z,new e.Float(.5)),A.subtract(1),new e.Vec2(0));var w=e.cond([e.equal(u,new e.Float(n.gradientFillMethods.rectangular)),
()=>{const x=e.abs(h).add(t).divide(A);return a.oneMinus(e.max(x.x,x.y))}],[e.equal(u,new e.Float(n.gradientFillMethods.circular)),a.oneMinus(e.sqrt(e.dot(h,h)).add(t.x).divide(A.x))],[!0,a.oneMinus(h.x.add(t.x).divide(A.x))]);w=new e.Vec2(e.clamp(w,new e.Float(0),new e.Float(1)),.5);w=e.mix(c.xy,c.zw,w).divide(this.mosaicInfo.size);w=e.texture2D(this.mosaicInfo.texture,w);return this.getFragmentOutput(w.multiply(q.color.a),q,new e.Float(0))}}r.__decorate([p.uniform(d.MosaicInfo)],g.prototype,"mosaicInfo",
void 0);r.__decorate([r.__param(0,p.input(b)),r.__param(1,p.input(m.BaseHittestVertexInput))],g.prototype,"vertex",null);r.__decorate([r.__param(0,p.input(f))],g.prototype,"fragment",null);k.GradientFillFragmentInput=f;k.GradientFillShader=g;k.GradientFillVertexInput=b;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/gradientFillConstants":function(){define(["exports"],function(k){k.bitset={isAbsolute:0,isDiscrete:1};k.gradientFillMethods=
{linear:0,rectangular:1,circular:2};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/OutlineFillTechnique":function(){define("exports ../FeatureTechnique ../featureTechniqueUtils ../TechniqueType ../line/utils ../shaders/OutlineFillShader".split(" "),function(k,r,p,e,n,m){class l extends r.FeatureTechnique{constructor(){super(...arguments);this.type=e.TechniqueType.OutlineFill;this.shaders={geometry:new m.OutlineFillShader}}render(d,
a){const {painter:b,pixelRatio:f}=d,g=a.instance.getInput();b.setShader({shader:this.shaders.geometry,uniforms:{...p.resolveDynamicUniforms(d,a.target,g.uniforms),...p.getFeatureUniforms(d,a.target),antialiasingControls:n.getAntialiasingControls(f)},defines:{...p.getSelectionDefines(d)},optionalAttributes:g.optionalAttributes,useComputeBuffer:p.isHittest(d)});b.setPipelineState(p.getFeaturePipelineState(d));b.submitDraw(d,a)}}k.OutlineFillTechnique=l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/PatternFillTechnique":function(){define(["exports","../FeatureTechnique","../featureTechniqueUtils","../TechniqueType","../shaders/PatternFillShader"],function(k,r,p,e,n){class m extends r.FeatureTechnique{constructor(){super(...arguments);this.type=e.TechniqueType.PatternFill;this.shaders={geometry:new n.PatternFillShader}}render(l,d){const {context:a,painter:b}=l,f=d.instance.getInput();b.setShader({shader:this.shaders.geometry,uniforms:{...p.resolveDynamicUniforms(l,
d.target,f.uniforms),...p.getFeatureUniforms(l,d.target),mosaicInfo:b.textureManager.getMosaicInfo(a,d.textureKey),localTileOffset:p.getLocalTileOffset(d.target)},defines:{...p.getSelectionDefines(l)},optionalAttributes:f.optionalAttributes,useComputeBuffer:p.isHittest(l)});b.setPipelineState(p.getFeaturePipelineState(l));b.submitDraw(l,d)}}k.PatternFillTechnique=m;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/PatternOutlineFillTechnique":function(){define("exports ../FeatureTechnique ../featureTechniqueUtils ../TechniqueType ../line/utils ../shaders/PatternOutlineFillShader".split(" "),
function(k,r,p,e,n,m){class l extends r.FeatureTechnique{constructor(){super(...arguments);this.type=e.TechniqueType.PatternOutlineFill;this.shaders={geometry:new m.PatternOutlineFillShader}}render(d,a){const {context:b,painter:f,pixelRatio:g}=d,q=a.instance.getInput();f.setShader({shader:this.shaders.geometry,uniforms:{...p.resolveDynamicUniforms(d,a.target,q.uniforms),...p.getFeatureUniforms(d,a.target),antialiasingControls:n.getAntialiasingControls(g),mosaicInfo:f.textureManager.getMosaicInfo(b,
a.textureKey),localTileOffset:p.getLocalTileOffset(a.target)},defines:{...p.getSelectionDefines(d)},optionalAttributes:q.optionalAttributes,useComputeBuffer:p.isHittest(d)});f.setPipelineState(p.getFeaturePipelineState(d));f.submitDraw(d,a)}}k.PatternOutlineFillTechnique=l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/heatmap/HeatmapTechnique":function(){define("exports ../../../enums ../FeatureTechnique ../featureTechniqueUtils ../TechniqueType ./HeatmapResources ../shaders/HeatmapAccumulateShader ../shaders/HeatmapResolveShader ../../../../../../webgl/enums".split(" "),
function(k,r,p,e,n,m,l,d,a){function b(u){return u.key.level+1}function f(u,A){const {referenceScale:z,radius:t}=u.uniforms;return t*(0!==z?z/A.scale:1)}class g extends p.FeatureTechnique{constructor(){super(...arguments);this.type=n.TechniqueType.Heatmap;this.drawPhase=r.WGLDrawPhase.MAP|r.WGLDrawPhase.HITTEST|r.WGLDrawPhase.DEBUG;this.shaders={accumulate:new l.HeatmapAccumulateShader,resolve:new d.HeatmapResolveShader};this._isBound=!1;this._resources=new Map}shutdown(u){super.shutdown(u);this._resources.get(u)?.destroy();
this._resources.delete(u);this._prevFBO=null;this._unbind()}render(u,A){const {context:z,painter:t,state:w}=u;var x=A.instance.getInput();const {isFieldActive:B}=x.uniforms,C=this._getOrCreateResourcesRecord(z),y=C.loadQualityProfile(z);e.isHittest(u)||this._bind(u,C,x);t.setShader({shader:this.shaders.accumulate,uniforms:{...e.getFeatureUniforms(u,A.target),kernelControls:{radius:f(x,w),isFieldActive:B?1:0}},defines:{...e.getSelectionDefines(u),...y.defines},optionalAttributes:{},useComputeBuffer:e.isHittest(u)});
x=e.isHittest(u)?c:q;t.setPipelineState(x);t.submitDraw(u,A)}getStencilReference(u){return b(u)}renderResolvePass(u,A){if(!e.isHittest(u)){var {context:z,painter:t}=u,w=this._resources.get(z);if(null!=this._prevFBO&&null!=this._prevViewport&&w?.initialized){({defines:u}=w.loadQualityProfile(z));var {minDensity:x,maxDensity:B,radius:C}=A.getInput().uniforms;A=w.accumulateFramebuffer;w=w.resolveGradientTexture;u={shader:this.shaders.resolve,uniforms:{accumulatedDensity:{texture:{unit:8,texture:A.colorTexture},
minAndInvRange:[x,1/(B-x)],normalization:3/(C*C*Math.PI)},gradient:{texture:{unit:9,texture:w}}},defines:u,optionalAttributes:{},useComputeBuffer:!1};z.bindFramebuffer(this._prevFBO);z.setViewport(0,0,this._prevViewport.width,this._prevViewport.height);z.bindTexture(A.colorTexture,8);z.bindTexture(w,9);t.setPipelineState(h);t.submitDrawMesh(z,u,t.quadMesh);this._unbind()}}}_getOrCreateResourcesRecord(u){let A=this._resources.get(u);null==A&&(A=new m.HeatmapResources,this._resources.set(u,A));return A}_unbind(){this._prevViewport=
this._prevFBO=null;this._isBound=!1}_bind(u,A,z){if(!this._isBound){var {context:t,state:w,pixelRatio:x}=u;u=t.getBoundFramebufferObject();var B=t.getViewport();this._prevFBO=u;this._prevViewport=B;var {gradient:C,gradientHash:y}=z.uniforms;A.ensureResolveGradientTexture(t,y,C);var {width:v,height:F}=B;z=f(z,w);B=1.5<x?.25:.5;z=z<1/(2*B)?1:B;A=A.ensureAccumulateFBO(t,v*z,F*z);t.blitFramebuffer(u,A,0,0,u.width,u.height,0,0,A.width,A.height,a.FramebufferBit.STENCIL,a.TextureSamplingMode.NEAREST);t.bindFramebuffer(A);
t.setViewport(0,0,A.width,A.height);t.setColorMask(!0,!0,!0,!0);t.setClearColor(0,0,0,0);t.clear(a.FramebufferBit.COLOR);this._isBound=!0}}}const q={color:{write:[!0,!0,!0,!0],blendMode:"additive"},depth:!1,stencil:{write:!1,test:{ref:b,compare:a.CompareFunction.GEQUAL,mask:255,op:{fail:a.StencilOperation.KEEP,zFail:a.StencilOperation.KEEP,zPass:a.StencilOperation.REPLACE}}}},c={...q,stencil:!1},h={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1};k.HeatmapTechnique=g;Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/heatmap/HeatmapResources":function(){define("exports ../../../../../../../core/Logger ../../../../../../../core/maybe ../../../../../../webgl/enums ../../../../../../webgl/FramebufferObject ../../../../../../webgl/heatmapTextureUtils ../../../../../../webgl/RenderbufferDescriptor ../../../../../../webgl/Texture ../../../../../../webgl/TextureDescriptor".split(" "),function(k,r,p,e,n,m,l,d,a){class b{destroy(){this._accumulateFramebuffer=
p.disposeMaybe(this._accumulateFramebuffer);this._resolveGradientTexture=p.disposeMaybe(this._resolveGradientTexture);this._qualityProfile=this._prevGradientHash=null}get initialized(){return null!=this._accumulateFramebuffer&&null!=this._resolveGradientTexture}get accumulateFramebuffer(){return this._accumulateFramebuffer}get resolveGradientTexture(){return this._resolveGradientTexture}loadQualityProfile(f){null==this._qualityProfile&&(f=m.loadHeatmapTextureConfiguration(f,r.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.heatmap.HeatmapResources")),
this._qualityProfile={...f,defines:{usesHalfFloatPrecision:f.dataType!==e.PixelType.FLOAT}});return this._qualityProfile}ensureAccumulateFBO(f,g,q){if(null==this._accumulateFramebuffer){const {dataType:c,samplingMode:h,pixelFormat:u,internalFormat:A}=this.loadQualityProfile(f),z=new a.TextureDescriptor(g,q);z.pixelFormat=u;z.internalFormat=A;z.dataType=c;z.samplingMode=h;z.wrapMode=e.TextureWrapMode.CLAMP_TO_EDGE;g=new l.RenderbufferDescriptor(e.RenderbufferFormat.DEPTH_STENCIL,g,q);this._accumulateFramebuffer=
new n.FramebufferObject(f,z,g)}else{const {width:c,height:h}=this._accumulateFramebuffer;c===g&&h===q||this._accumulateFramebuffer.resize(g,q)}return this._accumulateFramebuffer}ensureResolveGradientTexture(f,g,q){if(null==this._resolveGradientTexture){const c=new a.TextureDescriptor;c.wrapMode=e.TextureWrapMode.CLAMP_TO_EDGE;this._resolveGradientTexture=new d.Texture(f,c);this._prevGradientHash=null}this._prevGradientHash!==g&&(this._resolveGradientTexture.resize(q.length/4,1),this._resolveGradientTexture.setData(q),
this._prevGradientHash=g);return this._resolveGradientTexture}}k.HeatmapResources=b;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/heatmapTextureUtils":function(){define(["exports","../../core/Error","./enums"],function(k,r,p){class e{constructor(m,l,d,a){this.dataType=m;this.samplingMode=l;this.pixelFormat=d;this.internalFormat=a}}const n=new e(p.PixelType.HALF_FLOAT,p.TextureSamplingMode.NEAREST,p.PixelFormat.RGBA,p.PixelFormat.RGBA);k.HeatmapTextureConfiguration=
e;k.fallBackHeatmapConfiguration=n;k.loadHeatmapTextureConfiguration=function(m,l){const {textureFloatLinear:d,colorBufferFloat:a}=m.capabilities,b=a?.textureFloat,f=a?.textureHalfFloat,g=a?.floatBlend;m=m.driverTest.floatBufferBlend.result;if(!b&&!f)throw new r("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL extension EXT_color_buffer_float or EXT_color_buffer_half_float or WEBGL_color_buffer_float.");if(!(g&&m||f))throw new r("heatmap:missing-float-blend",`HeatmapRenderer requires the WebGL extension EXT_float_blend or EXT_color_buffer_half_float.${m?
"":" This device claims support for EXT_float_blend, but does not actually support it."}`);const q=!!a?.R32F,c=!!a?.R16F;if(b&&g&&m&&d)return d||l.warnOnce("Missing WebGL extension OES_texture_float_linear. Heatmap quality may be reduced."),new e(p.PixelType.FLOAT,d?p.TextureSamplingMode.LINEAR:p.TextureSamplingMode.NEAREST,q?p.PixelFormat.RED:p.PixelFormat.RGBA,q?p.SizedPixelFormat.R32F:p.PixelFormat.RGBA);if(f)return new e(p.PixelType.HALF_FLOAT,p.TextureSamplingMode.LINEAR,c?p.PixelFormat.RED:
p.PixelFormat.RGBA,c?p.SizedPixelFormat.R16F:p.PixelFormat.RGBA);throw new r("heatmap:missing-hardware-support","HeatmapRenderer requires WebGL extensions that allow it to render and blend to float or half float textures.");};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/HeatmapAccumulateShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./heatmapUtils ./hittestUtils".split(" "),
function(k,r,p,e,n,m,l){class d extends n.FeatureVertexInput{}r.__decorate([p.location(5,e.Vec2)],d.prototype,"offset",void 0);class a extends n.FeatureFragmentInput{}class b extends p.UniformGroup{}r.__decorate([p.uniform(e.Float)],b.prototype,"radius",void 0);r.__decorate([p.uniform(e.Float)],b.prototype,"isFieldActive",void 0);class f extends n.AFeatureShader{constructor(){super(...arguments);this.type="HeatmapAccumulateShader";this.usesHalfFloatPrecision=!1}vertex(g){const {radius:q,isFieldActive:c}=
this.kernelControls,h=g.offset,u=c.multiply(this.storage.getVVData(g.id).x).add((new e.Float(1)).subtract(c)),A=this.view.displayViewScreenMat3.multiply(new e.Vec3(g.pos,1)).add(this.view.displayViewMat3.multiply(new e.Vec3(h,0)).multiply(q)),z=this.clip(g.id);return{glPosition:new e.Vec4(A.xy,z,1),offset:h,fieldValue:u,color:new e.Vec4(0),...this.maybeRunHittest(g,{},null)}}fragment(g){const {offset:q,fieldValue:c}=g;var h=e.length(q),u=e.step(h,new e.Float(1));h=(new e.Float(1)).subtract(h.multiply(h));
h=h.multiply(h);u=u.multiply(h).multiply(c).multiply(new e.Float(m.getHeatmapCompressionFactor(this.usesHalfFloatPrecision)));return this.getFragmentOutput(new e.Vec4(u),g)}hittest(g){const {viewMat3:q,tileMat3:c}=this.view;g=q.multiply(c).multiply(new e.Vec3(g.pos,1));return l.hittestMarker(g.xy,this.kernelControls.radius,this.hittestRequest.position)}}r.__decorate([p.define],f.prototype,"usesHalfFloatPrecision",void 0);r.__decorate([p.uniform(b)],f.prototype,"kernelControls",void 0);r.__decorate([r.__param(0,
p.input(d))],f.prototype,"vertex",null);r.__decorate([r.__param(0,p.input(a))],f.prototype,"fragment",null);k.HeatmapAccumulateFragmentInput=a;k.HeatmapAccumulateShader=f;k.HeatmapAccumulateVertexInput=d;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/heatmapUtils":function(){define(["exports"],function(k){k.getHeatmapCompressionFactor=function(r){return r?.25:1};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/HeatmapResolveShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./heatmapUtils"],function(k,r,p,e,n){class m extends p.VertexInput{}r.__decorate([p.location(0,e.Vec2)],m.prototype,"position",void 0);class l extends p.FragmentInput{}class d extends p.UniformGroup{}r.__decorate([p.uniform(e.Sampler2D)],d.prototype,"texture",void 0);r.__decorate([p.uniform(e.Vec2)],d.prototype,
"minAndInvRange",void 0);r.__decorate([p.uniform(e.Float)],d.prototype,"normalization",void 0);class a extends p.UniformGroup{}r.__decorate([p.uniform(e.Sampler2D)],a.prototype,"texture",void 0);class b extends p.GraphShaderModule{constructor(){super(...arguments);this.type="HeatmapResolveShader";this.usesHalfFloatPrecision=!1}vertex(f){return{glPosition:new e.Vec4(f.position.multiply(2).subtract(1),1,1),uv:f.position}}fragment(f){const {accumulatedDensity:g,gradient:q}=this;f=e.texture2D(g.texture,
f.uv).r.divide(new e.Float(n.getHeatmapCompressionFactor(this.usesHalfFloatPrecision)));f=f.multiply(g.normalization);f=f.subtract(g.minAndInvRange.x).multiply(g.minAndInvRange.y);f=e.texture2D(q.texture,new e.Vec2(f,.5));const c=new p.FragmentOutput;c.fragColor=new e.Vec4(f.rgb.multiply(f.a),f.a);return c}}r.__decorate([p.define],b.prototype,"usesHalfFloatPrecision",void 0);r.__decorate([p.uniform(d)],b.prototype,"accumulatedDensity",void 0);r.__decorate([p.uniform(a)],b.prototype,"gradient",void 0);
r.__decorate([r.__param(0,p.input(m))],b.prototype,"vertex",null);r.__decorate([r.__param(0,p.input(l))],b.prototype,"fragment",null);k.AccumulatedDensity=d;k.Gradient=a;k.HeatmapResolveFragmentInput=l;k.HeatmapResolveShader=b;k.HeatmapResolveVertexInput=m;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/labels/LabelTechnique":function(){define("exports ../../../enums ../FeatureTechnique ../featureTechniqueUtils ../TechniqueType ../text/TextShader".split(" "),
function(k,r,p,e,n,m){class l extends p.FeatureTechnique{constructor(){super(...arguments);this.type=n.TechniqueType.Label;this.shaders={geometry:new m.TextShader};this.drawPhase=r.WGLDrawPhase.LABEL|r.WGLDrawPhase.LABEL_ALPHA|r.WGLDrawPhase.HITTEST;this.symbologyPlane=r.FeatureSymbologyDrawOrder.TEXT}render(d,a){const {context:b,painter:f}=d,g=e.getSelectionDefines(d),q={...e.getFeaturePipelineState(d)};var c=a.instance.getInput();c={shader:this.shaders.geometry,uniforms:{...e.resolveDynamicUniforms(d,
a.target,c.uniforms),...e.getFeatureUniforms(d,a.target),mosaicInfo:f.textureManager.getMosaicInfo(b,a.textureKey)},defines:{...g,textRenderPassType:m.TextRenderPassType.Color,isBackgroundPass:!0,isLabel:!0},optionalAttributes:c.optionalAttributes,useComputeBuffer:e.isHittest(d)};f.setPipelineState(q);f.setShader(c);f.submitDraw(d,a);f.setShader({...c,defines:{...g,textRenderPassType:m.TextRenderPassType.Halo,isBackgroundPass:!1,isLabel:!0}});f.submitDraw(d,a);f.setShader({...c,defines:{...g,textRenderPassType:m.TextRenderPassType.Color,
isBackgroundPass:!1,isLabel:!0}});f.submitDraw(d,a)}}k.LabelTechnique=l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/text/TextShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../../definitions ../../GraphShaderModule ../../graph/glsl ../shaders/AFeatureShader ../shaders/constants ../shaders/hittestUtils ../shaders/MosaicInfo ../shaders/utils ../shaders/VisualVariableColor ../shaders/VisualVariableOpacity ../shaders/VisualVariableRotation ../shaders/VisualVariableSizeMinMaxValue ../shaders/VisualVariableSizeScaleStops ../shaders/VisualVariableSizeStops ../shaders/VisualVariableSizeUnitValue ../shaders/vvUtils".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g,q,c,h,u,A,z){const t=360/254;k.TextRenderPassType=void 0;(function(y){y[y.Color=0]="Color";y[y.Outline=1]="Outline";y[y.Halo=2]="Halo"})(k.TextRenderPassType||(k.TextRenderPassType={}));class w extends m.FeatureVertexInput{}r.__decorate([e.location(3,n.Vec4)],w.prototype,"color",void 0);r.__decorate([e.location(4,n.Vec2)],w.prototype,"offset",void 0);r.__decorate([e.location(5,n.Vec2)],w.prototype,"textureUV",void 0);r.__decorate([e.location(6,n.Float)],w.prototype,
"fontSize",void 0);r.__decorate([e.location(7,n.Float)],w.prototype,"referenceSize",void 0);r.__decorate([e.location(8,n.Vec4)],w.prototype,"outlineColor",void 0);r.__decorate([e.location(9,n.Vec4)],w.prototype,"haloColor",void 0);r.__decorate([e.location(10,n.Vec2)],w.prototype,"outlineAndHaloSize",void 0);r.__decorate([e.location(11,n.Vec2)],w.prototype,"zoomRange",void 0);r.__decorate([e.location(12,n.Float)],w.prototype,"clipAngle",void 0);r.__decorate([e.location(13,n.Vec4)],w.prototype,"referenceSymbol",
void 0);class x extends e.ComputeVertexInput{}r.__decorate([e.location(14,n.Vec2)],x.prototype,"offsetNextVertex1",void 0);r.__decorate([e.location(15,n.Vec2)],x.prototype,"offsetNextVertex2",void 0);class B extends m.FeatureFragmentInput{}class C extends m.AFeatureShader{constructor(){super(...arguments);this.type="TextShader";this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"]};this.textRenderPassType=k.TextRenderPassType.Color;this.isLabel=this.isBackgroundPass=!1}clipLabel(y,
v,F){v=v.multiply(t);v=n.abs(this.view.rotation.subtract(v));var D=n.min((new n.Float(360)).subtract(v),v);v=new n.Float(0);const G=n.floor(this.view.currentZoom.multiply(p.minMaxZoomPrecisionFactor)).divide(p.minMaxZoomPrecisionFactor);var E=y.x;y=y.y;E=(new n.Float(1)).subtract(n.step(E,G)).multiply(2);D=n.step(new n.Float(90),D).multiply(2);y=(new n.Float(2)).multiply((new n.Float(1)).subtract(n.step(G,y)));v=v.add(F.multiply(E));v=v.add(F.multiply(D));return v=v.add(y)}vertex(y,v){var F=b.getBit(y.bitset,
l.bitsetTextIsBackground),D=(new n.Float(1)).subtract(F),G=y.fontSize;let E=G.divide(l.sdfFontSize);var H=this.textRenderPassType===k.TextRenderPassType.Outline?y.outlineColor:this.textRenderPassType===k.TextRenderPassType.Halo?y.haloColor:this._getVertexColor(y),K=this.isLabel?this.storage.getLabelVisibility(y.id):new n.Float(1);H=this.isLabel?H.multiply(K):H;var J=this.view.displayViewScreenMat3.multiply(new n.Vec3(y.pos,1)),L=y.offset;let P=new n.Float(1),Q=n.Mat3.identity();var S=new n.Vec2(0);
if(this.isLabel){if(!y.referenceSymbol)throw Error("InternalError: Optional attribute 'referenceSymbol' expected for labels");var U=y.referenceSymbol;S=U.xy;var X=U.z;U=this._unpackDirection(U.w);X=z.getVisualVariableSize(this,y.id,X).divide(2);X=U.multiply(X.add(p.labelPlacementOffsetPadding));S=S.add(X);L=L.add(S)}else P=z.getVisualVariableSize(this,y.id,y.referenceSize).divide(y.referenceSize),G=G.multiply(P),E=E.multiply(P),L=L.multiply(P),Q=z.getVisualVariableRotation(this,y.id),L=Q.multiply(new n.Vec3(L,
0)).xy;X=b.getBit(y.bitset,l.bitsetTextIsMapAligned);L=this._getViewRotationMatrix(X).multiply(new n.Vec3(L,0));X=this.isLabel?this.clipLabel(y.zoomRange,y.clipAngle,X):this.clip(y.id,y.zoomRange);X=this.isBackgroundPass?X.add(D.multiply(2)):X.add(F.multiply(2));F=new n.Float(0);this.textRenderPassType===k.TextRenderPassType.Outline&&(X=X.add(n.ifElse(n.equal(y.outlineAndHaloSize.x,new n.Float(0)),new n.Float(2),new n.Float(0))),F=(new n.Float(y.outlineAndHaloSize.x)).divide(E).divide(l.maxSdfDistance));
this.textRenderPassType===k.TextRenderPassType.Halo&&(F=y.outlineAndHaloSize.x,D=new n.Float(y.outlineAndHaloSize.y),X=X.add(n.ifElse(n.equal(D,new n.Float(0)),new n.Float(2),new n.Float(0))),F=D.add(F).divide(E).divide(l.maxSdfDistance));K=this.isLabel?n.or(n.greaterThan(X,new n.Float(1)),n.lessThanEqual(K,new n.Float(0))):new n.Bool(!1);J=new n.Vec4(J.xy.add(L.xy),X,1);D=y.textureUV.divide(this.mosaicInfo.size);G=(new n.Float(.105*l.sdfFontSize)).divide(G).divide(this.view.pixelRatio);return{glPosition:J,
color:H,size:E,textureUV:D,antialiasingWidth:G,outlineDistanceOffset:F,...this.maybeRunHittest(y,v,{vvSizeAdjustment:P,vvRotation:Q,labelOffset:S,labelClipped:K})}}_getViewRotationMatrix(y){const v=this.view.displayViewMat3,F=this.view.displayMat3,D=(new n.Float(1)).subtract(y);return v.multiply(y).add(F.multiply(D))}fragment(y){var v=new n.Float(.25),F=(new n.Float(1)).subtract(v);v=n.texture2D(this.mosaicInfo.texture,y.textureUV).a;F=F.subtract(y.outlineDistanceOffset);this.highlight&&(F=F.divide(2));
const D=y.antialiasingWidth;v=n.smoothstep(F.subtract(D),F.add(D),v);return this.getFragmentOutput(y.color.multiply(v),y)}hittest(y,v,{vvSizeAdjustment:F,vvRotation:D,labelOffset:G,labelClipped:E}){if(this.isLabel){var H=new n.Vec3(y.offset.add(G),0);var K=new n.Vec3(v.offsetNextVertex1.add(G),0);v=new n.Vec3(v.offsetNextVertex2.add(G),0)}else H=D.multiply(new n.Vec3(y.offset.multiply(F),0)),K=D.multiply(new n.Vec3(v.offsetNextVertex1.multiply(F),0)),v=D.multiply(new n.Vec3(v.offsetNextVertex2.multiply(F),
0));const {viewMat3:J,tileMat3:L}=this.view;y=J.multiply(L).multiply(new n.Vec3(y.pos,1));H=y.add(L.multiply(H)).xy;K=y.add(L.multiply(K)).xy;y=y.add(L.multiply(v)).xy;K=d.distPointTriangle(this.hittestRequest.position,H.xy,K.xy,y.xy);return this.isLabel?n.ifElse(E,d.failHittest(this.hittestRequest),K):K}_unpackDirection(y){var v=new n.Int(y);y=n.bitRShift(v,new n.Int(2));v=n.bitAnd(v,new n.Int(3));return new n.Vec2((new n.Float(y)).subtract(1),(new n.Float(v)).subtract(1))}_getVertexColor(y){var v=
y.color;this.visualVariableColor&&(v=this.storage.getColorValue(y.id),v=this.visualVariableColor.getColor(v,y.color,new n.Bool(!1)));this.visualVariableOpacity&&(y=this.storage.getOpacityValue(y.id),y=this.visualVariableOpacity.getOpacity(y),v=v.multiply(y));return v}}r.__decorate([e.option(f.VisualVariableColor)],C.prototype,"visualVariableColor",void 0);r.__decorate([e.option(g.VisualVariableOpacity)],C.prototype,"visualVariableOpacity",void 0);r.__decorate([e.option(q.VisualVariableRotation)],
C.prototype,"visualVariableRotation",void 0);r.__decorate([e.option(c.VisualVariableSizeMinMaxValue)],C.prototype,"visualVariableSizeMinMaxValue",void 0);r.__decorate([e.option(h.VisualVariableSizeScaleStops)],C.prototype,"visualVariableSizeScaleStops",void 0);r.__decorate([e.option(u.VisualVariableSizeStops)],C.prototype,"visualVariableSizeStops",void 0);r.__decorate([e.option(A.VisualVariableSizeUnitValue)],C.prototype,"visualVariableSizeUnitValue",void 0);r.__decorate([e.uniform(a.MosaicInfo)],
C.prototype,"mosaicInfo",void 0);r.__decorate([e.define],C.prototype,"textRenderPassType",void 0);r.__decorate([e.define],C.prototype,"isBackgroundPass",void 0);r.__decorate([e.define],C.prototype,"isLabel",void 0);r.__decorate([r.__param(0,e.input(w)),r.__param(1,e.input(x))],C.prototype,"vertex",null);r.__decorate([r.__param(0,e.input(B))],C.prototype,"fragment",null);k.TextFragmentInput=B;k.TextShader=C;k.TextVertexInput=w;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/GradientStrokeTechnique":function(){define("exports ../../../enums ../FeatureTechnique ../featureTechniqueUtils ../TechniqueType ./utils ../shaders/GradientStrokeShader ../../../../../../webgl/enums".split(" "),
function(k,r,p,e,n,m,l,d){class a extends p.FeatureTechnique{constructor(){super(...arguments);this.type=n.TechniqueType.GradientStroke;this.shaders={geometry:new l.GradientStrokeShader};this.symbologyPlane=r.FeatureSymbologyDrawOrder.LINE}_getShaderOptions(b,f,g){const {context:q,painter:c,pixelRatio:h}=b,u=f.instance.getInput();return{shader:this.shaders.geometry,uniforms:{...e.resolveDynamicUniforms(b,f.target,u.uniforms),...e.getFeatureUniforms(b,f.target),antialiasingControls:m.getAntialiasingControls(h),
mosaicInfo:c.textureManager.getMosaicInfo(q,f.textureKey),technique:{isColorPass:g}},defines:{...e.getSelectionDefines(b)},optionalAttributes:u.optionalAttributes,useComputeBuffer:e.isHittest(b)}}render(b,f){const {painter:g}=b;if(e.isHittest(b)||e.isHighlight(b)){var q=e.getFeaturePipelineState(b);g.setPipelineState(q);g.setShader(this._getShaderOptions(b,f,1))}else b.context.setClearDepth(1),b.context.clear(d.FramebufferBit.DEPTH),q={color:!1,depth:{write:{zNear:0,zFar:1},test:d.CompareFunction.LESS},
stencil:{write:!1,test:{ref:c=>c.stencilRef,compare:d.CompareFunction.EQUAL,mask:255,op:{fail:d.StencilOperation.KEEP,zFail:d.StencilOperation.KEEP,zPass:d.StencilOperation.KEEP}}}},g.setShader(this._getShaderOptions(b,f,0)),g.setPipelineState(q),g.submitDraw(b,f),q={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:{write:!1,test:d.CompareFunction.LEQUAL},stencil:{write:!1,test:{ref:c=>c.stencilRef,compare:d.CompareFunction.EQUAL,mask:255,op:{fail:d.StencilOperation.KEEP,zFail:d.StencilOperation.KEEP,
zPass:d.StencilOperation.KEEP}}}},g.setShader(this._getShaderOptions(b,f,1)),g.setPipelineState(q);g.submitDraw(b,f)}}k.GradientStrokeTechnique=a;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/GradientStrokeShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../../../../../../core/has ../../GraphShaderModule ../../graph/glsl ../line/gradientStrokeConstants ./AFeatureShader ./LineShader ./MosaicInfo ./utils".split(" "),
function(k,r,p,e,n,m,l,d,a,b){class f extends d.LineVertexInput{}r.__decorate([e.location(9,n.Float)],f.prototype,"accumulatedDistance",void 0);r.__decorate([e.location(10,n.Float)],f.prototype,"totalLength",void 0);r.__decorate([e.location(11,n.Float)],f.prototype,"gradientSize",void 0);r.__decorate([e.location(12,n.Vec2)],f.prototype,"segmentDirection",void 0);r.__decorate([e.location(13,n.Vec4)],f.prototype,"tlbr",void 0);class g extends d.LineFragmentInput{}class q extends e.UniformGroup{}r.__decorate([e.uniform(n.Float)],
q.prototype,"isColorPass",void 0);class c extends d.LineShader{constructor(){super(...arguments);this.type="GradientStrokeShader"}vertex(h,u){const {totalLength:A,gradientSize:z,segmentDirection:t,tlbr:w}=h,x=d.getLineVertexData(this,h),B=b.getBit(h.bitset,m.bitset.isAlongLine),C=A.divide(this.view.displayZoomFactor),y=n.ifElse(b.getBitBool(h.bitset,m.bitset.isAbsoluteSize),()=>{const D=n.ifElse(n.greaterThan(B,new n.Float(.5)),C,x.halfWidth);return z.divide(D)},z),v=h.accumulatedDistance.divide(this.view.displayZoomFactor).add(n.dot(t,
x.scaledOffset)).divide(C),F=w.divide(this.mosaicInfo.size.xyxy);return{...x,tlbr:F,relativePositionAlongLine:v,relativeGradientSize:y,isAlongLine:b.getBit(h.bitset,m.bitset.isAlongLine),isDiscrete:b.getBit(h.bitset,m.bitset.isDiscrete),...this.maybeRunHittest(h,u,x.halfWidth)}}fragment(h){const {isAlongLine:u,isDiscrete:A,relativePositionAlongLine:z,relativeGradientSize:t,normal:w,tlbr:x}=h;var B=d.getLineAntialiasing(h,this.antialiasingControls.blur),C=(new n.Float(.5)).multiply(w.y).add(new n.Float(.5));
C=n.ifElse(n.greaterThan(u,new n.Float(.5)),z,C);const y=n.ifElse(n.greaterThan(A,new n.Float(.5)),t.subtract(1),new n.Float(0));C=b.oneMinus(C.add(y).divide(t));C=n.mix(x.xy,x.zw,new n.Vec2(n.clamp(C,new n.Float(0),new n.Float(1)),.5));C=n.texture2D(this.mosaicInfo.texture,C);B=h.opacity.multiply(B);h=this.getFragmentOutput(C.multiply(B),h);B=n.step(new n.Float(.5),this.technique.isColorPass).multiply(p("gradient-depth-epsilon"));B=n.step(new n.Float(0),w.y).multiply((new n.Float(p("gradient-depth-bias"))).subtract(B));
h.glFragDepth=n.clamp(n.length(w).add(B),new n.Float(0),new n.Float(1));return h}}r.__decorate([e.uniform(a.MosaicInfo)],c.prototype,"mosaicInfo",void 0);r.__decorate([e.uniform(q)],c.prototype,"technique",void 0);r.__decorate([r.__param(0,e.input(f)),r.__param(1,e.input(l.BaseHittestVertexInput))],c.prototype,"vertex",null);k.GradientStrokeFragmentInput=g;k.GradientStrokeShader=c;k.GradientStrokeVertexInput=f;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/gradientStrokeConstants":function(){define(["exports"],
function(k){k.bitset={isAlongLine:0,isAbsoluteSize:1,isDiscrete:2};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/LineTechnique":function(){define("exports ../../../enums ../FeatureTechnique ../featureTechniqueUtils ../TechniqueType ./utils ../shaders/LineShader".split(" "),function(k,r,p,e,n,m,l){class d extends p.FeatureTechnique{constructor(){super(...arguments);this.type=n.TechniqueType.Line;this.shaders={geometry:new l.LineShader};
this.symbologyPlane=r.FeatureSymbologyDrawOrder.LINE}render(a,b){const {painter:f,pixelRatio:g}=a,q=b.instance.getInput();f.setShader({shader:this.shaders.geometry,uniforms:{...e.resolveDynamicUniforms(a,b.target,q.uniforms),...e.getFeatureUniforms(a,b.target),antialiasingControls:m.getAntialiasingControls(g)},defines:{...e.getSelectionDefines(a)},optionalAttributes:q.optionalAttributes,useComputeBuffer:e.isHittest(a)});f.setPipelineState(e.getFeaturePipelineState(a));f.submitDraw(a,b)}}k.LineTechnique=
d;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/TexturedLineTechnique":function(){define("exports ../../../enums ../FeatureTechnique ../featureTechniqueUtils ../TechniqueType ./utils ../shaders/TexturedLineShader".split(" "),function(k,r,p,e,n,m,l){class d extends p.FeatureTechnique{constructor(){super(...arguments);this.type=n.TechniqueType.TexturedLine;this.shaders={geometry:new l.TexturedLineShader};this.symbologyPlane=r.FeatureSymbologyDrawOrder.LINE}render(a,
b){const {context:f,painter:g,pixelRatio:q}=a,c=b.instance.getInput();g.setShader({shader:this.shaders.geometry,uniforms:{...e.resolveDynamicUniforms(a,b.target,c.uniforms),...e.getFeatureUniforms(a,b.target),antialiasingControls:m.getAntialiasingControls(q),mosaicInfo:g.textureManager.getMosaicInfo(f,b.textureKey)},defines:{...e.getSelectionDefines(a)},optionalAttributes:c.optionalAttributes,useComputeBuffer:e.isHittest(a)});g.setPipelineState(e.getFeaturePipelineState(a));g.submitDraw(a,b)}}k.TexturedLineTechnique=
d;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/TexturedLineShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../../../../../../core/screenUtils ../../../../../../../symbols/cim/constants ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./constants ./LineShader ./MosaicInfo ./utils".split(" "),function(k,r,p,e,n,m,l,d,a,b,f){class g extends a.LineVertexInput{}r.__decorate([n.location(9,
m.Float)],g.prototype,"accumulatedDistance",void 0);r.__decorate([n.location(10,m.Vec2)],g.prototype,"segmentDirection",void 0);r.__decorate([n.location(11,m.Float)],g.prototype,"offsetAlongLine",void 0);r.__decorate([n.location(12,m.Float)],g.prototype,"capType",void 0);r.__decorate([n.location(13,m.Vec4)],g.prototype,"tlbr",void 0);class q extends a.LineFragmentInput{}class c extends a.LineShader{constructor(){super(...arguments);this.type="TexturedLineShader"}_getDistanceRatio(h,u){h=f.getBit(h.bitset,
d.bitsetLineScaleDash);return h.multiply(m.max(u,new m.Float(.25)).multiply(new m.Float(2))).add((new m.Float(1)).subtract(h).multiply(p.pt2px(1)))}_getSDFAlpha(h){const {halfWidth:u,normal:A,tlbr:z,patternSize:t,accumulatedDistance:w,offsetAlongLine:x,dashToPx:B,capType:C}=h;h=t.x.divide(e.dashSdfRasterizationScale).multiply(B);h=m.fract(w.add(x).divide(h));h=m.mix(z.xy,z.zw,new m.Vec2(h,.5));h=f.rgba2float(m.texture2D(this.mosaicInfo.texture,h)).multiply(2).subtract(1).multiply(e.dashSdfDistanceNormalization).multiply(B);
const y=A.y.multiply(u);h=m.cond([m.equal(C,new m.Float(1)),h.subtract(u)],[m.equal(C,new m.Float(2)),m.sqrt(m.pow(m.max(h,new m.Float(0)),new m.Float(2)).add(y.multiply(y))).subtract(u)],[!0,h]);h=m.clamp((new m.Float(.25)).subtract(h),new m.Float(0),new m.Float(1));return new m.Vec4(h)}_getPatternColor(h){const {halfWidth:u,normal:A,color:z,accumulatedDistance:t,patternSize:w,sampleAlphaOnly:x,tlbr:B}=h;h=w.y.multiply((new m.Float(2)).multiply(u).divide(w.x));h=m.fract(t.divide(h));const C=(new m.Float(.5)).multiply(A.y).add(new m.Float(.5));
h=m.mix(B.xy,B.zw,new m.Vec2(C,h));h=m.texture2D(this.mosaicInfo.texture,h);null!=this.visualVariableColor&&(h=m.ifElse(m.greaterThan(x,new m.Float(.5)),new m.Vec4(z.a),z));return h}vertex(h,u){const {segmentDirection:A,tlbr:z,bitset:t}=h,w=a.getLineVertexData(this,h),x=h.accumulatedDistance.divide(this.view.displayZoomFactor).add(m.dot(A,w.scaledOffset)),B=new m.Vec2(z.z.subtract(z.x),z.w.subtract(z.y)),C=z.divide(this.mosaicInfo.size.xyxy),y=f.getBit(t,d.bitsetLineIsSdf),v=f.getBit(t,d.bitsetGenericConsiderAlphaOnly),
F=m.ifElse(m.greaterThan(y,new m.Float(.5)),this._getDistanceRatio(h,w.scaledHalfWidth),new m.Float(1));return{...w,tlbr:C,patternSize:B,accumulatedDistance:x,isSDF:y,sampleAlphaOnly:v,dashToPx:F,offsetAlongLine:h.offsetAlongLine,capType:h.capType,...this.maybeRunHittest(h,u,w.halfWidth)}}fragment(h){const {color:u,opacity:A,isSDF:z}=h;var t=a.getLineAntialiasing(h,this.antialiasingControls.blur);const w=m.ifElse(m.greaterThan(z,new m.Float(.5)),this._getSDFAlpha(h),this._getPatternColor(h));t=u.multiply(A).multiply(t).multiply(w);
return this.getFragmentOutput(t,h)}}r.__decorate([n.uniform(b.MosaicInfo)],c.prototype,"mosaicInfo",void 0);r.__decorate([r.__param(0,n.input(g)),r.__param(1,n.input(l.BaseHittestVertexInput))],c.prototype,"vertex",null);k.TexturedLineFragmentInput=q;k.TexturedLineShader=c;k.TexturedLineVertexInput=g;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/markers/MarkerTechnique":function(){define("exports ../../../enums ../FeatureTechnique ../featureTechniqueUtils ../TechniqueType ./MarkerShader".split(" "),
function(k,r,p,e,n,m){class l extends p.FeatureTechnique{constructor(){super(...arguments);this.type=n.TechniqueType.Marker;this.shaders={geometry:new m.MarkerShader};this.symbologyPlane=r.FeatureSymbologyDrawOrder.MARKER}render(d,a){const {context:b,painter:f}=d,g=a.instance.getInput();f.setShader({shader:this.shaders.geometry,uniforms:{...e.resolveDynamicUniforms(d,a.target,g.uniforms),...e.getFeatureUniforms(d,a.target),mosaicInfo:f.textureManager.getMosaicInfo(b,a.textureKey,!0)},defines:{...e.getSelectionDefines(d)},
optionalAttributes:g.optionalAttributes,useComputeBuffer:e.isHittest(d)});f.setPipelineState(e.getFeaturePipelineState(d));f.submitDraw(d,a)}}k.MarkerTechnique=l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/markers/MarkerShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./markerConstants ../shaders/AFeatureShader ../shaders/constants ../shaders/hittestUtils ../shaders/MosaicInfo ../shaders/utils ../shaders/VisualVariableColor ../shaders/VisualVariableOpacity ../shaders/VisualVariableRotation ../shaders/VisualVariableSizeMinMaxValue ../shaders/VisualVariableSizeScaleStops ../shaders/VisualVariableSizeStops ../shaders/VisualVariableSizeUnitValue ../shaders/vvUtils".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g,q,c,h,u,A,z){function t(v,F,D,G){return F.multiply(v.x).add(D.multiply(v.y)).add(G.multiply(v.z))}function w(v){return v.multiply(v).divide(128)}class x extends m.FeatureVertexInput{}r.__decorate([p.location(3,e.Vec4)],x.prototype,"color",void 0);r.__decorate([p.location(4,e.Vec4)],x.prototype,"outlineColor",void 0);r.__decorate([p.location(5,e.Vec2)],x.prototype,"offset",void 0);r.__decorate([p.location(6,e.Vec2)],x.prototype,"textureUV",void 0);r.__decorate([p.location(7,
e.Vec4)],x.prototype,"sizing",void 0);r.__decorate([p.location(8,e.Float)],x.prototype,"placementAngle",void 0);r.__decorate([p.location(9,e.Float)],x.prototype,"sdfDecodeCoeff",void 0);r.__decorate([p.location(10,e.Vec2)],x.prototype,"zoomRange",void 0);class B extends p.ComputeVertexInput{}r.__decorate([p.location(12,e.Vec2)],B.prototype,"offsetNextVertex1",void 0);r.__decorate([p.location(13,e.Vec2)],B.prototype,"offsetNextVertex2",void 0);r.__decorate([p.location(14,e.Vec2)],B.prototype,"textureUVNextVertex1",
void 0);r.__decorate([p.location(15,e.Vec2)],B.prototype,"textureUVNextVertex2",void 0);class C extends m.FeatureFragmentInput{}class y extends m.AFeatureShader{constructor(){super(...arguments);this.type="MarkerShader";this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],textureUV:["textureUVNextVertex1","textureUVNextVertex2"]}}vertex(v,F){var D=w(v.sizing.x),G=w(v.sizing.y),E=w(v.sizing.z),H=v.placementAngle;const K=b.getBit(v.bitset,n.MarkerConstants.bitset.isSDF),J=b.getBit(v.bitset,
n.MarkerConstants.bitset.isMapAligned);var L=b.getBit(v.bitset,n.MarkerConstants.bitset.scaleSymbolsProportionally),P=b.getBitBool(v.bitset,n.MarkerConstants.bitset.colorLocked),Q=z.getVisualVariableOpacity(this,v.id);P=z.getVisualVariableColor(this,v.id,v.color,P).multiply(Q);Q=this.view.displayViewScreenMat3.multiply(new e.Vec3(v.pos.xy,1));E=z.getVisualVariableSize(this,v.id,E).divide(E);D=D.multiply(E);var S=v.offset.xy.multiply(E);L=G.multiply(L.multiply(E.subtract(1)).add(1));L=e.min(L,e.max(D.subtract(.99),
new e.Float(0)));G=e.max(L,new e.Float(1));var U=e.min(L,new e.Float(1));H=e.Mat3.fromRotation(H.multiply(l.c256ToRad));L=z.getVisualVariableRotation(this,v.id);S=this._getViewRotationMatrix(J).multiply(L).multiply(H).multiply(new e.Vec3(S.xy,0));var X=this.clip(v.id,v.zoomRange);Q=new e.Vec4(Q.xy.add(S.xy),X,1);S=v.textureUV.divide(this.mosaicInfo.size);U=v.outlineColor.multiply(U);X=b.getBit(v.bitset,n.MarkerConstants.bitset.overrideOutlineColor);const aa=v.sdfDecodeCoeff.multiply(D);return{glPosition:Q,
color:P,textureUV:S,outlineColor:U,outlineSize:G,distanceToPx:aa,isSDF:K,overrideOutlineColor:X,...this.maybeRunHittest(v,F,{pos:v.pos,size:D,sizeCorrection:E,isMapAligned:J,vvRotationMat3:L,placementMat3:H,outlineSize:G,distanceToPx:aa,isSDF:K})}}fragment(v){const F=this._getColor(v.textureUV,v);return this.getFragmentOutput(F,v)}hittest(v,F,D){return e.ifElse(e.lessThan(D.size,this.hittestRequest.smallSymbolSizeThreshold),this._hittestSmallMarker(v,F,D),this._hittestMarker(v,F,D))}_getViewRotationMatrix(v){const F=
this.view.displayViewMat3,D=this.view.displayMat3,G=(new e.Float(1)).subtract(v);return F.multiply(v).add(D.multiply(G))}_getViewScreenMatrix(v){const F=this.view.viewMat3.multiply(this.view.tileMat3),D=this.view.tileMat3,G=(new e.Float(1)).subtract(v);return F.multiply(v).add(D.multiply(G))}_getColor(v,F){return e.ifElse(e.equal(F.isSDF,new e.Float(1)),this._getSDFColor(v,F),this._getSpriteColor(v,F))}_getSpriteColor(v,F){return e.texture2D(this.mosaicInfo.texture,v).multiply(F.color)}_getSDFColor(v,
F){v=e.texture2D(this.mosaicInfo.texture,v);var D=(new e.Float(.5)).subtract(b.rgba2float(v)).multiply(F.distanceToPx).multiply(l.softEdgeRatio);v=e.clamp((new e.Float(.5)).subtract(D),new e.Float(0),new e.Float(1));v=F.color.multiply(v);var G=F.outlineSize;this.highlight&&(G=e.max(G,F.overrideOutlineColor.multiply(4)));G=G.multiply(.5);D=e.abs(D).subtract(G);D=e.clamp((new e.Float(.5)).subtract(D),new e.Float(0),new e.Float(1));F=e.mix(F.outlineColor,F.color,F.overrideOutlineColor).multiply(D);return(new e.Float(1)).subtract(F.a).multiply(v).add(F)}_hittestSmallMarker(v,
F,D){const {position:G,distance:E,smallSymbolDistance:H}=this.hittestRequest;v=E.subtract(H);const {viewMat3:K,tileMat3:J}=this.view;F=K.multiply(J).multiply(new e.Vec3(D.pos,1)).xy;D=D.size.multiply(.5);return e.distance(F,G).subtract(D).add(v)}_hittestMarker(v,F,D){const {pos:G,sizeCorrection:E,isMapAligned:H}=D;var K=new e.Vec3(v.offset.multiply(E),0),J=new e.Vec3(F.offsetNextVertex1.multiply(E),0),L=new e.Vec3(F.offsetNextVertex2.multiply(E),0);const {viewMat3:P,tileMat3:Q}=this.view;var S=P.multiply(Q).multiply(new e.Vec3(G,
1)),U=this._getViewScreenMatrix(H).multiply(D.vvRotationMat3).multiply(D.placementMat3);K=S.add(U.multiply(K)).xy;J=S.add(U.multiply(J)).xy;L=S.add(U.multiply(L)).xy;S=this.hittestRequest.distance;U=d.distPointTriangle(this.hittestRequest.position,K,J,L);return e.ifElse(e.greaterThan(U,S),U,this._hittestSamples(K,J,L,v,F,D))}_hittestSamples(v,F,D,G,E,H){const {outlineSize:K,isSDF:J,distanceToPx:L}=H;var P=this.hittestRequest.position;const Q=this.hittestRequest.distance;H=d.xyToBarycentric(P.add(new e.Vec2(e.negate(Q),
e.negate(Q))),v,F,D);const S=d.xyToBarycentric(P.add(new e.Vec2(0,e.negate(Q))),v,F,D),U=d.xyToBarycentric(P.add(new e.Vec2(Q,e.negate(Q))),v,F,D),X=d.xyToBarycentric(P.add(new e.Vec2(e.negate(Q),0)),v,F,D),aa=d.xyToBarycentric(P,v,F,D),ba=d.xyToBarycentric(P.add(new e.Vec2(Q,0)),v,F,D),fa=d.xyToBarycentric(P.add(new e.Vec2(e.negate(Q),Q)),v,F,D),I=d.xyToBarycentric(P.add(new e.Vec2(0,Q)),v,F,D);v=d.xyToBarycentric(P.add(new e.Vec2(Q,Q)),v,F,D);G=G.textureUV.divide(this.mosaicInfo.size);F=E.textureUVNextVertex1.divide(this.mosaicInfo.size);
E=E.textureUVNextVertex2.divide(this.mosaicInfo.size);D={color:new e.Vec4(1),outlineColor:new e.Vec4(1),overrideOutlineColor:new e.Float(1),outlineSize:K,distanceToPx:L,isSDF:J};P=new e.Float(0);P=P.add(d.inTriangle(H).multiply(this._getColor(t(H,G,F,E),D).a));P=P.add(d.inTriangle(S).multiply(this._getColor(t(S,G,F,E),D).a));P=P.add(d.inTriangle(U).multiply(this._getColor(t(U,G,F,E),D).a));P=P.add(d.inTriangle(X).multiply(this._getColor(t(X,G,F,E),D).a));P=P.add(d.inTriangle(aa).multiply(this._getColor(t(aa,
G,F,E),D).a));P=P.add(d.inTriangle(ba).multiply(this._getColor(t(ba,G,F,E),D).a));P=P.add(d.inTriangle(fa).multiply(this._getColor(t(fa,G,F,E),D).a));P=P.add(d.inTriangle(I).multiply(this._getColor(t(I,G,F,E),D).a));P=P.add(d.inTriangle(v).multiply(this._getColor(t(v,G,F,E),D).a));return e.step(P,new e.Float(.05)).multiply(d.failHittest(this.hittestRequest))}}r.__decorate([p.option(f.VisualVariableColor)],y.prototype,"visualVariableColor",void 0);r.__decorate([p.option(g.VisualVariableOpacity)],y.prototype,
"visualVariableOpacity",void 0);r.__decorate([p.option(q.VisualVariableRotation)],y.prototype,"visualVariableRotation",void 0);r.__decorate([p.option(c.VisualVariableSizeMinMaxValue)],y.prototype,"visualVariableSizeMinMaxValue",void 0);r.__decorate([p.option(h.VisualVariableSizeScaleStops)],y.prototype,"visualVariableSizeScaleStops",void 0);r.__decorate([p.option(u.VisualVariableSizeStops)],y.prototype,"visualVariableSizeStops",void 0);r.__decorate([p.option(A.VisualVariableSizeUnitValue)],y.prototype,
"visualVariableSizeUnitValue",void 0);r.__decorate([p.uniform(a.MosaicInfo)],y.prototype,"mosaicInfo",void 0);r.__decorate([r.__param(0,p.input(x)),r.__param(1,p.input(B))],y.prototype,"vertex",null);r.__decorate([r.__param(0,p.input(C))],y.prototype,"fragment",null);k.MarkerFragmentInput=C;k.MarkerShader=y;k.MarkerVertexInput=x;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/pieChart/PieChartTechnique":function(){define("exports ../../../enums ../FeatureTechnique ../featureTechniqueUtils ../TechniqueType ./PieChartShader".split(" "),
function(k,r,p,e,n,m){class l extends p.FeatureTechnique{constructor(){super(...arguments);this.type=n.TechniqueType.PieChart;this.shaders={geometry:new m.PieChartShader};this.symbologyPlane=r.FeatureSymbologyDrawOrder.MARKER}render(d,a){const {painter:b}=d,{instance:f,target:g}=a,q=this.shaders.geometry,c=f.getInput(),h=c.uniforms.numberOfFields,u=e.isHittest(d),A=e.getFeatureUniforms(d,g),z=e.getSelectionDefines(d);q.setNumberOfFields(h);b.setShader({shader:q,uniforms:{...e.resolveDynamicUniforms(d,
a.target,c.uniforms.shader),...A.storage,...A.view,hittestUniforms:A.hittestRequest?{hittestDist:A.hittestRequest?.distance,hittestPos:A.hittestRequest?.position}:null},defines:{VV_SIZE_MIN_MAX_VALUE:!!c.uniforms.shader.visualVariableSizeMinMaxValue,VV_SIZE_SCALE_STOPS:!!c.uniforms.shader.visualVariableSizeScaleStops,VV_SIZE_FIELD_STOPS:!!c.uniforms.shader.visualVariableSizeStops,VV_SIZE_UNIT_VALUE:!!c.uniforms.shader.visualVariableSizeUnitValue,VV_OPACITY:!!c.uniforms.shader.visualVariableOpacity,
HITTEST:u,highlight:A.highlight?1:0,...z,numberOfFields:h},optionalAttributes:{},useComputeBuffer:u});b.setPipelineState(e.getFeaturePipelineState(d));b.submitDraw(d,a)}}k.PieChartTechnique=l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/pieChart/PieChartShader":function(){define(["exports","../../GLSLShaderModule","../../graph/glsl","../../../shaders/sources/resolver"],function(k,r,p,e){const n={hittestDist:p.Float,hittestPos:p.Vec2},
m={filterFlags:p.Sampler2D,animation:p.Sampler2D,visualVariableData:p.Sampler2D,dataDriven0:p.Sampler2D,dataDriven1:p.Sampler2D,dataDriven2:p.Sampler2D,gpgpu:p.Sampler2D,size:p.Float},l={displayViewScreenMat3:p.Mat3,displayViewMat3:p.Mat3,displayMat3:p.Mat3,viewMat3:p.Mat3,tileMat3:p.Mat3,displayZoomFactor:p.Float,requiredZoomFactor:p.Float,tileOffset:p.Vec2,currentScale:p.Float,currentZoom:p.Float,metersPerSRUnit:p.Float};class d extends r.GLSLShaderModule{constructor(){super(...arguments);this.vertexShader=
e.resolveIncludes("materials/pie/pie.vert");this.fragmentShader=e.resolveIncludes("materials/pie/pie.frag");this.required={...m,...l,outlineWidth:p.Float,colors:p.FixedArray,defaultColor:p.Vec4,othersColor:p.Vec4,outlineColor:p.Vec4,donutRatio:p.Float,sectorThreshold:p.Float};this.options={hittestUniforms:n,visualVariableSizeMinMaxValue:{minMaxValueAndSize:p.Vec4},visualVariableSizeScaleStops:{sizes:{...p.FixedArray.ofType(p.Float,8),type:"array",elementType:p.Float,size:8},values:{...p.FixedArray.ofType(p.Float,
8),type:"array",elementType:p.Float,size:8}},visualVariableSizeStops:{sizes:{...p.FixedArray.ofType(p.Float,8),type:"array",elementType:p.Float,size:8},values:{...p.FixedArray.ofType(p.Float,8),type:"array",elementType:p.Float,size:8}},visualVariableSizeUnitValue:{unitValueToPixelsRatio:p.Float},visualVariableOpacity:{opacities:{...p.FixedArray.ofType(p.Float,8),type:"array",elementType:p.Float,size:8},opacityValues:{...p.FixedArray.ofType(p.Float,8),type:"array",elementType:p.Float,size:8}}};this.locations=
{pos:{index:0,type:p.Vec2},id:{index:1,type:p.Vec3},bitset:{index:2,type:p.Float},offset:{index:3,type:p.Vec2},texCoords:{index:4,type:p.Vec2},size:{index:5,type:p.Vec2},referenceSize:{index:6,type:p.Float},zoomRange:{index:7,type:p.Vec2}};this.defines={VV_SIZE_MIN_MAX_VALUE:"boolean",VV_SIZE_SCALE_STOPS:"boolean",VV_SIZE_FIELD_STOPS:"boolean",VV_SIZE_UNIT_VALUE:"boolean",VV_OPACITY:"boolean",HITTEST:"boolean",numberOfFields:"number",highlight:"boolean",inside:"boolean",outside:"boolean"}}setNumberOfFields(a){this.required.colors=
{...p.FixedArray.ofType(p.Vec4,a),type:"array",elementType:p.Vec4,size:a}}}k.PieChartShader=d;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/GLSLShaderModule":function(){define(["exports","../../../../../core/string","./typed/TypedShaderProgram"],function(k,r,p){class e{constructor(){this.computeAttributes={}}get locationsMap(){const n=new Map;for(const m in this.locations)n.set(m,this.locations[m].index);return n}get optionPropertyKeys(){this._optionPropertyKeys||
(this._optionPropertyKeys=new Set(Object.keys(this.options)));return this._optionPropertyKeys}get _transformFeedbackBindings(){return[]}get locationInfo(){if(!this._locationInfo){const n=this.locationsMap,m=Array.from(n.entries()).map(([l,d])=>`${l}.${d}`).join(".");this._locationInfo={hash:r.numericHash(m),stringHash:m,locations:n,computeAttributeMap:this.computeAttributes}}return this._locationInfo}get renamedLocationsMap(){const n=new Map;for(const [m,l]of this.locationsMap.entries())n.set("a_"+
m,l);return n}getShaderKey(n,m,l){const d=Object.keys(n).map(b=>`${b}.${n[b]}`).join("."),a=Object.keys(l).filter(b=>l[b]).map(b=>`${b}_${l[b].toString()}`).join(".");m=Object.keys(m).filter(b=>this.optionPropertyKeys.has(b)).join(".");return`${d}.${a}.${m}`}getProgram(n,m,l,d){d=n="";for(const a in l)if(l[a]){const b="boolean"===typeof l[a]?`#define ${a}\n`:`#define ${a} ${l[a]}\n`;n+=b;d+=b}n+=this.vertexShader;d+=this.fragmentShader;return new p.TypedShaderProgram(n,d,this.renamedLocationsMap,
this.locationInfo,this._getUniformBindings(m),this._transformFeedbackBindings)}_getUniformBindings(n){const m=[];for(var l in this.required){var d=this.required[l];m.push({uniformHydrated:null,shaderModulePath:l,uniformName:l,uniformType:d.type,uniformArrayElementType:"array"===d.type?d.elementType?.type:void 0,uniformArrayLength:"array"===d.type?d.size:void 0})}for(const a in n)if(l=this.options[a],n[a])for(const b in l)d=l[b],m.push({uniformHydrated:null,shaderModulePath:`${a}.${b}`,uniformName:b,
uniformType:d.type,uniformArrayElementType:"array"===d.type?d.elementType?.type:void 0,uniformArrayLength:"array"===d.type?d.size:void 0});return m}}k.GLSLShaderModule=e;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/text/TextTechnique":function(){define("exports ../../../enums ../FeatureTechnique ../featureTechniqueUtils ../TechniqueType ./TextShader".split(" "),function(k,r,p,e,n,m){class l extends p.FeatureTechnique{constructor(){super(...arguments);
this.type=n.TechniqueType.Text;this.shaders={geometry:new m.TextShader};this.symbologyPlane=r.FeatureSymbologyDrawOrder.TEXT}render(d,a){const {context:b,painter:f}=d,g=e.getSelectionDefines(d);var q=a.instance.getInput();q={shader:this.shaders.geometry,uniforms:{...e.resolveDynamicUniforms(d,a.target,q.uniforms),...e.getFeatureUniforms(d,a.target),mosaicInfo:f.textureManager.getMosaicInfo(b,a.textureKey)},defines:{...g,isBackgroundPass:!0,isLabel:!1,textRenderPassType:m.TextRenderPassType.Color},
optionalAttributes:q.optionalAttributes,useComputeBuffer:e.isHittest(d)};f.setShader(q);f.setPipelineState(e.getFeaturePipelineState(d));f.submitDraw(d,a);f.setShader({...q,defines:{...g,isBackgroundPass:!1,isLabel:!1,textRenderPassType:m.TextRenderPassType.Halo}});f.submitDraw(d,a);f.setShader({...q,defines:{...g,isBackgroundPass:!1,isLabel:!1,textRenderPassType:m.TextRenderPassType.Outline}});f.submitDraw(d,a);f.setShader({...q,defines:{...g,isBackgroundPass:!1,isLabel:!1,textRenderPassType:m.TextRenderPassType.Color}});
f.submitDraw(d,a)}}k.TextTechnique=l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/MeshWriterRegistry":function(){define("exports ../TechniqueType ../animated/AnimatedMarkerMeshWriter ../dotDensity/DotDensityMeshWriter ../fill/ComplexFillMeshWriter ../fill/ComplexOutlineFillMeshWriter ../fill/FillMeshWriter ../fill/GradientFillMeshWriter ../fill/OutlineFillMeshWriter ../fill/PatternFillMeshWriter ../fill/PatternOutlineFillMeshWriter ../heatmap/HeatmapMeshWriter ../labels/LabelMeshWriter ../line/GradientStrokeMeshWriter ../line/LineMeshWriter ../line/TexturedLineMeshWriter ../markers/MarkerMeshWriter ./MeshWriterInputEvaluator ../pieChart/PieChartMeshWriter ../text/TextMeshWriter".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g,q,c,h,u,A,z,t,w){class x{async createMeshWriter(B,C,y,v){const F=this._getMeshWriter(v.techniqueType);B=await z.MeshWriterInputEvaluator.create(B,C,v.inputParams);y=new F(v.id,B,v.optionalAttributes,y);await y.loadDependencies();return y}_getMeshWriter(B){switch(B){case r.TechniqueType.Fill:return l.FillMeshWriter;case r.TechniqueType.DotDensity:return e.DotDensityMeshWriter;case r.TechniqueType.ComplexFill:return n.ComplexFillMeshWriter;case r.TechniqueType.PatternFill:return b.PatternFillMeshWriter;
case r.TechniqueType.GradientFill:return d.GradientFillMeshWriter;case r.TechniqueType.OutlineFill:return a.OutlineFillMeshWriter;case r.TechniqueType.PatternOutlineFill:return f.PatternOutlineFillMeshWriter;case r.TechniqueType.ComplexOutlineFill:return m.ComplexOutlineFillMeshWriter;case r.TechniqueType.Marker:return A.MarkerMeshWriter;case r.TechniqueType.PieChart:return t.PieChartMeshWriter;case r.TechniqueType.Text:return w.TextMeshWriter;case r.TechniqueType.Line:return h.LineMeshWriter;case r.TechniqueType.TexturedLine:return u.TexturedLineMeshWriter;
case r.TechniqueType.GradientStroke:return c.GradientStrokeMeshWriter;case r.TechniqueType.Heatmap:return g.HeatmapMeshWriter;case r.TechniqueType.Label:return q.LabelMeshWriter;case r.TechniqueType.AnimatedMarker:return p.AnimatedMarkerMeshWriter;default:throw Error("Internal Error: Mesh writer not in the registry");}}}k.MeshWriterRegistry=x;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/AnimatedMarkerMeshWriter":function(){define("exports ../../../../../../../core/screenUtils ../../../definitions ./AnimatedMeshWriter ../fill/meshWriterUtils ../shaders/constants ../../../../../../webgl/enums".split(" "),
function(k,r,p,e,n,m,l){class d extends e.AAnimatedMeshWriter{get vertexSpec(){return{createComputedParams:a=>{let {pixelDimensions:b,texelDimensions:f,baseSize:g,referenceSize:q,strokeWidth:c,sizeRatio:h}=a;b||=a.sprite.sdf?[0,0]:[a.sprite.width,a.sprite.height];f||=a.sprite.sdf?[0,0]:b;g=r.pt2px(g);q=r.pt2px(q);c=r.pt2px(c);return{...a,pixelDimensions:b,texelDimensions:f,baseSize:g,referenceSize:q,strokeWidth:c,sdfDecodeCoeff:(a.sprite.sdfDecodeCoeff??1)*h}},optionalAttributes:{zoomRange:{type:l.DataType.SHORT,
count:2,packPrecisionFactor:p.minMaxZoomPrecisionFactor,pack:({scaleInfo:a},{tileInfo:b})=>n.getMinMaxZoom(a,b)}},attributes:{id:{type:l.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:l.DataType.UNSIGNED_BYTE,count:1,pack:e.packAnimatedBitset},pos:{type:l.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:1},offset:{type:l.DataType.FLOAT,count:2,packAlternating:{count:4,pack:a=>{a=a.texelDimensions;return[[-.5*a[0],-.5*a[1]],[.5*a[0],-.5*a[1]],[-.5*a[0],.5*a[1]],[.5*a[0],.5*a[1]]]}}},
uv:{type:l.DataType.SHORT,count:2,packPrecisionFactor:1,packAlternating:{count:4,packTessellation:({texXmax:a,texXmin:b,texYmax:f,texYmin:g})=>[[b,g],[a,g],[b,f],[a,f]]}},animationPointerAndBaseSizeAndReferenceSize:{type:l.DataType.UNSIGNED_SHORT,count:4,packPrecisionFactor:1,pack:({animations:a,baseSize:b,referenceSize:f})=>[a.dataColumn,a.dataRow,b,f]},sizing:{type:l.DataType.UNSIGNED_SHORT,count:4,packPrecisionFactor:8,pack:({strokeWidth:a,pixelDimensions:b,baseSize:f,sprite:g,sizeRatio:q})=>[b[0],
b[1],a,g.sdfDecodeCoeff*Math.max(f*g.width/g.height,f)*q]},angle:{type:l.DataType.BYTE,count:1,packTessellation:({angle:a})=>a}}}}_write(a,b){var {textureBinding:f}=this.evaluatedMeshParams.sprite;a.recordStart(this.instanceId,this.attributeLayout,f);const g=b.getDisplayId();if("esriGeometryPolygon"===b.geometryType){b=b.readCentroidForDisplay();if(!b)return;const [q,c]=b.coords;this._writeQuad(a,g,q,c)}else if("esriGeometryPoint"===b.geometryType)f=b.readXForDisplay(),b=b.readYForDisplay(),this._writeQuad(a,
g,f,b);else if(b=b.readGeometryForDisplay())if({angleToLine:f}=this.evaluatedMeshParams,f){let q=!0,c=null,h=null;b.forEachVertex((u,A)=>{if(null!=c&&null!=h){const z=Math.atan2(A-h,u-c)/m.c256ToRad;q&&(this._writeQuad(a,g,c,h,z),q=!1);this._writeQuad(a,g,u,A,z)}c=u;h=A})}else b.forEachVertex((q,c)=>{this._writeQuad(a,g,q,c)});a.recordEnd()}_writeQuad(a,b,f,g,q=0){var {rect:c}=this.evaluatedMeshParams.sprite,h=c.x+p.spritePadding;const u=c.y+p.spritePadding,A=c.x+c.width-p.spritePadding,z=c.y+c.height-
p.spritePadding;c=a.vertexCount();a.recordBounds(f,g,64,64);q={texXmin:h,texYmin:u,texXmax:A,texYmax:z,angle:q};for(h=0;4>h;h++)this._writeVertex(a,b,f,g,q);a.indexEnsureSize(6);a.indexWrite(c);a.indexWrite(c+1);a.indexWrite(c+2);a.indexWrite(c+1);a.indexWrite(c+3);a.indexWrite(c+2)}}k.AnimatedMarkerMeshWriter=d;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/AnimatedMeshWriter":function(){define(["exports","../fill/meshWriterUtils",
"../markers/markerConstants","../mesh/MeshWriter"],function(k,r,p,e){class n extends e.MeshWriter{}k.AAnimatedMeshWriter=n;k.packAnimatedBitset=function(m){const {sprite:l,isMapAligned:d,colorLocked:a,scaleSymbolsProportionally:b,isStroke:f}=m;m=0;d&&(m|=r.getBitMask(p.MarkerConstants.bitset.isMapAligned));a&&(m|=r.getBitMask(p.MarkerConstants.bitset.colorLocked));l.sdf&&(m|=r.getBitMask(p.MarkerConstants.bitset.isSDF));b&&(m|=r.getBitMask(p.MarkerConstants.bitset.scaleSymbolsProportionally));f&&
(m|=r.getBitMask(p.MarkerConstants.bitset.isStroke));return m};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/meshWriterUtils":function(){define(["exports","../../../../../../../Color","../../../../../../../core/Error","../../../../../../../core/Logger","../../../../../../../symbols/cim/enums"],function(k,r,p,e,n){k.getBitMask=function(m){return 1<<m};k.getMinMaxZoom=function(m,l){const d=!!m?.minScale&&l.scaleToZoom(m.minScale)||
0;m=!!m?.maxScale&&l.scaleToZoom(m.maxScale)||100;return[d,m]};k.packBitset=function(m){let l=0;for(const [d,a]of m)a&&(l|=1<<d);return l};k.packByteSqrt=function(m,l){return Math.round(Math.min(Math.sqrt(m*l),255))};k.packRounded=function(m,l){return Math.round(m*l)/l};k.processColorInput=function(m){if(!m)return[0,0,0,0];if("string"===typeof m){const f=r.fromString(m);if(!f)return e.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.meshWriterUtils").errorOnce(new p("mapview:mesh-processing",
"Unable to parse string into color",{color:m})),[0,0,0,0];m=f.toArray()}const [l,d,a,b]=m;return[b/255*l,b/255*d,b/255*a,b]};k.processLineCapInput=function(m){switch(m){case "butt":case n.LineCapStyle.Butt:return n.CapType.BUTT;case "round":case n.LineCapStyle.Round:return n.CapType.ROUND;case "square":case n.LineCapStyle.Square:return n.CapType.SQUARE}};k.processLineJoinInput=function(m){switch(m){case "bevel":case n.LineJoinStyle.Bevel:return n.JoinType.BEVEL;case "miter":case n.LineJoinStyle.Miter:return n.JoinType.MITER;
case "round":case n.LineJoinStyle.Round:return n.JoinType.ROUND}};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/MeshWriter":function(){define(["exports","../../../../../../../geometry/GeometryCursor","../../../../../../../symbols/cim/effects/CIMEffectHelper","./loadGeometryEngine","./MeshWriterVertexPack"],function(k,r,p,e,n){class m{constructor(l,d,a,b){this._instanceId=l;this._evaluator=d;this._enabledOptionalAttributes=a;
this._viewParams=b;this._evaluator.evaluator=f=>this.vertexSpec.createComputedParams(f)}get _vertexPack(){if(!this._cachedVertexPack){const l=n.MeshWriterVertexPack.fromVertexSpec(this.vertexSpec,this._enabledOptionalAttributes);this._evaluator.hasDynamicProperties||l.pack(this._evaluator.evaluatedMeshParams,this._viewParams);this._cachedVertexPack=l}return this._cachedVertexPack}get evaluatedMeshParams(){return this._evaluator.evaluatedMeshParams}get hasEffects(){return!!this.evaluatedMeshParams.effects}get instanceId(){return this._instanceId}get attributeLayout(){return this._vertexPack.attributeLayout}get _preventEffectClipping(){return!1}setReferences(l){this._references=
l}getBoundsInfo(){return null}getTileInfo(){return this._viewParams.tileInfo}async loadDependencies(){var l;a:{if(l=this._evaluator.inputMeshParams.effects?.effectInfos)for(const d of l)switch(d.effect.type){case "CIMGeometricEffectBuffer":case "CIMGeometricEffectOffset":case "CIMGeometricEffectDonut":l=!0;break a}l=!1}l&&await e.loadGeometryEngine()}enqueueRequest(l,d,a){this._evaluator.hasDynamicProperties&&this._evaluator.enqueueRequest(l,d,a)}write(l,d,a,b,f){this.ensurePacked(d,a,b);if((d=this.evaluatedMeshParams.effects)&&
0!==d.length){if(b=a.readGeometryForDisplay()?.clone()){b=r.GeometryCursor.fromOptimizedCIM(b,a.geometryType);var g=e.getGeometryEngine();b.invertY();for(d=p.CIMEffectHelper.executeEffects(d,b,l.id||"",g,this._preventEffectClipping);b=d.next();)b.invertY(),this._write(l,a,b,f)}}else this._write(l,a,void 0,f)}ensurePacked(l,d,a){this._evaluator.hasDynamicProperties&&(l=this._evaluator.evaluateMeshParams(l,d,a),this._vertexPack.pack(l,this._viewParams))}hasArcadeDependency(l){return this._evaluator.hasArcadeDependency(l)}_writeVertex(l,
d,a,b,f){this._vertexPack.writeVertex(l,d,a,b,this.evaluatedMeshParams,f)}}k.MeshWriter=m;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/loadGeometryEngine":function(){define(["require","exports"],function(k,r){let p=null;r.getGeometryEngine=function(){return p};r.loadGeometryEngine=async function(){p=await new Promise((e,n)=>k(["../../../../../../../geometry/geometryEngineJSON"],e,n))};Object.defineProperty(r,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/MeshWriterVertexPack":function(){define(["exports","../../../number","./AlignedVertexSpec","./dataViewUtils"],function(k,r,p,e){class n{static fromVertexSpec(m,l){m=p.AlignedVertexSpec.fromVertexSpec(m,l);return new n(m)}constructor(m){this._spec=m;this._packed=new Uint8Array(this._spec.stride*this._spec.packVertexCount);this._packedU32View=new Uint32Array(this._packed.buffer);this._dataView=new DataView(this._packed.buffer)}get attributeLayout(){return this._spec.attributeLayout}get stride(){return this._spec.stride}writeVertex(m,
l,d,a,b,f){for(let c=0;c<this._spec.packVertexCount;c++){const h=c*this._spec.stride;this._packPosition(d,a,h);this._packId(l,h);var g=this._spec.bitset;if(f){if(g.packTessellation){var q=g.packTessellation(f,b,d,a);this._pack(q,g,h)}for(const u of this._spec.standardAttributes)if(null!=u.packTessellation)g=u.packTessellation(f,b,d,a),this._pack(g,u,h);else if(u.packAlternating?.packTessellation)for(g=u.packAlternating.packTessellation(f,b,d,a),q=0;q<this._spec.packVertexCount;q++)this._pack(g[q],
u,q*this._spec.stride)}}m.vertexWriteRegion(this._packedU32View)}pack(m,l){for(const b of this._spec.standardAttributes)if(b.pack&&"string"!==typeof b.pack){var d=b.pack(m,l);for(var a=0;a<this._spec.packVertexCount;a++)this._pack(d,b,a*this._spec.stride)}else if(b.packAlternating?.pack)for(d=b.packAlternating.pack(m,l),a=0;a<this._spec.packVertexCount;a++)this._pack(d[a],b,a*this._spec.stride)}_packPosition(m,l,d){const {offset:a}=this._spec.position,b=this._spec.position.packPrecisionFactor??1;
m=r.i1616to32(m*b,l*b);this._dataView.setUint32(d+a,m,!0)}_packId(m,l){m*=this._spec.id.packPrecisionFactor??1;const d=this._dataView.getUint32(l+this._spec.id.offset,!0)&4278190080;this._dataView.setUint32(l+this._spec.id.offset,m|d,!0)}_pack(m,l,d){e.packDataView(this._dataView,m,l,d)}}k.MeshWriterVertexPack=n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/AlignedVertexSpec":function(){define(["exports","../../../../../../../core/has",
"./utils","../../../../../../webgl/enums"],function(k,r,p,e){function n(d){switch(d){case e.DataType.BYTE:case e.DataType.UNSIGNED_BYTE:return 1;case e.DataType.SHORT:case e.DataType.UNSIGNED_SHORT:case e.DataType.HALF_FLOAT:return 2;case e.DataType.FLOAT:case e.DataType.INT:case e.DataType.UNSIGNED_INT:return 4}}function m(d){const a=[],b=[],f=[];for(const g of d)switch(d=n(g.type)*g.count,d%2||d%4||4){case 4:a.push(g);continue;case 2:b.push(g);continue;case 1:f.push(g);continue;default:throw Error("Found unexpected dataType byte count");
}a.push(...b);a.push(...f);return a}class l{static fromVertexSpec(d,a){const {attributes:b,optionalAttributes:f}=d;let g,q,c;d=[];for(var h in b){const z=b[h];"position"===z.pack?g={...z,name:h,offset:0}:"id"===z.pack?q={...z,name:h,offset:4}:"bitset"===h?c={...z,name:h,offset:7}:d.push({...z,name:h})}for(var u in f)!0===a[u]&&d.push({...f[u],name:u});d=m(d);a=[];h=8;u=1;for(var A of d)a.push({...A,offset:h}),h+=n(A.type)*A.count,A.packAlternating&&(u=Math.max(A.packAlternating.count,u));A=Uint32Array.BYTES_PER_ELEMENT;
d=h%A;return new l(g,q,c,a,h+(d?A-d:0),u)}constructor(d,a,b,f,g,q){this.position=d;this.id=a;this.bitset=b;this.standardAttributes=f;this.stride=g;this.packVertexCount=q;f.push(b);this._attributes=[d,a,b,...f]}get attributeLayout(){if(!this._attributeLayout){const d=p.vertexLayoutHash(this._attributes);this._attributeLayout={attributes:this._attributes.map(a=>({name:a.name,count:a.count,offset:a.offset,type:a.type,packPrecisionFactor:a.packPrecisionFactor,normalized:a.normalized??!1})),hash:d,stride:this.stride}}return this._attributeLayout}}
k.AlignedVertexSpec=l;k.sortByAlignment=m;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/dotDensity/DotDensityMeshWriter":function(){define(["exports","../fill/AFillMeshWriter","../../../../../../webgl/enums"],function(k,r,p){const e={createComputedParams:m=>m,optionalAttributes:{},attributes:{id:{type:p.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:p.DataType.UNSIGNED_BYTE,count:1},pos:{type:p.DataType.SHORT,count:2,pack:"position",
packPrecisionFactor:10},inverseArea:{type:p.DataType.FLOAT,count:1,packTessellation:({inverseArea:m})=>m}}};class n extends r.AFillMeshWriter{constructor(){super(...arguments);this.vertexSpec=e}createTesselationParams(m){return{inverseArea:1/m.readGeometryArea()}}}k.DotDensityMeshWriter=n;k.dotDensityVertexSpec=e;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/AFillMeshWriter":function(){define(["exports","../../../../../../../core/has",
"../../../../../../../geometry/libtess","../../../mesh/templates/templateUtils","../mesh/MeshWriter"],function(k,r,p,e,n){const m=r("featurelayer-fast-triangulation-enabled");class l extends n.MeshWriter{async loadDependencies(){await Promise.all([super.loadDependencies(),p.loadLibtess()])}_write(d,a,b){b=b?.asOptimized()??a.readGeometryForDisplay();if(b=this._clip(b))d.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(d,a,b),d.recordEnd()}_clip(d){return d?e.clipMarshall(d,this.hasEffects?
256:8):null}_writeGeometry(d,a,b){const f=100<b.maxLength,g=[],q=this.createTesselationParams(a);!f&&m&&e.triangulate(g,b)?g.length&&this._writeVertices(d,a,b.coords,q,g):(b=e.triangulateLibtess(b),this._writeVertices(d,a,b,q))}_writeVertices(d,a,b,f,g){const q=a.getDisplayId();a=d.vertexCount();const c=this.hasEffects;let h=0;if(g)for(var u of g){g=b[2*u];var A=b[2*u+1];c&&d.recordBounds(g,A,0,0);this._writeVertex(d,q,g,A,f);h++}else for(u=0;u<b.length;u+=2)g=Math.round(b[u]),A=Math.round(b[u+1]),
c&&d.recordBounds(g,A,0,0),this._writeVertex(d,q,g,A,f),h++;d.indexEnsureSize(h);for(b=0;b<h;b++)d.indexWrite(b+a)}}k.AFillMeshWriter=l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/libtess":function(){define(["require","exports","../assets","../core/has"],function(k,r,p,e){async function n(){l=await (e("esri-csp-restrictions")?await (new Promise((d,a)=>k(["../chunks/libtess-asm"],d,a))).then(d=>d.libtessAsm):await (new Promise((d,a)=>k(["../chunks/libtess"],d,a))).then(d=>
d.libtess)).default({locateFile:d=>p.getAssetUrl(`esri/core/libs/libtess/${d}`)})}let m=null,l=null;r.loadLibtess=async function(){m||=n();return m};r.triangulate=function(d,a){return l.triangulate(d,a,Math.max(d.length,128E3))};Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/templateUtils":function(){define("exports ../../../../../../chunks/earcut ../../../../../../geometry/libtess ../../../../../../geometry/support/TileClipper ../../../../../../layers/graphics/OptimizedGeometry ../../definitions ../bufcut".split(" "),
function(k,r,p,e,n,m,l){function d(g,q,c){let h=0;for(let u=1;u<c;u++)h+=(g[2*(q+u)]-g[2*(q+u-1)])*(g[2*(q+u)+1]+g[2*(q+u-1)+1]);return h}function a(g,q,c,h,u){let A=0;for(;c<h;c+=3){const z=2*(g[c]-u),t=2*(g[c+1]-u),w=2*(g[c+2]-u);A+=Math.abs((q[z]-q[w])*(q[t+1]-q[z+1])-(q[z]-q[t])*(q[w+1]-q[z+1]))}return A}const b=new e.TileClipper(0,0,0,1,0),f=new e.TileClipper(0,0,0,1,0);b.setExtent(m.tileSize);f.setExtent(m.tileSize);k.area=d;k.clipLinesMarshall=function(g,q){f.setPixelMargin(q);const c=-q;q=
m.tileSize+q;let h=[];var u=!1;if(!g.nextPath())return null;let A=g.pathLength(),z=!0;for(;z;){g.seekPathStart();const t=[];if(!g.pathSize)return null;f.reset(e.GeometryType.LineString);g.nextPoint();let w=g.x,x=g.y;if(u)f.moveTo(w,x);else{if(w<c||w>q||x<c||x>q){u=!0;continue}t.push({x:w,y:x})}let B=!1;for(;g.nextPoint();)if(w=g.x,x=g.y,u)f.lineTo(w,x);else{if(w<c||w>q||x<c||x>q){B=!0;break}t.push({x:w,y:x})}if(B)u=!0;else{if(u){if(u=f.resultWithStarts())for(const C of u)h.push({...C,pathLength:A})}else h.push({line:t,
start:0,pathLength:A});A=(z=g.nextPath())?g.pathLength():0;u=!1}}h=h.filter(t=>1<t.line.length);return 0===h.length?null:h};k.clipMarshall=function(g,q){if(null==g)return null;a:{var c=m.tileSize+128;var h=0;for(var u=0;u<g.lengths.length;u++){var A=g.lengths[u];for(var z=0;z<A;z++){const t=g.coords[2*(z+h)],w=g.coords[2*(z+h)+1];if(-128>t||t>c||-128>w||w>c){c=!0;break a}}h+=A}c=!1}if(!c)return g;b.setPixelMargin(q);b.reset(e.GeometryType.Polygon);q=0;for(c=0;c<g.lengths.length;c++){h=g.lengths[c];
u=g.coords[2*(0+q)];A=g.coords[2*(0+q)+1];b.moveTo(u,A);for(z=1;z<h;z++)u=g.coords[2*(z+q)],A=g.coords[2*(z+q)+1],b.lineTo(u,A);b.close();q+=h}c=b.result(!1);if(!c)return null;g=[];q=[];for(const t of c){c=0;for(const w of t)q.push(w.x),q.push(w.y),c++;g.push(c)}return new n(g,q)};k.triangleAreaArray=a;k.triangulate=function(g,q){const {coords:c,lengths:h}=q;q=0;for(var u=0;u<h.length;){let t=u,w=h[u];u=d(c,q,w);for(var A=[];++t<h.length;){var z=h[t];const x=d(c,q+w,z);if(!(0<x))break;u+=x;A.push(q+
w);w+=z}z=g.length;l.bufcut(g,c,q,q+w,A,2,0);A=a(g,c,z,g.length,0);u=Math.abs(u);if(1E-5<Math.abs((A-u)/Math.max(1E-7,u)))return g.length=0,!1;u=t;q+=w}return!0};k.triangulateEarcut=function(g,q,c){const {coords:h,lengths:u}=q;let A=0;for(var z=0;z<u.length;){let w=z,x=u[z];for(z=[];++w<u.length;){var t=u[w];if(!(0<d(h,A+x,t)))break;z.push(A+x-A);x+=t}t=q.coords.slice(2*A,2*(A+x));z=r.earcut(t,z,2);for(const B of z)g.push(B+c+A);z=w;A+=x}return!0};k.triangulateLibtess=function(g){const {coords:q,
lengths:c}=g;({buffer:g}=p.triangulate(q,c));return g};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/earcut":function(){define(["exports"],function(k){function r(C,y,v){v=v||2;var F=y&&y.length,D=F?y[0]*v:C.length,G=p(C,0,D,v,!0),E=[];if(!G||G.next===G.prev)return E;var H;if(F){var K=G;var J=v;G=[];var L;F=0;for(L=y.length;F<L;F++){var P=y[F]*J;var Q=F<L-1?y[F+1]*J:C.length;P=p(C,P,Q,J,!1);P===P.next&&(P.steiner=!0);Q=G;var S=Q.push,U=P,X=P;do{if(U.x<X.x||U.x===X.x&&
U.y<X.y)X=U;U=U.next}while(U!==P);S.call(Q,X)}G.sort(l);for(F=0;F<G.length;F++)J=G[F],y=K,(K=a(J,y))?(L=z(K,J),J=e(K,K.next),L=d(L),e(L,L.next),J=d(J),K=d(y===K?J:y)):K=y,K=e(K,K.next);G=K}if(C.length>80*v){var aa=H=C[0];var ba=F=C[1];for(J=v;J<D;J+=v)y=C[J],K=C[J+1],y<aa&&(aa=y),K<ba&&(ba=K),y>H&&(H=y),K>F&&(F=K);H=Math.max(H-aa,F-ba);H=0!==H?1/H:0}n(G,E,v,aa,ba,H);return E}function p(C,y,v,F,D){if(D===0<B(C,y,v,F))for(D=y;D<v;D+=F)var G=t(D,C[D],C[D+1],G);else for(D=v-F;D>=y;D-=F)G=t(D,C[D],C[D+
1],G);G&&q(G,G.next)&&(C=G.next,w(G),G=C);return G}function e(C,y){if(!C)return C;y||=C;do{var v=!1;if(C.steiner||!q(C,C.next)&&0!==g(C.prev,C,C.next))C=C.next;else{y=C.prev;w(C);C=y;if(C===C.next)break;v=!0}}while(v||C!==y);return y}function n(C,y,v,F,D,G,E){if(C){if(!E&&G){var H=C,K=H;do null===K.z&&(K.z=b(K.x,K.y,F,D,G)),K.prevZ=K.prev,K=K.nextZ=K.next;while(K!==H);K.prevZ.nextZ=null;K.prevZ=null;H=K;var J,L,P,Q,S=1;do{K=H;var U=H=null;for(L=0;K;){L++;var X=K;for(J=P=0;J<S&&(P++,X=X.nextZ,X);J++);
for(Q=S;0<P||0<Q&&X;)0!==P&&(0===Q||!X||K.z<=X.z)?(J=K,K=K.nextZ,P--):(J=X,X=X.nextZ,Q--),U?U.nextZ=J:H=J,J.prevZ=U,U=J;K=X}U.nextZ=null;S*=2}while(1<L)}for(H=C;C.prev!==C.next;){K=C.prev;X=C.next;if(G)U=m(C,F,D,G);else a:if(U=C,L=U.prev,P=U,S=U.next,0<=g(L,P,S))U=!1;else{for(J=U.next.next;J!==U.prev;){if(f(L.x,L.y,P.x,P.y,S.x,S.y,J.x,J.y)&&0<=g(J.prev,J,J.next)){U=!1;break a}J=J.next}U=!0}if(U)y.push(K.i/v),y.push(C.i/v),y.push(X.i/v),w(C),H=C=X.next;else if(C=X,C===H){if(!E)n(e(C),y,v,F,D,G,1);
else if(1===E){C=e(C);E=y;H=v;K=C;do X=K.prev,U=K.next.next,!q(X,U)&&c(X,K,K.next,U)&&A(X,U)&&A(U,X)&&(E.push(X.i/H),E.push(K.i/H),E.push(U.i/H),w(K),w(K.next),K=C=U),K=K.next;while(K!==C);C=e(K);n(C,y,v,F,D,G,2)}else if(2===E)a:{E=C;do{for(H=E.next.next;H!==E.prev;){if(K=E.i!==H.i){U=U=U=U=void 0;K=E;X=H;if(U=K.next.i!==X.i&&K.prev.i!==X.i){b:{U=K;do{if(U.i!==K.i&&U.next.i!==K.i&&U.i!==X.i&&U.next.i!==X.i&&c(U,U.next,K,X)){U=!0;break b}U=U.next}while(U!==K);U=!1}U=!U}if(U){if(U=A(K,X)&&A(X,K)){U=
K;L=!1;P=(K.x+X.x)/2;S=(K.y+X.y)/2;do U.y>S!==U.next.y>S&&U.next.y!==U.y&&P<(U.next.x-U.x)*(S-U.y)/(U.next.y-U.y)+U.x&&(L=!L),U=U.next;while(U!==K);U=L}U=U&&(g(K.prev,K,X.prev)||g(K,X.prev,X))||q(K,X)&&0<g(K.prev,K,K.next)&&0<g(X.prev,X,X.next)}K=U}if(K){C=z(E,H);E=e(E,E.next);C=e(C,C.next);n(E,y,v,F,D,G);n(C,y,v,F,D,G);break a}H=H.next}E=E.next}while(E!==C)}break}}}}function m(C,y,v,F){var D=C.prev,G=C.next;if(0<=g(D,C,G))return!1;var E=D.x>C.x?D.x>G.x?D.x:G.x:C.x>G.x?C.x:G.x,H=D.y>C.y?D.y>G.y?D.y:
G.y:C.y>G.y?C.y:G.y,K=b(D.x<C.x?D.x<G.x?D.x:G.x:C.x<G.x?C.x:G.x,D.y<C.y?D.y<G.y?D.y:G.y:C.y<G.y?C.y:G.y,y,v,F);y=b(E,H,y,v,F);v=C.prevZ;for(F=C.nextZ;v&&v.z>=K&&F&&F.z<=y;){if(v!==C.prev&&v!==C.next&&f(D.x,D.y,C.x,C.y,G.x,G.y,v.x,v.y)&&0<=g(v.prev,v,v.next))return!1;v=v.prevZ;if(F!==C.prev&&F!==C.next&&f(D.x,D.y,C.x,C.y,G.x,G.y,F.x,F.y)&&0<=g(F.prev,F,F.next))return!1;F=F.nextZ}for(;v&&v.z>=K;){if(v!==C.prev&&v!==C.next&&f(D.x,D.y,C.x,C.y,G.x,G.y,v.x,v.y)&&0<=g(v.prev,v,v.next))return!1;v=v.prevZ}for(;F&&
F.z<=y;){if(F!==C.prev&&F!==C.next&&f(D.x,D.y,C.x,C.y,G.x,G.y,F.x,F.y)&&0<=g(F.prev,F,F.next))return!1;F=F.nextZ}return!0}function l(C,y){return C.x-y.x}function d(C){if(C.next.prev===C)return C;let y=C;do{const v=y.next;if(v.prev===y||v===y||v===C)break;y=v}while(1);return y}function a(C,y){var v=y,F=C.x,D=C.y,G=-Infinity;do{if(D<=v.y&&D>=v.next.y&&v.next.y!==v.y){var E=v.x+(D-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(E<=F&&E>G){G=E;if(E===F){if(D===v.y)return v;if(D===v.next.y)return v.next}var H=v.x<
v.next.x?v:v.next}}v=v.next}while(v!==y);if(!H)return null;if(F===G)return H;y=H;E=H.x;var K=H.y,J=Infinity;v=H;do{if(F>=v.x&&v.x>=E&&F!==v.x&&f(D<K?F:G,D,E,K,D<K?G:F,D,v.x,v.y)){var L=Math.abs(D-v.y)/(F-v.x);var P;if((P=A(v,C))&&!(P=L<J)&&(P=L===J)&&!(P=v.x>H.x)&&(P=v.x===H.x)){P=H;var Q=v;P=0>g(P.prev,P,Q.prev)&&0>g(Q.next,P,P.next)}P&&(H=v,J=L)}v=v.next}while(v!==y);return H}function b(C,y,v,F,D){C=32767*(C-v)*D;y=32767*(y-F)*D;C=(C|C<<8)&16711935;C=(C|C<<4)&252645135;C=(C|C<<2)&858993459;y=(y|
y<<8)&16711935;y=(y|y<<4)&252645135;y=(y|y<<2)&858993459;return(C|C<<1)&1431655765|((y|y<<1)&1431655765)<<1}function f(C,y,v,F,D,G,E,H){return 0<=(D-E)*(y-H)-(C-E)*(G-H)&&0<=(C-E)*(F-H)-(v-E)*(y-H)&&0<=(v-E)*(G-H)-(D-E)*(F-H)}function g(C,y,v){return(y.y-C.y)*(v.x-y.x)-(y.x-C.x)*(v.y-y.y)}function q(C,y){return C.x===y.x&&C.y===y.y}function c(C,y,v,F){var D=u(g(C,y,v)),G=u(g(C,y,F)),E=u(g(v,F,C)),H=u(g(v,F,y));return D!==G&&E!==H||0===D&&h(C,v,y)||0===G&&h(C,F,y)||0===E&&h(v,C,F)||0===H&&h(v,y,F)?
!0:!1}function h(C,y,v){return y.x<=Math.max(C.x,v.x)&&y.x>=Math.min(C.x,v.x)&&y.y<=Math.max(C.y,v.y)&&y.y>=Math.min(C.y,v.y)}function u(C){return 0<C?1:0>C?-1:0}function A(C,y){return 0>g(C.prev,C,C.next)?0<=g(C,y,C.next)&&0<=g(C,C.prev,y):0>g(C,y,C.prev)||0>g(C,C.next,y)}function z(C,y){var v=new x(C.i,C.x,C.y),F=new x(y.i,y.x,y.y),D=C.next,G=y.prev;C.next=y;y.prev=C;v.next=D;D.prev=v;F.next=v;v.prev=F;G.next=F;F.prev=G;return F}function t(C,y,v,F){C=new x(C,y,v);F?(C.next=F.next,C.prev=F,F.next.prev=
C,F.next=C):(C.prev=C,C.next=C);return C}function w(C){C.next.prev=C.prev;C.prev.next=C.next;C.prevZ&&(C.prevZ.nextZ=C.nextZ);C.nextZ&&(C.nextZ.prevZ=C.prevZ)}function x(C,y,v){this.i=C;this.x=y;this.y=v;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function B(C,y,v,F){for(var D=0,G=v-F;y<v;y+=F)D+=(C[G]-C[y])*(C[y+1]+C[G+1]),G=y;return D}r.deviation=function(C,y,v,F){var D=y&&y.length,G=Math.abs(B(C,0,D?y[0]*v:C.length,v));if(D){D=0;for(var E=y.length;D<E;D++)G-=Math.abs(B(C,
y[D]*v,D<E-1?y[D+1]*v:C.length,v))}for(D=y=0;D<F.length;D+=3){E=F[D]*v;var H=F[D+1]*v,K=F[D+2]*v;y+=Math.abs((C[E]-C[K])*(C[H+1]-C[E+1])-(C[E]-C[H])*(C[K+1]-C[E+1]))}return 0===G&&0===y?0:Math.abs((y-G)/G)};r.flatten=function(C){for(var y=C[0][0].length,v={vertices:[],holes:[],dimensions:y},F=0,D=0;D<C.length;D++){for(var G=0;G<C[D].length;G++)for(var E=0;E<y;E++)v.vertices.push(C[D][G][E]);0<D&&(F+=C[D-1].length,v.holes.push(F))}return v};k.earcut=r})},"esri/views/2d/engine/webgl/mesh/bufcut":function(){define(["exports",
"../../../../../core/has"],function(k,r){function p(B,C,y,v,F,D,G){let E;y=0;for(let H=v,K=F-D;H<F;H+=D)y+=(B[K+C*D]-B[H+C*D])*(B[H+1+C*D]+B[K+1+C*D]),K=H;if(G===0<y)for(;v<F;v+=D)E=l(v+C*D,B[v+C*D],B[v+1+C*D],E);else for(F-=D;F>=v;F-=D)E=l(F+C*D,B[F+C*D],B[F+1+C*D],E);E&&u(E,E.next)&&(d(E),E=E.next);return E}function e(B,C=B){if(!B)return B;let y;do if(y=!1,B.steiner||!u(B,B.next)&&0!==f(B.prev,B,B.next))B=B.next;else{d(B);B=C=B.prev;if(B===B.next)break;y=!0}while(y||B!==C);return C}function n(B,
C,y,v,F,D,G,E){if(B){!E&&D&&(B=b(B,v,F,D));for(var H=B;B.prev!==B.next;){var K=B.prev,J=B.next;if(D)var L=m(B,v,F,D);else a:{L=B;var P=L.prev,Q=L;const S=L.next;if(0<=f(P,Q,S)){L=!1;break a}let U=L.next.next;const X=U;let aa=0;for(;U!==L.prev&&(0===aa||U!==X);){aa++;if(q(P.x,P.y,Q.x,Q.y,S.x,S.y,U.x,U.y)&&0<=f(U.prev,U,U.next)){L=!1;break a}U=U.next}L=!0}if(L)C.push(K.index/y+G),C.push(B.index/y+G),C.push(J.index/y+G),d(B),H=B=J.next;else if(B=J,B===H){if(!E)n(e(B),C,y,v,F,D,G,1);else if(1===E){E=
C;H=y;K=G;J=B;do L=J.prev,P=J.next.next,!u(L,P)&&g(L,J,J.next,P)&&c(L,P)&&c(P,L)&&(E.push(L.index/H+K),E.push(J.index/H+K),E.push(P.index/H+K),d(J),d(J.next),J=B=P),J=J.next;while(J!==B);B=J;n(B,C,y,v,F,D,G,2)}else if(2===E)a:{E=B;do{for(H=E.next.next;H!==E.prev;){if(K=E.index!==H.index){L=L=L=void 0;K=E;J=H;if(L=K.next.index!==J.index&&K.prev.index!==J.index){b:{L=K;do{if(L.index!==K.index&&L.next.index!==K.index&&L.index!==J.index&&L.next.index!==J.index&&g(L,L.next,K,J)){L=!0;break b}L=L.next}while(L!==
K);L=!1}L=!L}if(L=L&&c(K,J)&&c(J,K)){L=K;P=!1;Q=(K.x+J.x)/2;J=(K.y+J.y)/2;do L.y>J!==L.next.y>J&&L.next.y!==L.y&&Q<(L.next.x-L.x)*(J-L.y)/(L.next.y-L.y)+L.x&&(P=!P),L=L.next;while(L!==K);L=P}K=L}if(K){B=z(E,H);E=e(E,E.next);B=e(B,B.next);n(E,C,y,v,F,D,G,0);n(B,C,y,v,F,D,G,0);break a}H=H.next}E=E.next}while(E!==B)}break}}}}function m(B,C,y,v){const F=B.prev,D=B.next;if(0<=f(F,B,D))return!1;const G=F.x>B.x?F.x>D.x?F.x:D.x:B.x>D.x?B.x:D.x,E=F.y>B.y?F.y>D.y?F.y:D.y:B.y>D.y?B.y:D.y,H=h(F.x<B.x?F.x<D.x?
F.x:D.x:B.x<D.x?B.x:D.x,F.y<B.y?F.y<D.y?F.y:D.y:B.y<D.y?B.y:D.y,C,y,v);C=h(G,E,C,y,v);y=B.prevZ;for(v=B.nextZ;y&&y.z>=H&&v&&v.z<=C;){if(y!==B.prev&&y!==B.next&&q(F.x,F.y,B.x,B.y,D.x,D.y,y.x,y.y)&&0<=f(y.prev,y,y.next))return!1;y=y.prevZ;if(v!==B.prev&&v!==B.next&&q(F.x,F.y,B.x,B.y,D.x,D.y,v.x,v.y)&&0<=f(v.prev,v,v.next))return!1;v=v.nextZ}for(;y&&y.z>=H;){if(y!==B.prev&&y!==B.next&&q(F.x,F.y,B.x,B.y,D.x,D.y,y.x,y.y)&&0<=f(y.prev,y,y.next))return!1;y=y.prevZ}for(;v&&v.z<=C;){if(v!==B.prev&&v!==B.next&&
q(F.x,F.y,B.x,B.y,D.x,D.y,v.x,v.y)&&0<=f(v.prev,v,v.next))return!1;v=v.nextZ}return!0}function l(B,C,y,v){B=t.create(B,C,y);v?(B.next=v.next,B.prev=v,v.next.prev=B,v.next=B):(B.prev=B,B.next=B);return B}function d(B){B.next.prev=B.prev;B.prev.next=B.next;B.prevZ&&(B.prevZ.nextZ=B.nextZ);B.nextZ&&(B.nextZ.prevZ=B.prevZ)}function a(B,C){let y=C;const v=B.x,F=B.y;let D=-Infinity,G;do{if(F<=y.y&&F>=y.next.y&&y.next.y!==y.y){var E=y.x+(F-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(E<=v&&E>D){D=E;if(E===v){if(F===
y.y)return y;if(F===y.next.y)return y.next}G=y.x<y.next.x?y:y.next}}y=y.next}while(y!==C);if(!G)return null;if(v===D)return G.prev;C=G;E=G.x;const H=G.y;let K=Infinity,J;for(y=G.next;y!==C;)v>=y.x&&y.x>=E&&v!==y.x&&q(F<H?v:D,F,E,H,F<H?D:v,F,y.x,y.y)&&(J=Math.abs(F-y.y)/(v-y.x),(J<K||J===K&&y.x>G.x)&&c(y,B)&&(G=y,K=J)),y=y.next;return G}function b(B,C,y,v){for(var F;F!==B;F=F.next){F=F||B;null===F.z&&(F.z=h(F.x,F.y,C,y,v));if(F.prev.next!==F||F.next.prev!==F)return F.prev.next=F,F.next.prev=F,b(B,
C,y,v);F.prevZ=F.prev;F.nextZ=F.next}B.prevZ.nextZ=null;B.prevZ=null;a:for(y=1;;){v=B;C=B=null;let D=0;for(;v;){D++;F=v;let G=0;for(;G<y&&F;G++)F=F.nextZ;let E=y;for(;0<G||0<E&&F;){let H;0===G?(H=F,F=F.nextZ,E--):0!==E&&F?v.z<=F.z?(H=v,v=v.nextZ,G--):(H=F,F=F.nextZ,E--):(H=v,v=v.nextZ,G--);C?C.nextZ=H:B=H;H.prevZ=C;C=H}v=F}C.nextZ=null;y*=2;if(2>D)break a}return B}function f(B,C,y){return(C.y-B.y)*(y.x-C.x)-(C.x-B.x)*(y.y-C.y)}function g(B,C,y,v){return u(B,C)&&u(y,v)||u(B,v)&&u(y,C)?!0:0<f(B,C,y)!==
0<f(B,C,v)&&0<f(y,v,B)!==0<f(y,v,C)}function q(B,C,y,v,F,D,G,E){return 0<=(F-G)*(C-E)-(B-G)*(D-E)&&0<=(B-G)*(v-E)-(y-G)*(C-E)&&0<=(y-G)*(D-E)-(F-G)*(v-E)}function c(B,C){return 0>f(B.prev,B,B.next)?0<=f(B,C,B.next)&&0<=f(B,B.prev,C):0>f(B,C,B.prev)||0>f(B,B.next,C)}function h(B,C,y,v,F){B=32767*(B-y)*F;C=32767*(C-v)*F;B=(B|B<<8)&16711935;B=(B|B<<4)&252645135;B=(B|B<<2)&858993459;C=(C|C<<8)&16711935;C=(C|C<<4)&252645135;C=(C|C<<2)&858993459;return(B|B<<1)&1431655765|((C|C<<1)&1431655765)<<1}function u(B,
C){return B.x===C.x&&B.y===C.y}function A(B,C){return B.x-C.x}function z(B,C){const y=t.create(B.index,B.x,B.y),v=t.create(C.index,C.x,C.y),F=B.next,D=C.prev;B.next=C;C.prev=B;y.next=F;F.prev=y;v.next=y;y.prev=v;D.next=v;v.prev=D;return v}class t{constructor(){this.y=this.x=this.index=0;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}static create(B,C,y){const v=x<w.length?w[x++]:new t;v.index=B;v.x=C;v.y=y;v.prev=null;v.next=null;v.z=null;v.prevZ=null;v.nextZ=null;v.steiner=
!1;return v}}const w=[];let x=0;for(r=0;8096>r;r++)w.push(new t);k.bufcut=function(B,C,y,v,F,D,G){x=0;var E=(v-y)*D,H=F&&F.length;const K=H?(F[0]-y)*D:E;var J=p(C,y,v,0,K,D,!0);if(J&&J.next!==J.prev){var L;if(H){const X=[];for(let aa=0,ba=F.length;aa<ba;aa++){const fa=p(C,y,v,F[aa]*D,aa<ba-1?F[aa+1]*D:v*D,D,!1);fa===fa.next&&(fa.steiner=!0);H=X;var P=H.push;let I=fa,M=fa;do{if(I.x<M.x||I.x===M.x&&I.y<M.y)M=I;I=I.next}while(I!==fa);P.call(H,M)}X.sort(A);for(var Q of X)if(v=Q,F=a(v,J))v=z(F,v),e(v,
v.next),J=e(F,F.next)}if(E>80*D){var S=E=C[y*D];var U=L=C[1+y*D];for(Q=D;Q<K;Q+=D)v=C[Q+y*D],F=C[Q+1+y*D],S=Math.min(S,v),U=Math.min(U,F),E=Math.max(E,v),L=Math.max(L,F);L=Math.max(E-S,L-U);L=0!==L?1/L:0}n(J,B,D,S,U,L,G,0)}};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/ComplexFillMeshWriter":function(){define("exports ../../../../../../../core/screenUtils ../../../../vectorTiles/GeometryUtils ./meshWriterUtils ./PatternFillMeshWriter ../shaders/constants ../../../../../../webgl/enums".split(" "),
function(k,r,p,e,n,m,l){function d(g){const {sprite:q,aspectRatio:c,scaleProportionally:h}=g;var u=r.pt2px(g.height);g=0<u?u:q.height;u*=c;0>=u?u=q.width:h&&(u*=q.width/q.height);return{width:u,height:g}}function a(g){const {applyRandomOffset:q,sampleAlphaOnly:c}=g;return e.packBitset([[m.bitsetFillRandomPatternOffset,q],[m.bitsetGenericConsiderAlphaOnly,c]])}const b={createComputedParams:g=>g,optionalAttributes:n.patternFillVertexSpec.optionalAttributes,attributes:{...n.patternFillVertexSpec.attributes,
bitset:{count:1,type:l.DataType.UNSIGNED_BYTE,pack:a},width:{count:1,type:l.DataType.HALF_FLOAT,pack:g=>d(g).width},height:{count:1,type:l.DataType.HALF_FLOAT,pack:g=>d(g).height},offset:{count:2,type:l.DataType.HALF_FLOAT,pack:({offsetX:g,offsetY:q})=>[r.pt2px(g),-r.pt2px(q)]},scale:{count:2,type:l.DataType.UNSIGNED_BYTE,packPrecisionFactor:16,pack:({scaleX:g,scaleY:q})=>[g,q]},angle:{count:1,type:l.DataType.UNSIGNED_BYTE,pack:({angle:g})=>p.degToByte(g)}}};class f extends n.PatternFillMeshWriter{constructor(){super(...arguments);
this.vertexSpec=b}}k.ComplexFillMeshWriter=f;k.complexFillVertexSpec=b;k.getPatternSize=d;k.packComplexFillBitset=a;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/PatternFillMeshWriter":function(){define(["exports","../../../definitions","./FillMeshWriter","../../../../../../webgl/enums"],function(k,r,p,e){const n={createComputedParams:l=>l,optionalAttributes:p.fillVertexSpec.optionalAttributes,attributes:{...p.fillVertexSpec.attributes,
tlbr:{count:4,type:e.DataType.UNSIGNED_SHORT,pack:({sprite:l})=>{const {rect:d,width:a,height:b}=l;l=d.x+r.spritePadding;const f=d.y+r.spritePadding;return[l,f,l+a,f+b]}},inverseRasterizationScale:{count:1,type:e.DataType.BYTE,packPrecisionFactor:16,pack:({sprite:l})=>1/l.rasterizationScale}}};class m extends p.FillMeshWriter{constructor(){super(...arguments);this.vertexSpec=n}_write(l,d,a){a=a?.asOptimized()??d.readGeometryForDisplay();if(a=this._clip(a))l.recordStart(this.instanceId,this.attributeLayout,
this.evaluatedMeshParams.sprite?.textureBinding),this._writeGeometry(l,d,a),l.recordEnd()}}k.PatternFillMeshWriter=m;k.patternFillVertexSpec=n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/FillMeshWriter":function(){define(["exports","../../../definitions","./AFillMeshWriter","./meshWriterUtils","../../../../../../webgl/enums"],function(k,r,p,e,n){const m={createComputedParams:d=>d,optionalAttributes:{zoomRange:{type:n.DataType.SHORT,
count:2,packPrecisionFactor:r.minMaxZoomPrecisionFactor,pack:({scaleInfo:d},{tileInfo:a})=>e.getMinMaxZoom(d,a)}},attributes:{id:{type:n.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:n.DataType.UNSIGNED_BYTE,count:1},pos:{type:n.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},color:{type:n.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:d})=>e.processColorInput(d)}}};class l extends p.AFillMeshWriter{constructor(){super(...arguments);this.vertexSpec=m}createTesselationParams(d){return null}}
k.FillMeshWriter=l;k.fillVertexSpec=m;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/ComplexOutlineFillMeshWriter":function(){define("exports ../../../../../../../core/screenUtils ../../../../../../../geometry/GeometryCursor ./ComplexFillMeshWriter ./meshWriterUtils ./OutlineFillMeshWriter ../shaders/constants ../../../../../../webgl/enums".split(" "),function(k,r,p,e,n,m,l,d){const a=e.complexFillVertexSpec,b={createComputedParams:c=>
c,optionalAttributes:a.optionalAttributes,attributes:{...a.attributes,bitset:{type:d.DataType.UNSIGNED_BYTE,count:1,pack:c=>e.packComplexFillBitset(c)},aux1:{count:1,type:d.DataType.HALF_FLOAT,pack:c=>e.getPatternSize(c).width},aux2:{count:1,type:d.DataType.HALF_FLOAT,pack:c=>e.getPatternSize(c).height},aux3:{count:2,type:d.DataType.HALF_FLOAT,pack:({offsetX:c,offsetY:h})=>[r.pt2px(c),r.pt2px(h)]},aux4:{count:2,type:d.DataType.UNSIGNED_BYTE,pack:({scaleX:c,scaleY:h})=>[c*l.packPrecision,h*l.packPrecision]}}},
f={createComputedParams:c=>c,optionalAttributes:a.optionalAttributes,attributes:{...a.attributes,color:m.outlineFillVertexSpec_Outline.attributes.color,bitset:{type:d.DataType.UNSIGNED_BYTE,count:1,pack:c=>n.packBitset([[l.bitsetTypeFillOutline,!0]])},aux1:{count:1,type:d.DataType.HALF_FLOAT,pack:c=>r.pt2px(.5*c.width)},aux2:{count:1,type:d.DataType.HALF_FLOAT,pack:c=>r.pt2px(.5*c.referenceWidth)},aux3:{count:2,type:d.DataType.HALF_FLOAT,packTessellation:({extrusionOffsetX:c,extrusionOffsetY:h})=>
[c,h]},aux4:{count:2,type:d.DataType.UNSIGNED_BYTE,packTessellation:({normalX:c,normalY:h})=>[c*l.packPrecision+l.signedToUnsignedByte,h*l.packPrecision+l.signedToUnsignedByte]}}};class g extends m.OutlineFillOutlineMeshWriter{constructor(){super(...arguments);this.vertexSpec=f}}class q extends m.OutlineFillMeshWriter{constructor(){super(...arguments);this.vertexSpec=b}_createOutlineWriter(c,h,u,A){return new g(c,h,u,A)}_write(c,h,u){u=u?.asOptimized()??h.readGeometryForDisplay();if(u=this._clip(u))c.recordStart(this.instanceId,
this.attributeLayout,this.evaluatedMeshParams.sprite?.textureBinding),this._writeGeometry(c,h,u),this._lineMeshWriter.writeLineVertices(c,p.GeometryCursor.fromOptimizedCIM(u,"esriGeometryPolyline"),h),c.recordEnd()}ensurePacked(c,h,u){super.ensurePacked(c,h,u);this._lineMeshWriter.ensurePacked(c,h,u)}enqueueRequest(c,h,u){super.enqueueRequest(c,h,u);this._lineMeshWriter.enqueueRequest(c,h,u)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}
k.ComplexOutlineFillMeshWriter=q;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/OutlineFillMeshWriter":function(){define("exports ../../../../../../../geometry/GeometryCursor ../../../mesh/templates/templateUtils ./FillMeshWriter ./meshWriterUtils ../line/LineMeshWriter ../mesh/utils ../shaders/constants ../../../../../../webgl/enums".split(" "),function(k,r,p,e,n,m,l,d,a){const b={createComputedParams:c=>c,optionalAttributes:m.LineVertexSpec.optionalAttributes,
attributes:{...m.LineVertexSpec.attributes,bitset:{type:a.DataType.UNSIGNED_BYTE,count:1,pack:c=>0},color:{type:a.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:c})=>n.processColorInput(c)}}},f={createComputedParams:c=>c,optionalAttributes:m.LineVertexSpec.optionalAttributes,attributes:{...m.LineVertexSpec.attributes,bitset:{type:a.DataType.UNSIGNED_BYTE,count:1,pack:c=>n.packBitset([[d.bitsetTypeFillOutline,!0]])},color:{type:a.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:c})=>
n.processColorInput(c)}}};class g extends m.LineMeshWriter{constructor(){super(...arguments);this.vertexSpec=f}}class q extends e.FillMeshWriter{constructor(c,h,u,A){super(c,h,u,A);this.vertexSpec=b;this._lineMeshWriter=this._createOutlineWriter(c,h,u,A)}_createOutlineWriter(c,h,u,A){return new g(c,h,u,A)}_write(c,h,u){u=u?.asOptimized()??h.readGeometryForDisplay();if(u=this._clip(u))c.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(c,h,u),this._lineMeshWriter.writeLineVertices(c,
r.GeometryCursor.fromOptimizedCIM(u,"esriGeometryPolyline"),h),c.recordEnd()}_clip(c){return c?p.clipMarshall(c,l.getLineClippingMargin(this.evaluatedMeshParams)):null}ensurePacked(c,h,u){super.ensurePacked(c,h,u);this._lineMeshWriter.ensurePacked(c,h,u)}enqueueRequest(c,h,u){super.enqueueRequest(c,h,u);this._lineMeshWriter.enqueueRequest(c,h,u)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}k.OutlineFillMeshWriter=q;k.OutlineFillOutlineMeshWriter=
g;k.outlineFillVertexSpec_Fill=b;k.outlineFillVertexSpec_Outline=f;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/LineMeshWriter":function(){define("exports ../../../../../../../core/screenUtils ../../../../../../../geometry/GeometryCursor ../../../definitions ../../../TurboLine ../../../mesh/templates/templateUtils ../fill/meshWriterUtils ../mesh/MeshWriter ../mesh/utils ../../../../../../webgl/enums".split(" "),function(k,
r,p,e,n,m,l,d,a,b){class f{constructor(){this.pathLength=this.distance=this.directionY=this.directionX=this.normalY=this.normalX=this.extrusionOffsetY=this.extrusionOffsetX=0}}const g={createComputedParams:h=>h,optionalAttributes:{zoomRange:{type:b.DataType.SHORT,count:2,packPrecisionFactor:e.minMaxZoomPrecisionFactor,pack:({scaleInfo:h},{tileInfo:u})=>l.getMinMaxZoom(h,u)}},attributes:{id:{type:b.DataType.UNSIGNED_BYTE,count:3,pack:"id"},pos:{type:b.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},
bitset:{type:b.DataType.UNSIGNED_BYTE,count:1},color:{type:b.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:h})=>l.processColorInput(h)},offset:{type:b.DataType.BYTE,count:2,packPrecisionFactor:16,packTessellation:({extrusionOffsetX:h,extrusionOffsetY:u})=>[l.packRounded(h,16),l.packRounded(u,16)]},normal:{type:b.DataType.BYTE,count:2,packPrecisionFactor:16,packTessellation:({normalX:h,normalY:u})=>[l.packRounded(h,16),l.packRounded(u,16)]},halfWidth:{type:b.DataType.HALF_FLOAT,count:1,
pack:({width:h})=>r.pt2px(.5*h)},referenceHalfWidth:{type:b.DataType.HALF_FLOAT,count:1,pack:({referenceWidth:h})=>r.pt2px(.5*h)}}};class q{constructor(){this.pathLength=this.vertexBounds=this.vertexFrom=this.vertexCount=this.indexCount=this.bitset=this.id=0}}class c extends d.MeshWriter{constructor(h,u,A,z){super(h,u,A,z);this.vertexSpec=g;this._currentWrite=new q;this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0,wrapDistance:65535,textured:!1};this._tessParams=new f;this._initializeTessellator()}writeLineVertices(h,
u,A){u=this._getLines(u);null!=u&&this._writeVertices(h,A,u)}_initializeTessellator(){this._lineTessellator=new n.LineTessellation(this._writeTesselatedVertex.bind(this),this._writeTriangle.bind(this),!0)}_write(h,u,A){(A=A??p.GeometryCursor.fromFeatureSetReaderCIM(u))&&this._writeGeometry(h,u,A)}_writeGeometry(h,u,A,z){h.recordStart(this.instanceId,this.attributeLayout,z);this.writeLineVertices(h,A,u);h.recordEnd()}_getLines(h){return m.clipLinesMarshall(h,a.getLineClippingMargin(this.evaluatedMeshParams))}_writeVertices(h,
u,A){const {_currentWrite:z,_tessellationOptions:t,evaluatedMeshParams:w}=this,{width:x,capType:B,joinType:C,miterLimit:y,hasSizeVV:v}=w,F=r.pt2px(.5*x);t.halfWidth=F;t.capType=l.processLineCapInput(B);t.joinType=l.processLineJoinInput(C);t.miterLimit=y;const D=!v;z.out=h;z.id=u.getDisplayId();z.vertexCount=0;z.indexCount=0;z.vertexFrom=h.vertexCount();z.vertexBounds=D&&F<e.thinLineHalfWidthThreshold?0:1;for(const {line:G,start:E,pathLength:H}of A)t.initialDistance=E%65535,z.pathLength=H,this._lineTessellator.tessellate(G,
t,D)}_writeTesselatedVertex(h,u,A,z,t,w,x,B,C,y,v){const {out:F,id:D,vertexBounds:G,pathLength:E}=this._currentWrite;this.hasEffects&&F.recordBounds(h,u,G,G);this._tessParams.extrusionOffsetX=x;this._tessParams.extrusionOffsetY=B;this._tessParams.normalX=C;this._tessParams.normalY=y;this._tessParams.directionX=t;this._tessParams.directionY=w;this._tessParams.distance=v;this._tessParams.pathLength=E;this._writeVertex(F,D,h,u,this._tessParams);return this._currentWrite.vertexFrom+this._currentWrite.vertexCount++}_writeTriangle(h,
u,A){const {out:z}=this._currentWrite;z.indexEnsureSize(3);z.indexWrite(h);z.indexWrite(u);z.indexWrite(A);this._currentWrite.indexCount+=3}}k.LineMeshWriter=c;k.LineTessellationParams=f;k.LineVertexSpec=g;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TurboLine":function(){define(["exports","../../../../symbols/cim/enums","./definitions"],function(k,r,p){function e(g,q){return g.x===q.x&&g.y===q.y}function n(g,q){g.x=q.y;g.y=-q.x;return g}function m(g,
q){g.x=-q.y;g.y=q.x;return g}function l(g,q){g.x=q.x;g.y=q.y;return g}function d(g,q){g.x=-q.x;g.y=-q.y;return g}function a(g){return Math.sqrt(g.x*g.x+g.y*g.y)}function b(g,q,c,h){g.x=q.x*c+q.y*h;g.y=q.x*h-q.y*c;return g}class f{constructor(g,q,c){this._writeVertex=g;this._writeTriangle=q;this._canUseThinTessellation=c;this._prevNormal={x:void 0,y:void 0};this._nextNormal={x:void 0,y:void 0};this._textureNormalLeft={x:0,y:1};this._textureNormalRight={x:0,y:-1};this._textureNormal={x:void 0,y:void 0};
this._joinNormal={x:void 0,y:void 0};this._inner={x:void 0,y:void 0};this._outer={x:void 0,y:void 0};this._roundStart={x:void 0,y:void 0};this._roundEnd={x:void 0,y:void 0};this._startBreak={x:void 0,y:void 0};this._endBreak={x:void 0,y:void 0};this._innerPrev={x:void 0,y:void 0};this._innerNext={x:void 0,y:void 0};this._bevelStart={x:void 0,y:void 0};this._bevelEnd={x:void 0,y:void 0};this._bevelMiddle={x:void 0,y:void 0}}tessellate(g,q,c=this._canUseThinTessellation){if(g){var h=g.length;if(!(1>=
h)){var u=0;for(let A=1;A<h;A++)e(g[A],g[u])||++u===A||(g[u]=g[A]);g.length=u+1}}c&&q.halfWidth<p.thinLineHalfWidthThreshold&&!q.offset?this._tessellateThin(g,q):this._tessellate(g,q)}_tessellateThin(g,q){if(!(2>g.length)){var c=q.wrapDistance||65535;q=q.initialDistance||0;var h=!1,u=g[0].x,A=g[0].y,z=g.length;for(let B=1;B<z;++B){h&&(h=!1,q=0);let C=g[B].x,y=g[B].y;var t=C-u;let v=y-A;var w=Math.sqrt(t*t+v*v);t/=w;v/=w;if(q+w>c){h=!0;var x=(c-q)/w;w=c-q;C=(1-x)*u+x*C;y=(1-x)*A+x*y;--B}x=this._writeVertex(u,
A,0,0,t,v,v,-t,0,-1,q);u=this._writeVertex(u,A,0,0,t,v,-v,t,0,1,q);q+=w;w=this._writeVertex(C,y,0,0,t,v,v,-t,0,-1,q);t=this._writeVertex(C,y,0,0,t,v,-v,t,0,1,q);this._writeTriangle(x,u,w);this._writeTriangle(u,w,t);u=C;A=y}}}_tessellate(g,q){var c=g[g.length-1];const h=e(g[0],c);if(!(g.length<(h?3:2))){var u=q.pixelCoordRatio,A=null!=q.capType?q.capType:r.CapType.BUTT,z=null!=q.joinType?q.joinType:r.JoinType.MITER,t=null!=q.miterLimit?Math.min(q.miterLimit,4):2,w=null!=q.roundLimit?Math.min(q.roundLimit,
1.05):1.05,x=null!=q.halfWidth?q.halfWidth:2,B=!!q.textured,C=null,y=this._prevNormal,v=this._nextNormal,F=-1,D=-1,G=this._joinNormal,E=this._textureNormalLeft,H=this._textureNormalRight,K=this._textureNormal,J=-1,L=-1,P=q.wrapDistance||65535,Q=q.initialDistance||0,S=this._writeVertex,U=this._writeTriangle;q=(ka,ia,na,ma,qa,ra)=>{ka=S(aa,ba,M,N,na,ma,ka,ia,qa,ra,Q);0<=J&&0<=L&&0<=ka&&U(J,L,ka);J=L;return L=ka};if(h){var X=g[g.length-2];v.x=c.x-X.x;v.y=c.y-X.y;D=a(v);v.x/=D;v.y/=D}c=!1;for(let ka=
0;ka<g.length;++ka){c&&(c=!1,Q=0);X&&(y.x=-v.x,y.y=-v.y,F=D,Q+F>P&&(c=!0));c?(C=(P-Q)/F,F=P-Q,X={x:(1-C)*X.x+C*g[ka].x,y:(1-C)*X.y+C*g[ka].y},--ka):X=g[ka];var aa=X.x;var ba=X.y;var fa=0>=ka&&!c,I=ka===g.length-1;fa||(Q+=F);(C=I?h?g[1]:null:g[ka+1])?(v.x=C.x-aa,v.y=C.y-ba,D=a(v),v.x/=D,v.y/=D):(v.x=void 0,v.y=void 0);if(!h){if(fa){m(G,v);var M=G.x;var N=G.y;A===r.CapType.SQUARE&&(q(-v.y-v.x,v.x-v.y,v.x,v.y,0,-1),q(v.y-v.x,-v.x-v.y,v.x,v.y,0,1));A===r.CapType.ROUND&&(q(-v.y-v.x,v.x-v.y,v.x,v.y,-1,
-1),q(v.y-v.x,-v.x-v.y,v.x,v.y,-1,1));if(A===r.CapType.ROUND||A===r.CapType.BUTT)q(-v.y,v.x,v.x,v.y,0,-1),q(v.y,-v.x,v.x,v.y,0,1);continue}if(I){n(G,y);M=G.x;N=G.y;if(A===r.CapType.ROUND||A===r.CapType.BUTT)q(y.y,-y.x,-y.x,-y.y,0,-1),q(-y.y,y.x,-y.x,-y.y,0,1);A===r.CapType.SQUARE&&(q(y.y-y.x,-y.x-y.y,-y.x,-y.y,0,-1),q(-y.y-y.x,y.x-y.y,-y.x,-y.y,0,1));A===r.CapType.ROUND&&(q(y.y-y.x,-y.x-y.y,-y.x,-y.y,1,-1),q(-y.y-y.x,y.x-y.y,-y.x,-y.y,1,1));continue}}var R=void 0;fa=-(y.x*v.y-y.y*v.x);.01>Math.abs(fa)?
0<y.x*v.x+y.y*v.y?(G.x=y.x,G.y=y.y,fa=1,R=Number.MAX_VALUE,C=!0):(m(G,v),R=fa=1,C=!1):(G.x=(y.x+v.x)/fa,G.y=(y.y+v.y)/fa,R=a(G),C=(R-1)*x*u,C=4<R||C>F&&C>D);M=G.x;N=G.y;var T=z;switch(z){case r.JoinType.BEVEL:1.05>R&&(T=r.JoinType.MITER);break;case r.JoinType.ROUND:R<w&&(T=r.JoinType.MITER);break;case r.JoinType.MITER:R>t&&(T=r.JoinType.BEVEL)}switch(T){case r.JoinType.MITER:q(G.x,G.y,-y.x,-y.y,0,-1);q(-G.x,-G.y,-y.x,-y.y,0,1);if(I)break;B&&(C=c?0:Q,J=this._writeVertex(aa,ba,M,N,v.x,v.y,G.x,G.y,0,
-1,C),L=this._writeVertex(aa,ba,M,N,v.x,v.y,-G.x,-G.y,0,1,C));break;case r.JoinType.BEVEL:fa=0>fa;var W=void 0;fa?(T=J,J=L,L=T,W=E,T=H):(W=H,T=E);var Y=void 0,Z=void 0;C?(Y=fa?m(this._innerPrev,y):n(this._innerPrev,y),Z=fa?n(this._innerNext,v):m(this._innerNext,v)):Y=Z=fa?d(this._inner,G):l(this._inner,G);R=fa?n(this._bevelStart,y):m(this._bevelStart,y);q(Y.x,Y.y,-y.x,-y.y,W.x,W.y);Y=q(R.x,R.y,-y.x,-y.y,T.x,T.y);if(I)break;I=fa?m(this._bevelEnd,v):n(this._bevelEnd,v);C?(C=this._writeVertex(aa,ba,
M,N,-y.x,-y.y,0,0,0,0,Q),J=this._writeVertex(aa,ba,M,N,v.x,v.y,Z.x,Z.y,W.x,W.y,Q),L=this._writeVertex(aa,ba,M,N,v.x,v.y,I.x,I.y,T.x,T.y,Q),this._writeTriangle(Y,C,L)):(B?(C=this._bevelMiddle,C.x=(R.x+I.x)/2,C.y=(R.y+I.y)/2,b(K,C,-y.x,-y.y),q(C.x,C.y,-y.x,-y.y,K.x,K.y),b(K,C,v.x,v.y),J=this._writeVertex(aa,ba,M,N,v.x,v.y,C.x,C.y,K.x,K.y,Q),L=this._writeVertex(aa,ba,M,N,v.x,v.y,Z.x,Z.y,W.x,W.y,Q)):(C=J,J=L,L=C),q(I.x,I.y,v.x,v.y,T.x,T.y));fa&&(C=J,J=L,L=C);break;case r.JoinType.ROUND:fa=0>fa;var da=
void 0;fa?(T=J,J=L,L=T,T=E,da=H):(T=H,da=E);var ca=fa?d(this._inner,G):l(this._inner,G);C?(Z=fa?m(this._innerPrev,y):n(this._innerPrev,y),W=fa?n(this._innerNext,v):m(this._innerNext,v)):W=Z=ca;Y=fa?n(this._roundStart,y):m(this._roundStart,y);var ja=fa?m(this._roundEnd,v):n(this._roundEnd,v);Z=q(Z.x,Z.y,-y.x,-y.y,T.x,T.y);Y=q(Y.x,Y.y,-y.x,-y.y,da.x,da.y);if(I)break;I=this._writeVertex(aa,ba,M,N,-y.x,-y.y,0,0,0,0,Q);C||this._writeTriangle(J,L,I);ca=d(this._outer,ca);da=this._writeVertex(aa,ba,M,N,v.x,
v.y,ja.x,ja.y,da.x,da.y,Q);let ia,na;if(ja=2<R){var ha=void 0;R!==Number.MAX_VALUE?(ca.x/=R,ca.y/=R,ha=y.x*ca.x+y.y*ca.y,ha=(R*(ha*ha-1)+1)/ha):ha=-1;ia=fa?n(this._startBreak,y):m(this._startBreak,y);ia.x+=y.x*ha;ia.y+=y.y*ha;na=fa?m(this._endBreak,v):n(this._endBreak,v);na.x+=v.x*ha;na.y+=v.y*ha}b(K,ca,-y.x,-y.y);R=this._writeVertex(aa,ba,M,N,-y.x,-y.y,ca.x,ca.y,K.x,K.y,Q);b(K,ca,v.x,v.y);ca=B?this._writeVertex(aa,ba,M,N,v.x,v.y,ca.x,ca.y,K.x,K.y,Q):R;ha=I;const ma=B?this._writeVertex(aa,ba,M,N,
v.x,v.y,0,0,0,0,Q):I;let qa=-1,ra=-1;ja&&(b(K,ia,-y.x,-y.y),qa=this._writeVertex(aa,ba,M,N,-y.x,-y.y,ia.x,ia.y,K.x,K.y,Q),b(K,na,v.x,v.y),ra=this._writeVertex(aa,ba,M,N,v.x,v.y,na.x,na.y,K.x,K.y,Q));B?ja?(this._writeTriangle(ha,Y,qa),this._writeTriangle(ha,qa,R),this._writeTriangle(ma,ca,ra),this._writeTriangle(ma,ra,da)):(this._writeTriangle(ha,Y,R),this._writeTriangle(ma,ca,da)):ja?(this._writeTriangle(I,Y,qa),this._writeTriangle(I,qa,ra),this._writeTriangle(I,ra,da)):(this._writeTriangle(I,Y,R),
this._writeTriangle(I,ca,da));C?J=this._writeVertex(aa,ba,M,N,v.x,v.y,W.x,W.y,T.x,T.y,Q):(J=B?this._writeVertex(aa,ba,M,N,v.x,v.y,W.x,W.y,T.x,T.y,Q):Z,this._writeTriangle(J,ma,da));L=da;fa&&(C=J,J=L,L=C)}}}}}k.LineTessellation=f;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/GradientFillMeshWriter":function(){define("exports ../../../../../../../symbols/cim/enums ../../../definitions ./AFillMeshWriter ./FillMeshWriter ./gradientFillConstants ./GradientSizeHelper ./meshWriterUtils ../../../../../../webgl/enums".split(" "),
function(k,r,p,e,n,m,l,d,a){const b={createComputedParams:g=>g,optionalAttributes:n.fillVertexSpec.optionalAttributes,attributes:{...n.fillVertexSpec.attributes,bitset:{type:a.DataType.UNSIGNED_BYTE,count:1,pack:({gradientSizeUnits:g,gradientType:q})=>{let c=0;g===r.SymbolUnits.Absolute&&(c|=d.getBitMask(m.bitset.isAbsolute));"discrete"===q.toLowerCase()&&(c|=d.getBitMask(m.bitset.isDiscrete));return c}},tlbr:{count:4,type:a.DataType.UNSIGNED_SHORT,pack:({sprite:g})=>{const {rect:q,width:c,height:h}=
g;g=q.x+p.spritePadding+p.gradientTextureExternalPadding;const u=q.y+p.spritePadding;return[g,u,g+c-2*p.gradientTextureExternalPadding,u+h]}},relativePosition:{count:2,type:a.DataType.HALF_FLOAT,packTessellation:({gradientStats:g},q,c,h)=>g?.getRelativePosition(c,h)??[0,0]},relativeGradientSize:{count:2,type:a.DataType.HALF_FLOAT,packTessellation:({gradientStats:g})=>g?.relativeSize??[1,1]},gradientMethod:{count:1,type:a.DataType.UNSIGNED_BYTE,pack:({gradientMethod:g})=>{switch(g.toLowerCase()){case "rectangular":return m.gradientFillMethods.rectangular;
case "circular":return m.gradientFillMethods.circular;default:return m.gradientFillMethods.linear}}}}};class f extends e.AFillMeshWriter{constructor(){super(...arguments);this.vertexSpec=b}get _preventEffectClipping(){return!0}createTesselationParams(g){return{gradientStats:l.getGradientSizeHelper(g.readGeometryForDisplay(),this.evaluatedMeshParams)}}_write(g,q,c){c=c?.asOptimized()??q.readGeometryForDisplay();if(c=this._clip(c))g.recordStart(this.instanceId,this.attributeLayout,this.evaluatedMeshParams.sprite?.textureBinding),
this._writeGeometry(g,q,c),g.recordEnd()}}k.GradientFillMeshWriter=f;k.gradientFillVertexSpec=b;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/GradientSizeHelper":function(){define(["exports","../../../../../../../core/Logger","../../../../../../../core/mathUtils","../../../../../../../core/screenUtils","../../../../../../../symbols/cim/enums"],function(k,r,p,e,n){class m{constructor(f,g){this._size=f;this._sizeUnits=g;this._relativeSize=
null}get relativeSize(){this._relativeSize??(this._relativeSize=this.calculateRelativeSize());return this._relativeSize}calculateRelativeSize(){if(this._sizeUnits===n.SymbolUnits.Relative){const f=Math.min(this._size/100,1);return[f,f]}return this.calculateRelativeSizeFromAbsolute()}}class l extends m{constructor(f,g,q,c){super(g,q);this.rotationMatrix00=1;this.rotationMatrix10=this.rotationMatrix01=0;this.rotationMatrix11=1;this.bounds={xmin:Infinity,ymin:Infinity,xmax:-Infinity,ymax:-Infinity};
this.rotationMatrix00=Math.cos(c);this.rotationMatrix01=-Math.sin(c);this.rotationMatrix10=-this.rotationMatrix01;this.rotationMatrix11=this.rotationMatrix00;const {bounds:h,rotationMatrix00:u,rotationMatrix01:A,rotationMatrix10:z,rotationMatrix11:t}=this;f.forEachVertex((w,x)=>{const B=w*u+x*A;w=w*z+x*t;h.xmin=Math.min(h.xmin,B);h.ymin=Math.min(h.ymin,w);h.xmax=Math.max(h.xmax,B);h.ymax=Math.max(h.ymax,w)});this.center=[(h.xmin+h.xmax)/2,(h.ymin+h.ymax)/2]}}class d extends l{constructor(f,g,q,c){super(f,
g,q,c);this.method="linear"}getRelativePosition(f,g){const {rotationMatrix00:q,rotationMatrix01:c,bounds:h}=this,{xmin:u,xmax:A}=h;return[(f*q+g*c-u)/(A-u),0]}calculateRelativeSizeFromAbsolute(){const {_size:f,bounds:g}=this,{xmin:q,xmax:c}=g;return[e.pt2px(f)/(c-q),0]}}class a extends l{constructor(f,g,q,c){super(f,g,q,c);this.method="rectangular"}getRelativePosition(f,g){const {bounds:q,center:c,rotationMatrix00:h,rotationMatrix01:u,rotationMatrix10:A,rotationMatrix11:z}=this;return[2/(q.xmax-q.xmin)*
(f*h+g*u-c[0]),2/(q.ymax-q.ymin)*-(f*A+g*z-c[1])]}calculateRelativeSizeFromAbsolute(){const {_size:f,bounds:g}=this,{xmin:q,ymin:c,xmax:h,ymax:u}=g;return[e.pt2px(2*f)/(h-q),e.pt2px(2*f)/(u-c)]}}class b extends l{constructor(f,g,q){super(f,g,q,0);this.method="circular";const {xmin:c,xmax:h,ymin:u,ymax:A}=this.bounds;f=h-c;g=A-u;this.radius=Math.sqrt(f*f+g*g)/2}getRelativePosition(f,g){const {center:q,radius:c}=this;return[(f-q[0])/c,-((g-q[1])/c)]}calculateRelativeSizeFromAbsolute(){const {_size:f}=
this;return[e.pt2px(f)/this.radius,0]}}k.AGradientSizeHelper=m;k.getGradientSizeHelper=function(f,g){if(null==f)return null;const q=p.deg2rad(g.angle),c=g.gradientSize,h=g.gradientSizeUnits;switch(g.gradientMethod.toLowerCase()){case "linear":return new d(f,c,h,q);case "rectangular":return new a(f,c,h,q);case "circular":return new b(f,c,h);default:return r.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.fill.GradientSizeHelper").errorOnce(`Gradient fill method "${g.gradientMethod}" currently unsupported.`),
null}};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/PatternOutlineFillMeshWriter":function(){define(["exports","../../../../../../../geometry/GeometryCursor","./OutlineFillMeshWriter","./PatternFillMeshWriter"],function(k,r,p,e){const n={optionalAttributes:e.patternFillVertexSpec.optionalAttributes,createComputedParams:a=>a,attributes:{...e.patternFillVertexSpec.attributes,...p.outlineFillVertexSpec_Fill.attributes}},m={optionalAttributes:e.patternFillVertexSpec.optionalAttributes,
createComputedParams:a=>a,attributes:{...e.patternFillVertexSpec.attributes,...p.outlineFillVertexSpec_Outline.attributes}};class l extends p.OutlineFillOutlineMeshWriter{constructor(){super(...arguments);this.vertexSpec=m}}class d extends p.OutlineFillMeshWriter{constructor(){super(...arguments);this.vertexSpec=n}_createOutlineWriter(a,b,f,g){return new l(a,b,f,g)}_write(a,b,f){f=f?.asOptimized()??b.readGeometryForDisplay();if(f=this._clip(f))a.recordStart(this.instanceId,this.attributeLayout,this.evaluatedMeshParams.sprite?.textureBinding),
this._writeGeometry(a,b,f),this._lineMeshWriter.writeLineVertices(a,r.GeometryCursor.fromOptimizedCIM(f,"esriGeometryPolyline"),b),a.recordEnd()}ensurePacked(a,b,f){super.ensurePacked(a,b,f);this._lineMeshWriter.ensurePacked(a,b,f)}enqueueRequest(a,b,f){super.enqueueRequest(a,b,f);this._lineMeshWriter.enqueueRequest(a,b,f)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}k.PatternOutlineFillMeshWriter=d;Object.defineProperty(k,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/heatmap/HeatmapMeshWriter":function(){define(["exports","../mesh/MeshWriter","../../../../../../webgl/enums"],function(k,r,p){const e={createComputedParams:m=>m,optionalAttributes:{},attributes:{pos:{type:p.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:p.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:p.DataType.UNSIGNED_BYTE,count:1},offset:{type:p.DataType.BYTE,count:2,packAlternating:{count:4,
pack:()=>[[-1,-1],[1,-1],[-1,1],[1,1]]}}}};class n extends r.MeshWriter{constructor(){super(...arguments);this.vertexSpec=e}_write(m,l){m.recordStart(this.instanceId,this.attributeLayout);const d=l.getDisplayId();if("esriGeometryPoint"===l.geometryType){const a=l.readXForDisplay();l=l.readYForDisplay();this._writeQuad(m,d,a,l)}else"esriGeometryMultipoint"===l.geometryType&&l.readGeometryForDisplay()?.forEachVertex((a,b)=>{0<=a&&512>=a&&0<=b&&512>=b&&this._writeQuad(m,d,a,b)});m.recordEnd()}_writeQuad(m,
l,d,a){const b=m.vertexCount();this._writeVertex(m,l,d,a);m.indexWrite(b+0);m.indexWrite(b+1);m.indexWrite(b+2);m.indexWrite(b+1);m.indexWrite(b+3);m.indexWrite(b+2)}}k.HeatmapMeshWriter=n;k.heatmapVertexSpec=e;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/labels/LabelMeshWriter":function(){define("exports ../../../../../../../core/MapUtils ../../../../../../../core/screenUtils ../../../../../../../core/libs/gl-matrix-2/math/mat2d ../../../../../../../core/libs/gl-matrix-2/factories/mat2df32 ../../../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../../../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../../../../layers/graphics/featureConversionUtils ../../../../../../../layers/graphics/OptimizedGeometry ../../../alignmentUtils ../../../definitions ../../../DisplayId ../../../collisions/BoundingBox ../../../collisions/LabelMetric ../../../mesh/templates/segmentUtils ../fill/meshWriterUtils ../text/TextMeshWriter".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g,q,c,h,u,A,z){function t(B,C,y){const {coords:v,lengths:F}=C;C=d.create();const D=d.create(),G=d.create(),E=d.create(),H=d.create(),K=d.create();let J=0;for(let P=0;P<F.length;P++){const Q=F[P];for(let S=0;S<Q;S++){var L=2*(S+J-1);const U=2*(S+J),X=2*(S+J+1);0<S?m.set(C,v[L],v[L+1]):m.set(C,0,0);m.set(D,v[U],v[U+1]);S<Q-1?m.set(G,v[X],v[X+1]):m.set(G,0,0);0===S?m.set(E,0,0):(m.sub(E,D,C),m.normalize(E,E),m.set(E,E[1],-E[0]));S===Q-1?m.set(H,0,0):(m.sub(H,G,D),m.normalize(H,
H),m.set(H,H[1],-H[0]));m.add(K,E,H);m.normalize(K,K);L=K[0]*H[0]+K[1]*H[1];0!==L&&m.scale(K,K,L);m.scale(K,K,y);B.coords.push(D[0]+K[0],D[1]+K[1])}B.lengths.push(Q);J+=Q}return B}const w=r.memoize(B=>{let C=0;if(0===B)return Infinity;for(;!(B%2);)C++,B/=2;return C});class x extends z.TextMeshWriter{constructor(){super(...arguments);this._zoomLevel=0}_write(B,C,y,v){this._zoomLevel=v||0;if(null!=y)throw Error("InternalError: EffectGeometry not support for LabelMeshWriter");switch(C.geometryType){case "esriGeometryPoint":y=
C.readXForDisplay();v=C.readYForDisplay();this._writePoint(B,y,v,C);break;case "esriGeometryEnvelope":case "esriGeometryPolygon":case "esriGeometryMultipoint":y=C.readCentroidForDisplay();if(!y)break;const [F,D]=y.coords;this._writePoint(B,F,D,C);break;case "esriGeometryPolyline":this._writeLines(B,C)}}_getMetricDir(){const {horizontalAlignment:B,verticalAlignment:C}=this.evaluatedMeshParams;return["center"===B?0:"right"===B?-1:1,"middle"===C?0:"bottom"===C?-1:1]}_createLineLabelMetric(B,C,y,v){B=
q.getDisplayIdTexel(B);const [F,D]=this._getMetricDir();return new h.LabelMetric(B,C,y,F,D,this.evaluatedMeshParams.scaleInfo?.maxScale??0,this.evaluatedMeshParams.scaleInfo?.minScale??0,v??null)}_writePoint(B,C,y,v){const F=this._getShaping();if(F){var D=v.getDisplayId(),G=f.getXAnchorDirection(this.evaluatedMeshParams.horizontalAlignment),E=f.getYAnchorDirection(this.evaluatedMeshParams.verticalAlignment),H=this.evaluatedMeshParams.scaleInfo?.maxScale??0,K=this.evaluatedMeshParams.scaleInfo?.minScale??
0;v=q.getDisplayIdTexel(v.getDisplayId());var J=this._getPointReferenceBounds()||{offsetX:0,offsetY:0,size:0};B.metricStart(new h.LabelMetric(v,C,y,G,E,H,K,J));this._writeGlyphs(B,D,C,y,F,0,J);B.metricBoxWrite(F.boundsT);B.metricEnd()}}_getPointReferenceBounds(){if(!this._references)return null;for(const B of this._references){const C=B.getBoundsInfo();if(C)return C}return null}_writeLines(B,C){const {scaleInfo:y,verticalAlignment:v}=this.evaluatedMeshParams;var F=this.evaluatedMeshParams.repeatLabelDistance||
128;const D=this._getShaping("middle");if(D){var G=(E,H,K,J)=>this._placeSubdivGlyphs(E,H,K,J);F=(D.bounds.width+F)/2;this._current={out:B,id:C.getDisplayId(),shaping:D,zoomRange:A.getMinMaxZoom(y,this.getTileInfo()),referenceBounds:this._getPointReferenceBounds()||{offsetX:0,offsetY:0,size:0},offsetDirection:null};(this._verticalPlacement="bottom"===v?"above":"top"===v?"below":null)?this._writeAboveAndBelowAlong(C,G,F):this._writeCenterAlong(C,G,F)}}_writeAboveAndBelowAlong(B,C,y){const {repeatLabel:v}=
this.evaluatedMeshParams;var {shaping:F}=this._current,D=F.bounds.halfHeight;if(B=B.readGeometryForDisplay()){var G=new b;a.generalizeOptimizedGeometry(G,B,!1,!1,"esriGeometryPolyline",1);B=t(new b,G,D);D=t(new b,G,-D);D=a.convertToGeometry(D,"esriGeometryPolyline",!1,!1);B=a.convertToGeometry(B,"esriGeometryPolyline",!1,!1);B=u.smoothPaths(B.paths,F.bounds.width);F=u.smoothPaths(D.paths,F.bounds.width);this._current.offsetDirection="above";for(const E of B)u.pathDivide(E,y,C,!!v);this._current.offsetDirection=
"below";for(const E of F)u.pathDivide(E,y,C,!!v)}}_writeCenterAlong(B,C,y){const {repeatLabel:v}=this.evaluatedMeshParams,{shaping:F}=this._current;B=u.smoothPaths(B.readLegacyGeometryForDisplay().paths,F.bounds.width);for(const D of B)u.pathDivide(D,y,C,!!v)}_placeSubdivGlyphs(B,C,y,v){const {allowOverrun:F,labelPosition:D,repeatLabelDistance:G}=this.evaluatedMeshParams,E=this._current.zoomRange[0];var H=w(C),K=this._current.shaping.bounds.width/2,J=Math.sqrt(G||128)/2;y=Math.min(y,v-y);K=this._current.shaping.isMultiline?
z.maxLabelZoom:Math.log2(y/(J+K/2));H=Math.max(E,this._zoomLevel+1-(0===C?K:Math.min(H,K)));K=this._zoomLevel-H;J=this._current.shaping.bounds.width/2*2**K;this._current.shaping.isMultiline?0===C&&this._placeStraight(B,H):F&&0>K?this._placeStraightAlong(B,E):"parallel"===D?this._placeStraightAlong(B,H):"curved"===D&&this._placeCurved(B,H,J)}_placeStraight(B,C){const {out:y,id:v,shaping:F,referenceBounds:D}=this._current,{x:G,y:E}=B;y.metricStart(this._createLineLabelMetric(v,G,E));y.metricBoxWrite(F.boundsT);
const H=(180/Math.PI*B.angle+180)%360;this._writeGlyphs(y,v,G,E,F,0,D,{clipAngle:180/Math.PI*B.angle%360,mapAligned:!0,isLineLabel:!0,minZoom:C});this._writeGlyphs(y,v,G,E,F,0,D,{clipAngle:H,mapAligned:!0,isLineLabel:!0,minZoom:C});y.metricEnd()}_placeCurved(B,C,y){const {out:v,id:F}=this._current;v.metricStart(this._createLineLabelMetric(F,B.x,B.y));const D=B.clone(),G=180/Math.PI*B.angle%360,E=(180/Math.PI*B.angle+180)%360;this._verticalPlacement&&this._verticalPlacement!==this._current.offsetDirection||
(this._placeFirst(D,C,1,G),this._placeBack(B,D,C,y,1,G),this._placeForward(B,D,C,y,1,G));this._verticalPlacement&&this._verticalPlacement===this._current.offsetDirection||(this._placeFirst(D,C,0,E),this._placeBack(B,D,C,y,0,E),this._placeForward(B,D,C,y,0,E));v.metricEnd()}_placeStraightAlong(B,C){const {out:y,id:v,shaping:F,zoomRange:D,referenceBounds:G}=this._current,{boxBorderLineColor:E,boxBackgroundColor:H}=this.evaluatedMeshParams,K=B.clone(),J=180/Math.PI*B.angle%360,L=(180/Math.PI*B.angle+
180)%360;var P=0<F.glyphs.length&&!(!E&&!H);y.metricStart(this._createLineLabelMetric(v,B.x,B.y));if(P){var Q=Math.max(C,D[0],0),S=Math.min(z.maxLabelZoom,D[1]);P=e.fromRotation(n.create(),-B.angle);Q={minZoom:Q,maxZoom:S,clipAngle:J,mapAligned:!0,isLineLabel:!0};S=p.pt2px(this.evaluatedMeshParams.offsetX);const X=p.pt2px(this.evaluatedMeshParams.offsetY);if(!this._verticalPlacement||this._verticalPlacement===this._current.offsetDirection){var U=l.fromValues(S,-1*X);const [aa,ba]=F.shapeBackground(e.translate(n.create(),
P,U));y.recordStart(this.instanceId,this.attributeLayout,F.glyphs[0].textureBinding);U=2*Math.max(aa.width,aa.height);y.recordBounds(B.x+aa.x,B.y+aa.y,U,U);this._writeTextBox(y,v,B.x,B.y,ba,G,Q);y.recordEnd()}if(!this._verticalPlacement||this._verticalPlacement!==this._current.offsetDirection){S=l.fromValues(S,X);const [aa,ba]=F.shapeBackground(e.translate(n.create(),P,S));Q.clipAngle=L;y.recordStart(this.instanceId,this.attributeLayout,F.glyphs[0].textureBinding);P=2*Math.max(aa.width,aa.height);
y.recordBounds(B.x+aa.x,B.y+aa.y,P,P);this._writeTextBox(y,v,B.x,B.y,ba,G,Q);y.recordEnd()}}this._verticalPlacement&&this._verticalPlacement!==this._current.offsetDirection||this._placeFirst(K,C,1,J,!0);this._verticalPlacement&&this._verticalPlacement===this._current.offsetDirection||this._placeFirst(K,C,0,L,!0);y.metricEnd()}_placeBack(B,C,y,v,F,D){const G=B.clone();for(B=B.backwardLength+0;G.prev()&&!(B>=v);)this._placeOnSegment(G,C,B,y,-1,F,D),B+=G.length+0}_placeForward(B,C,y,v,F,D){const G=B.clone();
for(B=B.remainingLength+0;G.next()&&!(B>=v);)this._placeOnSegment(G,C,B,y,1,F,D),B+=G.length+0}_placeFirst(B,C,y,v,F=!1){const {out:D,id:G,shaping:E,zoomRange:H,referenceBounds:K}=this._current;var J=E.glyphs,L=p.pt2px(this.evaluatedMeshParams.offsetX),P=p.pt2px(this.evaluatedMeshParams.offsetY);L=l.fromValues(L,P);P=e.fromRotation(n.create(),-B.angle);m.transformMat2d(L,L,P);for(const Q of J)J=Q.x>E.bounds.x?y:1-y,J=Math.max(0,this._zoomLevel+Math.log2(Math.abs(Q.x+Q.width/2-E.bounds.x)/(J*B.remainingLength+
(1-J)*B.backwardLength))),J=Math.max(C,F?0:J),Q.maxZoom=Math.min(H[1],z.maxLabelZoom),Q.angle=B.angle+(1-y)*Math.PI,Q.minZoom=Math.max(H[0],J),this._writeLineGlyph(D,G,B.x,B.y,E.bounds,Q,v,K,!0),(y||this._current.offsetDirection)&&this._isVisible(Q.minZoom,Q.maxZoom)&&(J=new c(Q.bounds.x+L[0],Q.bounds.y+L[1],Q.bounds.width,Q.bounds.height),D.metricBoxWrite(J))}_placeOnSegment(B,C,y,v,F,D,G){const {out:E,id:H,shaping:K,referenceBounds:J}=this._current;var L=K.glyphs;C=B.x+B.dx/B.length*-F*y;var P=
B.y+B.dy/B.length*-F*y,Q=p.pt2px(this.evaluatedMeshParams.offsetX),S=p.pt2px(this.evaluatedMeshParams.offsetY);Q=l.fromValues(Q,S);S=e.fromRotation(n.create(),-B.angle);m.transformMat2d(Q,Q,S);for(const U of L)if((L=U.x>K.bounds.x?D:1-D)&&1===F||!L&&-1===F)S=Math.abs(U.x+U.width/2-K.bounds.x),L=Math.max(0,this._zoomLevel+Math.log2(S/y)-.1),S=Math.max(v,this._zoomLevel+Math.log2(S/(y+B.length+0))),0!==L&&(U.angle=B.angle+(1-D)*Math.PI,U.minZoom=S,U.maxZoom=L,this._writeLineGlyph(E,H,C,P,K.bounds,U,
G,J,!0),(D||this._current.offsetDirection)&&this._isVisible(U.minZoom,U.maxZoom)&&(L=new c(U.bounds.x+Q[0],U.bounds.y+Q[1],U.bounds.width,U.bounds.height),E.metricBoxWrite(L)))}_writeLineGlyph(B,C,y,v,F,D,G,E,H){const K=y+F.x,J=v+F.y;F=2*Math.max(F.width,F.height)*(this.evaluatedMeshParams.minPixelBuffer?this.evaluatedMeshParams.minPixelBuffer/this._textMeshTransformProps.fontSize:1);B.recordStart(this.instanceId,this.attributeLayout,D.textureBinding);B.recordBounds(K,J,F,F);const {texcoords:L,offsets:P}=
D,{fontSize:Q,haloSize:S,outlineSize:U}=this._textMeshTransformProps;this._writeQuad(B,C,y,v,{texcoords:L,offsets:P,fontSize:Q,haloSize:S,outlineSize:U,color:A.processColorInput(this.evaluatedMeshParams.color),isBackground:!1,referenceBounds:E,minZoom:Math.max(this._current.zoomRange[0],D.minZoom),maxZoom:Math.min(this._current.zoomRange[1],D.maxZoom),clipAngle:G,mapAligned:H,isLineLabel:!0});B.recordEnd()}_isVisible(B,C){const y=Math.floor(this._zoomLevel*g.minMaxZoomPrecisionFactor)/g.minMaxZoomPrecisionFactor;
return B<=y&&y<=C}}k.LabelMeshWriter=x;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/DisplayId":function(){define(["exports"],function(k){k.aggregateValidFiltersMask=254;k.createDisplayId=function(r,p){return((p?8388608:0)|r)>>>0};k.displayIdTexelMask=8388607;k.displayIdTypeAggregate=1;k.displayIdTypeFeature=0;k.displayIdTypeMask=8388608;k.getDisplayIdFilterMask=r=>1===(r&8388608)>>>23?254:255;k.getDisplayIdTexel=r=>r&8388607;k.getDisplayIdType=r=>(r&
8388608)>>>23;k.isAggregateId=function(r){return 1===(r&8388608)>>>23};k.nonAggregateValidFiltersMask=255;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/segmentUtils":function(){define(["exports","../../../../../../symbols/cim/constants"],function(k,r){function p(b,f,g){b[0]=f[0]-g[0];b[1]=f[1]-g[1];return b}function e(b){var f=b[0];var g=b[1];f=Math.sqrt(f*f+g*g);b[0]/=f;b[1]/=f}function n(b){return b.length-1}function m(b){let f=0;for(let g=
0;g<n(b);g++)f+=l(b,g);return f}function l(b,f,g=1){let [q,c]=b[f+1];[q,c]=[Math.round(q),Math.round(c)];return Math.sqrt(q*q+c*c)*g}function d(b,f,g,q,c){if(!(g<f)){var h=q.clone().seek(g/2);null!=h&&(b(h.clone(),g,c),g=(g-f)/2,h=h.seek(f/2),d(b,f,g,q,c+1),d(b,f,g,h,c+1))}}class a{constructor(b,f,g,q,c){this._segments=b;this._index=f;this._distance=g;this._xStart=q;this._yStart=c;this._done=!1}static create(b){return new a(b,0,0,b[0][0],b[0][1])}clone(){return new a(this._segments,this._index,this._distance,
this.xStart,this.yStart)}equals(b){return this._index===b._index||b._index===this._index-1&&(0===this._distance||1===b._distance)||b._index===this._index+1&&(1===this._distance||0===b._distance)}leq(b){return this._index<b._index||this._index===b._index&&this._distance<=b._distance}geq(b){return this._index>b._index||this._index===b._index&&this._distance>=b._distance}get _segment(){return this._segments[this._index+1]}get angle(){const b=this.dy;let f=Math.acos((0*b+-1*-this.dx)/(1*this.length));
0<b&&(f=2*Math.PI-f);return f}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){const {dx:b,dy:f}=this;return Math.sqrt(b*b+f*f)}get remainingLength(){return this.length*
(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return 0<=this._index-1}hasNext(){return this._index+1<n(this._segments)}next(){if(!this.hasNext())return null;this._xStart+=this.dx;this._yStart+=this.dy;this._distance=0;this._index+=1;return this}prev(){if(!this.hasPrev())return this._done=!0,null;--this._index;this._xStart-=this.dx;this._yStart-=this.dy;this._distance=1;return this}_seekBackwards(b,
f){var g=this.backwardLength;if(b<=g)return this._distance=(g-b)/this.length,this;for(g=this.backwardLength;this.prev();){if(g+this.length>b)return this._seekBackwards(b-g);g+=this.length}this._distance=0;return f?this:null}seek(b,f=!1){if(0>b)return this._seekBackwards(Math.abs(b),f);if(b<=this.remainingLength)return this._distance=(this.backwardLength+b)/this.length,this;let g=this.remainingLength;for(;this.next();){if(g+this.length>b)return this.seek(b-g,f);g+=this.length}this._distance=1;return f?
this:null}}k.SegmentCursor=a;k.pathDivide=function(b,f,g,q=!0){const c=m(b);b=a.create(b);const h=c/2;if(q){q=Math.floor(Math.max((c-f)/2,0)/f);b.seek(h-q*f);for(let u=-q;u<=q;u++)Math.abs(b.x)<r.maxTileCoordValue&&Math.abs(b.y)<r.maxTileCoordValue&&g(b.clone(),u,h+u*f,c),b.seek(f)}else b.seek(h),Math.abs(b.x)<r.maxTileCoordValue&&Math.abs(b.y)<r.maxTileCoordValue&&g(b.clone(),0,h+0*f,c)};k.pathLength=m;k.pathSubdivide=function(b,f,g){d(g,f,m(b),a.create(b),0)};k.segmentAt=function(b,f){return b[f+
1]};k.segmentCount=n;k.segmentLength=l;k.smoothPaths=function(b,f){for(let E=0;E<b.length;E++){let H=b[E];a:{var g=H,q=f;if(0>=q)break a;const K=g.length;if(3>K)break a;const J=[];var c=0;J.push(0);for(var h=1;h<K;h++){var u=g[h],A=g[h-1],z=u[0]-A[0];u=u[1]-A[1];c+=Math.sqrt(z*z+u*u);J.push(c)}q=Math.min(q,.2*c);h=[];h.push(g[0][0]);h.push(g[0][1]);c=g[K-1][0];z=g[K-1][1];u=p([0,0],g[0],g[1]);e(u);g[0][0]+=q*u[0];g[0][1]+=q*u[1];p(u,g[K-1],g[K-2]);e(u);g[K-1][0]+=q*u[0];g[K-1][1]+=q*u[1];for(u=1;u<
K;u++)J[u]+=q;J[K-1]+=q;u=.5*q;for(A=1;A<K-1;A++){let L=0,P=0,Q=0;for(var t=A-1;0<=t&&!(J[t+1]<J[A]-u);t--){var w=u+J[t+1]-J[A],x=J[t+1]-J[t],B=J[A]-J[t]<u?1:w/x;if(1E-6>Math.abs(B))break;var C=B*B,y=B*w-.5*C*x,v=B*x/q,F=g[t+1],D=g[t][0]-F[0],G=g[t][1]-F[1];L+=v/y*(F[0]*B*w+.5*C*(w*D-x*F[0])-C*B*x*D/3);P+=v/y*(F[1]*B*w+.5*C*(w*G-x*F[1])-C*B*x*G/3);Q+=v}for(t=A+1;t<K&&!(J[t-1]>J[A]+u);t++){w=u-J[t-1]+J[A];x=J[t]-J[t-1];B=J[t]-J[A]<u?1:w/x;if(1E-6>Math.abs(B))break;C=B*B;y=B*w-.5*C*x;v=B*x/q;F=g[t-
1];D=g[t][0]-F[0];G=g[t][1]-F[1];L+=v/y*(F[0]*B*w+.5*C*(w*D-x*F[0])-C*B*x*D/3);P+=v/y*(F[1]*B*w+.5*C*(w*G-x*F[1])-C*B*x*G/3);Q+=v}h.push(L/Q);h.push(P/Q)}h.push(c);h.push(z);for(let L=0,P=0;L<K;L++)g[L][0]=h[P++],g[L][1]=h[P++]}g=[];g.push(H[0]);for(q=1;q<H.length;q++){const [K,J]=H[q-1],[L,P]=H[q];g.push([L-K,P-J])}H=b[E]=g}return b};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/text/TextMeshWriter":function(){define("exports ../../../../../../../core/mathUtils ../../../../../../../core/screenUtils ../../../../../../../geometry/GeometryCursor ../../../../../../../symbols/cim/placements/CIMMarkerPlacementHelper ../../../alignmentUtils ../../../definitions ../../../mesh/templates/shapingUtils ../fill/meshWriterUtils ../mesh/loadGeometryEngine ../mesh/MeshWriter ../shaders/constants ./TextParams ../../../../../../webgl/enums".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g,q,c){const h=[4,4];var u=[16,4];const A={topLeft:u,topRight:u,bottomLeft:u,bottomRight:u};u=[4,2];const z=[4,6],t={topLeft:u,topRight:u,bottomLeft:z,bottomRight:z},w={topLeft:u,topRight:z,bottomLeft:u,bottomRight:z},x={topLeft:z,topRight:z,bottomLeft:h,bottomRight:h},B={topLeft:h,topRight:h,bottomLeft:z,bottomRight:z},C={topLeft:z,topRight:h,bottomLeft:z,bottomRight:h},y={topLeft:h,topRight:z,bottomLeft:h,bottomRight:z},v={createComputedParams:D=>D,optionalAttributes:{zoomRange:{type:c.DataType.UNSIGNED_SHORT,
count:2,packPrecisionFactor:l.minMaxZoomPrecisionFactor,packTessellation:({minZoom:D,maxZoom:G})=>[D||0,G||28]},clipAngle:{type:c.DataType.UNSIGNED_BYTE,count:1,packTessellation:({clipAngle:D})=>Math.round(254/360*(D||0))},referenceSymbol:{type:c.DataType.BYTE,count:4,packPrecisionFactor:1,packTessellation:(D,G)=>{const E=D.isLineLabel||!D.referenceBounds,H=m.getXDirection(E?"center":G.horizontalAlignment);G=m.getYDirection(E?"middle":G.verticalAlignment);const {offsetX:K,offsetY:J,size:L}=E?{offsetX:0,
offsetY:0,size:0}:D.referenceBounds;return[p.pt2px(K),-p.pt2px(J),Math.round(p.pt2px(L)),H+1<<2|G+1]}}},attributes:{pos:{type:c.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:c.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:c.DataType.UNSIGNED_BYTE,count:1,packTessellation:({isBackground:D,mapAligned:G})=>a.packBitset([[g.bitsetTextIsBackground,D],[g.bitsetTextIsMapAligned,!!G]])},offset:{type:c.DataType.SHORT,count:2,packPrecisionFactor:8,packAlternating:{count:4,
packTessellation:({offsets:D})=>{const {bottomLeft:G,bottomRight:E,topLeft:H,topRight:K}=D;return[H,K,G,E]}}},textureUV:{type:c.DataType.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,packTessellation:({texcoords:D})=>{const {bottomLeft:G,bottomRight:E,topLeft:H,topRight:K}=D;return[H,K,G,E]}}},color:{type:c.DataType.UNSIGNED_BYTE,count:4,normalized:!0,packTessellation:({color:D})=>D},fontSize:{type:c.DataType.UNSIGNED_SHORT,count:1,packPrecisionFactor:4,packTessellation:({fontSize:D})=>
Math.round(p.pt2px(D))},referenceSize:{type:c.DataType.UNSIGNED_BYTE,count:1,packPrecisionFactor:4,packTessellation:({fontSize:D},{referenceSize:G})=>Math.round(p.pt2px(G??D))},outlineColor:{type:c.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:D})=>a.processColorInput(D)},haloColor:{type:c.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({haloColor:D})=>a.processColorInput(D)},outlineAndHaloSize:{type:c.DataType.UNSIGNED_SHORT,count:2,packPrecisionFactor:4,packTessellation:({outlineSize:D,
haloSize:G})=>[Math.round(p.pt2px(D)),Math.round(p.pt2px(G))]}}};class F extends f.MeshWriter{constructor(){super(...arguments);this.vertexSpec=v;this._textMeshParamsPropsInitialized=!1}ensurePacked(D,G,E){super.ensurePacked(D,G,E);if(!this._textMeshParamsPropsInitialized||this._evaluator.hasDynamicProperties)this._textMeshTransformProps=new q.TextMeshTransformProps(this.evaluatedMeshParams),this._textMeshParamsPropsInitialized=!0}_write(D,G,E){const H=this._getShaping();if(H){var K=G.getDisplayId();
if(null!=this.evaluatedMeshParams.placement)return this._writePlacedTextMarkers(D,G,H,E);if(E?.nextPath())return E.nextPoint(),this._writeGlyphs(D,K,E.x,E.y,H,0);if("esriGeometryPolygon"===G.geometryType){G=G.readCentroidForDisplay();if(!G)return;const [J,L]=G.coords;return this._writeGlyphs(D,K,J,L,H,0)}if("esriGeometryMultipoint"===G.geometryType)G.readGeometryForDisplay()?.forEachVertex((J,L)=>this._writeGlyphs(D,K,J,L,H,0));else return E=G.readXForDisplay(),G=G.readYForDisplay(),this._writeGlyphs(D,
K,E,G,H,0)}}_writePlacedTextMarkers(D,G,E,H){if(H=H??e.GeometryCursor.fromFeatureSetReaderCIM(G))if(H=n.CIMMarkerPlacementHelper.getPlacement(H,-1,this.evaluatedMeshParams.placement,p.pt2px(1),D.id,b.getGeometryEngine())){G=G.getDisplayId();for(var K=H.next();null!=K;){const J=K.tx,L=-K.ty;K=-K.getAngle();this._writeGlyphs(D,G,J,L,E,K);K=H.next()}}}_getShaping(D){const G=this._textMeshTransformProps,E=this.evaluatedMeshParams;if(!E.glyphs?.glyphs.length)return null;const H=p.pt2px(G.fontSize),K=p.pt2px(G.offsetX),
J=p.pt2px(G.offsetY),L=r.clamp(p.pt2px(E.lineWidth),l.minTextLineWidth,l.maxTextLineWidth),P=l.magicLabelLineHeight*r.clamp(E.lineHeightRatio,.25,4);return d.shapeGlyphs(E.glyphs,{scale:H/l.glyphSize,angle:G.postAngle,xOffset:K,yOffset:J,horizontalAlignment:E.horizontalAlignment,verticalAlignment:D||E.verticalAlignment,maxLineWidth:L,lineHeight:P,decoration:E.decoration,borderLineSizePx:p.pt2px(E.boxBorderLineSize),hasBackground:!!E.boxBackgroundColor,useCIMAngleBehavior:E.useCIMAngleBehavior})}_writeGlyphs(D,
G,E,H,K,J,L,P){const Q=this.evaluatedMeshParams;var S=this._textMeshTransformProps;const U=p.pt2px(S.fontSize),X=S.haloSize,aa=S.outlineSize;var ba=p.pt2px(S.offsetX),fa=p.pt2px(S.offsetY);const [I,M]=a.getMinMaxZoom(Q.scaleInfo,this.getTileInfo());0!==J&&K.setRotation(J);S=K.bounds;ba=E+S.x+ba;fa=H+S.y-fa;S=2*Math.max(S.width,S.height)*(Q.minPixelBuffer?Q.minPixelBuffer/U:1);K.textBox&&(D.recordStart(this.instanceId,this.attributeLayout,K.glyphs[0].textureBinding),D.recordBounds(ba,fa,S,S),this._writeTextBox(D,
G,E,H,K.textBox,L,P),D.recordEnd());for(const N of K.glyphs){D.recordStart(this.instanceId,this.attributeLayout,N.textureBinding);D.recordBounds(ba,fa,S,S);const {texcoords:R,offsets:T}=N;this._writeQuad(D,G,E,H,{texcoords:R,offsets:T,fontSize:U,haloSize:X,outlineSize:aa,color:a.processColorInput(Q.color),isBackground:!1,referenceBounds:L,minZoom:I,maxZoom:M,...P});D.recordEnd()}0!==J&&K.setRotation(-J)}_writeTextBox(D,G,E,H,K,J,L){const P=this.evaluatedMeshParams,{fontSize:Q,haloSize:S,outlineSize:U}=
this._textMeshTransformProps,{boxBackgroundColor:X,boxBorderLineColor:aa}=P;J={isBackground:!0,fontSize:Q,haloSize:S,outlineSize:U,referenceBounds:J,...L};X&&(this._writeQuad(D,G,E,H,{texcoords:A,offsets:K.main,color:a.processColorInput(X),...J}),aa||(this._writeQuad(D,G,E,H,{texcoords:x,offsets:K.top,color:a.processColorInput(X),...J}),this._writeQuad(D,G,E,H,{texcoords:B,offsets:K.bot,color:a.processColorInput(X),...J}),this._writeQuad(D,G,E,H,{texcoords:C,offsets:K.left,color:a.processColorInput(X),
...J}),this._writeQuad(D,G,E,H,{texcoords:y,offsets:K.right,color:a.processColorInput(X),...J})));aa&&(this._writeQuad(D,G,E,H,{texcoords:t,offsets:K.top,color:a.processColorInput(aa),...J}),this._writeQuad(D,G,E,H,{texcoords:t,offsets:K.bot,color:a.processColorInput(aa),...J}),this._writeQuad(D,G,E,H,{texcoords:w,offsets:K.left,color:a.processColorInput(aa),...J}),this._writeQuad(D,G,E,H,{texcoords:w,offsets:K.right,color:a.processColorInput(aa),...J}))}_writeQuad(D,G,E,H,K){const J=D.vertexCount();
this._writeVertex(D,G,E,H,K);D.indexWrite(J+0);D.indexWrite(J+1);D.indexWrite(J+2);D.indexWrite(J+1);D.indexWrite(J+3);D.indexWrite(J+2)}}k.TextMeshWriter=F;k.TextVertexSpec=v;k.maxLabelZoom=28;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/CIMMarkerPlacementHelper":function(){define(["exports","../CIMOperators"],function(k,r){class p{static getPlacement(e,n,m,l,d,a){const b=r.getPlacementOperator(m);if(!b)return null;-1===n&&e.invertY();return b.execute(e,
m,l,d,a)}}k.CIMMarkerPlacementHelper=p;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/text/TextParams":function(){define(["exports","../../../../../../../symbols/cim/utils"],function(k,r){class p{constructor(e){const {offsetX:n,offsetY:m,postAngle:l,fontSize:d,haloSize:a,outlineSize:b,scaleFactor:f,transforms:g}=e;this.offsetX=n;this.offsetY=m;this.postAngle=l;this.fontSize=Math.min(d,96);this.haloSize=a??0;this.outlineSize=b??0;
if((this.transforms=g)&&1<g.infos.length){e=r.applyParentTransform(d,l,!1,n,m,g,!1);this.fontSize=Math.min(e.size,96);const q=e.size/d;this.haloSize*=q;this.outlineSize*=q;this.postAngle=e.rotation;this.offsetX=e.offsetX;this.offsetY=e.offsetY}f&&(this.fontSize*=f,this.offsetX*=f,this.offsetY*=f)}}k.TextMeshTransformProps=p;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/GradientStrokeMeshWriter":function(){define("exports ../../../../../../../core/screenUtils ../../../../../../../geometry/GeometryCursor ../../../../../../../symbols/cim/enums ../../../definitions ../fill/meshWriterUtils ./gradientStrokeConstants ./LineMeshWriter ../../../../../../webgl/enums".split(" "),
function(k,r,p,e,n,m,l,d,a){const b={createComputedParams:g=>g,optionalAttributes:d.LineVertexSpec.optionalAttributes,attributes:{...d.LineVertexSpec.attributes,bitset:{type:a.DataType.UNSIGNED_BYTE,count:1,pack:({gradientMethod:g,gradientSizeUnits:q,gradientType:c})=>m.packBitset([[l.bitset.isAlongLine,"alongline"===g.toLowerCase()],[l.bitset.isAbsoluteSize,q===e.SymbolUnits.Absolute],[l.bitset.isDiscrete,"discrete"===c.toLowerCase()]])},tlbr:{type:a.DataType.UNSIGNED_SHORT,count:4,pack:({sprite:g})=>
{const {rect:q,width:c,height:h}=g;g=q.x+n.spritePadding+n.gradientTextureExternalPadding;const u=q.y+n.spritePadding;return[g,u,g+c-2*n.gradientTextureExternalPadding,u+h]}},accumulatedDistance:{type:a.DataType.UNSIGNED_SHORT,count:1,packTessellation:({distance:g})=>g},gradientSize:{type:a.DataType.HALF_FLOAT,count:1,pack:({gradientSize:g,gradientSizeUnits:q})=>q===e.SymbolUnits.Relative?g/100:r.pt2px(g)},totalLength:{type:a.DataType.HALF_FLOAT,count:1,packTessellation:({pathLength:g})=>g},segmentDirection:{type:a.DataType.BYTE,
count:2,packPrecisionFactor:16,packTessellation:({directionX:g,directionY:q})=>[g,q]}}};class f extends d.LineMeshWriter{get _preventEffectClipping(){return!0}constructor(g,q,c,h){super(g,q,c,h);this.vertexSpec=b;this._tessellationOptions.textured=!0}_write(g,q,c){if(c=c??p.GeometryCursor.fromFeatureSetReaderCIM(q)){var {sprite:h}=this.evaluatedMeshParams;this._writeGeometry(g,q,c,h?.textureBinding)}}}k.GradientStrokeMeshWriter=f;k.GradientStrokeVertexSpec=b;Object.defineProperty(k,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/TexturedLineMeshWriter":function(){define("exports ../../../../../../../core/screenUtils ../../../../../../../geometry/GeometryCursor ../../../../../../../symbols/cim/enums ../../../definitions ../fill/meshWriterUtils ./LineMeshWriter ../shaders/constants ../../../../../../webgl/enums".split(" "),function(k,r,p,e,n,m,l,d,a){const b={createComputedParams:g=>g,optionalAttributes:l.LineVertexSpec.optionalAttributes,attributes:{...l.LineVertexSpec.attributes,
bitset:{type:a.DataType.UNSIGNED_BYTE,count:1,pack:({shouldSampleAlphaOnly:g,shouldScaleDash:q,isSDF:c})=>m.packBitset([[d.bitsetGenericConsiderAlphaOnly,g],[d.bitsetLineScaleDash,q],[d.bitsetLineIsSdf,c]])},tlbr:{type:a.DataType.UNSIGNED_SHORT,count:4,pack:({sprite:g})=>{const {rect:q,width:c,height:h}=g;g=q.x+n.spritePadding;const u=q.y+n.spritePadding;return[g,u,g+c,u+h]}},accumulatedDistance:{type:a.DataType.UNSIGNED_SHORT,count:1,packTessellation:({distance:g})=>g},segmentDirection:{type:a.DataType.BYTE,
count:2,packPrecisionFactor:16,packTessellation:({directionX:g,directionY:q})=>[g,q]},offsetAlongLine:{type:a.DataType.HALF_FLOAT,count:1,pack:({offsetAlongLine:g})=>r.pt2px(g)},capType:{type:a.DataType.UNSIGNED_BYTE,count:1,pack:({capType:g})=>{switch(g){case e.LineCapStyle.Butt:case "butt":return 0;case e.LineCapStyle.Square:case "square":return 1;case e.LineCapStyle.Round:case "round":return 2;default:return 0}}}}};class f extends l.LineMeshWriter{constructor(g,q,c,h){super(g,q,c,h);this.vertexSpec=
b;this._tessellationOptions.textured=!0}_write(g,q,c){if(c=c??p.GeometryCursor.fromFeatureSetReaderCIM(q)){var {sprite:h}=this.evaluatedMeshParams;this._writeGeometry(g,q,c,h?.textureBinding)}}}k.TexturedLineMeshWriter=f;k.texturedLineVertexSpec=b;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/markers/MarkerMeshWriter":function(){define("exports ../../../../../../../core/screenUtils ../../../../../../../core/libs/gl-matrix-2/math/mat2d ../../../../../../../core/libs/gl-matrix-2/factories/mat2df32 ../../../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../../../geometry/GeometryCursor ../../../../../../../symbols/cim/constants ../../../../../../../symbols/cim/enums ../../../../../../../symbols/cim/placements/CIMMarkerPlacementHelper ../../../definitions ../fill/meshWriterUtils ./ComputedMarkerParams ./markerConstants ../mesh/loadGeometryEngine ../mesh/MeshWriter ../../../../../../webgl/enums".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g,q,c,h,u){function A(B,C,y,v,F=!1){B=e.create();F=F?1:-1;p.identity(B);(C||y)&&p.translate(B,B,[C,-y]);v&&p.rotate(B,B,F*z*-v);return B}const z=3.14159265359/180,t=128/Math.PI,w={createComputedParams:B=>g.ComputedMarkerParams.from(B),optionalAttributes:{zoomRange:{type:u.DataType.SHORT,count:2,packPrecisionFactor:b.minMaxZoomPrecisionFactor,pack:({scaleInfo:B},{tileInfo:C})=>f.getMinMaxZoom(B,C)}},attributes:{pos:{type:u.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},
id:{type:u.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:u.DataType.UNSIGNED_BYTE,count:1,pack:({sprite:B,alignment:C,scaleSymbolsProportionally:y,overrideOutlineColor:v,colorLocked:F})=>{let D=0;B.sdf&&(D|=f.getBitMask(q.MarkerConstants.bitset.isSDF));C===d.Alignment.MAP&&(D|=f.getBitMask(q.MarkerConstants.bitset.isMapAligned));y&&(D|=f.getBitMask(q.MarkerConstants.bitset.scaleSymbolsProportionally));v&&(D|=f.getBitMask(q.MarkerConstants.bitset.overrideOutlineColor));F&&(D|=f.getBitMask(q.MarkerConstants.bitset.colorLocked));
return D}},offset:{type:u.DataType.HALF_FLOAT,count:2,packAlternating:{count:4,pack:({angle:B,computedWidth:C,computedHeight:y,anchorX:v,anchorY:F,offsetX:D,offsetY:G,rotateClockwise:E})=>{B=A(0,D,G,-B,E);v=-(.5+v)*C;E=-(.5-F)*y;F=[v,E];D=[v+C,E];G=[v,E+y];C=[v+C,E+y];n.transformMat2d(F,F,B);n.transformMat2d(D,D,B);n.transformMat2d(G,G,B);n.transformMat2d(C,C,B);return[F,D,G,C]}}},textureUV:{type:u.DataType.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({texXmax:B,texXmin:C,texYmax:y,
texYmin:v})=>[[C,v],[B,v],[C,y],[B,y]]}},color:{type:u.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:B})=>f.processColorInput(B)},outlineColor:{type:u.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:B})=>f.processColorInput(B)},sizing:{type:u.DataType.UNSIGNED_BYTE,count:4,pack:({rawWidth:B,rawHeight:C,outlineSize:y,referenceSize:v})=>[f.packByteSqrt(Math.max(B,C),128),f.packByteSqrt(y,128),f.packByteSqrt(v,128),0]},placementAngle:{type:u.DataType.UNSIGNED_BYTE,count:1,
packTessellation:({placementAngle:B})=>{B*=t;B%=256;return Math.abs(0<=B?B:B+256)}},sdfDecodeCoeff:{type:u.DataType.UNSIGNED_SHORT,count:1,packPrecisionFactor:64,pack:({sdfDecodeCoeff:B})=>B}}};class x extends h.MeshWriter{constructor(){super(...arguments);this.vertexSpec=w}getBoundsInfo(){return this.evaluatedMeshParams.boundsInfo}_write(B,C,y){var v=this.evaluatedMeshParams.sprite?.textureBinding;const F=C.getDisplayId();B.recordStart(this.instanceId,this.attributeLayout,v);v=this.evaluatedMeshParams.minPixelBuffer;
const D=Math.max(this.evaluatedMeshParams.computedWidth,v),G=Math.max(this.evaluatedMeshParams.computedHeight,v),E=this.evaluatedMeshParams.offsetX+-this.evaluatedMeshParams.anchorX*this.evaluatedMeshParams.computedWidth,H=-this.evaluatedMeshParams.offsetY+this.evaluatedMeshParams.anchorY*this.evaluatedMeshParams.computedHeight;if(null!=this.evaluatedMeshParams.placement)this._writePlacedMarkers(B,C,y,D,G);else if(y?.nextPath())y.nextPoint(),C=y.x,y=y.y,B.recordBounds(C+E,y+H,D,G),this._writeQuad(B,
F,C,y);else if("esriGeometryPolygon"===C.geometryType){C=C.readCentroidForDisplay();if(!C)return;const [K,J]=C.coords;B.recordBounds(K+E,J+H,D,G);this._writeQuad(B,F,K,J)}else"esriGeometryPoint"===C.geometryType?(y=C.readXForDisplay(),C=C.readYForDisplay(),B.recordBounds(y+E,C+H,D,G),this._writeQuad(B,F,y,C)):C.readGeometryForDisplay()?.forEachVertex((K,J)=>{B.recordBounds(K+E,J+H,D,G);Math.abs(K)>l.maxTileCoordValue||Math.abs(J)>l.maxTileCoordValue||this._writeQuad(B,F,K,J)});B.recordEnd()}_writePlacedMarkers(B,
C,y,v,F){if(y=y??m.GeometryCursor.fromFeatureSetReaderCIM(C)?.clone())if(y=a.CIMMarkerPlacementHelper.getPlacement(y,-1,this.evaluatedMeshParams.placement,r.pt2px(1),B.id,c.getGeometryEngine())){C=C.getDisplayId();for(var D=y.next(),G=this.evaluatedMeshParams.offsetX,E=-this.evaluatedMeshParams.offsetY;null!=D;){const H=D.tx,K=-D.ty;Math.abs(H)>l.maxTileCoordValue||Math.abs(K)>l.maxTileCoordValue?D=y.next():(D=-D.getAngle(),B.recordBounds(H+G,K+E,v,F),this._writeQuad(B,C,H,K,D),D=y.next())}}}_writeQuad(B,
C,y,v,F){const D=B.vertexCount();this._writeVertex(B,C,y,v,null==F?null:{placementAngle:F});B.indexWrite(D+0);B.indexWrite(D+1);B.indexWrite(D+2);B.indexWrite(D+1);B.indexWrite(D+3);B.indexWrite(D+2)}}k.MarkerMeshWriter=x;k.MarkerVertexSpec=w;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/markers/ComputedMarkerParams":function(){define(["exports","../../../../../../../core/screenUtils","../../../../../../../symbols/cim/enums","../../../../../../../symbols/cim/utils",
"../../../definitions"],function(k,r,p,e,n){function m(a,b=1E-7){const f=Math.ceil(a);return f-a<b?f:Math.floor(a)}function l(a,b=1E-7){const f=Math.floor(a);return a-f<b?f:Math.ceil(a)}class d{static from(a){return"width"in a?this.fromSimpleMeshParams(a):this.fromComplexMeshParams(a)}static fromSimpleMeshParams(a){const b=new d(a.sprite,a.color,a.outlineColor,a.minPixelBuffer,a.placement,a.scaleInfo,a.effects),{type:f,width:g,height:q,angle:c,alignment:h,outlineSize:u,referenceSize:A,sprite:z,overrideOutlineColor:t}=
a;b.rawWidth=r.pt2px(g);b.rawHeight=r.pt2px(q);b.angle=c;b.alignment=h;b.outlineSize=r.pt2px(u);b.referenceSize=r.pt2px(A);b.overrideOutlineColor=t;b.offsetX=r.pt2px(a.offsetX);b.offsetY=r.pt2px(a.offsetY);"simple"!==f||z.sdf||(b.rawWidth=z.width,b.rawHeight=z.height);b._computeSize(a,!1);return b}static fromComplexMeshParams(a){const b=new d(a.sprite,a.color,a.outlineColor,a.minPixelBuffer,a.placement,a.scaleInfo,a.effects);let {alignment:f,transforms:g,size:q,scaleX:c,anchorX:h,anchorY:u,angle:A,
colorLocked:z,frameHeight:t,widthRatio:w,offsetX:x,offsetY:B,outlineSize:C,referenceSize:y,scaleFactor:v,sizeRatio:F,isAbsoluteAnchorPoint:D,rotateClockwise:G,scaleSymbolsProportionally:E,sprite:H}=a;if(g&&0<g.infos.length){var K=e.applyParentTransform(q,A,G,x,B,g);q=K.size;A=K.rotation;x=K.offsetX;B=K.offsetY;G=!1}v&&(q*=v,x*=v,B*=v);K=H.width/H.height*c;b.alignment=f;b.rawHeight=r.pt2px(q);b.rawWidth=b.rawHeight*K;b.referenceSize=r.pt2px(y);b.sizeRatio=F;b.sdfDecodeCoeff=(H.sdfDecodeCoeff??1)*F;
b.angle=A;b.rotateClockwise=G;b.anchorX=h;b.anchorY=u;b.offsetX=r.pt2px(x);b.offsetY=r.pt2px(B);D&&q&&(b.anchorX=H.sdf?h/(q*w):h/(q*K),b.anchorY=u/q);K=E&&t?q/t:1;b.outlineSize=0===C||isNaN(C)?0:r.pt2px(C)*K;b.scaleSymbolsProportionally=E;b.colorLocked=z;b._computeSize(a,!0);return b}constructor(a,b,f,g,q,c,h){this.sprite=a;this.color=b;this.outlineColor=f;this.minPixelBuffer=g;this.placement=q;this.scaleInfo=c;this.effects=h;this.referenceSize=this.outlineSize=this.angle=this.rawHeight=this.rawWidth=
0;this.sdfDecodeCoeff=this.sizeRatio=1;this.alignment=p.Alignment.SCREEN;this.colorLocked=this.overrideOutlineColor=this.scaleSymbolsProportionally=!1;this.offsetY=this.offsetX=this.texYmax=this.texXmax=this.texYmin=this.texXmin=this.computedHeight=this.computedWidth=this.anchorY=this.anchorX=0;this.rotateClockwise=!0}get boundsInfo(){return{size:Math.max(this.computedHeight,this.computedWidth),offsetX:this.offsetX,offsetY:this.offsetY}}_computeSize(a,b){const {sprite:f,hasSizeVV:g}=a;var q=!!f.sdf;
const c=f.sdfPaddingRatio??.5,{rawWidth:h,rawHeight:u,sizeRatio:A,outlineSize:z}=this;var t=f.rect;a=h*A;let w=u*A;var x=0,B=0;q?(q=1/(1-c),a*=q,w*=q,g?(this.computedWidth=a,this.computedHeight=w):(x=z+2,this.computedWidth=Math.min((b&&h>u?a:h)+x,a),this.computedHeight=Math.min(u+x,w),B=Math.max(f.width,f.height)/Math.max(a,w),x=(this.computedWidth-a)*B,B*=this.computedHeight-w)):(this.computedWidth=t.width/f.width*a,this.computedHeight=t.height/f.height*w,x=2*n.spritePadding,B=2*n.spritePadding);
b=t.x+n.spritePadding-x/2;t=t.y+n.spritePadding-B/2;x=b+f.width+x;B=t+f.height+B;this.texXmin=m(b);this.texYmin=m(t);this.texXmax=l(x);this.texYmax=l(B);this.computedWidth*=(this.texXmax-this.texXmin)/(x-b);this.computedHeight*=(this.texYmax-this.texYmin)/(B-t);this.anchorX*=a/this.computedWidth;this.anchorY*=w/this.computedHeight}}k.ComputedMarkerParams=d;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/MeshWriterInputEvaluator":function(){define("exports ../../../../../../../core/arrayUtils ../../../../../../../core/Error ../../../../../../../core/lang ../../../../../../../core/Logger ../../../../../../../support/arcadeOnDemand ../../../grouping ../../../animations/infos ../../../animations/utils ./utils ../../../../../layers/features/support/DictionaryValue".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f){async function g(A,z,t=!1){const {defaultValue:w,valueExpressionInfo:x,value:B}=z;if(x){const {expression:C}=x;return(A=await A.createComputedField({expression:C},t))?{...z,computed:A,defaultValue:w}:null}return{...z,computed:new f.DictionaryValue(B),defaultValue:w}}async function q(A,z){var {valueExpressionInfo:t}=z;({expression:t}=t);return(A=await A.createComputedField({expression:t}))?{...z,computed:A}:null}function c(A){return"object"!==typeof A||null==A?!1:"valueExpressionInfo"in
A&&A.valueExpressionInfo||"type"in A&&"Process"===A.type&&"op"in A&&"Random"===A.op?!0:!1}function h(A){if(Array.isArray(A))for(const z of A)if(h(z))return!0;if("object"===typeof A){if(c(A))return!0;for(const z in A)if(h(A[z]))return!0}return!1}class u{static async create(A,z,t){const w={},x=new Map,B=new Map,C=new Map,y=new Map,v=new Map,F=new Map;for(const G in t){const E=t[G];if(null==E||"object"!==typeof E)w[G]=E;else if(Array.isArray(E)){if("object"===typeof E[0])throw Error(`InternalError: Cannot handle ${G}. Nested array params are not supported`);
w[G]=E}else if("valueExpressionInfo"in E)if(E.value)w[G]=E.value;else{var D=await q(A,E);D?(x.set(G,D),w[G]=null):w[G]=E.defaultValue}else switch(E.type){case "cim-effect-infos":if(E.effectInfos.some(H=>H.overrides.length)){B.set(G,{effects:await Promise.all(E.effectInfos.map(async H=>{const K=H.overrides.map(J=>g(A,J));return{effect:H.effect,compiledOverrides:(await Promise.all(K)).filter(r.isSome)}}))});break}w[G]=E.effectInfos.map(H=>H.effect);break;case "cim-marker-placement-param":E.overrides.length&&
C.set(G,{placementInfo:E,compiledOverrides:(await Promise.all(E.overrides.map(H=>g(A,H)))).filter(r.isSome)});w[G]=E.placement;break;case "text-rasterization-param":if(E.overrides.length){D=E.overrides.map(H=>g(A,H,E.useLegacyLabelEvaluationRules));y.set(G,{compiledOverrides:(await Promise.all(D)).filter(r.isSome),rasterizationParam:E,objectIdToResourceId:new Map});continue}w[G]=await z.fetchResourceImmediate({type:"cim-rasterization-info",resource:E.resource})??null;break;case "sprite-rasterization-param":if(E.overrides.length){D=
E.overrides.map(H=>g(A,H));y.set(G,{compiledOverrides:(await Promise.all(D)).filter(r.isSome),rasterizationParam:E,objectIdToResourceId:new Map});continue}if("animated"===E.resource.type){y.set(G,{compiledOverrides:[],rasterizationParam:E,objectIdToResourceId:new Map});continue}w[G]=await z.fetchResourceImmediate({type:"cim-rasterization-info",resource:E.resource})??null;break;case "cim-marker-transform-param":({params:D}=E);if(h(D)){const H={compiledMarkerInfos:[]};await Promise.all(D.map(async K=>
{const J={props:{}};for(const L in K)if(c(K[L])){const P=await q(A,K[L]);J.compiledExpressionMap||(J.compiledExpressionMap=new Map);const Q=J.compiledExpressionMap;P&&Q.set(L,P)}else J.props[L]=K[L];H.compiledMarkerInfos.push(J)}));v.set(G,H)}else w[G]={type:"cim-marker-transform-info",infos:D};break;case "animation-params":({params:D}=E);D=a.createParamList(D);h(D)?(D=await Promise.all(D.map(H=>a.compileAnimationParam(H,A))),F.set(G,{params:D,propertyIdToResourceId:new Map,key:G})):(D=a.fromJSON(D),
D=await z.fetchResourceImmediate({type:"animation-info",resource:D}),null!=D&&"sprite"===D.type&&(w[G]={dataRow:D.rect.y,dataColumn:D.rect.x}));break;default:w[G]=E}}return new u(t,w,x,B,C,y,v,F)}constructor(A,z,t,w,x,B,C,y){this.inputMeshParams=A;this._resolvedMeshParams=z;this._dynamicProperties=t;this._dynamicEffectProperties=w;this._dynamicPlacementProperties=x;this._dynamicAsyncProperties=B;this._dynamicTransformProperties=C;this._dynamicAsyncAnimations=y;this.evaluator=v=>v;this._arcadeDependencies=
new Set;for(const v of this._expressions())m.collectExpressionDependencies(this._arcadeDependencies,v)}get hasDynamicProperties(){return!!(this._dynamicProperties.size||this._dynamicAsyncProperties.size||this._dynamicEffectProperties.size||this._dynamicTransformProperties.size||this._dynamicPlacementProperties.size||this._dynamicAsyncAnimations.size)}get evaluatedMeshParams(){this._evaluatedMeshParams||(this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams));return this._evaluatedMeshParams}enqueueRequest(A,
z,t){for(var w of this._dynamicAsyncProperties.values()){var x=e.clone(w.rasterizationParam.resource);"animated"===w.rasterizationParam.resource.type&&w.rasterizationParam.resource.randomizeStartTime&&(x.primitiveName="__RESERVED__PRIMITIVE__NAME__",x.startGroup=l.getStartGroup(z.getObjectId()||0));for(const {primitiveName:B,propertyName:C,computed:y,defaultValue:v,valueExpressionInfo:F}of w.compiledOverrides)try{b.applyComputedValue(x,"animated"===w.rasterizationParam.resource.type?x.primitiveName:
B,C,y,z,t,v)}catch(D){n.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.mesh.MeshWriterInputEvaluator").errorOnce(new p("invalid-arcade-expression",`Encountered an error when evaluating the arcade expression '${F?.expression}' (primitive: '${B}', property: '${C}')`,D))}x=A.enqueueRequest({type:"cim-rasterization-info",resource:x});w.objectIdToResourceId.set(z.getObjectId(),x)}for(const B of this._dynamicAsyncAnimations.values())w=B.params.map(C=>a.resolveToAnimationInfo(C,z,t)).map(d.hydrate).map(C=>
C.simplify()),w=a.encodeParamList(w),w=A.enqueueRequest({type:"animation-info",resource:w}),B.propertyIdToResourceId.set(z.getObjectId()+"."+B.key,w)}evaluateMeshParams(A,z,t){for(const [B,C]of this._dynamicProperties.entries())this._resolvedMeshParams[B]=C.computed.readWithDefault(z,t,C.defaultValue);for(const [B,C]of this._dynamicPlacementProperties.entries())for(const {computed:y,defaultValue:v,propertyName:F}of C.compiledOverrides){var w=y.readWithDefault(z,t,v);C.placementInfo.placement[F]=w;
this._resolvedMeshParams[B]=C.placementInfo.placement}for(const [B,C]of this._dynamicEffectProperties.entries())for(var x of C.effects){for(const {computed:y,defaultValue:v,propertyName:F}of x.compiledOverrides)w=y.readWithDefault(z,t,v),x.effect[F]=w;this._resolvedMeshParams[B]=C.effects.map(y=>y.effect)}for(const [B,C]of this._dynamicTransformProperties.entries()){x={type:"cim-marker-transform-info",infos:[]};for(const y of C.compiledMarkerInfos){w={...y.props};if(y.compiledExpressionMap)for(const [v,
F]of y.compiledExpressionMap){const D=F.computed.readWithDefault(z,t,F.defaultValue);w[v]="number"===typeof D||"boolean"===typeof D?D:F.defaultValue}x.infos.push(w)}this._resolvedMeshParams[B]=x}for(const [B,C]of this._dynamicAsyncProperties.entries())t=C.objectIdToResourceId.get(z.getObjectId()),null!=t&&(t=A.getResource(t),this._resolvedMeshParams[B]=t);for(const [B,C]of this._dynamicAsyncAnimations.entries())t=C.propertyIdToResourceId.get(z.getObjectId()+"."+B),null!=t&&(t=A.getResource(t),this._resolvedMeshParams[B]=
{dataRow:t.rect.y,dataColumn:t.rect.x});this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams);return this.evaluatedMeshParams}hasArcadeDependency(A){return this._arcadeDependencies.has(A)}*_expressions(){for(const A of this._dynamicProperties.values())yield A.computed;for(const A of this._dynamicEffectProperties.values())for(const z of A.effects)for(const t of z.compiledOverrides)yield t.computed;for(const A of this._dynamicPlacementProperties.values())for(const z of A.compiledOverrides)yield z.computed;
for(const A of this._dynamicAsyncProperties.values())for(const z of A.compiledOverrides)yield z.computed;for(const A of this._dynamicTransformProperties.values())for(const z of A.compiledMarkerInfos)if(null!=z.compiledExpressionMap)for(const t of z.compiledExpressionMap.values())yield t.computed;for(const A of this._dynamicAsyncAnimations.values())for(const z of A.params)yield*a.getAnimationExpressions(z)}}k.MeshWriterInputEvaluator=u;k.hasExpression=c;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/animations/infos":function(){define(["exports","./instructions"],function(k,r){function p(a){return a instanceof e?a:"object"===typeof a&&"type"in a?d[a.type].hydrate(a):new n(a)}class e{constructor(a){this.inputs=a}encode(){const a=[];for(const b of this.inputs)a.push(...b.encode());a.push(...this.instructions);return a}}class n extends e{constructor(a){super([]);this.value=a}simplify(){return this}get instructions(){if(Array.isArray(this.value)){const [a,b,f,g]=this.value;
return null!=g?r.instructions.vector4.encode([a,b||0,f||0,g]):r.instructions.vector3.encode([a,b||0,f||0])}return r.instructions.scalar.encode(this.value)}}class m extends e{constructor(a,b){super([b]);this._config=a;this._parent=b}static hydrate(a){return new m(a,p(a.parent))}simplify(){if(this._config.relativeTranslation||this._config.absoluteScale)return this;var a=this._parent.simplify();if(!(a instanceof n))return this;const [b,f,g,q]=a.value,c=this._config.translation.from[0],h=this._config.translation.from[1],
u=this._config.rotation.from,A=this._config.scale.from;if(c===this._config.translation.to[0]&&h===this._config.translation.to[1]&&u===this._config.rotation.to&&A===this._config.scale.to){a=Math.sin(g);const z=Math.cos(g);return new n([z*q*c-a*q*h+b,a*q*c+z*q*h+f,g+u,q*A])}return new m(this._config,a)}get instructions(){return r.instructions.animatedTransform.encode(this._config)}}class l extends e{constructor(a,b){super([b]);this._config=a;this._parent=b}static hydrate(a){return new l(a,p(a.parent))}simplify(){const a=
this._parent.simplify();if(!(a instanceof n))return this;const [b,f,g,q]=a.value,c=this._config.color.from[0],h=this._config.color.from[1],u=this._config.color.from[2];let A=this._config.color.from[3];const z=this._config.opacity.from;return c===this._config.color.to[0]&&h===this._config.color.to[1]&&u===this._config.color.to[2]&&A===this._config.color.to[3]&&z===this._config.opacity.to?new n([b*c,f*h,g*u,q*A*z]):new l(this._config,a)}get instructions(){return r.instructions.animatedColor.encode(this._config)}}
const d={AnimatedTransform:m,AnimatedColor:l};k.AAnimationInfo=e;k.AnimatedColor=l;k.AnimatedTransform=m;k.Constant=n;k.hydrate=p;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/animations/utils":function(){define(["exports","../../../../../Color","../grouping","./infos","./instructions"],function(k,r,p,e,n){function m(f){const g=[],q=[];let c=0;for(const h of f){const u=[...h.encode(),...n.instructions.ret.encode()];g.push([c+f.length,0,0,0]);q.push(...u);
c+=u.length}return[...g,...q]}async function l(f,g){if("number"===typeof f||"string"===typeof f||"boolean"===typeof f)var q=f;else if(Array.isArray(f))q=await Promise.all(f.map(c=>l(c,g)));else if("object"===typeof f)if("valueExpressionInfo"in f)({valueExpressionInfo:q}=f),{expression:q}=q,q={...f,computed:await g.createComputedField({expression:q})};else{q={};for(const c in f)q[c]=await l(f[c],g)}return q}function d(f,g,q){function c(z){if(!("computed"in z))return z;z=z.computed.readWithDefault(g,
q,[255*z.defaultValue[0],255*z.defaultValue[1],255*z.defaultValue[2],z.defaultValue[3]]);if("string"===typeof z){const t=r.fromString(z);t&&(z=[t.r,t.g,t.b,t.a])}return z}if("number"===typeof f||"string"===typeof f||"boolean"===typeof f)var h=f;else if(Array.isArray(f))h=f.map(z=>d(z,g,q));else if("object"===typeof f)if("type"in f&&null!=f.type&&"Process"===f.type)switch(f.op){case "ArcadeColor":f=d(f.value,g,q);b(Array.isArray(f)&&4===f.length);h=[f[0]/255,f[1]/255,f[2]/255,f[3]];break;case "Transparency":f=
d(f.value,g,q);b("number"===typeof f);h=1-f/100;break;case "Divide":case "Add":var u=d(f.left,g,q);b("number"===typeof u);var A=d(f.right,g,q);b("number"===typeof A);switch(f.op){case "Divide":h=u/A;break;case "Add":h=u+A}break;case "Random":h=d(f.seed,g,q);u=d(f.min,g,q);f=d(f.max,g,q);A=g.getObjectId();A=p.getStartGroup(A||0);h=u+p.getRandomValue(A,h)*(f-u);break;case "Cond":h=d(f.condition,g,q);u=d(f.ifTrue,g,q);f=d(f.ifFalse,g,q);h=h?u:f;break;case "MatchWinding":h=d(f.sign,g,q);f=d(f.angle,g,
q);if(0<h)for(;0>f;)f+=2*Math.PI;else for(;0<f;)f-=2*Math.PI;h=f}else if("computed"in f)h=c(f);else for(u in h={},f)h[u]=d(f[u],g,q);return h}function*a(f){if(Array.isArray(f))for(const g of f)yield*a(g);else if("object"===typeof f)if("type"in f&&null!=f.type&&"Process"===f.type)switch(f.op){case "ArcadeColor":case "Transparency":yield*a(f.value);break;case "Divide":case "Add":yield*a(f.left);yield*a(f.right);break;case "Random":yield*a(f.seed);yield*a(f.min);yield*a(f.max);break;case "Cond":yield*a(f.condition);
yield*a(f.ifTrue);yield*a(f.ifFalse);break;case "MatchWinding":yield*a(f.sign),yield*a(f.angle)}else if("computed"in f)yield f.computed;else for(const g in f)yield*a(f[g])}function b(f){if(!f)throw Error("Assertion failed.");}k.assert=b;k.compileAnimationParam=l;k.createParamList=function(f){const g=[];g.push(f.transform);g.push(f.fromColor);g.push(f.toColor);g.push(f.colorMix);g.push(f.toOpacity);g.push(f.opacityMix);return g};k.encodeParamList=m;k.fromJSON=function(f){f=f.map(g=>d(g)).map(g=>e.hydrate(g).simplify());
return m(f)};k.getAnimationExpressions=a;k.resolveToAnimationInfo=d;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/DictionaryValue":function(){define(["exports","./AComputedField"],function(k,r){class p extends r.AComputedField{constructor(e){super();this._value=e}resize(e){}read(e,n){return this._value}readWithDefault(e,n,m){return this._value}hasArcadeDependency(e){return!1}}k.DictionaryValue=p;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/layers/features/support/AComputedField":function(){define(["exports"],function(k){class r{destroy(){}}k.AComputedField=r;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/pieChart/PieChartMeshWriter":function(){define(["exports","../../../../../../../core/screenUtils","../fill/meshWriterUtils","../mesh/MeshWriter","../../../../../../webgl/enums"],function(k,r,p,e,n){const m={createComputedParams:d=>d,optionalAttributes:{},
attributes:{pos:{type:n.DataType.SHORT,count:2,packPrecisionFactor:10,pack:"position"},id:{type:n.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:n.DataType.UNSIGNED_BYTE,count:1,pack:d=>0},offset:{type:n.DataType.SHORT,count:2,packPrecisionFactor:16,packAlternating:{count:4,pack:({size:d})=>{d=r.pt2px(d);const a=-d/2,b=-d/2;return[[a,b],[a+d,b],[a,b+d],[a+d,b+d]]}}},texCoords:{type:n.DataType.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:()=>[[0,1],[1,1],[0,0],[1,0]]}},
size:{type:n.DataType.UNSIGNED_BYTE,count:2,pack:({size:d})=>[d,d]},referenceSize:{type:n.DataType.UNSIGNED_BYTE,count:1,pack:({size:d})=>r.pt2px(d)},zoomRange:{type:n.DataType.UNSIGNED_BYTE,count:2,pack:({scaleInfo:d},{tileInfo:a})=>p.getMinMaxZoom(d,a)}}};class l extends e.MeshWriter{constructor(){super(...arguments);this.vertexSpec=m}_write(d,a){const b=a.getDisplayId();var f=this.evaluatedMeshParams.minPixelBuffer,g=Math.max(r.pt2px(this.evaluatedMeshParams.size),f);if("esriGeometryPoint"===a.geometryType)f=
a.readXForDisplay(),a=a.readYForDisplay();else{a=a.readCentroidForDisplay();if(!a)return;f=a?.coords[0];a=a?.coords[1]}d.recordStart(this.instanceId,this.attributeLayout);d.recordBounds(f,a,g,g);g=d.vertexCount();this._writeVertex(d,b,f,a);d.indexWrite(g+0);d.indexWrite(g+1);d.indexWrite(g+2);d.indexWrite(g+1);d.indexWrite(g+3);d.indexWrite(g+2);d.recordEnd()}}k.PieChartMeshWriter=l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/RenderingContext":function(){define("exports ../../core/has ../../core/maybe ../../core/promiseUtils ../../core/time ./checkWebGLError ./ContextState ./enums ./InstanceCounter ./Parameters ./ProgramCache ./renderState ./Texture ./Util ./WebGLDriverTest ./capabilities/Capabilities".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g,q,c,h,u){function A(t,w,x,B){w?B!==w&&t.bindBuffer(x,w.glName):t.bindBuffer(x,null);return w}function z(t,w){switch(t){case d.PrimitiveType.POINTS:return 2*w;case d.PrimitiveType.TRIANGLES:return w/3;case d.PrimitiveType.TRIANGLE_STRIP:return w-2;case d.PrimitiveType.TRIANGLE_FAN:return w-2;default:return 0}}k.RenderingContext=class{constructor(t,w){this.gl=t;this.instanceCounter=new a.InstanceCounter;this.programCache=new f.ProgramCache(this);this._transformFeedbackRequestInfo=
null;this._state=new l.ContextState;this._numOfTriangles=this._numOfDrawCalls=0;this._loadExtensions();this.configure(w)}configure(t){this._capabilities=new u.Capabilities(this.gl,t);this._parameters=new b.Parameters(this.gl,this._capabilities,t);q.Texture.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;t=this.gl.getParameter(this.gl.VIEWPORT);this._state=new l.ContextState;this._state.viewport={x:t[0],y:t[1],width:t[2],height:t[3]};this._stateTracker=new g.StateTracker({setBlending:w=>
{w?(this.setBlendingEnabled(!0),this.setBlendEquationSeparate(w.opRgb,w.opAlpha),this.setBlendFunctionSeparate(w.srcRgb,w.dstRgb,w.srcAlpha,w.dstAlpha),w=w.color,this.setBlendColor(w.r,w.g,w.b,w.a)):this.setBlendingEnabled(!1)},setCulling:w=>{w?(this.setFaceCullingEnabled(!0),this.setCullFace(w.face),this.setFrontFace(w.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:w=>{w?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(w.factor,w.units)):this.setPolygonOffsetFillEnabled(!1)},
setDepthTest:w=>{w?(this.setDepthTestEnabled(!0),this.setDepthFunction(w.func)):this.setDepthTestEnabled(!1)},setStencilTest:w=>{if(w){this.setStencilTestEnabled(!0);const x=w.function;this.setStencilFunction(x.func,x.ref,x.mask);w=w.operation;this.setStencilOp(w.fail,w.zFail,w.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:w=>{w?(this.setDepthWriteEnabled(!0),this.setDepthRange(w.zNear,w.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:w=>{w?this.setColorMask(w.r,w.g,w.b,w.a):this.setColorMask(!1,
!1,!1,!1)},setStencilWrite:w=>{w?this.setStencilWriteMask(w.mask):this.setStencilWriteMask(0)},setDrawBuffers:w=>{w?this.setDrawBuffers(w.buffers):({drawFramebuffer:w}=this._state,null===w?this.setDrawBuffers([d.SpecialDrawBuffers.BACK]):0===w.colorAttachments.length?this.setDrawBuffers([d.SpecialDrawBuffers.NONE]):this.setDrawBuffers([d.ColorAttachment.COLOR_ATTACHMENT0]))}});this.enforceState();p.disposeMaybe(this._driverTest);this._driverTest=new h.WebGLDriverTest(this)}dispose(){p.disposeMaybe(this._driverTest);
this.programCache.dispose();this.bindVAO(null);this.unbindBuffer(d.BufferType.ARRAY_BUFFER);this.unbindBuffer(d.BufferType.ELEMENT_ARRAY_BUFFER);this.unbindBuffer(d.BufferType.UNIFORM_BUFFER);this._state.uniformBufferBindingPoints.length=0;this.unbindBuffer(d.BufferType.PIXEL_PACK_BUFFER);this.unbindBuffer(d.BufferType.PIXEL_UNPACK_BUFFER);this.unbindBuffer(d.BufferType.COPY_READ_BUFFER);this.unbindBuffer(d.BufferType.COPY_WRITE_BUFFER);this._state.textureUnitMap.length=0;m.webglDebugEnabled()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(t){this._stateTracker.setPipeline(t)}setBlendingEnabled(t){this._state.blend!==
t&&(!0===t?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=t,this._stateTracker.invalidateBlending())}externalProgramUpdate(){this._state.program?.stop();this._state.program=null}externalTextureUnitUpdate(t,w){for(let x=0;x<t.length;++x)this._state.textureUnitMap[t[x]]=null;0<=w&&(this._state.activeTexture=w)}externalVertexArrayObjectUpdate(){this.gl.bindVertexArray(null);this._state.vertexArrayObject=null;this._state.vertexBuffer=null;this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=
null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(t,w,x,B){if(t!==this._state.blendColor.r||w!==this._state.blendColor.g||x!==this._state.blendColor.b||B!==this._state.blendColor.a)this.gl.blendColor(t,w,x,B),this._state.blendColor.r=t,this._state.blendColor.g=w,this._state.blendColor.b=x,this._state.blendColor.a=B,this._stateTracker.invalidateBlending()}setBlendFunction(t,w){if(t!==this._state.blendFunction.srcRGB||w!==this._state.blendFunction.dstRGB)this.gl.blendFunc(t,
w),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=t,this._state.blendFunction.dstRGB=w,this._state.blendFunction.dstAlpha=w,this._stateTracker.invalidateBlending()}setBlendFunctionSeparate(t,w,x,B){if(this._state.blendFunction.srcRGB!==t||this._state.blendFunction.srcAlpha!==x||this._state.blendFunction.dstRGB!==w||this._state.blendFunction.dstAlpha!==B)this.gl.blendFuncSeparate(t,w,x,B),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=x,this._state.blendFunction.dstRGB=
w,this._state.blendFunction.dstAlpha=B,this._stateTracker.invalidateBlending()}setBlendEquation(t){this._state.blendEquation.mode!==t&&(this.gl.blendEquation(t),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=t,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(t,w){if(this._state.blendEquation.mode!==t||this._state.blendEquation.modeAlpha!==w)this.gl.blendEquationSeparate(t,w),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=w,this._stateTracker.invalidateBlending()}setColorMask(t,
w,x,B){if(this._state.colorMask.r!==t||this._state.colorMask.g!==w||this._state.colorMask.b!==x||this._state.colorMask.a!==B)this.gl.colorMask(t,w,x,B),this._state.colorMask.r=t,this._state.colorMask.g=w,this._state.colorMask.b=x,this._state.colorMask.a=B,this._stateTracker.invalidateColorWrite()}setClearColor(t,w,x,B){if(this._state.clearColor.r!==t||this._state.clearColor.g!==w||this._state.clearColor.b!==x||this._state.clearColor.a!==B)this.gl.clearColor(t,w,x,B),this._state.clearColor.r=t,this._state.clearColor.g=
w,this._state.clearColor.b=x,this._state.clearColor.a=B}setFaceCullingEnabled(t){this._state.faceCulling!==t&&(!0===t?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=t,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(t){this._state.polygonOffsetFill!==t&&(!0===t?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=t,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(t,
w){if(this._state.polygonOffset[0]!==t||this._state.polygonOffset[1]!==w)this._state.polygonOffset[0]=t,this._state.polygonOffset[1]=w,this.gl.polygonOffset(t,w),this._stateTracker.invalidatePolygonOffset()}setCullFace(t){this._state.cullFace!==t&&(this.gl.cullFace(t),this._state.cullFace=t,this._stateTracker.invalidateCulling())}setFrontFace(t){this._state.frontFace!==t&&(this.gl.frontFace(t),this._state.frontFace=t,this._stateTracker.invalidateCulling())}setScissorTestEnabled(t){this._state.scissorTest!==
t&&(!0===t?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=t)}setScissorRect(t,w,x,B){if(this._state.scissorRect.x!==t||this._state.scissorRect.y!==w||this._state.scissorRect.width!==x||this._state.scissorRect.height!==B)this.gl.scissor(t,w,x,B),this._state.scissorRect.x=t,this._state.scissorRect.y=w,this._state.scissorRect.width=x,this._state.scissorRect.height=B}setDepthTestEnabled(t){this._state.depthTest!==t&&(!0===t?this.gl.enable(this.gl.DEPTH_TEST):
this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=t,this._stateTracker.invalidateDepthTest())}setClearDepth(t){this._state.clearDepth!==t&&(this.gl.clearDepth(t),this._state.clearDepth=t)}setDepthFunction(t){this._state.depthFunction!==t&&(this.gl.depthFunc(t),this._state.depthFunction=t,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(t){this._state.depthWrite!==t&&(this.gl.depthMask(t),this._state.depthWrite=t,this._stateTracker.invalidateDepthWrite())}setDepthRange(t,w){if(this._state.depthRange.zNear!==
t||this._state.depthRange.zFar!==w)this.gl.depthRange(t,w),this._state.depthRange.zNear=t,this._state.depthRange.zFar=w,this._stateTracker.invalidateDepthWrite()}setStencilTestEnabled(t){this._state.stencilTest!==t&&(!0===t?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=t,this._stateTracker.invalidateStencilTest())}setClearStencil(t){t!==this._state.clearStencil&&(this.gl.clearStencil(t),this._state.clearStencil=t)}setStencilFunction(t,w,x){if(this._state.stencilFunction.func!==
t||this._state.stencilFunction.ref!==w||this._state.stencilFunction.mask!==x)this.gl.stencilFunc(t,w,x),this._state.stencilFunction.face=d.Face.FRONT_AND_BACK,this._state.stencilFunction.func=t,this._state.stencilFunction.ref=w,this._state.stencilFunction.mask=x,this._stateTracker.invalidateStencilTest()}setStencilFunctionSeparate(t,w,x,B){if(this._state.stencilFunction.face!==t||this._state.stencilFunction.func!==w||this._state.stencilFunction.ref!==x||this._state.stencilFunction.mask!==B)this.gl.stencilFuncSeparate(t,
w,x,B),this._state.stencilFunction.face=t,this._state.stencilFunction.func=w,this._state.stencilFunction.ref=x,this._state.stencilFunction.mask=B,this._stateTracker.invalidateStencilTest()}setStencilWriteMask(t){this._state.stencilWriteMask!==t&&(this.gl.stencilMask(t),this._state.stencilWriteMask=t,this._stateTracker.invalidateStencilWrite())}setStencilOp(t,w,x){if(this._state.stencilOperation.face!==d.Face.FRONT_AND_BACK||this._state.stencilOperation.fail!==t||this._state.stencilOperation.zFail!==
w||this._state.stencilOperation.zPass!==x)this.gl.stencilOp(t,w,x),this._state.stencilOperation.face=d.Face.FRONT_AND_BACK,this._state.stencilOperation.fail=t,this._state.stencilOperation.zFail=w,this._state.stencilOperation.zPass=x,this._stateTracker.invalidateStencilTest()}setStencilOpSeparate(t,w,x,B){if(this._state.stencilOperation.face!==t||this._state.stencilOperation.fail!==w||this._state.stencilOperation.zFail!==x||this._state.stencilOperation.zPass!==B)this.gl.stencilOpSeparate(t,w,x,B),
this._state.stencilOperation.face=t,this._state.stencilOperation.fail=w,this._state.stencilOperation.zFail=x,this._state.stencilOperation.zPass=B,this._stateTracker.invalidateStencilTest()}setActiveTexture(t,w=!1){const x=this._state.activeTexture;0<=t&&(w||t!==this._state.activeTexture)&&(this.gl.activeTexture(d.baseTextureUnit+t),this._state.activeTexture=t);return x}setDrawBuffers(t){const {drawFramebuffer:w}=this._state,x=null===w,B=x?this._state.drawBuffers.defaultFramebuffer:this._state.drawBuffers.fbos.get(w);
if(B?.length!==t.length||!B.every((C,y)=>C===t[y]))if(t.length>this.parameters.maxDrawBuffers)console.error("Setting more active draw buffers than GL.MAX_DRAW_BUFFERS allows.");else{if(x){if(1<t.length){console.error("The default framebuffer can only have one active draw buffer.");return}if(t[0]!==d.SpecialDrawBuffers.BACK&&t[0]!==d.SpecialDrawBuffers.NONE){console.error("The default framebuffer can only use the constants GL.BACK or GL.NONE as draw buffers.");return}}!x&&t.includes(d.SpecialDrawBuffers.BACK)?
console.error("A framebuffer object can only use the constants GL.COLOR_ATTACHMENTi or GL.NONE as draw buffers."):(this.gl.drawBuffers(t),x?this._state.drawBuffers.defaultFramebuffer=t:this._state.drawBuffers.fbos.set(w,t),this._stateTracker.invalidateDrawBuffers())}}clear(t,w=255){if(t){if(t&d.FramebufferBit.COLOR){const x=this._state.drawFramebuffer?.colorAttachments;x&&this.setDrawBuffers(x);this.setColorMask(!0,!0,!0,!0)}t&d.FramebufferBit.DEPTH&&this.setDepthWriteEnabled(!0);t&d.FramebufferBit.STENCIL&&
this.setStencilWriteMask(w);this.gl.clear(t)}}clearFramebuffer(t,w=!1,x=!1){let B=0;t&&(this.setClearColor(t[0],t[1],t[2],Math.max(1E-13,t[3])),B|=d.FramebufferBit.COLOR);w&&(B|=d.FramebufferBit.DEPTH);!1===x?x=0:(!0===x&&(x=255),B|=d.FramebufferBit.STENCIL);B&&this.clear(B,x)}drawArrays(t,w,x){if(this._transformFeedbackRequestInfo){if(t!==this._transformFeedbackRequestInfo.primitiveType)throw Error("DrawArrays called during transform feedback, but primitiveType does not match that of the current transform feedback request");
if(null==this._state.program?.hasTransformFeedbackVaryings)throw Error("DrawArrays called during transform feedback, but the shader program was not linked with a transform feedback varying");}if(m.webglDebugEnabled()){this._numOfDrawCalls++;this._numOfTriangles+=z(t,x);const B=this._state.textureUnitMap;for(let C=0;C<B.length;C++){const y=B[C];if(null!=y&&y===this._state.drawFramebuffer?.colorTexture)throw Error(`Detected readWrite. Texture already bound at index ${C}`);}}this.gl.drawArrays(t,w,x);
m.checkWebGLError(this.gl)}drawArraysInstanced(t,w,x,B){this.gl.drawArraysInstanced(t,w,x,B);m.checkWebGLError(this.gl)}drawElements(t,w,x,B){if(this._transformFeedbackRequestInfo)throw Error("Cannot called drawElements during a transform feedback request");m.webglDebugEnabled()&&(this._numOfDrawCalls++,this._numOfTriangles+=z(t,w));this.gl.drawElements(t,w,x,B);if(m.webglDebugEnabled()){const C=c.getErrorString(this);if(C){const y=this.getBoundVAO(),v=y?.indexBuffer,F=v?.size??0,D=B+w;console.error(`drawElements: ${C}${F<
D?`. Buffer is too small. Attempted to draw index ${D} of ${F}`:""}`,{args:{mode:t,count:w,type:x,offset:B},vao:{indexBuffer:v,vertexBuffers:y?.vertexBuffers}})}}}drawElementsInstanced(t,w,x,B,C){this.gl.drawElementsInstanced(t,w,x,B,C);m.checkWebGLError(this.gl)}logInfo(){m.webglDebugEnabled()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){m.webglDebugEnabled()&&(this._numOfTriangles=this._numOfDrawCalls=0)}get capabilities(){return this._capabilities}setViewport(t,
w,x,B){x=Math.max(Math.round(x),1);B=Math.max(Math.round(B),1);const C=this._state.viewport;if(C.x!==t||C.y!==w||C.width!==x||C.height!==B)C.x=t,C.y=w,C.width=x,C.height=B,this.gl.viewport(t,w,x,B)}setViewport4fv(t){this.setViewport(t[0],t[1],t[2],t[3])}restoreViewport({x:t,y:w,width:x,height:B}){this.setViewport(t,w,x,B)}getViewport(){const t=this._state.viewport;return{x:t.x,y:t.y,width:t.width,height:t.height}}useProgram(t){this._state.program!==t&&(this._state.program?.stop(),this._state.program=
t,this.gl.useProgram(t?.glName??null))}bindTexture(t,w,x=!1){(w>=this.parameters.maxTextureImageUnits||0>w)&&console.error("Input texture unit is out of range of available units!");const B=this._state.textureUnitMap[w];if(null==t?.glName)return null!=B&&(this.setActiveTexture(w,x),this.gl.bindTexture(B.descriptor.target,null)),this._state.textureUnitMap[w]=null,B;if(!x&&B===t)return t.isDirty&&(this.setActiveTexture(w,x),t.applyChanges()),B;this.setActiveTexture(w,x);this.gl.bindTexture(t.descriptor.target,
t.glName);t.applyChanges();this._state.textureUnitMap[w]=t;return B}unbindTexture(t){if(null!=t)for(let w=0;w<this.parameters.maxTextureImageUnits;w++)this._state.textureUnitMap[w]===t&&(this.bindTexture(null,w),this._state.textureUnitMap[w]=null)}bindFramebuffer(t,w=!1){if(w||this._state.readFramebuffer!==t||this._state.drawFramebuffer!==t)this._stateTracker.invalidateDrawBuffers(),null==t?(this.gl.bindFramebuffer(d.FramebufferTarget.FRAMEBUFFER,null),this._state.readFramebuffer=this._state.drawFramebuffer=
null):(t.initializeAndBind(d.FramebufferTarget.FRAMEBUFFER),this._state.readFramebuffer=t,this._state.drawFramebuffer=t)}bindFramebufferSeparate(t,w,x=!1){const B=w===d.FramebufferTarget.READ_FRAMEBUFFER,C=B?this._state.readFramebuffer:this._state.drawFramebuffer;if(x||C!==t)null==t?this.gl.bindFramebuffer(w,null):t.initializeAndBind(w),B?this._state.readFramebuffer=t??null:(this._stateTracker.invalidateDrawBuffers(),this._state.drawFramebuffer=t??null)}blitFramebuffer(t,w,x=0,B=0,C=t.width,y=t.height,
v=0,F=0,D=w.width,G=w.height,E=d.FramebufferBit.COLOR,H=d.TextureSamplingMode.NEAREST){this.bindFramebufferSeparate(t,d.FramebufferTarget.READ_FRAMEBUFFER);this.bindFramebufferSeparate(w,d.FramebufferTarget.DRAW_FRAMEBUFFER);this.gl.blitFramebuffer(x,B,C,y,v,F,D,G,E,H)}bindBuffer(t,w){if(t)switch(w??=t.bufferType,w){case d.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=A(this.gl,t,w,this._state.vertexBuffer);break;case d.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=A(this.gl,t,w,this._state.indexBuffer);
break;case d.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=A(this.gl,t,w,this._state.uniformBuffer);break;case d.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=A(this.gl,t,w,this._state.pixelPackBuffer);break;case d.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=A(this.gl,t,w,this._state.pixelUnpackBuffer);break;case d.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=A(this.gl,t,w,this._state.copyReadBuffer);break;case d.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=
A(this.gl,t,w,this._state.copyWriteBuffer);break;case d.BufferType.TRANSFORM_FEEDBACK_BUFFER:this._state.transformFeedbackBuffer=A(this.gl,t,w,this._state.transformFeedbackBuffer)}}bindRenderbuffer(t){const w=this.gl;t||(w.bindRenderbuffer(w.RENDERBUFFER,null),this._state.renderbuffer=null);this._state.renderbuffer!==t&&(w.bindRenderbuffer(w.RENDERBUFFER,t.glName),this._state.renderbuffer=t)}_getBufferBinding(t,w){if(w>=this.parameters.maxUniformBufferBindings||0>w)return console.error("Uniform buffer binding point is out of range!"),
null;t=t===d.BufferType.UNIFORM_BUFFER?this._state.uniformBufferBindingPoints:this._state.transformBufferBindingPoints;let x=t[w];null==x&&(x={buffer:null,offset:0,size:0},t[w]=x);return x}bindBufferBase(t,w,x){const B=this._getBufferBinding(t,w);null==B||B.buffer===x&&0===B.offset&&0===B.size||(this.gl.bindBufferBase(t,w,x?x.glName:null),B.buffer=x,B.offset=0,B.size=0)}bindBufferRange(t,w,x,B,C){const y=this._getBufferBinding(t,w);null==y||y.buffer===x&&y.offset===B&&y.size===C||(0!==B%this._parameters.uniformBufferOffsetAlignment?
console.error("Uniform buffer binding offset is not a multiple of the context offset alignment"):(this.gl.bindBufferRange(t,w,x.glName,B,C),y.buffer=x,y.offset=B,y.size=C))}bindUBO(t,w,x,B){null==w?this.bindBufferBase(d.BufferType.UNIFORM_BUFFER,t,null):(m.webglDebugEnabled()&&(B??w.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),w.initialize(),void 0!==x&&void 0!==B?this.bindBufferRange(d.BufferType.UNIFORM_BUFFER,
t,w.buffer,x,B):this.bindBufferBase(d.BufferType.UNIFORM_BUFFER,t,w.buffer))}unbindUBO(t){for(let w=0,x=this._state.uniformBufferBindingPoints.length;w<x;w++){const B=this._state.uniformBufferBindingPoints[w];null!=B&&B.buffer===t.buffer&&this.bindBufferBase(d.BufferType.UNIFORM_BUFFER,w,null)}}unbindBuffer(t){switch(t){case d.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=A(this.gl,null,t,this._state.vertexBuffer);break;case d.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=A(this.gl,null,
t,this._state.indexBuffer);break;case d.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=A(this.gl,null,t,this._state.uniformBuffer);break;case d.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=A(this.gl,null,t,this._state.pixelPackBuffer);break;case d.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=A(this.gl,null,t,this._state.pixelUnpackBuffer);break;case d.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=A(this.gl,null,t,this._state.copyReadBuffer);break;case d.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=
A(this.gl,null,t,this._state.copyWriteBuffer)}}bindVAO(t=null){null==t?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==t&&(t.bind(),this._state.vertexArrayObject=t)}bindTransformFeedback(t){const {gl:w}=this;w.bindTransformFeedback(w.TRANSFORM_FEEDBACK,t.glName)}beginTransformFeedback(t,w){if(this._transformFeedbackRequestInfo)throw Error("Already in a transform feedback request");const {gl:x}=this;x.bindTransformFeedback(x.TRANSFORM_FEEDBACK,
t.glName);x.beginTransformFeedback(w);this._transformFeedbackRequestInfo={primitiveType:w}}endTransformFeedback(){if(!this._transformFeedbackRequestInfo)throw Error("Not in a transform feedback request");const {gl:t}=this;t.endTransformFeedback();t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null);this._transformFeedbackRequestInfo=null}async clientWaitAsync(t=n.Milliseconds(10)){const {gl:w}=this,x=w.fenceSync(d.SyncCondition.SYNC_GPU_COMMANDS_COMPLETE,0);if(!x)throw Error("Client wait failed, could not create sync object");
this.instanceCounter.increment(d.ResourceType.Sync,x);w.flush();let B;do await e.after(t),B=w.clientWaitSync(x,0,0);while(B===d.ClientWaitSyncStatus.TIMEOUT_EXPIRED);this.instanceCounter.decrement(d.ResourceType.Sync,x);w.deleteSync(x);if(B===d.ClientWaitSyncStatus.WAIT_FAILED)throw Error("Client wait failed");}getBoundFramebufferObject(t=d.FramebufferTarget.FRAMEBUFFER){return t===d.FramebufferTarget.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null);
this.bindVAO(null);this.bindFramebuffer(null,!0);this.unbindBuffer(d.BufferType.ARRAY_BUFFER);this.unbindBuffer(d.BufferType.ELEMENT_ARRAY_BUFFER);this.unbindBuffer(d.BufferType.UNIFORM_BUFFER);this._state.uniformBufferBindingPoints.length=0;this.unbindBuffer(d.BufferType.PIXEL_PACK_BUFFER);this.unbindBuffer(d.BufferType.PIXEL_UNPACK_BUFFER);this.unbindBuffer(d.BufferType.COPY_READ_BUFFER);this.unbindBuffer(d.BufferType.COPY_WRITE_BUFFER);for(let t=0;t<this.parameters.maxTextureImageUnits;++t)this.bindTexture(null,
t);this.setBlendingEnabled(!1);this.setBlendFunction(d.BlendFactor.ONE,d.BlendFactor.ZERO);this.setBlendEquation(d.BlendOperation.ADD);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(d.Face.BACK);this.setFrontFace(d.CullMode.CCW);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(d.CompareFunction.LESS);this.setDepthRange(0,
1);this.setStencilTestEnabled(!1);this.setStencilFunction(d.CompareFunction.ALWAYS,0,0);this.setStencilOp(d.StencilOperation.KEEP,d.StencilOperation.KEEP,d.StencilOperation.KEEP);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setDrawBuffers([d.SpecialDrawBuffers.BACK]);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){const {gl:t}=this;t.bindVertexArray(null);
for(var w=0;w<this.parameters.maxVertexAttributes;w++)t.disableVertexAttribArray(w);this._state.vertexBuffer?t.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):t.bindBuffer(d.BufferType.ARRAY_BUFFER,null);this._state.indexBuffer?t.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):t.bindBuffer(d.BufferType.ELEMENT_ARRAY_BUFFER,null);this._state.uniformBuffer?t.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):
t.bindBuffer(d.BufferType.UNIFORM_BUFFER,null);for(w=0;w<this._parameters.maxUniformBufferBindings;w++){var x=this._state.uniformBufferBindingPoints[w];if(null!=x){const {buffer:B,offset:C,size:y}=x;null!==B?0===C&&0===y?t.bindBufferBase(d.BufferType.UNIFORM_BUFFER,w,B.glName):t.bindBufferRange(d.BufferType.UNIFORM_BUFFER,w,B.glName,C,y):t.bindBufferBase(d.BufferType.UNIFORM_BUFFER,w,null)}}this._state.pixelPackBuffer?t.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):
t.bindBuffer(d.BufferType.PIXEL_PACK_BUFFER,null);this._state.pixelUnpackBuffer?t.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):t.bindBuffer(d.BufferType.PIXEL_UNPACK_BUFFER,null);this._state.copyReadBuffer?t.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):t.bindBuffer(d.BufferType.COPY_READ_BUFFER,null);this._state.copyWriteBuffer?t.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):
t.bindBuffer(d.BufferType.COPY_WRITE_BUFFER,null);t.bindFramebuffer(d.FramebufferTarget.READ_FRAMEBUFFER,null);t.readBuffer(t.BACK);this._state.readFramebuffer&&(t.bindFramebuffer(d.FramebufferTarget.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),t.readBuffer(d.ColorAttachment.COLOR_ATTACHMENT0));t.bindFramebuffer(d.FramebufferTarget.DRAW_FRAMEBUFFER,this._state.drawFramebuffer?.glName??null);null===this._state.drawFramebuffer?t.drawBuffers(this._state.drawBuffers.defaultFramebuffer??[d.SpecialDrawBuffers.BACK]):
(w=this._state.drawBuffers.fbos.get(this._state.drawFramebuffer),t.drawBuffers(w??[d.ColorAttachment.COLOR_ATTACHMENT0]));if(this._state.vertexArrayObject){if(w=this._state.vertexArrayObject)this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null;this.bindVAO(w)}t.useProgram(this._state.program?.glName??null);t.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a);t.bindRenderbuffer(t.RENDERBUFFER,this._state.renderbuffer?.glName??
null);!0===this._state.blend?t.enable(this.gl.BLEND):t.disable(this.gl.BLEND);t.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha);t.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha);t.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a);t.clearDepth(this._state.clearDepth);t.clearStencil(this._state.clearStencil);
t.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a);t.cullFace(this._state.cullFace);t.depthFunc(this._state.depthFunction);t.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar);!0===this._state.depthTest?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST);t.depthMask(this._state.depthWrite);t.frontFace(this._state.frontFace);t.lineWidth(1);!0===this._state.faceCulling?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE);t.polygonOffset(this._state.polygonOffset[0],
this._state.polygonOffset[1]);!0===this._state.polygonOffsetFill?t.enable(t.POLYGON_OFFSET_FILL):t.disable(t.POLYGON_OFFSET_FILL);t.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height);!0===this._state.scissorTest?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST);t.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask);t.stencilOpSeparate(this._state.stencilOperation.face,
this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass);!0===this._state.stencilTest?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST);t.stencilMask(this._state.stencilWriteMask);for(w=0;w<this.parameters.maxTextureImageUnits;w++)t.activeTexture(d.baseTextureUnit+w),t.bindTexture(d.TextureType.TEXTURE_2D,null),t.bindTexture(d.TextureType.TEXTURE_CUBE_MAP,null),t.bindTexture(d.TextureType.TEXTURE_3D,null),t.bindTexture(d.TextureType.TEXTURE_2D_ARRAY,
null),x=this._state.textureUnitMap[w],null!=x&&t.bindTexture(x.descriptor.target,x.glName);t.activeTexture(d.baseTextureUnit+this._state.activeTexture);w=this._state.viewport;t.viewport(w.x,w.y,w.width,w.height);this.resetInfo()}_loadExtensions(){this.gl.getExtension("KHR_parallel_shader_compile")}};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ContextState":function(){define(["exports","./enums"],function(k,r){class p{constructor(){this.blend=!1;this.blendColor=
{r:0,g:0,b:0,a:0};this.blendFunction={srcRGB:r.BlendFactor.ONE,dstRGB:r.BlendFactor.ZERO,srcAlpha:r.BlendFactor.ONE,dstAlpha:r.BlendFactor.ZERO};this.blendEquation={mode:r.BlendOperation.ADD,modeAlpha:r.BlendOperation.ADD};this.colorMask={r:!0,g:!0,b:!0,a:!0};this.faceCulling=!1;this.cullFace=r.Face.BACK;this.frontFace=r.CullMode.CCW;this.scissorTest=!1;this.scissorRect={x:0,y:0,width:0,height:0};this.depthTest=!1;this.depthFunction=r.CompareFunction.LESS;this.clearDepth=1;this.depthWrite=!0;this.depthRange=
{zNear:0,zFar:1};this.viewport=null;this.polygonOffsetFill=this.stencilTest=!1;this.polygonOffset=[0,0];this.stencilFunction={face:r.Face.FRONT_AND_BACK,func:r.CompareFunction.ALWAYS,ref:0,mask:1};this.clearStencil=0;this.stencilWriteMask=1;this.stencilOperation={face:r.Face.FRONT_AND_BACK,fail:r.StencilOperation.KEEP,zFail:r.StencilOperation.KEEP,zPass:r.StencilOperation.KEEP};this.clearColor={r:0,g:0,b:0,a:0};this.transformFeedbackBuffer=this.copyWriteBuffer=this.copyReadBuffer=this.pixelUnpackBuffer=
this.pixelPackBuffer=this.uniformBuffer=this.indexBuffer=this.vertexBuffer=this.program=null;this.uniformBufferBindingPoints=[];this.transformBufferBindingPoints=[];this.drawFramebuffer=this.readFramebuffer=null;this.drawBuffers={defaultFramebuffer:[r.SpecialDrawBuffers.BACK],fbos:new WeakMap};this.renderbuffer=null;this.activeTexture=0;this.textureUnitMap=[];this.vertexArrayObject=null}}k.ContextState=p;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/InstanceCounter":function(){define(["exports",
"./AllocationTracer","./enums"],function(k,r,p){const e={RECORD_ALLOCATIONS:!1};class n{constructor(){this._current=[];for(this._allocations=e.RECORD_ALLOCATIONS?new r.AllocationTracer("WebGLObject"):null;this._current.length<p.ResourceType.COUNT;)this._current.push(0)}increment(m,l,d=1){this._current[m]+=d;this._allocations?.add(l)}decrement(m,l,d=1){this._current[m]-=d;this._allocations?.remove(l)}get current(){return this._current}get total(){return this.current.reduce((m,l,d)=>m+(d<p.ResourceType.UNCOUNTED?
l:0),0)}get resourceInformation(){let m="";if(0<this.total){m+="Live objects:\n";for(let l=0;l<p.ResourceType.COUNT;++l){const d=this._current[l];0<d&&(m+=`${p.ResourceType[l]}: ${d}\n`)}}return m+=this._allocations?.resetLog()}}k.InstanceCounter=n;k.test=e;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/AllocationTracer":function(){define(["exports"],function(k){class r{constructor(e){this._objectType=e;this._active=new Map}get _stack(){const e=Error().stack.split("\n");
e.shift();e.shift();e.shift();return e.join("\n")}add(e){this._active.set(e,new p(this._stack))}remove(e){this._active.delete(e)}addReference(e){(e=this._active.get(e))&&e.retains.push(this._stack)}removeReference(e){(e=this._active.get(e))&&e.releases.push(this._stack)}resetLog(){const e=new Map;let n="";this._active.forEach((d,{usedMemory:a})=>{e.has(d.from)||(e.set(d.from,new Map),0<d.retains.length&&(n+=`  First reference count mismatch:\n  Retain:\n    ${d.retains.join("\n\n    ")}\n\n  Release:    ${d.releases.join("\n\n    ")}\n`));
d=e.get(d.from);d.set(a??0,d.get(a??0)??1)});this._active.clear();let m=0;const l=[];e.forEach((d,a)=>{let b=0;d.forEach((f,g)=>b+=f*g);d.set(-1,b);m+=b;l.push([a,d])});e.clear();l.sort((d,a)=>a[1].get(-1)-d[1].get(-1));return l.reduce((d,[a,b])=>{const f=Math.round(b.get(-1)/1024);b.delete(-1);b=Array.from(b.values()).reduce((g,q)=>g+q,0);return d+=`  ${f}KB from ${b} allocations at ${a}\n`},`Total ${this._objectType} memory: ${Math.round(m/1024)}KB\n${n}`)}}class p{constructor(e){this.from=e;this.retains=
[];this.releases=[]}}k.AllocationTracer=r;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Parameters":function(){define(["exports"],function(k){class r{constructor(p,e,n){e=e.textureFilterAnisotropic;n=n.maxAnisotropy??Infinity;this.versionString=p.getParameter(p.VERSION);this.maxVertexTextureImageUnits=p.getParameter(p.MAX_VERTEX_TEXTURE_IMAGE_UNITS);this.maxVertexAttributes=p.getParameter(p.MAX_VERTEX_ATTRIBS);this.maxMaxAnisotropy=e?Math.min(p.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY),
n):1;this.maxTextureImageUnits=p.getParameter(p.MAX_TEXTURE_IMAGE_UNITS);this.maxTextureSize=p.getParameter(p.MAX_TEXTURE_SIZE);this.maxRenderbufferSize=p.getParameter(p.MAX_RENDERBUFFER_SIZE);this.maxViewportDims=p.getParameter(p.MAX_VIEWPORT_DIMS);this.maxUniformBufferBindings=p.getParameter(p.MAX_UNIFORM_BUFFER_BINDINGS);this.maxVertexUniformBlocks=p.getParameter(p.MAX_VERTEX_UNIFORM_BLOCKS);this.maxFragmentUniformBlocks=p.getParameter(p.MAX_FRAGMENT_UNIFORM_BLOCKS);this.maxUniformBlockSize=p.getParameter(p.MAX_UNIFORM_BLOCK_SIZE);
this.uniformBufferOffsetAlignment=p.getParameter(p.UNIFORM_BUFFER_OFFSET_ALIGNMENT);this.maxArrayTextureLayers=p.getParameter(p.MAX_ARRAY_TEXTURE_LAYERS);this.maxSamples=p.getParameter(p.MAX_SAMPLES);this.maxDrawBuffers=p.getParameter(p.MAX_DRAW_BUFFERS)}}k.Parameters=r;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/renderState":function(){define(["exports","../3d/webgl-engine/lib/basicInterfaces","./enums"],function(k,r,p){function e(N,R,T=p.BlendOperation.ADD,
W=[0,0,0,0]){return{srcRgb:N,srcAlpha:N,dstRgb:R,dstAlpha:R,opRgb:T,opAlpha:T,color:{r:W[0],g:W[1],b:W[2],a:W[3]}}}function n(N,R,T,W,Y=p.BlendOperation.ADD,Z=p.BlendOperation.ADD,da=[0,0,0,0]){return{srcRgb:N,srcAlpha:R,dstRgb:T,dstAlpha:W,opRgb:Y,opAlpha:Z,color:{r:da[0],g:da[1],b:da[2],a:da[3]}}}function m(N){return L.intern(N)}function l(N){return P.intern(N)}function d(N){return Q.intern(N)}function a(N){return S.intern(N)}function b(N){return U.intern(N)}function f(N){return X.intern(N)}function g(N){return aa.intern(N)}
function q(N){return ba.intern(N)}function c(N){return fa.intern(N)}function h(N){return"["+N.join(",")+"]"}function u(N){return N?h([N.srcRgb,N.srcAlpha,N.dstRgb,N.dstAlpha,N.opRgb,N.opAlpha,N.color.r,N.color.g,N.color.b,N.color.a]):null}function A(N){return N?h([N.face,N.mode]):null}function z(N){return N?h([N.factor,N.units]):null}function t(N){return N?h([N.func]):null}function w(N){return N?h([N.function.func,N.function.ref,N.function.mask,N.operation.fail,N.operation.zFail,N.operation.zPass]):
null}function x(N){return N?h([N.zNear,N.zFar]):null}function B(N){return N?h([N.r,N.g,N.b,N.a]):null}function C(N){return N?h([N.mask]):null}function y(N){return N?h(N.buffers):null}const v=e(p.BlendFactor.ZERO,p.BlendFactor.ONE_MINUS_SRC_ALPHA),F=e(p.BlendFactor.ONE,p.BlendFactor.ZERO),D=e(p.BlendFactor.ONE,p.BlendFactor.ONE),G=e(p.BlendFactor.ONE,p.BlendFactor.ONE_MINUS_SRC_ALPHA),E=n(p.BlendFactor.SRC_ALPHA,p.BlendFactor.ONE,p.BlendFactor.ONE_MINUS_SRC_ALPHA,p.BlendFactor.ONE_MINUS_SRC_ALPHA),
H={face:p.Face.BACK,mode:p.CullMode.CCW},K={face:p.Face.FRONT,mode:p.CullMode.CCW};class J{constructor(N,R){this._makeKey=N;this._makeRef=R;this._interns=new Map}intern(N){if(!N)return null;const R=this._makeKey(N),T=this._interns;T.has(R)||T.set(R,this._makeRef(N));return T.get(R)??null}}const L=new J(u,N=>({__tag:"Blending",...N})),P=new J(A,N=>({__tag:"Culling",...N})),Q=new J(z,N=>({__tag:"PolygonOffset",...N})),S=new J(t,N=>({__tag:"DepthTest",...N})),U=new J(w,N=>({__tag:"StencilTest",...N})),
X=new J(x,N=>({__tag:"DepthWrite",...N})),aa=new J(B,N=>({__tag:"ColorWrite",...N})),ba=new J(C,N=>({__tag:"StencilWrite",...N})),fa=new J(y,N=>({__tag:"DrawBuffers",...N})),I=new J(function(N){return N?h([u(N.blending),A(N.culling),z(N.polygonOffset),t(N.depthTest),w(N.stencilTest),x(N.depthWrite),B(N.colorWrite),C(N.stencilWrite),y(N.drawBuffers)]):null},N=>({blending:m(N.blending),culling:l(N.culling),polygonOffset:d(N.polygonOffset),depthTest:a(N.depthTest),stencilTest:b(N.stencilTest),depthWrite:f(N.depthWrite),
colorWrite:g(N.colorWrite),stencilWrite:q(N.stencilWrite),drawBuffers:c(N.drawBuffers)}));class M{constructor(N){this._drawBuffersInvalid=this._stencilWriteInvalid=this._colorWriteInvalid=this._depthWriteInvalid=this._stencilTestInvalid=this._depthTestInvalid=this._polygonOffsetInvalid=this._cullingInvalid=this._blendingInvalid=this._pipelineInvalid=!0;this._stateSetters=N}setPipeline(N){if(this._pipelineInvalid||N!==this._pipeline)this._setBlending(N.blending),this._setCulling(N.culling),this._setPolygonOffset(N.polygonOffset),
this._setDepthTest(N.depthTest),this._setStencilTest(N.stencilTest),this._setDepthWrite(N.depthWrite),this._setColorWrite(N.colorWrite),this._setStencilWrite(N.stencilWrite),this._setDrawBuffers(N.drawBuffers),this._pipeline=N;this._pipelineInvalid=!1}invalidateBlending(){this._pipelineInvalid=this._blendingInvalid=!0}invalidateCulling(){this._pipelineInvalid=this._cullingInvalid=!0}invalidatePolygonOffset(){this._pipelineInvalid=this._polygonOffsetInvalid=!0}invalidateDepthTest(){this._pipelineInvalid=
this._depthTestInvalid=!0}invalidateStencilTest(){this._pipelineInvalid=this._stencilTestInvalid=!0}invalidateDepthWrite(){this._pipelineInvalid=this._depthWriteInvalid=!0}invalidateColorWrite(){this._pipelineInvalid=this._colorWriteInvalid=!0}invalidateStencilWrite(){this._pipelineInvalid=this._stencilTestInvalid=!0}invalidateDrawBuffers(){this._pipelineInvalid=this._drawBuffersInvalid=!0}_setBlending(N){this._blending=this._setSubState(N,this._blending,this._blendingInvalid,this._stateSetters.setBlending);
this._blendingInvalid=!1}_setCulling(N){this._culling=this._setSubState(N,this._culling,this._cullingInvalid,this._stateSetters.setCulling);this._cullingInvalid=!1}_setPolygonOffset(N){this._polygonOffset=this._setSubState(N,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset);this._polygonOffsetInvalid=!1}_setDepthTest(N){this._depthTest=this._setSubState(N,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest);this._depthTestInvalid=!1}_setStencilTest(N){this._stencilTest=
this._setSubState(N,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest);this._stencilTestInvalid=!1}_setDepthWrite(N){this._depthWrite=this._setSubState(N,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite);this._depthWriteInvalid=!1}_setColorWrite(N){this._colorWrite=this._setSubState(N,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite);this._colorWriteInvalid=!1}_setStencilWrite(N){this._stencilWrite=this._setSubState(N,this._stencilWrite,
this._stencilWriteInvalid,this._stateSetters.setStencilWrite);this._stencilTestInvalid=!1}_setDrawBuffers(N){this._drawBuffers=this._setSubState(N,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers);this._drawBuffersInvalid=!1}_setSubState(N,R,T,W){if(T||N!==R)W(N),this._pipelineInvalid=!0;return N}}k.StateTracker=M;k.backFaceCullingParams=H;k.blendWithPremultipliedAlpha=G;k.cullingParams=N=>N===r.CullFaceOptions.Back?H:N===r.CullFaceOptions.Front?K:null;k.defaultColorWrite=
{r:!0,g:!0,b:!0,a:!0};k.defaultDepthWrite={zNear:0,zFar:1};k.frontFaceCullingParams=K;k.keepSourceValues=F;k.makeBlending=m;k.makeColorWrite=g;k.makeCulling=l;k.makeDepthTest=a;k.makeDepthWrite=f;k.makeDrawBuffers=c;k.makePipelineState=function(N){return I.intern(N)};k.makePolygonOffset=d;k.makeStencilTest=b;k.makeStencilWrite=q;k.premultipliedAlphaToPremultipliedAlpha=E;k.separateBlendingParams=n;k.simpleBlendingParams=e;k.weightedAdd=D;k.writeDestinationPremultipliedAlpha=v;Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/basicInterfaces":function(){define(["exports"],function(k){k.CullFaceOptions=void 0;(function(r){r[r.None=0]="None";r[r.Front=1]="Front";r[r.Back=2]="Back";r[r.COUNT=3]="COUNT"})(k.CullFaceOptions||(k.CullFaceOptions={}));k.DepthTestFunction=void 0;(function(r){r[r.Less=0]="Less";r[r.Lequal=1]="Lequal";r[r.COUNT=2]="COUNT"})(k.DepthTestFunction||(k.DepthTestFunction={}));k.RenderRequestType=void 0;(function(r){r[r.BACKGROUND=
0]="BACKGROUND";r[r.UPDATE=1]="UPDATE"})(k.RenderRequestType||(k.RenderRequestType={}));k.ResourceState=void 0;(function(r){r[r.NOT_LOADED=0]="NOT_LOADED";r[r.LOADING=1]="LOADING";r[r.LOADED=2]="LOADED"})(k.ResourceState||(k.ResourceState={}));k.StencilBits=void 0;(function(r){r[r.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded";r[r.OutlineVisualElementMask=2]="OutlineVisualElementMask"})(k.StencilBits||(k.StencilBits={}));k.Object3DState=void 0;(function(r){r[r.Highlight=0]="Highlight";
r[r.MaskOccludee=1]="MaskOccludee"})(k.Object3DState||(k.Object3DState={}));k.AlphaDiscardMode=void 0;(function(r){r[r.Blend=0]="Blend";r[r.Opaque=1]="Opaque";r[r.Mask=2]="Mask";r[r.MaskBlend=3]="MaskBlend";r[r.COUNT=4]="COUNT"})(k.AlphaDiscardMode||(k.AlphaDiscardMode={}));k.TextureEncodingMimeType=void 0;(function(r){r.DDS_ENCODING="image/vnd-ms.dds";r.KTX2_ENCODING="image/ktx2";r.BASIS_ENCODING="image/x.basis"})(k.TextureEncodingMimeType||(k.TextureEncodingMimeType={}));Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/WebGLDriverTest":function(){define(["exports","./testAppleAmdDrawArrays","./testDoublePrecisionArithmetic","./testFloatBufferBlend","./testSVGPremultipliedAlpha"],function(k,r,p,e,n){class m{constructor(l){this.rctx=l;this.floatBufferBlend=new e.FloatBufferBlend(l);this.svgPremultipliesAlpha=new n.SVGPremultipliedAlpha(l);this.doublePrecisionRequiresObfuscation=new p.DoublePrecisionRequiresObfuscation(l);this.drawArraysRequiresIndicesTypeReset=
new r.DrawArraysRequiresIndicesTypeReset(l)}dispose(){this.doublePrecisionRequiresObfuscation.dispose();this.svgPremultipliesAlpha.dispose();this.floatBufferBlend.dispose();this.drawArraysRequiresIndicesTypeReset.dispose()}}k.WebGLDriverTest=m;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testAppleAmdDrawArrays":function(){define("exports ../../core/has ../3d/webgl-engine/core/shaderModules/glsl ./AppleAmdDriverHelper ./BufferObject ./enums ./FramebufferObject ./TextureDescriptor ./WebGLDriverTestModule".split(" "),
function(k,r,p,e,n,m,l,d,a){class b extends a.WebGLDriverTestModule{constructor(f){super();this._rctx=f;this._helperProgram=null;r("mac")&&r("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){super.dispose();this._helperProgram?.dispose();this._helperProgram=null}_test(f){const g=this._rctx,q=g.getBoundFramebufferObject(),{x:c,y:h,width:u,height:A}=g.getViewport();g.resetState();var z=new d.TextureDescriptor(1);z.wrapMode=m.TextureWrapMode.CLAMP_TO_EDGE;
z.samplingMode=m.TextureSamplingMode.NEAREST;z=new l.FramebufferObject(g,z);const t=n.BufferObject.createIndex(this._rctx,m.Usage.STATIC_DRAW,new Uint8Array([0]));g.bindFramebuffer(z);g.setViewport(0,0,1,1);g.useProgram(this._helperProgram);g.bindBuffer(t,m.BufferType.ELEMENT_ARRAY_BUFFER);g.drawElements(m.PrimitiveType.POINTS,1,m.DataType.UNSIGNED_BYTE,0);g.useProgram(f);g.bindVAO(null);g.drawArrays(m.PrimitiveType.TRIANGLES,0,258);f=new Uint8Array(4);z.readPixels(0,0,1,1,m.PixelFormat.RGBA,m.PixelType.UNSIGNED_BYTE,
f);g.setViewport(c,h,u,A);g.bindFramebuffer(q);z.dispose();t.dispose();return 255===f[0]}_prepareProgram(){const f=`#version 300 es\n    precision highp float;\n\n    out float triangleId;\n\n    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));\n\n    void main(void) {\n      triangleId = floor(float(gl_VertexID)/3.0);\n\n      vec3 position = triangleVertices[gl_VertexID % 3];\n      float offset = triangleId / ${p.glsl.float(85)};\n      position.z = 0.5 - offset;\n\n      gl_Position = vec4(position, 1.0);\n    }\n    `,
g=`#version 300 es\n    precision highp float;\n\n    in float triangleId;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor = triangleId == ${p.glsl.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);\n    }\n    `;return this._rctx.programCache.acquire(f,g,new Map([]))}_prepareHelperProgram(){const f=e.AppleAmdDriverHelper.getShaderSources();return this._rctx.programCache.acquire(f.vertex,f.fragment,new Map([]))}}k.DrawArraysRequiresIndicesTypeReset=b;Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/glsl":function(){define(["exports"],function(k){function r(p,...e){let n="";for(let m=0;m<e.length;m++)n+=p[m]+e[m];return n+=p[p.length-1]}(function(p){p.int=function(e){return Math.round(e).toString()};p.float=function(e){return e.toPrecision(8)}})(r);k.If=function(p,e,n=""){return p?e:n};k.glsl=r;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/AppleAmdDriverHelper":function(){define(["exports",
"../../core/has","./BufferObject","./enums"],function(k,r,p,e){class n{constructor(m){this._rctx=m;this._indexBuffer=this._createIndexbuffer();this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:"#version 300 es\n    precision highp float;\n\n    void main(void) {\n      gl_Position \x3d vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);\n    }",fragment:"#version 300 es\n    precision highp float;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor \x3d vec4(0.0, 0.0, 0.0, 1.0);\n    }"}}_createHelperProgram(){const m=
n.getShaderSources();return this._rctx.programCache.acquire(m.vertex,m.fragment,new Map([]))}_createIndexbuffer(){return p.BufferObject.createIndex(this._rctx,e.Usage.STATIC_DRAW,new Uint32Array([0]))}run(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,e.BufferType.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(e.PrimitiveType.POINTS,1,e.DataType.UNSIGNED_INT,0))}dispose(){this._program.dispose();this._indexBuffer.dispose()}get test(){}}
k.AppleAmdDriverHelper=n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/WebGLDriverTestModule":function(){define(["exports","../../core/maybe"],function(k,r){class p{constructor(){this._result=!1}dispose(){this._program=r.disposeMaybe(this._program)}get result(){null!=this._program&&(this._result=this._test(this._program),this.dispose());return this._result}}k.WebGLDriverTestModule=p;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testDoublePrecisionArithmetic":function(){define("exports ../../core/floatRGBA ../../core/has ../../core/maybe ../../core/libs/gl-matrix-2/factories/vec3f64 ./BufferObject ./doublePrecisionUtils ./enums ./FramebufferObject ./TextureDescriptor ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g,q){function c(u,A){return u.programCache.acquire(`\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ${A?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  `,
"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor \x3d v_color;\n  }\n  ",new Map([["position",0]]))}class h extends q.WebGLDriverTestModule{constructor(u){super();this._rctx=u;this._program=c(this._rctx,!1);this._obfuscated=c(this._rctx,!0)}dispose(){super.dispose();this._obfuscated=e.disposeMaybe(this._obfuscated)}_test(u){if(p("force-double-precision-obfuscation"))return!0;if(null==this._obfuscated)return!1;const A=this._rctx,z=A.getBoundFramebufferObject(),
{x:t,y:w,width:x,height:B}=A.getViewport();u=this._runProgram(u);const C=this._runProgram(this._obfuscated);A.setViewport(t,w,x,B);A.bindFramebuffer(z);return 0!==u&&(0===C||5<u/C)}_runProgram(u){var A=this._rctx;A.resetState();var z=new b.TextureDescriptor(1);z.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;z.samplingMode=d.TextureSamplingMode.NEAREST;z=new a.FramebufferObject(A,z);var t=m.BufferObject.createVertex(A,d.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));t=new f.VertexArrayObject(A,new Map([["position",
0]]),new Map([["geometry",[new g.VertexElementDescriptor("position",2,d.DataType.UNSIGNED_SHORT,0,4)]]]),new Map([["geometry",t]]));const w=n.fromValues(5633261.287538229,2626832.878767164,1434988.0495278358),x=n.fromValues(5633271.46742708,2626873.6381334523,1434963.231608387),B=new Float32Array(6);l.encodeDoubleArray(w,B,3);const C=new Float32Array(6);l.encodeDoubleArray(x,C,3);A.useProgram(u);u.setUniform3f("u_highA",B[0],B[2],B[4]);u.setUniform3f("u_lowA",B[1],B[3],B[5]);u.setUniform3f("u_highB",
C[0],C[2],C[4]);u.setUniform3f("u_lowB",C[1],C[3],C[5]);A.bindFramebuffer(z);A.setViewport(0,0,1,1);A.bindVAO(t);A.drawArrays(d.PrimitiveType.TRIANGLE_STRIP,0,4);u=new Uint8Array(4);z.readPixels(0,0,1,1,d.PixelFormat.RGBA,d.PixelType.UNSIGNED_BYTE,u);t.dispose();z.dispose();A=(w[2]-x[2])/25;u=r.unpackFloatRGBA(u);return Math.abs(A-u)}}k.DoublePrecisionRequiresObfuscation=h;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/doublePrecisionUtils":function(){define(["exports"],
function(k){const r=new Float32Array(2);k.decodeDoubleArray=function(p,e,n){for(let m=0;m<n;++m)e[m]=p[2*m]+p[2*m+1]};k.encodeDoubleArray=function(p,e,n){for(let m=0;m<n;++m)e[2*m]=p[m],e[2*m+1]=p[m]-e[2*m]};k.encodeDoubleHi=function(p,e){const n=p.length;for(let m=0;m<n;++m)r[0]=p[m],e[m]=r[0];return e};k.encodeDoubleLo=function(p,e){const n=p.length;for(let m=0;m<n;++m)r[0]=p[m],r[1]=p[m]-r[0],e[m]=r[1];return e};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testFloatBufferBlend":function(){define("exports ./BufferObject ./enums ./FramebufferObject ./renderState ./TextureDescriptor ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),
function(k,r,p,e,n,m,l,d,a){class b extends a.WebGLDriverTestModule{constructor(f){super();this._rctx=f;f.gl&&f.capabilities.colorBufferFloat?.textureFloat&&f.capabilities.colorBufferFloat?.floatBlend&&(this._program=f.programCache.acquire("\n    precision highp float;\n    attribute vec2 a_pos;\n\n    void main() {\n      gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ","\n     precision highp float;\n\n     void main() {\n      gl_FragColor \x3d vec4(0.5, 0.5, 0.5, 0.5);\n     }\n    ",
new Map([["a_pos",0]])))}_test(f){const g=this._rctx;var q=new m.TextureDescriptor(1);q.wrapMode=p.TextureWrapMode.CLAMP_TO_EDGE;q.dataType=p.PixelType.FLOAT;q.internalFormat=p.SizedPixelFormat.RGBA32F;q.samplingMode=p.TextureSamplingMode.NEAREST;q=new e.FramebufferObject(g,q);var c=r.BufferObject.createVertex(g,p.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));c=new l.VertexArrayObject(g,new Map([["a_pos",0]]),new Map([["geometry",[new d.VertexElementDescriptor("a_pos",2,p.DataType.UNSIGNED_SHORT,
0,4)]]]),new Map([["geometry",c]]));g.gl.getError();g.useProgram(f);f=g.getBoundFramebufferObject();const {x:h,y:u,width:A,height:z}=g.getViewport();g.bindFramebuffer(q);g.setViewport(0,0,1,1);g.bindVAO(c);g.drawArrays(p.PrimitiveType.TRIANGLE_STRIP,0,4);var t=n.makePipelineState({blending:n.writeDestinationPremultipliedAlpha});g.setPipelineState(t);g.drawArrays(p.PrimitiveType.TRIANGLE_STRIP,0,4);t=g.gl.getError();g.setViewport(h,u,A,z);g.bindFramebuffer(f);c.dispose();q.dispose();return t===g.gl.INVALID_OPERATION?
(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1):!0}}k.FloatBufferBlend=b;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testSVGPremultipliedAlpha":function(){define("exports ../2d/engine/webgl/DefaultVertexAttributeLayouts ./BufferObject ./enums ./FramebufferObject ./Texture ./TextureDescriptor ./VertexArrayObject ./WebGLDriverTestModule".split(" "),function(k,r,p,e,n,m,l,d,a){class b extends a.WebGLDriverTestModule{constructor(g){super();
this._rctx=g;this._program=g.programCache.acquire("\n    precision highp float;\n\n    attribute vec2 a_pos;\n    varying vec2 v_uv;\n\n    void main() {\n      v_uv \x3d a_pos;\n      gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ","\n    precision highp float;\n\n    varying vec2 v_uv;\n\n    uniform sampler2D u_texture;\n\n    void main() {\n      gl_FragColor \x3d texture2D(u_texture, v_uv);\n    }\n    ",new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(g){const q=this._rctx;
if(!q.gl)return g.dispose(),!0;var c=new l.TextureDescriptor(1);c.wrapMode=e.TextureWrapMode.CLAMP_TO_EDGE;c.samplingMode=e.TextureSamplingMode.NEAREST;c=new n.FramebufferObject(q,c);var h=p.BufferObject.createVertex(q,e.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));h=new d.VertexArrayObject(q,new Map([["a_pos",0]]),r.Pos2us,new Map([["geometry",h]]));var u=new l.TextureDescriptor;u.samplingMode=e.TextureSamplingMode.LINEAR;u.wrapMode=e.TextureWrapMode.CLAMP_TO_EDGE;u=new m.Texture(q,u,f);
q.useProgram(g);q.bindTexture(u,0);g.setUniform1i("u_texture",0);g=q.getBoundFramebufferObject();const {x:A,y:z,width:t,height:w}=q.getViewport();q.bindFramebuffer(c);q.setViewport(0,0,1,1);q.setClearColor(0,0,0,0);q.setBlendingEnabled(!1);q.clear(e.FramebufferBit.COLOR);q.bindVAO(h);q.drawArrays(e.PrimitiveType.TRIANGLE_STRIP,0,4);const x=new Uint8Array(4);c.readPixels(0,0,1,1,e.PixelFormat.RGBA,e.PixelType.UNSIGNED_BYTE,x);h.dispose();c.dispose();u.dispose();q.setViewport(A,z,t,w);q.bindFramebuffer(g);
return 255!==x[0]}}const f=new Image;f.src="data:image/svg+xml,%3C%3Fxml version\x3d'1.0' encoding\x3d'UTF-8'%3F%3E%3Csvg width\x3d'5' height\x3d'5' version\x3d'1.1' viewBox\x3d'0 0 5 5' xmlns\x3d'http://www.w3.org/2000/svg'%3E%3Crect width\x3d'5' height\x3d'5' fill\x3d'%23f00' fill-opacity\x3d'.5'/%3E%3C/svg%3E%0A";f.width=5;f.height=5;f.decode();k.SVGPremultipliedAlpha=b;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/Capabilities":function(){define(["exports",
"./DebugRendererInfo","./DisjointTimerQuery","./load","./LoseContext"],function(k,r,p,e,n){class m{constructor(l,d){this._gl=l;this._debugRendererInfo=this._textureFloatLinear=this._textureNorm16=this._loseContext=this._colorBufferFloat=this._textureFilterAnisotropic=this._compressedTextureS3TC=this._compressedTextureETC=null;this._disabledExtensions=d.disabledExtensions||{};this._debugWebGLExtensions=d.debugWebGLExtensions||{}}get compressedTextureETC(){this._compressedTextureETC??(this._compressedTextureETC=
e.loadCompressedTextureETC(this._gl,this._disabledExtensions));return this._compressedTextureETC}get compressedTextureS3TC(){this._compressedTextureS3TC??(this._compressedTextureS3TC=e.loadCompressedTextureS3TC(this._gl,this._disabledExtensions));return this._compressedTextureS3TC}get textureFilterAnisotropic(){this._textureFilterAnisotropic??(this._textureFilterAnisotropic=e.loadTextureFilterAnisotropicCapability(this._gl,this._disabledExtensions));return this._textureFilterAnisotropic}get disjointTimerQuery(){this._disjointTimerQuery??
(this._disjointTimerQuery=p.createDisjointTimerQuery(this._gl,this._disabledExtensions));return this._disjointTimerQuery}get colorBufferFloat(){this._colorBufferFloat??(this._colorBufferFloat=e.loadColorBufferFloat(this._gl,this._disabledExtensions));return this._colorBufferFloat}get textureNorm16(){this._textureNorm16??(this._textureNorm16=e.loadTextureNorm16(this._gl,this._disabledExtensions));return this._textureNorm16}get textureFloatLinear(){this._textureFloatLinear??(this._textureFloatLinear=
e.loadBooleanExtension(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"]));return this._textureFloatLinear}get loseContext(){this._loseContext??(this._loseContext=n.load(this._gl,this._debugWebGLExtensions));return this._loseContext}get debugRendererInfo(){this._debugRendererInfo??(this._debugRendererInfo=r.loadDebugRendererInfo(this._gl,this._debugWebGLExtensions));return this._debugRendererInfo}enable(l){return this[l]}}k.Capabilities=m;Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/load":function(){define(["exports"],function(k){k.loadBooleanExtension=function(r,p,e,n,m){if(n)return!0;if(p[e])return!1;for(const l of m)if(r.getExtension(l))return!0;return!1};k.loadColorBufferFloat=function(r,p){const e=!p.colorBufferHalfFloat&&r.getExtension("EXT_color_buffer_half_float")||!p.colorBufferFloat&&r.getExtension("EXT_color_buffer_float"),n=!p.colorBufferFloat&&r.getExtension("EXT_color_buffer_float");p=!p.floatBlend&&
!p.colorBufferFloat&&r.getExtension("EXT_float_blend");return e||n||p?{textureFloat:!!n,textureHalfFloat:!!e,floatBlend:!!p,R16F:r.R16F,RG16F:r.RG16F,RGBA16F:r.RGBA16F,R32F:r.R32F,RG32F:r.RG32F,RGBA32F:r.RGBA32F,R11F_G11F_B10F:r.R11F_G11F_B10F,RGB16F:r.RGB16F}:null};k.loadCompressedTextureETC=function(r,p){return p.compressedTextureETC?null:(r=r.getExtension("WEBGL_compressed_texture_etc"))?{COMPRESSED_R11_EAC:r.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:r.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:r.COMPRESSED_RG11_EAC,
COMPRESSED_SIGNED_RG11_EAC:r.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:r.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:r.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null};k.loadCompressedTextureS3TC=function(r,p){return p.compressedTextureS3TC?
null:(r=r.getExtension("WEBGL_compressed_texture_s3tc"))?{COMPRESSED_RGB_S3TC_DXT1:r.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:r.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:r.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:r.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null};k.loadTextureFilterAnisotropicCapability=function(r,p){return p.textureFilterAnisotropic?null:(r=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))?
{MAX_TEXTURE_MAX_ANISOTROPY:r.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:r.TEXTURE_MAX_ANISOTROPY_EXT}:null};k.loadTextureNorm16=function(r,p){return p.textureNorm16?null:(r=r.getExtension("EXT_texture_norm16"))?{R16:r.R16_EXT,RG16:r.RG16_EXT,RGB16:r.RGB16_EXT,RGBA16:r.RGBA16_EXT,R16_SNORM:r.R16_SNORM_EXT,RG16_SNORM:r.RG16_SNORM_EXT,RGB16_SNORM:r.RGB16_SNORM_EXT,RGBA16_SNORM:r.RGBA16_SNORM_EXT}:null};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/LoseContext":function(){define(["exports"],
function(k){k.load=function(r,p){const e=p.loseContext&&r.getExtension("WEBGL_lose_context");return e?{loseRenderingContext:()=>e.loseContext()}:null};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/LabelManager":function(){define("exports ../../chunks/tslib.es6 ../../core/Accessor ../../core/Error ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ./engine/webgl/collisions/CollisionEngine".split(" "),
function(k,r,p,e,n,m,l,d,a,b){k.LabelManager=class extends p{constructor(f){super(f);this._lastUpdate=0;this.collisionEngine=new b.CollisionEngine;this.lastUpdateId=-1;this.updateRequested=!1;this.view=null}get updating(){n("esri-2d-log-updating")&&console.log(`Updating LabelManager ${this.updateRequested}:\n-> updateRequested: ${this.updateRequested}`);return this.updateRequested}update(f){const g=performance.now();32<=g-this._lastUpdate?(this._lastUpdate=g,this.doUpdate(f)):this.requestUpdate()}viewChange(){this.requestUpdate()}requestUpdate(){this.updateRequested||
(this.updateRequested=!0,this.view?.requestUpdate())}processUpdate(f){this.updateRequested&&(this.updateRequested=!1,this.update(f))}doUpdate(f){const g=this.view;if(g)try{const q=f.state.scale,c=g.featuresTilingScheme.getClosestInfoForScale(q).level;this.collisionEngine.run(g.allLayerViews.items,f,q,c)}catch(q){}}};r.__decorate([l.property()],k.LabelManager.prototype,"updateRequested",void 0);r.__decorate([l.property()],k.LabelManager.prototype,"updating",null);r.__decorate([l.property()],k.LabelManager.prototype,
"view",void 0);k.LabelManager=r.__decorate([a.subclass("esri.views.2d.LabelManager")],k.LabelManager);Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/collisions/CollisionEngine":function(){define(["exports","../../../../../core/has","../definitions","../enums","./CollisionGrid"],function(k,r,p,e,n){function m(a,b){a=a.children.slice();a.sort((f,g)=>f.tileAge-g.tileAge);a.forEach(f=>{null!=f.labelMetrics&&f.isReady&&b(f,f.labelMetrics)})}function l(a,b){return(!a.minScale||
a.minScale>=b)&&(!a.maxScale||a.maxScale<=b)}class d{run(a,b,f,g){const q=[];for(let c=a.length-1;0<=c;c--){const h=a[c];h.labelingCollisionInfos?.length&&q.push(...h.labelingCollisionInfos)}r("esri-2d-update-debug")&&q.length&&console.debug("CollisionEngine.run");this._transformMetrics(q);this._runCollision(q,b,f,g);for(const c of q)c.container.requestRender()}_runCollision(a,b,f,g){const [q,c]=b.state.size,h=new n.CollisionBitsetGrid(q,c,b.pixelRatio);for(const {container:u,deconflictionEnabled:A,
visible:z}of a){const t=u.attributeView;A?z?(this._prepare(u),this._collideVisible(h,u,f,g),this._collideInvisible(h,u)):m(u,(w,x)=>{for(const B of x)t.setLabelMinZoom(B.entityTexel,255)}):m(u,(w,x)=>{for(const B of x)l(B,f)?(t.setLabelMinZoom(B.entityTexel,0),z&&h.insertMetrics(B)):t.setLabelMinZoom(B.entityTexel,254)})}}_isFiltered(a,b,f){a=b.getFilterFlags(a);f=null==f.featureEffect||f.featureEffect.excludedLabelsVisible||a&p.effectFlag0;return!(a&p.filterFlag0&&f)}_prepare(a){const b=a.attributeView,
f=new Set;m(a,(g,q)=>{for(const c of q)g=c.entityTexel,f.has(g)||(f.add(g),this._isFiltered(g,b,a.layerView)?b.setLabelMinZoom(g,254):0!==b.getLabelMinZoom(g)?b.setLabelMinZoom(g,255):b.setLabelMinZoom(g,0))})}_collideVisible(a,b,f,g){const q=b.attributeView,c=new Set;m(b,(h,u)=>{for(var A=0;A<u.length;A++){const t=u[A].entityTexel;if(c.has(t))continue;if(h.key.level!==g){q.setLabelMinZoom(t,254);c.add(t);continue}if(!l(u[A],f)){q.setLabelMinZoom(t,254);c.add(t);continue}if(0!==q.getLabelMinZoom(t)){c.add(t);
continue}let w=!1,x=!0;for(var z=A;A<u.length;A++){const B=u[A];if(B.entityTexel!==t)break;if(!w)switch(a.hasCollision(B)){case n.hasCollision:w=!0;x=!1;break;case n.none:x=!1}}if(!w)for(;z<A;z++)a.insertMetrics(u[z]);--A;x||(c.add(t),q.setLabelMinZoom(t,w?254:0))}})}_collideInvisible(a,b){const f=b.attributeView,g=new Set;m(b,(q,c)=>{for(var h=0;h<c.length;h++){q=c[h].entityTexel;if(g.has(q))continue;if(255!==f.getLabelMinZoom(q)){g.add(q);continue}let A=!1,z=!0;for(var u=h;h<c.length;h++){const t=
c[h];if(t.entityTexel!==q)break;if(!A)switch(a.hasCollision(t)){case n.hasCollision:A=!0;z=!1;break;case n.none:z=!1}}if(!A)for(;u<h;u++)a.insertMetrics(c[u]);--h;z||(g.add(q),f.setLabelMinZoom(q,A?255:0))}})}_transformMetrics(a){for(const {container:b,geometryType:f,vvEvaluators:g}of a)m(b,(q,c)=>{const h=b.attributeView;q=q.transforms.labelMat2d;q[4]=Math.round(q[4]);q[5]=Math.round(q[5]);const u="polyline"===f;for(const w of c){const {entityTexel:x,anchorX:B,anchorY:C}=w;c=w.referenceBounds?.size??
0;var A=g[0];if(null!=A){var z=h.getVisualVariableData(x,e.VVBinding.SIZE);A=A(z);c=isNaN(A)||null==A||Infinity===A?c:A}A=p.labelPlacementOffsetPadding+c/2;c=w.directionX*A;A*=w.directionY;for(const y of w.bounds){z=B;var t=C;if(u){t=B+y.x+c;const v=C+y.y+A;z=q[0]*t+q[2]*v+q[4];t=q[1]*t+q[3]*v+q[5];y.transformedX=Math.floor(z);y.transformedY=Math.floor(t)}else z=q[0]*B+q[2]*C+q[4],t=q[1]*B+q[3]*C+q[5],t=t+y.y+A,y.transformedX=z+y.x+c,y.transformedY=t}}})}}k.CollisionEngine=d;Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/collisions/CollisionGrid":function(){define(["exports","../../../../../core/mathUtils","../../../layers/features/support/StaticBitSet"],function(k,r,p){class e{constructor(n,m,l){this._width=n*l;this._height=m*l;this._pixelRatio=l;n=Math.ceil(this._width/1);m=Math.ceil(this._height/1);this._cols=n;this._rows=m;this._cells=p.StaticBitSet.create(n*m)}insertMetrics(n){this._markMetrics(n)}hasCollision(n){let m=0;for(const {transformedX:l,
transformedY:d,width:a,height:b}of n.bounds)switch(this._collide(l*this._pixelRatio,d*this._pixelRatio,a*this._pixelRatio,b*this._pixelRatio)){case 2:return 2;case 1:m++}return m===n.bounds.length?1:0}getCellId(n,m){return n+m*this._cols}has(n){return this._cells.has(n)}hasRange(n,m){return this._cells.hasRange(n,m)}set(n){this._cells.set(n)}setRange(n,m){this._cells.setRange(n,m)}_collide(n,m,l,d){n-=l/2;m-=d/2;l=n+l;var a=m+d;if(0>l||0>a||n>this._width||m>this._height)return 1;d=r.clamp(Math.floor(n/
1),0,this._cols);var b=r.clamp(Math.floor(m/1),0,this._rows);n=r.clamp(Math.ceil(l/1),0,this._cols);m=r.clamp(Math.ceil(a/1),0,this._rows);for(l=b;l<=m;l++)for(a=d;a<=n;a++)if(b=this.getCellId(a,l),this.has(b))return 2;return 0}_mark(n,m,l,d){n-=l/2;m-=d/2;l=n+l;var a=m+d;d=r.clamp(Math.floor(n/1),0,this._cols);var b=r.clamp(Math.floor(m/1),0,this._rows);n=r.clamp(Math.ceil(l/1),0,this._cols);m=r.clamp(Math.ceil(a/1),0,this._rows);for(l=b;l<=m;l++)for(a=d;a<=n;a++)b=this.getCellId(a,l),this.set(b);
return!1}_markMetrics(n){for(const {transformedX:m,transformedY:l,width:d,height:a}of n.bounds)this._mark(m*this._pixelRatio,l*this._pixelRatio,d*this._pixelRatio,a*this._pixelRatio)}}k.CollisionBitsetGrid=e;k.hasCollision=2;k.none=0;k.outsideExtent=1;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/StaticBitSet":function(){define(["exports"],function(k){class r{static fromBuffer(p,e){return new r(p,e)}static create(p,e=4294967295){p=new Uint32Array(Math.ceil(p/
32));return new r(p,e)}constructor(p,e){this._mask=0;this._buf=p;this._mask=e}_getIndex(p){return Math.floor(p/32)}has(p){p&=this._mask;return!!(this._buf[this._getIndex(p)]&1<<p%32)}hasRange(p,e){for(;p%32&&p!==e;){if(this.has(p))return!0;p++}for(;e%32&&p!==e;){if(this.has(p))return!0;e--}if(p===e)return!1;for(p/=32;p!==e/32;p++)if(this._buf[p])return!0;return!1}set(p){p&=this._mask;const e=this._getIndex(p);this._buf[e]|=1<<p%32}setRange(p,e){for(;p%32&&p!==e;)this.set(p++);for(;e%32&&p!==e;)this.set(e--);
if(p!==e)for(p/=32;p!==e/32;p++)this._buf[p]=4294967295}unset(p){p&=this._mask;const e=this._getIndex(p);this._buf[e]&=4294967295^1<<p%32}resize(p){const e=this._buf;p=new Uint32Array(Math.ceil(p/32));p.set(e);this._buf=p}or(p){for(let e=0;e<this._buf.length;e++)this._buf[e]|=p._buf[e];return this}and(p){for(let e=0;e<this._buf.length;e++)this._buf[e]&=p._buf[e];return this}xor(p){for(let e=0;e<this._buf.length;e++)this._buf[e]^=p._buf[e];return this}ior(p){for(let e=0;e<this._buf.length;e++)this._buf[e]|=
~p._buf[e];return this}iand(p){for(let e=0;e<this._buf.length;e++)this._buf[e]&=~p._buf[e];return this}ixor(p){for(let e=0;e<this._buf.length;e++)this._buf[e]^=~p._buf[e];return this}any(){for(let p=0;p<this._buf.length;p++)if(this._buf[p])return!0;return!1}copy(p){for(let e=0;e<this._buf.length;e++)this._buf[e]=p._buf[e];return this}clone(){return new r(this._buf.slice(),this._mask)}clear(){for(let p=0;p<this._buf.length;p++)this._buf[p]=0;return this}forEachSet(p){for(let e=0;e<this._buf.length;e++){let n=
this._buf[e],m=32*e;if(n)for(;n;)n&1&&p(m),n>>>=1,m++}}countSet(){let p=0;this.forEachSet(e=>{p++});return p}}k.StaticBitSet=r;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/graphics/GraphicsView2D":function(){define("../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/has ../../../../core/Identifiable ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/jsonUtils ../../../../layers/support/FieldsIndex ../../../../symbols/cim/CIMSymbolHelper ../../../../symbols/cim/OverrideHelper ../../../../symbols/support/defaults ../../engine/webgl/definitions ../../engine/webgl/FeatureTile ../../engine/webgl/mesh/MeshData ../../engine/webgl/mesh/factories/ResourceProxy ../../engine/webgl/shaderGraph/techniques/createGraphicSymbolMeshSchemas ../features/schema/processor/StorageSchema ../features/support/AttributeStore ../features/support/ComputedAttributeStorage ../features/support/FeatureMetadata ../features/support/GraphicsReader ./GraphicStore ../support/FeatureCommandQueue ../support/UpdateTracking2D".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g,q,c,h,u,A,z,t,w,x,B,C,y,v,F,D,G,E,H){class K{static getOrCreate(J,L,P){let Q=L.get(J.id);Q||(Q=new K(J,P),L.set(J.id,Q));return Q}static fromItems(J,L,P){J=new K(J,P);for(const Q of L)J.append(Q);return J}constructor(J,L){this.tile=J;this.metadata=L;this.addedOrModified=[];this.removed=[];this.objectIdMap=null}get reader(){this._reader||(this._reader=D.GraphicsReader.from(this.addedOrModified,this.tile,this.metadata));return this._reader}append(J){this.addedOrModified.push(J);
J.hasAnimations&&(this.objectIdMap=this.objectIdMap||{},this.objectIdMap[J.displayId]=J.objectId)}}r=class extends n.IdentifiableMixin(r){constructor(J){super(J);this._attached=!1;this._tiles=new Map;this._controller=new AbortController;this._hashToSymbolInfo=new Map;this._lastCleanup=performance.now();this._cleanupRequired=!0;this.lastUpdateId=-1;this.renderer=null;this._updateTracking=new H.UpdateTracking2D({debugName:"GraphicsView2D"});this.updateRequested=!1;this.defaultPointSymbolEnabled=!0;
this._commandQueue=new E.FeatureCommandQueue({process:L=>{switch(L.type){case "update":return this._update();default:throw Error("InternalError: Unsupported command");}}});this.graphicUpdateHandler=this.graphicUpdateHandler.bind(this)}destroy(){this.container.destroy();this.renderer=this.view=null;this._set("graphics",null);this._controller.abort();this._graphicStore.clear();this._graphicStore.destroy();this._attributeStore=null;this._hashToSymbolInfo.clear();this._updateTracking.destroy();this._commandQueue.destroy()}_initAttributeStore(){this._storage=
new v.ComputedAttributeStorage({spatialReference:this.view.spatialReference,fields:new c});this._attributeStore=new y.AttributeStore({isLocal:!0,update:L=>{e("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView2D.AttributeStoreView.updateStart`,{message:L});this.container.attributeView.requestUpdate(L);this.container.requestRender();e("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView2D.AttributeStoreView.updateEnd`,{message:L})}});const J=C.createStorageSchema(null,
[]);this._attributeStore.update(J,this._storage,null);this.container.checkHighlight=()=>this._attributeStore.hasHighlight}initialize(){this._initAttributeStore();this._metadata=F.GraphicsMetadata.createGraphics(this.view.spatialReference);this._resourceProxy=new x.ResourceProxy({fetch:J=>Promise.all(J.map(L=>this.view.stage.textureManager.rasterizeItem(L))),fetchDictionary:J=>{throw Error("InternalError: Graphics do not support Dictionary requests");}});this.addHandles([d.watch(()=>this._effectiveRenderer,
()=>this._pushUpdate()),this.view.graphicsTileStore.on("update",this._onTileUpdate.bind(this)),this.container.on("attach",()=>{this.addHandles([this.graphics.on("change",()=>this._pushUpdate())]);this._graphicStore?.destroy();this._graphicStore=new G(this.view.spatialReference,this._cimResourceManager,this.view.featuresTilingScheme,this.view.state.scale,this._attributeStore);this._attached=!0;this.requestUpdate();this._pushUpdate()})]);this._updateTracking.addUpdateTracking("CommandQueue",this._commandQueue.updateTracking);
this._onTileUpdate({added:this.view.graphicsTileStore.tiles,removed:[]})}get _effectiveRenderer(){return"function"===typeof this.renderer?this.renderer():this.renderer}get _cimResourceManager(){return this.view.stage.textureManager.resourceManager}get updating(){const J=!this._attached||this._updateTracking.updating;e("esri-2d-log-updating")&&console.log(`Updating GraphicsView2D: ${J}\n  -> attaching ${!this._attached}\n  -> updateTracking ${this._updateTracking.updating}`);return J}hitTest(J){if(!this.view||
this.view.suspended)return[];const {resolution:L,rotation:P}=this.view.state;J=this._graphicStore.hitTest(J.x,J.y,2,L,P);const Q=new Set(J),S=this.graphics.items.reduce((U,X)=>{Q.has(X.uid)&&U.set(X.uid,X);return U},new Map);return J.map(U=>S.get(U)).filter(p.isSome)}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.requestUpdateCallback());this.notifyChange("updating")}processUpdate(J){this.updateRequested&&(this.updateRequested=!1,this.update(J))}viewChange(){this.requestUpdate()}setHighlight(J){const L=
[];for(const {objectId:P,highlightFlags:Q}of J){const S=this._graphicStore.getItem(P)?.displayId;L.push({objectId:P,highlightFlags:Q,displayId:S})}this._attributeStore.setHighlight(L,J);this._pushUpdate()}graphicUpdateHandler(J){this._pushUpdate()}update(J){this.updateRequested=!1;this._attached&&this._graphicStore.updateLevel(J.state.resolution)&&this.pushUpdate()}pushUpdate(){this._pushUpdate()}_pushUpdate(){l.ignoreAbortErrors(this._commandQueue.push({type:"update"}))}async _update(){try{e("esri-2d-update-debug")&&
console.debug(`[Id: ${this.layerId}] GraphicsView._update start`);const J=await this._graphicStore.update(this.graphics,P=>this._getSymbolForGraphic(P),P=>this._ensureSymbolResource(P));for(const P of J.updated)this.container.restartAnimation(P.objectId);if(!J.hasAnyUpdate()){this._attributeStore.sendUpdates();return}J.removed.length&&(this._cleanupRequired=!0);e("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView updateMessage`,J);const L=this._createTileMessages(J);await this._densifyItemsForDisplay(L);
await this._fetchResources(L);this._write(L);for(const P of J.added)this._setFilterState(P);for(const P of J.updated)this._setFilterState(P);e("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView sendUpdate`,J);this._attributeStore.sendUpdates();e("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView sendUpdate.await`,J)}catch(J){}this._cleanupSharedResources()}_createTileMessages(J){const L=new Map;for(var P of J.added){var Q=this.view.graphicsTileStore.getIntersectingTiles(P.symbolBounds);
for(const S of Q)K.getOrCreate(S,L,this._metadata).append(P)}for(const S of J.updated){P=this.view.graphicsTileStore.getIntersectingTiles(S.prevSymbolBounds);Q=this.view.graphicsTileStore.getIntersectingTiles(S.symbolBounds);for(const U of P)K.getOrCreate(U,L,this._metadata).removed.push(S.displayId);for(const U of Q)K.getOrCreate(U,L,this._metadata).append(S)}for(const S of J.removed){J=this.view.graphicsTileStore.getIntersectingTiles(S.symbolBounds);for(const U of J)K.getOrCreate(U,L,this._metadata).removed.push(S.displayId)}return Array.from(L.values())}async _densifyItemsForDisplay(J){const L=
new Map;for(const P of J)for(const Q of P.addedOrModified)L.has(Q)||L.set(Q,Q.densifyCurvedGeometryForDisplay(this.view.spatialReference));await Promise.all(L.values())}async _fetchResources(J){const L={timeZone:null,timeExtent:null};for(const {tile:P,reader:Q}of J){e("esri-2d-update-debug")&&console.debug(`Id[${this.layerId}] Tile[${P.id}] GraphicsView fetchResources`,J);const S=Q.getCursor();for(;S.next();)for(const U of S.getMeshWriters())U.enqueueRequest(this._resourceProxy,S,P.createArcadeEvaluationOptions(L))}await this._resourceProxy.fetchEnqueuedResources()}_write(J){for(const L of J){e("esri-2d-update-debug")&&
console.debug(`Id[${this.layerId}] Tile[${L.tile.id}] GraphicsView write`,L);J=this._writeMeshes(L);let P=this._tiles.get(L.tile.key);P||=this._createFeatureTile(L.tile.key);e("esri-2d-update-debug")&&console.debug(`Id[${this.layerId}] Tile[${L.tile.id}] GraphicsView onTileData`,L);this.container.onTileData(P,{type:"update",modify:J,remove:L.removed,end:!1,attributeEpoch:this._attributeStore.epoch,objectIdMap:L.objectIdMap});this.container.requestRender()}}_writeMeshes(J){const L={timeZone:null,timeExtent:null},
P=new w.MeshData(J.tile.id),Q=J.reader.getCursor();for(;Q.next();){P.entityStart(Q.getDisplayId(),Q.getZOrder());for(const S of Q.getMeshWriters())S.write(P,this._resourceProxy,Q,J.tile.createArcadeEvaluationOptions(L),J.tile.level);P.entityEnd()}return{...P.serialize().message,tileId:J.tile.id}}_setFilterState(J){const L=J.displayId,P=this._attributeStore.getHighlightFlags(J.objectId);this._attributeStore.setData(L,0,0,P|(J.visible?z.filterFlag0:0))}_getSymbolForGraphic(J){return null!=J.symbol?
J.symbol:null!=this._effectiveRenderer?this._effectiveRenderer.getSymbol(J):this._getNullSymbol(J)}async _ensureSymbolResource(J){if(J.symbol){var L=await this._getSymbolInfo(J.symbol);if(L){var P=L.linearCIM.filter(Q=>"text"===Q.type);0<P.length?(P=await this._getTextResources(J,P),J.symbolResource={symbolInfo:L,textInfo:P}):J.symbolResource={symbolInfo:L}}}}_getSymbolInfo(J){const L=J.hash();this._hashToSymbolInfo.has(L)||this._hashToSymbolInfo.set(L,this._createSymbolInfo(L,J).catch(P=>null));
return this._hashToSymbolInfo.get(L)}async _createSymbolInfo(J,L){L=await this._convertToCIMSymbol(L);const P=await this._createLinearCIM(L),Q=await this._createMeshWriters(L,P);return{hash:J,cimSymbol:L,linearCIM:P,meshWriters:Q}}async _convertToCIMSymbol(J){J=h.symbolToCIM(J);return"web-style"===J.type?(await J.fetchCIMSymbol()).data:J}async _createLinearCIM(J){await Promise.all(h.CIMSymbolHelper.fetchResources(J.symbol,this._cimResourceManager,[]));return this.view.stage.cimAnalyzer.analyzeSymbolReference(J,
!1)}async _createMeshWriters(J,L){l.throwIfAborted(this._controller.signal);const P=this.view.stage.meshWriterRegistry;J=await B.createGraphicSymbolMeshSchemas(J,L,this.container.instanceStore);return Promise.all(J.map(Q=>P.createMeshWriter(this._storage,this._resourceProxy,{tileInfo:this.view.featuresTilingScheme.tileInfo},Q)))}_onTileUpdate(J){if(J.added&&0<J.added.length)for(const L of J.added)this._updateTracking.addPromise(this._addTile(L));if(J.removed&&0<J.removed.length)for(const L of J.removed)this._removeTile(L.key)}_createFeatureTile(J){var L=
this.view.featuresTilingScheme.getTileBounds(g.create(),J);const P=this.view.featuresTilingScheme.getTileResolution(J.level);L=new t.FeatureTile(J,P,L[0],L[3]);this._tiles.set(J,L);this.container.addChild(L);return L}async _addTile(J){if(this._attached){var L=this._graphicStore.queryItems(J);if(L.length){var P=this._createFeatureTile(J.key);J=K.fromItems(J,L,this._metadata);await this._densifyItemsForDisplay([J]);await this._fetchResources([J]);L=this._writeMeshes(J);P.onMessage({type:"append",append:L,
clear:!1,end:!0,attributeEpoch:this._attributeStore.epoch,objectIdMap:J.objectIdMap})}}}_removeTile(J){if(this._tiles.has(J)){var L=this._tiles.get(J);this.container.removeChild(L);L.destroy();this._tiles.delete(J)}}_getNullSymbol(J){J=J.geometry;return q.isPolyline(J)?A.errorPolylineSymbol2D:q.isPolygon(J)||q.isExtent(J)?A.errorPolygonSymbol2D:this.defaultPointSymbolEnabled?A.errorPointSymbol2D:null}async _getTextResources(J,L){var P=[];const Q=[];for(var S=0;S<L.length;S++){const X=L[S],{resource:aa,
overrides:ba}=X.textRasterizationParam;if(0<ba?.length){var U=u.OverrideHelper.resolveSymbolOverrides({type:"CIMSymbolReference",primitiveOverrides:ba,symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,size:aa.symbol.height,anchorPointUnits:"Relative",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:aa.symbol,textString:aa.textString}],scaleSymbolsProportionally:!0,respectFrame:!0}]}},J,this.view.spatialReference,null,
q.getJsonType(J.projectedGeometry),null,null);U.then(fa=>{({textString:fa}=fa.symbolLayers[0].markerGraphics[0]);Q.push({type:"cim-rasterization-info",resource:{type:"text",textString:fa||"",font:aa.font}});X.text=aa.textString=fa||""});P.push(U)}else Q.push({type:"cim-rasterization-info",resource:aa})}0<P.length&&await Promise.all(P);J=Q.map(X=>this.view.stage.textureManager.rasterizeItem(X));J=await Promise.all(J);m.assertIsSome(J);P=new Map;for(S=0;S<L.length;S++)U=L[S],P.set(U.textRasterizationParam.resource.symbol,
{text:U.text,glyphMosaicItems:J[S]});return P}_cleanupSharedResources(){if(this._cleanupRequired){var J=performance.now();if(!(5E3>J-this._lastCleanup)){this._cleanupRequired=!1;this._lastCleanup=J;J=new Set;for(var L of this._graphicStore.items())J.add(L.symbolResource?.symbolInfo.hash);L=new Set(this._hashToSymbolInfo.keys());for(const P of L.values())J.has(P)||this._hashToSymbolInfo.delete(P)}}}};k.__decorate([a.property()],r.prototype,"_effectiveRenderer",null);k.__decorate([a.property({constructOnly:!0})],
r.prototype,"layerId",void 0);k.__decorate([a.property({constructOnly:!0})],r.prototype,"requestUpdateCallback",void 0);k.__decorate([a.property()],r.prototype,"container",void 0);k.__decorate([a.property({constructOnly:!0})],r.prototype,"graphics",void 0);k.__decorate([a.property()],r.prototype,"renderer",void 0);k.__decorate([a.property()],r.prototype,"_updateTracking",void 0);k.__decorate([a.property()],r.prototype,"updating",null);k.__decorate([a.property()],r.prototype,"view",void 0);k.__decorate([a.property()],
r.prototype,"updateRequested",void 0);k.__decorate([a.property()],r.prototype,"defaultPointSymbolEnabled",void 0);return r=k.__decorate([f.subclass("esri.views.2d.layers.graphics.GraphicsView2D")],r)})},"esri/views/2d/engine/webgl/mesh/MeshData":function(){define(["exports","../DisplayEntity","../DisplayRecord","./VertexDataWriter","../util/Writer"],function(k,r,p,e,n){class m{constructor(l,d=0){this._id=l;this._sizeHint=d;this._entitySortKeyIndex=this._entityIdIndex=this._entityCountOffset=this._entityRecordCountOffset=
0;this._didEntityStart=!1;this._instanceIdToVertexData=new Map;this._recordVertexCount=this._recordVertexStart=this._recordIndexCount=this._recordIndexStart=0;this._current={metric:null,writer:null,start:0,sortKey:0,instanceId:0,layoutHash:0,indexStart:0,vertexStart:0,textureKey:0,metricBoxLenPointer:0};this._entities=new n(Uint32Array,this._sizeHint*r.byteSizeHint);this._entityCountOffset=this._entities.push(0)}get id(){return this._id}serialize(){const l=[],d=[],a=this._entities.buffer();for(const b of this._instanceIdToVertexData.values())d.push(b.serialize(l));
return{message:{data:d,entities:a},transferList:l}}vertexCount(){return this._current.writer?.vertexCount??0}indexCount(){return this._current.writer?.indexCount??0}vertexEnsureSize(l){this._current.writer.vertexEnsureSize(l)}indexEnsureSize(l){this._current.writer.indexEnsureSize(l)}vertexWrite(l){this._current.writer.writeVertex(l)}vertexWriteRegion(l){this._current.writer.writeVertexRegion(l)}vertexWriteF32(l){this._current.writer.writeVertexF32(l)}recordBounds(l,d,a,b){}indexWrite(l){this._current.writer.writeIndex(l)}metricStart(l){this._current.metric=
l}metricEnd(){this._current.metric.bounds.length&&this._current.writer.writeMetric(this._current.metric)}metricBoxWrite(l){this._current.metric.bounds.push(l)}entityStart(l,d=l){this._entityIdIndex=this._entities.push(l);this._entitySortKeyIndex=this._entities.writeF32(d);this._entityRecordCountOffset=this._entities.push(0);this._didEntityStart=!0}entityRecordCount(){return this._entities.getValue(this._entityRecordCountOffset)}entityEnd(){this._didEntityStart&&(0===this.entityRecordCount()?this._entities.seek(this._entityIdIndex):
this._entities.incr(this._entityCountOffset),this._didEntityStart=!1)}recordCount(){return this._entities.getValue(this._entityRecordCountOffset)}recordStart(l,d,a=0){this._current.writer=this._getVertexWriter(l,d);this._current.indexStart=this._current.writer.indexCount;this._current.vertexStart=this._current.writer.vertexCount;this._current.instanceId=l;this._current.layoutHash=d.hash;this._current.textureKey=a}recordEnd(l=0){const d=this._current.vertexStart,a=this._current.writer.vertexCount-
d;if(!a)return!1;const b=this._current.indexStart,f=this._current.writer.indexCount-b;this._recordIndexStart=b;this._recordIndexCount=f;this._recordVertexStart=d;this._recordVertexCount=a;this._entities.incr(this._entityRecordCountOffset);p.write(this._entities,this._current.instanceId,this._current.textureKey,b,f,d,a,l);return!0}copyLast(l,d){var a=this._recordVertexStart+this._recordVertexCount;this._entities.incr(this._entityRecordCountOffset);p.write(this._entities,this._current.instanceId,this._current.textureKey,
this._recordIndexStart+this._recordIndexCount,this._recordIndexCount,a,this._recordVertexCount,0);var b=this._current.writer.indexWriter;const f=this._current.writer.vertexWriter;var g=this._recordIndexStart+this._recordIndexCount,q=this._recordVertexCount;for(var c=this._recordIndexStart;c!==g;c++){const h=b.getValue(c);b.push(h+q)}b=this._current.writer.layout.stride/Uint32Array.BYTES_PER_ELEMENT;q=this._recordVertexStart*b;for(g=(this._recordVertexStart+this._recordVertexCount)*b;q!==g;q++)c=f.getValue(q),
f.push(c);g=this._current.writer.layout.position;q=g.packPrecisionFactor??1;g=g.offset/Uint32Array.BYTES_PER_ELEMENT;l*=q;d*=q;for(a*=b;a<=f.length;a+=b)f.i1616Add(a+g,l,d)}copyLastFrom(l,d,a){var b=l._entities.getValue(l._entityIdIndex),f=this._entities.getValue(this._entityIdIndex);b!==f&&(f=l._entities.getValueF32(l._entitySortKeyIndex),this.entityStart(b,f));this.recordStart(l._current.instanceId,l._current.writer.layout,l._current.textureKey);b=this._current.writer.layout.stride/Uint32Array.BYTES_PER_ELEMENT;
var g=this._current.vertexStart,q=l._current.vertexStart-g;const c=this._current.writer.indexWriter;f=this._current.writer.vertexWriter;const h=l._current.writer.indexWriter;var u=l._current.writer.vertexWriter;for(let A=l._current.indexStart;A!==h.length;A++){const z=h.getValue(A);c.push(z-q)}for(l=l._current.vertexStart*b;l!==u.length;l++)q=u.getValue(l),f.push(q);l=this._current.writer.layout.position;u=l.packPrecisionFactor??1;l=l.offset/Uint32Array.BYTES_PER_ELEMENT;d*=u;a*=u;for(g*=b;g<=f.length;g+=
b)f.i1616Add(g+l,d,a);this.recordEnd()}_getVertexWriter(l,d){const a=this._instanceIdToVertexData;a.has(l)||a.set(l,new e.VertexDataWriter(l,d,this._sizeHint));return a.get(l)}}k.MeshData=m;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/VertexDataWriter":function(){define(["exports","../util/Writer"],function(k,r){class p{constructor(e,n,m=0){const l=6*m*Uint32Array.BYTES_PER_ELEMENT;m=4*m*n.stride;const d=n.stride/4,a=n.attributes.find(b=>"pos"===
b.name||"position"===b.name);if(!a)throw Error("InternalError: Unable to find position attribute");this.layout={...n,position:a};this._indices=new r(Uint32Array,l);this._vertices=new r(Uint32Array,m);this._metrics=new r(Uint32Array,0);this._metricCountOffset=this._metrics.push(0);this._strideInt=d;this._instanceId=e}serialize(e){const n=this._indices.buffer(),m=this._vertices.buffer(),l=this._metrics.length?this._metrics.buffer():null;e.push(n,m);return{instanceId:this._instanceId,layout:this.layout,
indices:n,vertices:m,metrics:l}}get strideInt(){return this._strideInt}get vertexCount(){return this._vertices.length/this._strideInt}get indexCount(){return this._indices.length}get indexWriter(){return this._indices}get vertexWriter(){return this._vertices}get metricWriter(){return this._metrics}vertexEnsureSize(e){this._vertices.ensureSize(e)}indexEnsureSize(e){this._indices.ensureSize(e)}writeIndex(e){this._indices.push(e)}writeVertex(e){this._vertices.push(e)}writeVertexRegion(e){this._vertices.writeRegion(e)}writeVertexF32(e){this._vertices.writeF32(e)}writeMetric(e){this._metrics.incr(this._metricCountOffset);
e.serialize(this._metrics)}}k.VertexDataWriter=p;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/Writer":function(){define(function(){class k{get length(){return this._pos}constructor(r,p){this._pos=0;p=p?this._roundToNearest(p,r.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(p);this._buffer=new r(this._array);this._ctor=r;this._i16View=new Int16Array(this._array)}_roundToNearest(r,p){r=Math.round(r);return 1===p?r:r+(p-r%p)}_ensureSize(r){if(this._pos+
r>=this._buffer.length){r=this._roundToNearest(1.25*(this._array.byteLength+r*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT);r=new ArrayBuffer(r);const p=new this._ctor(r);p.set(this._buffer,0);this._array=r;this._buffer=p;this._i16View=new Int16Array(this._array)}}ensureSize(r){this._ensureSize(r)}writeF32(r){this._ensureSize(1);const p=this._pos;(new Float32Array(this._array,4*this._pos,1))[0]=r;this._pos++;return p}push(r){this._ensureSize(1);const p=this._pos;this._buffer[this._pos++]=
r;return p}writeFixed(r){this._buffer[this._pos++]=r}setValue(r,p){this._buffer[r]=p}i1616Add(r,p,e){this._i16View[2*r]+=p;this._i16View[2*r+1]+=e}getValue(r){return this._buffer[r]}getValueF32(r){return(new Float32Array(this._array,4*r,1))[0]}incr(r){if(this._buffer.length<r)throw Error("Increment index overflows the target buffer");this._buffer[r]++}decr(r){this._buffer[r]--}writeRegion(r){this._ensureSize(r.length);const p=this._pos;this._buffer.set(r,this._pos);this._pos+=r.length;return p}writeManyFrom(r,
p,e){for(this._ensureSize(e-p);p!==e;p++)this.writeFixed(r._buffer[p])}buffer(){const r=this._array.slice(0,4*this._pos);this.destroy();return r}toArray(){return[...this._buffer]}seek(r){this._pos=r}destroy(){this._buffer=this._array=null}}return k})},"esri/views/2d/engine/webgl/mesh/factories/ResourceProxy":function(){define(["exports","../../../../../../core/string","../../urlUtils","../../shaderGraph/techniques/mesh/AResourceProxy"],function(k,r,p,e){class n extends e.AResourceProxy{constructor(m){super();
this._fetcher=m;this._controller=new AbortController;this._pendingIds=new Set;this._pendingRequests=[];this._resourceIdToResource=new Map}destroy(){this._controller.abort()}get _abortOptions(){return{signal:this._controller.signal}}enqueueRequest(m){var l=p.discardUrlIfHasUrlHash(m.resource);l=r.numericHash(JSON.stringify(l));if(this._pendingIds.has(l))return l;this._pendingIds.add(l);this._pendingRequests.push({...m,resourceId:l});return l}async fetchEnqueuedResources(){const m=this._pendingRequests;
this._pendingIds.clear();this._pendingRequests=[];if(0!==m.length){var l=await this._fetcher.fetch(m,this._abortOptions);for(let d=0;d<l.length;d++)this._resourceIdToResource.set(m[d].resourceId,l[d])}}async fetchResourceImmediate(m){m=await this._fetcher.fetch([m],this._abortOptions);if(1!==m.length)throw Error("FeaturePipelineResourceProxy: failed to fetch resources");return m[0]}async fetchDictionaryResourceImmediate(m){m=await this._fetcher.fetchDictionary([m],this._abortOptions);if(1!==m.length)throw Error("FeaturePipelineResourceProxy: failed to fetch dictionary resources");
return m[0]}getResource(m){return this._resourceIdToResource.get(m)}}k.ResourceProxy=n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/AResourceProxy":function(){define(["exports"],function(k){class r{}k.AResourceProxy=r;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/createGraphicSymbolMeshSchemas":function(){define(["exports","../../../../layers/features/schema/processor/VisualVariablesSchema",
"../../../../layers/features/schema/processor/symbols/ComplexSymbolSchema"],function(k,r,p){k.createGraphicSymbolMeshSchemas=async function(e,n,m){const l=[];e={scaleInfo:p.getScaleInfo(e),scaleExpression:null};for(const d of n)switch(d.type){case "marker":if(d.animationParams){l.push(...p.createAnimatedMarkerMeshInfos(m.instances.animatedMarker,d,r.noVisualVariables,e));break}l.push(...p.createComplexMarkerMeshInfos(m.instances.marker,d,r.noVisualVariables,e));break;case "fill":null==d.spriteRasterizationParam?
l.push(...p.createComplexSimpleFillMeshInfos(m.instances.fill,d,e)):l.push(...p.createComplexFillMeshInfos(m.instances.complexFill,d,!1,e));break;case "line":d.spriteRasterizationParam?l.push(...p.createComplexTexturedLineMeshInfos(m.instances.texturedLine,d,!1,e)):l.push(...p.createComplexSimpleLineMeshInfos(m.instances.line,d,!1,e));break;case "text":l.push(...p.createComplexTextMeshInfos(m.instances.text,d,r.noVisualVariables,e));break;case "gradientFill":l.push(...p.createGradientFillMeshInfos(m.instances.gradientFill,
d,e));break;case "gradientStroke":l.push(...p.createGradientStrokeMeshInfos(m.instances.gradientStroke,d,e))}return l};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/VisualVariablesSchema":function(){define("exports ../../../../../../core/has ../../../../../../core/screenUtils ../../../../../../core/unitUtils ../../../../../../renderers/support/lengthUtils ../../../../engine/webgl/definitions ../../../../engine/webgl/shaderGraph/techniques/shaders/constants ./schemaUtils ../../support/rendererUtils".split(" "),
function(k,r,p,e,n,m,l,d,a){function b(z){if(!z.stops?.length)return null;z=z.stops.sort((w,x)=>w.value-x.value);var t=d.padStops(z,8);z=t.map(({value:w})=>w);t=t.map(({color:w})=>d.premultiplyColor(w));return{values:z,colors:t}}function f(z){if(!z.stops?.length)return null;z=z.stops.sort((w,x)=>w.value-x.value);var t=d.padStops(z,8);z=t.map(({value:w})=>w);t=t.map(({opacity:w})=>w);return{opacityValues:z,opacities:t}}function g(z){return{rotationType:"geographic"===z.rotationType?l.RotationType.Geographic:
l.RotationType.Arithmatic}}function q(z){if(!z.stops?.length)return null;if(z.stops.some(x=>x.useMaxValue||x.useMinValue))return(x,B)=>{const C=x.statisticsByLevel.get(B.key.level);x=z.stops.map(y=>{const v=y.useMaxValue?C?.get(z.field)?.maxValue??0:y.useMinValue?C?.get(z.field)?.minValue??0:y.value;y=y.size?p.pt2px(y.size):m.nanMagicNumber;return{value:v,size:y}}).sort((y,v)=>y.value-v.value);B=d.padStops(x,8);x=B.map(({value:y})=>y);B=B.map(({size:y})=>y);return{values:x,sizes:B}};var t=z.stops.sort((x,
B)=>x.value-B.value),w=d.padStops(t,8);t=w.map(({value:x})=>x);w=w.map(({size:x})=>p.pt2px(x));return{values:t,sizes:w}}function c(z){return t=>{({state:t}=t);return{unitValueToPixelsRatio:e.getMetersPerUnitForSR(t.spatialReference)/n.meterIn[z.valueUnit??"meters"]/t.resolution}}}function h(z,t){const w=t.length;if(z<t[0].value||1===w)return t[0].size;for(let x=1;x<w;x++)if(z<t[x].value)return t[x-1].size+(z-t[x-1].value)/(t[x].value-t[x-1].value)*(t[x].size-t[x-1].size);return t[w-1].size}function u(z){const {minDataValue:t,
maxDataValue:w,minSize:x,maxSize:B}=z;if("object"===typeof x&&"object"===typeof B)return(C,y)=>{y=C.state.scale;C=p.pt2px(h(y,x.stops));y=p.pt2px(h(y,B.stops));return{minMaxValueAndSize:[t,w,C,y]}};if("object"===typeof x||"object"===typeof B)throw Error("InternalError: Found a partial VisualVariableSizeMinMaxValue");return{minMaxValueAndSize:[t,w,p.pt2px(x),p.pt2px(B)]}}const A={visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:null,visualVariableSizeStops:null,visualVariableSizeScaleStops:null,
visualVariableSizeOutlineScaleStops:null,visualVariableSizeUnitValue:null,visualVariableSizeMinMaxValue:null};k.createVisualVariableColor=b;k.createVisualVariableOpacity=f;k.createVisualVariableRotation=g;k.createVisualVariableSizeMinMaxValue=u;k.createVisualVariableSizeStops=q;k.createVisualVariableSizeUnitValue=c;k.createVisualVariableUniforms=function(z){const t={...A};if(!(z&&"visualVariables"in z&&z.visualVariables))return t;for(const w of a.simplifyVisualVariables(z.visualVariables))switch(w.type){case "color":t.visualVariableColor=
b(w);break;case "opacity":t.visualVariableOpacity=f(w);break;case "rotation":t.visualVariableRotation=g(w);break;case "size":switch(z=w,"number"===typeof z.minDataValue&&"number"===typeof z.maxDataValue&&null!=z.minSize&&null!=z.maxSize?"min-max":"$view.scale"===z?.valueExpression&&Array.isArray(z.stops)?"scale-stops":null==z.field&&"$view.scale"===z?.valueExpression||!(Array.isArray(z.stops)||"levels"in z&&z.levels)?null!=z.field||"$view.scale"!==z?.valueExpression?"unit-value":null:"field-stops"){case "field-stops":t.visualVariableSizeStops=
q(w);break;case "scale-stops":"outline"===w.target?t.visualVariableSizeOutlineScaleStops=q(w):t.visualVariableSizeScaleStops=q(w);break;case "min-max":t.visualVariableSizeMinMaxValue=u(w);break;case "unit-value":t.visualVariableSizeUnitValue=c(w)}}return t};k.getMaxSizeVVSize=function(z,t=128,w=1.25){if(z.visualVariableSizeMinMaxValue)return z.visualVariableSizeMinMaxValue instanceof Function?128:Math.max(z.visualVariableSizeMinMaxValue.minMaxValueAndSize[3]*w,t);if(z.visualVariableSizeScaleStops){if(z.visualVariableSizeScaleStops instanceof
Function)return 128;z=z.visualVariableSizeScaleStops.sizes;return Math.max(z[z.length-1]*w,t)}if(z.visualVariableSizeStops){if(z.visualVariableSizeStops instanceof Function)return 128;z=z.visualVariableSizeStops.sizes;return Math.max(z[z.length-1]*w,t)}return z.visualVariableSizeUnitValue?256:0};k.noVisualVariables=A;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/schemaUtils":function(){define(["exports"],function(k){k.padStops=function(r,
p){r=r.slice(0,p);p-=r.length;for(let e=0;e<p;e++)r.push(r[r.length-1]);return r};k.premultiplyColor=function(r){if(!r)return[0,0,0,0];const {r:p,g:e,b:n,a:m}=r;return[m/255*p,m/255*e,m/255*n,m]};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/rendererUtils":function(){define(["exports","../../../../../core/Error","../../../../../core/Logger","../../../../../core/screenUtils","../../../../webgl/capabilities"],function(k,r,p,e,n){function m(){const {supportsColorBufferFloat:d,
supportsColorBufferFloatBlend:a,supportsColorBufferHalfFloat:b}=n.getWebGLCapabilities();return d&&a||b}const l=()=>p.getLogger("esri.views.2d.layers.features.support.rendererUtils");k.isRendererSupported=function(d){if(!d)return!0;switch(d.type){case "heatmap":if(!m()){const a=n.getWebGLCapabilities();d=["supportsColorBufferFloat","supportsColorBufferFloatBlend","supportsColorBufferHalfFloat"].filter(b=>!a[b]).join(", ");l().errorOnce(new r("webgl-missing-extension",`Missing WebGL2 requirements for Heatmap: ${d}`));
return!1}}return!0};k.simplifyVisualVariables=function(d){return d.map(a=>{if(("size"===a.type||"color"===a.type||"opacity"===a.type)&&null!=a.stops){a=a.clone();var b=a.type;var f=a.stops??[];if(8>=f.length)b=f;else if(l().warn(`Found ${f.length} Visual Variable stops, but MapView only supports ${8}. Displayed stops will be simplified.`),16<f.length){const [B,...C]=f;var g=C.pop(),q=C[0].value,c=C[C.length-1].value,h=(c-q)/6;const y=[];for(;q<c;q+=h){for(var u=0;q>=C[u].value;)u++;var A=C[u],z=f[u-
1],t=q-z.value;A=A.value===z.value?1:t/(A.value-z.value);"color"===b?(z=C[u],u=f[u-1],t=z.color.clone(),t.r=(1-A)*u.color.r+A*t.r,t.g=(1-A)*u.color.g+A*t.g,t.b=(1-A)*u.color.b+A*t.b,t.a=(1-A)*u.color.a+A*t.a,y.push({value:q,color:t,label:z.label})):"size"===b?(z=C[u],t=f[u-1],u=e.toPt(z.size),t=e.toPt(t.size),y.push({value:q,size:(1-A)*t+A*u,label:z.label})):(z=C[u],y.push({value:q,opacity:(1-A)*f[u-1].opacity+A*z.opacity,label:z.label}))}b=[B,...y,g]}else{var [w,...x]=f;for(b=x.pop();6<x.length;){g=
f=0;for(c=1;c<x.length;c++)h=Math.abs(x[c].value-x[c-1].value),h>g&&(g=h,f=c);x.splice(f,1)}b=[w,...x,b]}a.stops=b}return a})};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/symbols/ComplexSymbolSchema":function(){define("exports ../../../../../../../symbols/cim/CIMSymbolHelper ../../../../../../../symbols/cim/defaultCIMValues ../../../../../../../symbols/cim/enums ../../../../../engine/webgl/shaderGraph/techniques/TechniqueRegistry ../VisualVariablesSchema ./utils".split(" "),
function(k,r,p,e,n,m,l){function d(w){return w.minScale||w.maxScale?{minScale:w.minScale??0,maxScale:w.maxScale??0}:null}function a(w){if(null==w)return null;if(Array.isArray(w)){const [x,B,C,y]=w;return[x,B,C,255*y]}return"string"===typeof w?w:{...w,defaultValue:a(w?.defaultValue)}}function b(w,x,B,C){return x.animationParams?[w.createMeshInfo({pixelDimensions:x.pixelDimensions,texelDimensions:x.texelDimensions,effects:x.effects?{type:"cim-effect-infos",effectInfos:x.effects}:null,sprite:x.spriteRasterizationParam,
animations:x.animationParams,scaleInfo:C.scaleInfo,scaleSymbolsProportionally:x.scaleSymbolsProportionally,strokeWidth:x.outlineWidth,isMapAligned:x.alignment===e.Alignment.MAP,colorLocked:x.colorLocked,isStroke:x.isStroke,baseSize:x.baseSize,referenceSize:x.referenceSize,angleToLine:x.markerPlacement?x.markerPlacement.placement&&"angleToLine"in x.markerPlacement.placement&&x.markerPlacement.placement.angleToLine:!1,sizeRatio:x.sizeRatio})]:[]}function f(w,x,B,{scaleInfo:C,scaleExpression:y}){const v=
l.hasSizeVVUniform(B);return[w.createMeshInfo({size:x.size,scaleX:x.scaleX,anchorX:x.anchorPoint.x,anchorY:x.anchorPoint.y,angle:x.rotation,color:a(x.color)??[0,0,0,0],colorLocked:x.colorLocked,frameHeight:x.frameHeight,widthRatio:x.widthRatio,scaleInfo:C,offsetX:x.offsetX,offsetY:x.offsetY,outlineColor:a(x.outlineColor)??[0,0,0,0],outlineSize:x.outlineWidth,referenceSize:x.referenceSize||p.defaultCIMValues.CIMVectorMarker.size,rotateClockwise:x.rotateClockwise,scaleFactor:y??1,sizeRatio:x.sizeRatio,
alignment:x.alignment,isAbsoluteAnchorPoint:x.isAbsoluteAnchorPoint,scaleSymbolsProportionally:x.scaleSymbolsProportionally,sprite:x.spriteRasterizationParam,hasSizeVV:v,placement:x.markerPlacement,effects:x.effects?{type:"cim-effect-infos",effectInfos:x.effects}:null,transforms:x.transform,minPixelBuffer:m.getMaxSizeVVSize(B)})]}function g(w,x,{scaleInfo:B}){return[w.createMeshInfo({color:a(x.color)??[0,0,0,0],scaleInfo:B,effects:x.effects?{type:"cim-effect-infos",effectInfos:x.effects}:null})]}
function q(w,x,B,{scaleInfo:C}){if(!x.spriteRasterizationParam)throw Error("InternalError: Sprite should always be defined");B=!!x.hasUnresolvedReplacementColor&&(!B||x.colorLocked);B=x.sampleAlphaOnly&&!B;const y=x.spriteRasterizationParam;return[w.createMeshInfo({color:a(x.color)??[0,0,0,0],height:x.height,aspectRatio:x.scaleX,offsetX:x.offsetX,offsetY:x.offsetY,scaleX:1,scaleY:1,angle:x.angle,applyRandomOffset:x.applyRandomOffset,sampleAlphaOnly:B,scaleProportionally:"CIMHatchFill"===y.resource.type,
sprite:y,scaleInfo:C,effects:x.effects?{type:"cim-effect-infos",effectInfos:x.effects}:null})]}function c(w,x,{scaleInfo:B}){if(!x.spriteRasterizationParam)throw Error("InternalError: Sprite should always be defined");const C=x.spriteRasterizationParam;return[w.createMeshInfo({color:a(x.color)??[0,0,0,0],angle:x.angle,gradientMethod:x.gradientMethod,gradientSize:x.gradientSize,gradientSizeUnits:x.gradientSizeUnits,gradientType:x.gradientType,sprite:C,scaleInfo:B,effects:x.effects?{type:"cim-effect-infos",
effectInfos:x.effects}:null})]}function h(w,x,{scaleInfo:B}){return{color:a(w.color)??[0,0,0,0],width:w.width,referenceWidth:w.referenceWidth,capType:w.cap,joinType:w.join,miterLimit:w.miterLimit,scaleInfo:B,hasSizeVV:x,effects:w.effects?{type:"cim-effect-infos",effectInfos:w.effects}:null}}function u(w,x,B,C){if(x.spriteRasterizationParam)throw Error("InternalError: Sprite should not be defined");x=h(x,B,C);return[w.createMeshInfo(x)]}function A(w,x,B,C){const {spriteRasterizationParam:y,scaleDash:v,
sampleAlphaOnly:F}=x;if(!y)throw Error("InternalError: Sprite should be defined");return[w.createMeshInfo({...h(x,B,C),offsetAlongLine:x.offsetAlongLine??0,shouldScaleDash:v??!1,shouldSampleAlphaOnly:F,isSDF:"CIMPictureStroke"!==y.resource.type&&"CIMGradientStroke"!==y.resource.type,sprite:y})]}function z(w,x,B){if(!x.spriteRasterizationParam)throw Error("InternalError: Sprite should always be defined");const C=x.spriteRasterizationParam;return[w.createMeshInfo({...h(x,!1,B),gradientMethod:x.gradientMethod,
gradientSize:x.gradientSize,gradientSizeUnits:x.gradientSizeUnits,gradientType:x.gradientType,sprite:C,effects:x.effects?{type:"cim-effect-infos",effectInfos:x.effects}:null})]}function t(w,x,B,{scaleInfo:C,scaleExpression:y}){return[w.createMeshInfo({boxBackgroundColor:a(x.backgroundColor),boxBorderLineColor:a(x.borderLineColor),boxBorderLineSize:x.borderLineWidth??0,color:a(x.color)??[0,0,0,0],offsetX:x.offsetX,offsetY:x.offsetY,postAngle:x.angle,fontSize:x.size,referenceSize:x.referenceSize,decoration:x.decoration,
haloColor:a(x.haloColor)??[0,0,0,0],haloSize:x.haloSize??0,outlineColor:a(x.outlineColor)??[0,0,0,0],outlineSize:x.outlineSize,lineWidth:x.lineWidth||512,lineHeightRatio:1,horizontalAlignment:x.horizontalAlignment??"center",verticalAlignment:x.verticalAlignment??"baseline",useCIMAngleBehavior:!1,glyphs:x.textRasterizationParam,scaleInfo:C,effects:x.effects?{type:"cim-effect-infos",effectInfos:x.effects}:null,placement:x.markerPlacement,transforms:x.transform,scaleFactor:y??1,minPixelBuffer:m.getMaxSizeVVSize(B),
repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null})]}k.createAnimatedMarkerMeshInfos=b;k.createComplexFillMeshInfos=q;k.createComplexMarkerMeshInfos=f;k.createComplexSimpleFillMeshInfos=g;k.createComplexSimpleLineMeshInfos=u;k.createComplexSymbolInstances=async function(w,x){const {cimResourceManager:B,cimAnalyzer:C,scaleExpression:y}=x.schemaOptions;await Promise.all(r.CIMSymbolHelper.fetchResources(w.symbol,B,[]));var v=C.analyzeSymbolReference(w,!1);w={scaleInfo:d(w),
scaleExpression:y};const F=[];for(const J of v)switch(J.type){case "marker":v=F;var D=v.push;{var G=J;var E=w;const {uniforms:aa,schemaOptions:ba}=x;var {store:H}=ba,K=G.isOutline?{...m.noVisualVariables,visualVariableSizeScaleStops:aa.visualVariableSizeOutlineScaleStops}:{visualVariableColor:aa.visualVariableColor,visualVariableOpacity:aa.visualVariableOpacity,visualVariableSizeMinMaxValue:aa.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:aa.visualVariableSizeScaleStops,visualVariableSizeStops:aa.visualVariableSizeStops,
visualVariableSizeUnitValue:aa.visualVariableSizeUnitValue,visualVariableRotation:aa.visualVariableRotation};G.animationParams?(H=H.ensureInstance(n.Techniques.animatedMarker,{uniforms:K,optionalAttributes:{zoomRange:!0}}),G=b(H,G,m.noVisualVariables,E)):(H=H.ensureInstance(n.Techniques.marker,{uniforms:K,optionalAttributes:{zoomRange:!!E.scaleInfo}}),G=f(H,G,aa,E))}D.call(v,...G);break;case "fill":v=F;D=v.push;a:{E=J;H=x;G=w;if(!E.spriteRasterizationParam){const {uniforms:fa,schemaOptions:I}=H;({store:H}=
I);H=H.ensureInstance(n.Techniques.fill,{uniforms:{visualVariableColor:E.colorLocked?null:fa.visualVariableColor,visualVariableOpacity:fa.visualVariableOpacity},optionalAttributes:{zoomRange:!!G.scaleInfo}});G=g(H,E,G);break a}const {uniforms:aa,schemaOptions:ba}=H;({store:H}=ba);H=H.ensureInstance(n.Techniques.complexFill,{uniforms:{visualVariableColor:E.colorLocked?null:aa.visualVariableColor,visualVariableOpacity:aa.visualVariableOpacity},optionalAttributes:{zoomRange:!!G.scaleInfo}});G=q(H,E,
null!=aa.visualVariableColor,G)}D.call(v,...G);break;case "gradientFill":v=F;D=v.push;G=J;E=w;const {uniforms:L,schemaOptions:P}=x;({store:H}=P);H=H.ensureInstance(n.Techniques.gradientFill,{uniforms:{visualVariableColor:null,visualVariableOpacity:L.visualVariableOpacity},optionalAttributes:{zoomRange:!!E.scaleInfo}});G=c(H,G,E);D.call(v,...G);break;case "line":v=F;D=v.push;{G=J;E=w;const {uniforms:aa,schemaOptions:ba}=x;({store:K}=ba);H=G.isOutline?{...m.noVisualVariables,visualVariableSizeScaleStops:aa.visualVariableSizeOutlineScaleStops}:
{visualVariableColor:G.colorLocked?null:aa.visualVariableColor,visualVariableOpacity:aa.visualVariableOpacity,visualVariableSizeMinMaxValue:aa.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:aa.visualVariableSizeScaleStops,visualVariableSizeStops:aa.visualVariableSizeStops,visualVariableSizeUnitValue:aa.visualVariableSizeUnitValue};const fa={uniforms:H,optionalAttributes:{zoomRange:!!E.scaleInfo}};H=!!(H.visualVariableSizeMinMaxValue||H.visualVariableSizeScaleStops||H.visualVariableSizeStops||
H.visualVariableSizeUnitValue);G.spriteRasterizationParam?(K=K.ensureInstance(n.Techniques.texturedLine,fa),G=A(K,G,H,E)):(K=K.ensureInstance(n.Techniques.line,fa),G=u(K,G,H,E))}D.call(v,...G);break;case "gradientStroke":v=F;D=v.push;G=J;E=w;const {uniforms:Q,schemaOptions:S}=x;({store:H}=S);H=H.ensureInstance(n.Techniques.gradientStroke,{uniforms:G.isOutline?{...m.noVisualVariables,visualVariableSizeScaleStops:Q.visualVariableSizeOutlineScaleStops}:{visualVariableColor:null,visualVariableOpacity:Q.visualVariableOpacity,
visualVariableSizeMinMaxValue:Q.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:Q.visualVariableSizeScaleStops,visualVariableSizeStops:Q.visualVariableSizeStops,visualVariableSizeUnitValue:Q.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!!E.scaleInfo}});G=z(H,G,E);D.call(v,...G);break;case "text":v=F;D=v.push;G=J;E=w;const {uniforms:U,schemaOptions:X}=x;({store:H}=X);H=H.ensureInstance(n.Techniques.text,{uniforms:{visualVariableColor:G.colorLocked?null:U.visualVariableColor,
visualVariableOpacity:U.visualVariableOpacity,visualVariableRotation:U.visualVariableRotation,visualVariableSizeMinMaxValue:U.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:U.visualVariableSizeScaleStops,visualVariableSizeStops:U.visualVariableSizeStops,visualVariableSizeUnitValue:U.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!!E.scaleInfo,referenceSymbol:!1,clipAngle:!1}});G=t(H,G,U,E);D.call(v,...G)}return F};k.createComplexTextMeshInfos=t;k.createComplexTexturedLineMeshInfos=
A;k.createGradientFillMeshInfos=c;k.createGradientStrokeMeshInfos=z;k.getScaleInfo=d;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/symbols/utils":function(){define(["exports"],function(k){k.hasRotationVVUniform=function(r){return!!r.visualVariableRotation};k.hasSizeVVUniform=function(r){return!!(r.visualVariableSizeMinMaxValue||r.visualVariableSizeScaleStops||r.visualVariableSizeStops||r.visualVariableSizeUnitValue||r.visualVariableSizeOutlineScaleStops)};
Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/StorageSchema":function(){define("exports ../../../../../../core/arrayUtils ../../../../../../layers/support/streamLayerUtils ../../../../engine/webgl/enums ../../support/rendererUtils ../../../../../webgl/capabilities".split(" "),function(k,r,p,e,n,m){function l(c){switch(c){case "opacity":return e.VVBinding.OPACITY;case "color":return e.VVBinding.COLOR;case "rotation":return e.VVBinding.ROTATION;
case "size":return e.VVBinding.SIZE;default:return null}}function d(c){if(!c)return[];switch(c.type){case "simple":case "class-breaks":case "unique-value":case "dictionary":return g(c);case "dot-density":return a(c);case "pie-chart":return b(c);case "heatmap":return f(c)}}function a(c){const h=[];for(const u of c.attributes)h.push({binding:h.length,expression:u.valueExpression,field:u.field});return h}function b(c){const h=g(c);let u=4;for(const A of c.attributes)h.push({binding:u++,expression:A.valueExpression,
field:A.field});return h}function f({valueExpression:c,field:h}){return c||h?[{binding:0,expression:c,field:h}]:[]}function g(c){return"visualVariables"in c&&c.visualVariables?.length?n.simplifyVisualVariables(c.visualVariables).map(h=>q(h)).filter(r.isSome):[]}function q(c){switch(c.type){case "size":return c="$view.scale"===c.valueExpression?null:{binding:l(c.type),field:c.field,normalizationField:c.normalizationField,expression:c.valueExpression,valueRepresentation:c.valueRepresentation},c;case "color":return{binding:l(c.type),
field:c.field,normalizationField:c.normalizationField,expression:c.valueExpression};case "opacity":return{binding:l(c.type),field:c.field,normalizationField:c.normalizationField,expression:c.valueExpression};case "rotation":return{binding:l(c.type),expression:c.valueExpression,field:c.field}}}k.createDotDensityBindings=a;k.createHeatmapBindings=f;k.createPieChartBindings=b;k.createStorageSchema=function(c,h){const u=m.getWebGLCapabilities();return{type:"simple",filters:h,capabilities:{maxTextureSize:u.maxTextureSize},
bindings:d(c)}};k.createTrackStorageSchema=function(c,h){const u=m.getWebGLCapabilities();return{type:"multi",target:"feature",keyField:p.internalTrackPartField,filters:h,capabilities:{maxTextureSize:u.maxTextureSize},bindings:{[p.TrackPart.TrackLine]:d(c.trackLines.renderer),[p.TrackPart.LatestObservation]:d(c.latestObservations.renderer),[p.TrackPart.PreviousObservation]:d(c.previousObservations.renderer)}}};k.createVVBindings=g;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/streamLayerUtils":function(){define(["exports"],
function(k){k.TrackPart=void 0;var r=k.TrackPart||(k.TrackPart={});r[r.TrackLine=0]="TrackLine";r[r.LatestObservation=1]="LatestObservation";r[r.PreviousObservation=2]="PreviousObservation";k.defaultStreamIdField="__esri_stream_id__";k.esriTimestamp="__esri_timestamp__";k.externalTrackLineOidPrefix="__esri_track_line__";k.internalTimeReceivedField="__esri_time_received__";k.internalTrackPartField="__esri_track_part__";Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/AttributeStore":function(){define("exports ../../../../../core/Error ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/diffUtils ../../../../../support/arcadeOnDemand ../../../engine/webgl/definitions ../../../engine/webgl/DisplayId ../../../engine/webgl/Utils ../../../engine/webgl/shaderGraph/techniques/shaders/constants ../../../engine/webgl/util/debug ./DisplayIdGenerator ./FeatureFilterEvaluator ../../../../webgl/enums".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g,q,c){function h(x,B){if(!x||!B)return x;switch(B){case "radius":case "distance":return 2*x;case "area":return Math.sqrt(x)}return x}const u=()=>e.getLogger("esri.views.layers.2d.features.support.AttributeStore"),A=f.createDebugLogger(f.DEBUG_ATTR_UPDATES,u());var z=p("esri-shared-array-buffer");p("esri-atomics");class t{constructor(x,B,C){this.size=0;this.texelSize=4;this.dirtyEnd=this.dirtyStart=0;const {pixelType:y,layout:v,textureOnly:F}=B;this.textureOnly=F||!1;
this.pixelType=y;this.layout=v;this._resetRange();this.size=x;this.isLocal=C;F||(this.data=this._initData(y,x))}get buffer(){return this.data?.buffer}unsetComponentAllTexels(x,B){const C=this.data;for(let y=0;y<this.size*this.size;y++)C[y*this.texelSize+x]&=~B;this.dirtyStart=0;this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(x,B){const C=this.data;for(let y=0;y<this.size*this.size;y++)C[y*this.texelSize+x]|=255&B;this.dirtyStart=0;this.dirtyEnd=this.size*this.size-1}setComponent(x,B,C){const y=
this.data;for(const v of C)y[v*this.texelSize+x]|=B,this.dirtyStart=Math.min(this.dirtyStart,v),this.dirtyEnd=Math.max(this.dirtyEnd,v)}setComponentTexel(x,B,C){this.data[C*this.texelSize+x]|=B;this.dirtyStart=Math.min(this.dirtyStart,C);this.dirtyEnd=Math.max(this.dirtyEnd,C)}unsetComponentTexel(x,B,C){this.data[C*this.texelSize+x]&=~B;this.dirtyStart=Math.min(this.dirtyStart,C);this.dirtyEnd=Math.max(this.dirtyEnd,C)}getData(x,B){x=d.getDisplayIdTexel(x);return this.data[x*this.texelSize+B]}setData(x,
B,C){x=d.getDisplayIdTexel(x);0===(this.layout&1<<B)?u().error("mapview-attributes-store","Tried to set a value for a texel's readonly component"):null!=this.data&&(this.data[x*this.texelSize+B]=C,this.dirtyStart=Math.min(this.dirtyStart,x),this.dirtyEnd=Math.max(this.dirtyEnd,x))}expand(x){this.size=x;this.textureOnly||(x=this._initData(this.pixelType,x),x.set(this.data),this.data=x)}toMessage(){const x=this.dirtyStart,B=this.dirtyEnd;var C=this.texelSize;if(x>B)return null;this._resetRange();const y=
this.pixelType,v=this.layout,F=this.data;C=!this.isLocal&&F.slice(x*C,(B+1)*C)||null;return{start:x,end:B,data:C,pixelType:y,layout:v}}_initData(x,B){var C=ArrayBuffer;x=a.getPixelArrayCtor(x);B=new x(new C(B*B*4*x.BYTES_PER_ELEMENT));for(C=0;C<B.length;C+=4)B[C+1]=255;return B}_resetRange(){this.dirtyStart=2147483647;this.dirtyEnd=0}}class w{constructor(x){this._client=x;this._filters=[];this._blocks=[];this._attributeComputeInfo=null;this._abortController=new AbortController;this._size=l.attributeStoreInitialSize;
this._idsToHighlight=new Map;this._arcadeDependencies=new Set;this._initialized=!1;this.version=0;this._idGenerator=new g.DisplayIdGenerator;this._epoch=1}destroy(){this._abortController.abort()}_initialize(){if(null==this._blockDescriptors){var x=c.PixelType.FLOAT;A(`Creating AttributeStore ${z?"with":"without"} shared memory`);this._blockDescriptors=[{pixelType:c.PixelType.UNSIGNED_BYTE,layout:1},{pixelType:c.PixelType.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:c.PixelType.UNSIGNED_BYTE,
layout:15,textureOnly:!0},{pixelType:x,layout:15},{pixelType:x,layout:15},{pixelType:x,layout:15},{pixelType:x,layout:15},{pixelType:c.PixelType.FLOAT,layout:15}];this._blocks=this._blockDescriptors.map(()=>null)}}get hasHighlight(){return 0<this._idsToHighlight.size}createDisplayIdForObjectId(x){return this._idGenerator.createIdForObjectId(x)}releaseDisplayIdForObjectId(x){return this._idGenerator.releaseIdForObjectId(x)}getDisplayIdForObjectId(x){return this._idGenerator.getDisplayIdForObjectId(x)}incrementDisplayIdGeneration(){this._idGenerator.incrementGeneration()}hasArcadeDependency(x){return this._arcadeDependencies.has(x)}releaseAllIds(){this._idGenerator.releaseAll()}async update(x,
B,C,y=0){const v=n.diff(this._schema,x);this.version=y;if(v&&(p("esri-2d-update-debug")&&console.debug(`Version[${y}] AttributeStore.update`,{changed:v}),this._schema=x,this._attributeComputeInfo=null,this._initialize(),null!=x))if(C&&(this._filters=await Promise.all(x.filters.map(F=>F?q.create({geometryType:C.geometryType,hasM:!1,hasZ:!1,timeInfo:C.timeInfo,fieldsIndex:C.fieldsIndex,spatialReference:C.outSpatialReference,filterJSON:F}):null))),"multi"===x.type){this._attributeComputeInfo={type:"multi",
keyField:x.keyField,map:new Map};for(const F in x.bindings)await Promise.all(x.bindings[F].map(async D=>{D=await this._bind(B,D,parseInt(F,10));this._updateReferences(D)}))}else this._attributeComputeInfo={type:"feature",map:new Map},await Promise.all(x.bindings.map(async F=>{F=await this._bind(B,F);this._updateReferences(F)}))}setHighlight(x,B){const C=this._getBlock(0);C.unsetComponentAllTexels(0,(1<<l.maxHighlightReasons)-1);for(const {displayId:y,highlightFlags:v}of x){if(null==y)continue;const F=
d.getDisplayIdTexel(y);C.setComponent(0,v,[F])}this._idsToHighlight.clear();for(const {objectId:y,highlightFlags:v}of x)this._idsToHighlight.set(y,v);for(const {objectId:y,highlightFlags:v}of B)this._idsToHighlight.set(y,v)}setData(x,B,C,y){const v=d.getDisplayIdTexel(x);this._ensureSizeForTexel(v);this._getBlock(B).setData(x,C,y)}getData(x,B,C){return this._getBlock(B).getData(x,C)}getHighlightFlags(x){return this._idsToHighlight.get(x)||0}unsetAttributeData(x){x=d.getDisplayIdTexel(x);this._getBlock(0).setData(x,
0,0)}setAttributeData(x,B,C,y){const v=d.getDisplayIdTexel(x);this._ensureSizeForTexel(v);this._getBlock(0).setData(v,0,this.getFilterFlags(B,y));x=this._attributeComputeInfo;y=null;x&&(y="multi"===x.type?x.map.get(B.readAttribute(x.keyField)):x.map,y?.size&&y.forEach((F,D)=>{const G=1*D%4;D=this._getBlock(Math.floor(1*D/4)+l.AttributeDataType.VV);let E=F.field?.read(B,C);F.valueRepresentation&&(E=h(E,F.valueRepresentation));if(null===E||isNaN(E)||Infinity===E||-Infinity===E)E=b.nanMagicNumber;D.setData(v,
G,E)}))}get epoch(){return this._epoch}sendUpdates(){const x=this._blocks.map(C=>null!=C?C.toMessage():null),B=this._getInitArgs();p("esri-2d-log-updating")&&console.log("AttributeStore: _doSendUpdate.start");this._client.update({initArgs:B,blockData:x,version:this.version,sendUpdateEpoch:this._epoch});this._epoch+=1;p("esri-2d-log-updating")&&console.log("AttributeStore: _doSendUpdate.end")}_ensureSizeForTexel(x){for(;x>=this._size*this._size&&!this._expand(););}async _bind(x,B,C){x=await x.createComputedField(B);
const {valueRepresentation:y}=B,v=this._attributeComputeInfo;if("multi"===v.type){const F=v.map.get(C)??new Map;F.set(B.binding,{field:x,valueRepresentation:y});v.map.set(C,F)}else v.map.set(B.binding,{field:x,valueRepresentation:y});return x}_getInitArgs(){if(this._initialized)return null;this._initialized=!0;this._getBlock(l.AttributeDataType.Animation);this._getBlock(l.AttributeDataType.GPGPU);this._getBlock(l.AttributeDataType.LocalTimeOrigin);return{blockSize:this._size,blockDescriptors:this._blocks.map(x=>
null!=x?{textureOnly:x.textureOnly,buffer:x.buffer,pixelType:x.pixelType}:null)}}_getBlock(x){var B=this._blocks[x];if(null!=B)return B;A(`Initializing AttributeBlock at index ${x}`);B=new t(this._size,this._blockDescriptors[x],this._client.isLocal);this._blocks[x]=B;this._initialized=!1;return B}_expand(){if(this._size<this._schema.capabilities.maxTextureSize){const x=this._size<<=1;A("Expanding block size to",x,this._blocks);for(const B of this._blocks)B?.expand(x);this._initialized=!1;this._size=
x;return 0}u().error(new r("mapview-limitations","Maximum number of onscreen features exceeded."));return-1}_updateReferences(x){m.collectExpressionDependencies(this._arcadeDependencies,x)}isVisible(x){return!!(this._getBlock(0).getData(x,0)&1<<l.maxHighlightReasons)}getFilterFlags(x,B){let C=0;for(let v=0;v<this._filters.length;v++){var y=this._filters[v];y=!(1<<v)||null==y||y.check(x,B);C|=(y?1:0)<<v}B=0;this._idsToHighlight.size&&(x=x.getObjectId(),B=this.getHighlightFlags(x));return C<<l.maxHighlightReasons|
B}}k.AttributeStore=w;k.getVisualVariableSizeValueRepresentationRatio=h;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/debug":function(){define(["exports"],function(k){k.DEBUG_ATTR_UPDATES=!1;k.createDebugLogger=(r,p)=>r&&((...e)=>p.warn("DEBUG:",...e))||(()=>null);Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/DisplayIdGenerator":function(){define(["exports","../../../engine/webgl/DisplayId"],
function(k,r){class p{constructor(n){this.data=n;this._referenceCount=0}increment(){this._referenceCount+=1}decrement(){--this._referenceCount}empty(){return 0===this._referenceCount}}class e{constructor(){this._freeIdsGenerationA=[];this._freeIdsGenerationB=[];this._idCounter=1;this._freeIds=this._freeIdsGenerationA;this._objectIdToDisplayId=new Map}createIdForObjectId(n){let m=this._objectIdToDisplayId.get(n);m?m.increment():(m=new p(r.createDisplayId(this._getFreeId(),!1)),m.increment(),this._objectIdToDisplayId.set(n,
m));return m.data}releaseIdForObjectId(n){const m=this._objectIdToDisplayId.get(n);m&&(m.decrement(),m.empty()&&(this._objectIdToDisplayId.delete(n),this._freeIds.push(m.data)))}getDisplayIdForObjectId(n){n=this._objectIdToDisplayId.get(n);return null!=n?n.data:null}releaseAll(){for(const n of this._objectIdToDisplayId.values())this._freeIds.push(n.data);this._objectIdToDisplayId.clear()}incrementGeneration(){this._freeIds=this._freeIds===this._freeIdsGenerationA?this._freeIdsGenerationB:this._freeIdsGenerationA}_getFreeId(){return this._freeIds.length?
this._freeIds.pop():this._idCounter++}}k.DisplayIdGenerator=e;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureFilterEvaluator":function(){define("../../../../../core/Error ../../../../../core/Logger ../../../../../geometry/support/aaBoundingRect ../../../../../geometry/support/boundsUtils ../../../../../layers/graphics/data/queryUtils ../../../../../layers/graphics/data/spatialQuerySupport ../../../../../layers/graphics/data/timeSupport ../../../../../rest/support/Query ../FeatureStoreQueryAdapter ./whereUtils".split(" "),
function(k,r,p,e,n,m,l,d,a,b){class f{constructor(g){this._geometryBounds=p.create();this._idToVisibility=new Map;this._serviceInfo=g}static async create(g){const q=new f(g);await q.update(g.filterJSON,g.spatialReference);return q}get hash(){return this._hash}check(g,q){return this._applyFilter(g,q)}invalidate(){this._idToVisibility.forEach((g,q)=>{this._idToVisibility.set(q,0)})}setKnownIds(g){for(const q of g)this._idToVisibility.set(q,1)}setTrue(g){const q=[],c=[],h=new Set(g);this._idToVisibility.forEach((u,
A)=>{u=!!(this._idToVisibility.get(A)&1);const z=h.has(A);!u&&z?q.push(A):u&&!z&&c.push(A);this._idToVisibility.set(A,z?3:0)});return{show:q,hide:c}}createQuery(){const {geometry:g,spatialRel:q,where:c,timeExtent:h,objectIds:u}=this;return d.fromJSON({geometry:g,spatialRel:q,where:c,timeExtent:h,objectIds:u})}async update(g,q){this._hash=JSON.stringify(g);g=await n.normalizeQueryLike(g,null,q);await Promise.all([this._setGeometryFilter(g),this._setIdFilter(g),this._setAttributeFilter(g),this._setTimeFilter(g)])}async _setAttributeFilter(g){g?.where?
(this._clause=await b.createWhereClause(g.where,this._serviceInfo.fieldsIndex),this.where=g.where):this.where=this._clause=null}_setIdFilter(g){this._idsToShow=g?.objectIds&&new Set(g.objectIds);this._idsToHide=g?.hiddenIds&&new Set(g.hiddenIds);this.objectIds=g?.objectIds}async _setGeometryFilter(g){if(g?.geometry){var q=g.geometry;g=g.spatialRel??"esriSpatialRelIntersects";var c=await m.getSpatialQueryOperator(g,q,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);e.getBoundsXY(this._geometryBounds,
q);this._spatialQueryOperator=c;this.geometry=q;this.spatialRel=g}else this.spatialRel=this.geometry=this._spatialQueryOperator=null}_setTimeFilter(g){this.timeExtent=this._timeOperator=null;g?.timeExtent&&(this._serviceInfo.timeInfo?(this.timeExtent=g.timeExtent,this._timeOperator=l.getTimeOperator(this._serviceInfo.timeInfo,g.timeExtent,a.FeatureStoreQueryAdapter.Shared)):(g=new k("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",
g.timeExtent),r.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter").error(g)))}_applyFilter(g,q){return this._filterByGeometry(g)&&this._filterById(g)&&this._filterByTime(g)&&this._filterByExpression(g,q)}_filterByExpression(g,q){return this.where?this._clause(g,q):!0}_filterById(g){return(!this._idsToHide?.size||!this._idsToHide.has(g.getObjectId()))&&(!this._idsToShow?.size||this._idsToShow.has(g.getObjectId()))}_filterByGeometry(g){return this.geometry?(g=g.readGeometryWorldSpace())?
this._spatialQueryOperator(g):!1:!0}_filterByTime(g){return null==this._timeOperator?!0:this._timeOperator(g)}}return f})},"esri/layers/graphics/data/queryUtils":function(){define("require exports ../../../core/Error ../../../core/jsonMap ../../../core/unitUtils ../../../geometry/projection ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ./projectionSupport".split(" "),function(k,r,p,
e,n,m,l,d,a,b,f){async function g(z,t,w){const {outFields:x,orderByFields:B,groupByFieldsForStatistics:C,outStatistics:y}=z;if(x)for(var v=0;v<x.length;v++)x[v]=x[v].trim();if(B)for(v=0;v<B.length;v++)B[v]=B[v].trim();if(C)for(v=0;v<C.length;v++)C[v]=C[v].trim();if(y)for(v=0;v<y.length;v++)y[v].onStatisticField&&(y[v].onStatisticField=y[v].onStatisticField.trim());z.geometry&&!z.outSR&&(z.outSR=z.geometry.spatialReference);return q(z,t,w)}async function q(z,t,w){if(!z)return null;var {where:x}=z;
z.where=x=x?.trim();if(!x||/^1 *= *1$/.test(x)||t&&t===x)z.where=null;if(!z.geometry)return z;t=await h(z);z.distance=0;z.units=null;"esriSpatialRelEnvelopeIntersects"===z.spatialRel&&({spatialReference:x}=z.geometry,t=l.getGeometryExtent(t),t.spatialReference=x);if(t){await f.checkProjectionSupport(t.spatialReference,w);x=t.spatialReference;t=c(t,w)&&d.isExtent(t)?{spatialReference:x,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}:t;x=(await a.normalizeCentralMeridian(d.fromJSON(t)))[0];
if(null==x)throw A;const B="quantizationParameters"in z&&z.quantizationParameters?.tolerance||"maxAllowableOffset"in z&&z.maxAllowableOffset||0;t=B&&c(t,w)?{densificationStep:8*B}:void 0;x=x.toJSON();t=f.project(x,x.spatialReference,w,t);if(!t)throw A;t.spatialReference=w;z.geometry=t}return z}function c(z,t){if(!z)return!1;const w=z.spatialReference;return(d.isExtent(z)||d.isPolygon(z)||d.isPolyline(z))&&!b.equals(w,t)&&!m.canProjectWithoutEngine(w,t)}async function h(z){const {distance:t,units:w}=
z,x=z.geometry;if(null==t||"vertexAttributes"in x)return x;var B=x.spatialReference;z=w?u.fromJSON(w):n.getUnitString(B);B=B&&(b.isGeographic(B)||b.isWebMercator(B))?x:await f.checkProjectionSupport(B,b.wgs84).then(()=>f.project(x,b.wgs84));const C=await new Promise((y,v)=>k(["../../../geometry/operators/json/geodesicBufferOperator"],y,v));await C.load();z=C.execute(B,t||1,{unit:z})??void 0;if(!z||!d.isPolygon(z)||0===z.rings.length)throw new p("unsupported-query:invalid-parameters","Invalid parameters for query by distance");
return z}const u=new e.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),A=Object.freeze({});r.getDateInNumber=function(z,t){return null==z?null:"string"===typeof z?t?(new Date(`1970-01-01T${z}Z`)).getTime():(new Date(z)).getTime():z instanceof Date?z.getTime():z};r.normalizeAttributeBinsQuery=async function(z,t,w){const x=z.bin;x.onField&&
(x.onField=x.onField.trim());x.onExpression?.value&&(x.onExpression.value=x.onExpression.value.trim());x.splitBy&&(x.splitBy.value&&(x.splitBy.value=x.splitBy.value.trim()),x.splitBy.outAlias&&(x.splitBy.outAlias=x.splitBy.outAlias.trim()));x.stackBy&&(x.stackBy.value&&(x.stackBy.value=x.stackBy.value.trim()),x.stackBy.outAlias&&(x.stackBy.outAlias=x.stackBy.outAlias.trim()));"normalizationField"in x.parameters&&x.parameters.normalizationField&&(x.parameters.normalizationField=x.parameters.normalizationField.trim());
z.outStatistics?.length||(z.outStatistics=[{statisticType:"count",onStatisticField:"1",outStatisticFieldName:"frequency"}]);return g(z,t,w)};r.normalizeQuery=g;r.normalizeQueryLike=q;r.queryEngineEmptyResult=A;r.unitsKebabDict=u;Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/projectionSupport":function(){define("exports ../../../core/arrayUtils ../../../core/promiseUtils ../../../geometry/projection ../../../geometry/geometryAdapters/json ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),
function(k,r,p,e,n,m,l){function d(u,A){if(!A)return null;if("x"in A){var z={x:0,y:0};[z.x,z.y]=u(A.x,A.y,f);null!=A.z&&(z.z=A.z);null!=A.m&&(z.m=A.m);return z}return"xmin"in A?(z={xmin:0,ymin:0,xmax:0,ymax:0},[z.xmin,z.ymin]=u(A.xmin,A.ymin,f),[z.xmax,z.ymax]=u(A.xmax,A.ymax,f),A.hasZ&&(z.zmin=A.zmin,z.zmax=A.zmax,z.hasZ=!0),A.hasM&&(z.mmin=A.mmin,z.mmax=A.mmax,z.hasM=!0),z):"rings"in A?{rings:a(A.rings,u),hasM:A.hasM,hasZ:A.hasZ}:"paths"in A?{paths:a(A.paths,u),hasM:A.hasM,hasZ:A.hasZ}:"points"in
A?{points:b(A.points,u),hasM:A.hasM,hasZ:A.hasZ}:null}function a(u,A){const z=[];for(const t of u)z.push(b(t,A));return z}function b(u,A){const z=[];for(const t of u)u=A(t[0],t[1],[0,0]),z.push(u),2<t.length&&u.push(t[2]),3<t.length&&u.push(t[3]);return z}const f=[0,0],g=d.bind(null,l.lngLatToXY),q=d.bind(null,l.xyToLngLat);class c{constructor(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}async push(u,A,z,t){if(!u?.length||!A||!z||m.equals(A,z))return u;u={geometries:u,inSpatialReference:A,
outSpatialReference:z,geographicTransformation:t,resolve:p.createResolver()};this._jobs.push(u);this._timer??(this._timer=setTimeout(this._process,10));return u.resolve.promise}_process(){this._timer=null;const u=this._jobs.shift();if(u){var {geometries:A,inSpatialReference:z,outSpatialReference:t,resolve:w,geographicTransformation:x}=u;l.canProject(z,t)?m.isWebMercator(t)?w(A.map(g)):w(A.map(q)):w(e.projectMany(n.jsonAdapter,A,z,t,x,null));0<this._jobs.length&&(this._timer=setTimeout(this._process,
10))}}}const h=new c;k.checkProjectionSupport=async function(u,A){u&&A&&(u=Array.isArray(u)?u.map(z=>null!=z.geometry?z.geometry.spatialReference:null).filter(r.isSome):[u],await e.initializeProjection(u.map(z=>({source:z,dest:A}))))};k.project=function(u,A,z,t){if(!u)return null;z||(z=A,A=u.spatialReference);return m.isValid(A)&&m.isValid(z)&&!m.equals(A,z)?l.canProject(A,z)?(u=m.isWebMercator(z)?g(u):q(u),u.spatialReference=z,u):e.projectMany(n.jsonAdapter,[u],A,z,null,t)[0]:u};k.projectMany=function(u,
A,z,t){return h.push(u,A,z,t)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/geometryAdapters/json":function(){define(["exports"],function(k){class r{constructor(l,d,a){this.x=l;this.y=d;this.spatialReference=a;this.m=this.z=void 0}}class p{constructor(l,d,a,b){this.rings=l;this.spatialReference=d;this.hasM=this.hasZ=void 0;a&&(this.hasZ=a);b&&(this.hasM=b)}}class e{constructor(l,d,a,b){this.paths=l;this.spatialReference=d;this.hasM=this.hasZ=void 0;a&&(this.hasZ=
a);b&&(this.hasM=b)}}class n{constructor(l,d,a,b){this.points=l;this.spatialReference=d;this.hasM=this.hasZ=void 0;a&&(this.hasZ=a);b&&(this.hasM=b)}}class m{constructor(l,d,a,b,f){this.xmin=l;this.ymin=d;this.xmax=a;this.ymax=b;this.spatialReference=f;this.mmax=this.mmin=this.zmax=this.zmin=void 0}}k.jsonAdapter={convertToGEGeometry:function(l,d){return null==d?null:l.convertJSONToGeometry(d)},exportPoint:function(l,d,a){a=new r(l.getPointX(d),l.getPointY(d),a);const b=l.hasZ(d),f=l.hasM(d);b&&(a.z=
l.getPointZ(d));f&&(a.m=l.getPointM(d));return a},exportPolygon:function(l,d,a){return new p(l.exportPaths(d),a,l.hasZ(d),l.hasM(d))},exportPolyline:function(l,d,a){return new e(l.exportPaths(d),a,l.hasZ(d),l.hasM(d))},exportMultipoint:function(l,d,a){return new n(l.exportPoints(d),a,l.hasZ(d),l.hasM(d))},exportExtent:function(l,d,a){var b=l.hasZ(d);const f=l.hasM(d);a=new m(l.getXMin(d),l.getYMin(d),l.getXMax(d),l.getYMax(d),a);b&&(b=l.getZExtent(d),a.zmin=b.vmin,a.zmax=b.vmax);f&&(l=l.getMExtent(d),
a.mmin=l.vmin,a.mmax=l.vmax);return a}};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/spatialQuerySupport":function(){define("require exports ../../../core/Error ../../../geometry/support/contains ../../../geometry/support/intersects ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ../contains ../featureConversionUtils ../OptimizedGeometry ./geometryUtils ./projectionSupport".split(" "),function(k,r,p,e,n,m,l,d,a,b,f,
g){function q(z){const t=A[z];if(null==t)throw Error(`Cannot load unsupported spatial operator: ${z}`);return t()}var c={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},h={esriGeometryPoint:!0,esriGeometryMultiPatch:!1,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,
esriGeometryEnvelope:!0},u={esriGeometryPoint:!0,esriGeometryMultiPatch:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};const A={esriSpatialRelIntersects:()=>new Promise((z,t)=>k(["../../../geometry/operators/json/intersectsOperator"],z,t)),esriSpatialRelContains:()=>new Promise((z,t)=>k(["../../../geometry/operators/json/containsOperator"],z,t)),esriSpatialRelCrosses:()=>new Promise((z,t)=>k(["../../../geometry/operators/json/crossesOperator"],
z,t)),esriSpatialRelDisjoint:()=>new Promise((z,t)=>k(["../../../geometry/operators/json/disjointOperator"],z,t)),esriSpatialRelEnvelopeIntersects:null,esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:()=>new Promise((z,t)=>k(["../../../geometry/operators/json/overlapsOperator"],z,t)),esriSpatialRelTouches:()=>new Promise((z,t)=>k(["../../../geometry/operators/json/touchesOperator"],z,t)),esriSpatialRelWithin:()=>new Promise((z,t)=>k(["../../../geometry/operators/json/withinOperator"],z,
t)),esriSpatialRelRelation:null};r.canQueryWithRBush=function(z){if(m.isExtent(z))return!0;if(m.isPolygon(z)){for(const t of z.rings)if(5!==t.length||t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1;return!0}return!1};r.checkSpatialQuerySupport=async function(z,t,w){const {spatialRel:x,geometry:B}=z;if(B){if(null==x||!0!==c[x])throw new p("unsupported-query","Unsupported query spatial relationship",{query:z});if(l.isValid(B.spatialReference)&&
l.isValid(w)){if(null==B||!0!==h[m.getJsonType(B)])throw new p("unsupported-query","Unsupported query geometry type",{query:z});if(null==t||!0!==u[t])throw new p("unsupported-query","Unsupported layer geometry type",{query:z});if(z.outSR)return g.checkProjectionSupport(z.geometry?.spatialReference,z.outSR)}}};r.getSpatialQueryOperator=async function(z,t,w,x,B){if(m.isPolygon(t)){if("esriGeometryPoint"===w&&("esriSpatialRelIntersects"===z||"esriSpatialRelContains"===z)){const y=a.convertFromPolygon(new b,
t,!1,!1);return v=>d.polygonContainsPoint(y,!1,!1,v)}if("esriGeometryMultipoint"===w){const y=a.convertFromPolygon(new b,t,!1,!1);if("esriSpatialRelContains"===z)return v=>d.polygonContainsMultipoint(y,!1,!1,v,x,B)}}if(m.isExtent(t)){if("esriGeometryPoint"===w&&("esriSpatialRelIntersects"===z||"esriSpatialRelContains"===z))return y=>e.extentContainsPoint(t,f.getGeometry(w,x,B,y));if("esriGeometryMultipoint"===w&&"esriSpatialRelContains"===z)return y=>e.extentContainsMultipoint(t,f.getGeometry(w,x,
B,y));if("esriSpatialRelIntersects"===z){const y=n.getExtentIntersector(w);return v=>y(t,f.getGeometry(w,x,B,v))}}"esriSpatialRelEnvelopeIntersects"===z&&(z="esriSpatialRelIntersects");const C=await q(z);return y=>C.execute(t,f.getGeometry(w,x,B,y))};Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/intersects":function(){define(["exports","./intersectsBase"],function(k,r){k.extentIntersectsExtent=r.extentIntersectsExtent;k.extentIntersectsMultipoint=r.extentIntersectsMultipoint;
k.extentIntersectsPoint=r.extentIntersectsPoint;k.extentIntersectsPolygon=r.extentIntersectsPolygon;k.extentIntersectsPolyline=r.extentIntersectsPolyline;k.getFeatureExtentIntersector=r.getFeatureExtentIntersector;k.isSelfIntersecting=r.isSelfIntersecting;k.segmentIntersects=r.segmentIntersects;k.getExtentIntersector=function(p){return"mesh"===p?r.extentIntersectsExtent:r.getFeatureExtentIntersector(p)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/contains":function(){define(["exports"],
function(k){function r(p,e,n,m,l){if(!p)return!1;e=e?n?4:3:n?3:2;const {coords:d,lengths:a}=p;n=!1;p=0;for(const f of a){var b=p;for(let g=p,q=p+f*e;g<q;g+=e){b=g+e;b===q&&(b=p);const c=d[g],h=d[g+1],u=d[b];b=d[b+1];(h<l&&b>=l||b<l&&h>=l)&&c+(l-h)/(b-h)*(u-c)<m&&(n=!n)}p+=f*e}return n}k.polygonContainsCoords=r;k.polygonContainsMultipoint=function(p,e,n,m,l,d){l=l?d?4:3:d?3:2;const {coords:a,lengths:b}=m;if(!b)return!1;for(let f=0,g=0;f<b.length;f++,g+=l)if(!r(p,e,n,a[g],a[g+1]))return!1;return!0};
k.polygonContainsPoint=function(p,e,n,m){return r(p,e,n,m.coords[0],m.coords[1])};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/geometryUtils":function(){define(["exports","../featureConversionUtils","../OptimizedGeometry"],function(k,r,p){const e=new p,n=new p,m=new p,l={esriGeometryPoint:r.convertToPoint,esriGeometryPolyline:r.convertToPolyline,esriGeometryPolygon:r.convertToPolygon,esriGeometryMultipoint:r.convertToMultipoint},d=(a,b)=>"_geVersion"===
a?void 0:b;k.cleanFromGeometryEngine=function(a){return a&&"_geVersion"in a?JSON.parse(JSON.stringify(a,d)):a};k.getGeometry=function(a,b,f,g,q,c,h=b,u=f){const A=b&&h,z=f&&u;g=null!=g?"coords"in g?g:g.geometry:null;if(null==g)return null;if(q)return b=r.generalizeOptimizedGeometry(n,g,b,f,a,q,h,u),c&&(b=r.quantizeOptimizedGeometry(m,b,A,z,a,c)),l[a]?.(b,A,z)??null;if(c)return c=r.quantizeOptimizedGeometry(m,g,b,f,a,c,h,u),l[a]?.(c,A,z)??null;r.removeZMValues(e,g,b,f,h,u);return l[a]?.(e,A,z)??null};
k.transformCentroid=function(a,b,f,g=a.hasZ,q=a.hasM){if(null==b)return null;const c=a.hasZ&&g,h=a.hasM&&q;return f?(a=r.quantizeOptimizedGeometry(m,b,a.hasZ,a.hasM,"esriGeometryPoint",f,g,q),r.convertToPoint(a,c,h)):r.convertToPoint(b,c,h)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/timeSupport":function(){define(["exports","../../../core/compilerUtils"],function(k,r){function p(m,l,d,a,b){if(null!=a&&null!=b)return f=>{const g=m(f,l);f=m(f,d);return(null==
g||g<=b)&&(null==f||f>=a)};if(null!=a)return f=>{f=m(f,d);return null==f||f>=a};if(null!=b)return f=>{f=m(f,l);return null==f||f<=b}}function e(m,l,d,a){if(null!=d&&null!=a&&d===a)return b=>m(b,l)===d;if(null!=d&&null!=a)return b=>{b=m(b,l);return null!=b&&b>=d&&b<=a};if(null!=d)return b=>{b=m(b,l);return null!=b&&b>=d};if(null!=a)return b=>{b=m(b,l);return null!=b&&b<=a}}function n(){return()=>!1}k.getTimeExtent=async function(m,l){if(!m)return null;const d=l.featureAdapter,{startTimeField:a,endTimeField:b}=
m;let f=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY;if(a&&b)await l.forEach(q=>{const c=d.getAttribute(r.toConst(q),a);q=d.getAttribute(r.toConst(q),b);null==c||isNaN(c)||(f=Math.min(f,c));null==q||isNaN(q)||(g=Math.max(g,q))});else{const q=a||b;await l.forEach(c=>{c=d.getAttribute(r.toConst(c),q);null==c||isNaN(c)||(f=Math.min(f,c),g=Math.max(g,c))})}return{start:f,end:g}};k.getTimeOperator=function(m,l,d){if(!l||!m)return null;const {startTimeField:a,endTimeField:b}=m;if(!a&&!b)return null;
const {start:f,end:g}=l;if(null===f&&null===g)return null;if(void 0===f&&void 0===g)return n();m=d.getAttributeAsTimestamp?.bind(d)??d.getAttribute.bind(d);return a&&b?p(m,a,b,f,g):e(m,a||b,f,g)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/FeatureStoreQueryAdapter":function(){define(["exports","../../../../layers/graphics/OptimizedFeature","./support/FeatureSetReaderJSON"],function(k,r,p){class e{getObjectId(n){return n.getObjectId()}getAttributes(n){return n.readAttributes()}getAttribute(n,
m){return n.readAttribute(m)}getAttributeAsTimestamp(n,m){return n.readAttributeAsTimestamp(m)}cloneWithGeometry(n,m){const l=n.readAttributes();m=new r.OptimizedFeature(m,l,null,n.getObjectId(),n.getDisplayId());n=p.FeatureSetReaderJSON.fromOptimizedFeatures([m],n.metadata);n.setIndex(0);return n}getGeometry(n){return n.readGeometryWorldSpace()}getCentroid(n,m){return n.readCentroidForDisplay()}}e.Shared=new e;k.FeatureStoreQueryAdapter=e;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/layers/features/support/FeatureSetReaderJSON":function(){define(["exports","../../../../../layers/graphics/featureConversionUtils","../../../../../layers/graphics/OptimizedFeature","../../../../../layers/support/FieldsIndex","./FeatureSetReader"],function(k,r,p,e,n){class m extends n.FeatureSetReader{static fromFeatures(l,d){const {objectIdField:a,geometryType:b}=d,f=r.convertFromFeatures([],l,b,!1,!1,a);for(let g=0;g<f.length;g++)f[g].displayId=l[g].displayId;return m.fromOptimizedFeatures(f,
d)}static fromFeatureSet(l,d){l=r.convertFromFeatureSet(l,d.objectIdField);return m.fromOptimizedFeatureSet(l,d)}static fromOptimizedFeatureSet(l,d){d=m.fromOptimizedFeatures(l.features,d);d._exceededTransferLimit=l.exceededTransferLimit;d._transform=l.transform;d._fieldsIndex=new e(l.fields);return d}static fromOptimizedFeatures(l,d,a){l=new m(l,d);l._fieldsIndex=d.fieldsIndex;l._transform=a;return l}static empty(l){return new m([],l)}constructor(l,d){super(d);this._exceededTransferLimit=!1;this._featureIndex=
-1;this._fieldsIndex=null;this._geometryType=d.geometryType;this._features=l}get fields(){return this._fieldsIndex}get geometryType(){return this._geometryType}get hasFeatures(){return!!this._features.length}get hasNext(){return this._featureIndex+1<this._features.length}get exceededTransferLimit(){return this._exceededTransferLimit}get hasZ(){return!1}get hasM(){return!1}get _current(){return this._features[this._featureIndex]}get usedMemory(){return this._current.usedMemory}getSize(){return this._features.length}getCursor(){return this.copy()}getInTransform(){return this._transform}getAttributeHash(){let l=
"";for(const d in this._current.attributes)l+=this._current.attributes[d];return l}getIndex(){return this._featureIndex}setIndex(l){this._featureIndex=l}getObjectId(){return this._current?.objectId}getDisplayId(){return this._current.displayId}setDisplayId(l){this._current.displayId=l}copy(){const l=new m(this._features,this.metadata);this.copyInto(l);return l}next(){for(;++this._featureIndex<this._features.length&&!this._getExists(););return this._featureIndex<this._features.length}readGeometryArea(){return p.hasGeometry(this._current)?
r.getQuantizedArea(this._current.geometry,2):0}_readX(){return p.hasGeometry(this._current)?this._current.geometry.coords[0]:0}_readY(){return p.hasGeometry(this._current)?this._current.geometry.coords[1]:0}_readGeometry(){return p.hasGeometry(this._current)?this._current.geometry??null:null}_readServerCentroid(){return this._current.centroid}_readAttribute(l,d){if(this._fieldsIndex){var a=this._fieldsIndex.get(l);if(a)return a=this._current.attributes[a.name],null==a?a:d&&this.fields.isDateField(l)?
new Date(a):a}else{d=this._current.attributes[l];if(void 0!==d)return d;l=l.toLowerCase();for(a in this._current.attributes)if(a.toLowerCase()===l)return this._current.attributes[a]}}_readAttributes(){return this._current.attributes}copyInto(l){super.copyInto(l);l._featureIndex=this._featureIndex;l._transform=this._transform;l._fieldsIndex=this._fieldsIndex}}k.FeatureSetReaderJSON=m;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetReader":function(){define("exports ../../../../../arcade/ArcadeDate ../../../../../core/has ../../../../../core/sql/DateOnly ../../../../../core/sql/TimeOnly ../../../../../geometry/GeometryCursor ../../../../../geometry/support/aaBoundingBox ../../../../../geometry/support/jsonUtils ../../../../../geometry/support/labelPoint ../../../../../geometry/support/quantizationUtils ../../../../../layers/graphics/centroid ../../../../../layers/graphics/featureConversionUtils ../../../../../layers/graphics/OptimizedFeature ../../../../../layers/graphics/OptimizedGeometry ../../../../../time/constants ./FeatureSetCache".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g,q,c,h,u){function A(E,H,K){if(!(E.length>H))for(;E.length<=H;)E.push(K)}var z=p("featurelayer-simplify-thresholds")??[.5,.5,.5,.5];const t=z[0],w=z[1],x=z[2],B=z[3];z=p("featurelayer-simplify-payload-size-factors")??[1,2,4];const C=z[0],y=z[1],v=z[2],F=p("featurelayer-simplify-mobile-factor")??2,D=p("esri-mobile");class G{constructor(E){this.metadata=E;this.type="FeatureSetReader";this._overrides=null;this._joined=[];this._objectIdToIndex=null;this._boundsBuffer=[];
this._caches=new Map;this.arcadeDeclaredClass="esri.arcade.Feature";this._contextTimeZone=null}destroy(){}[Symbol.dispose](){this.destroy()}getAreaSimplificationThreshold(E,H){let K=1;const J=D?F:1;4E6<H?K=v*J:1E6<H?K=y*J:5E5<H?K=C*J:1E5<H&&(K=J);H=0;4E3<E?H=B*K:2E3<E?H=x*K:100<E?H=w:15<E&&(H=t);return H}getBounds(E){A(this._boundsBuffer,4*this.getIndex()+4,0);if(4294967295===this.getBoundsXMin())return!1;if(0===this.getBoundsXMin()){var H=this.readGeometryWorldSpace();if(!H)return this.setBoundsXMin(4294967295),
!1;let P=Infinity,Q=Infinity,S=-Infinity,U=-Infinity;H.forEachVertex((X,aa)=>{P=Math.min(P,X);Q=Math.min(Q,aa);S=Math.max(S,X);U=Math.max(U,aa)});this.setBoundsXMin(P);this.setBoundsYMin(Q);this.setBoundsXMax(S);this.setBoundsYMax(U);l.fromRectValues(E,P,Q,S,U);return!0}H=this.getBoundsXMin();const K=this.getBoundsYMin(),J=this.getBoundsXMax(),L=this.getBoundsYMax();l.fromRectValues(E,H,K,J,L);return!0}getBoundsXMin(){return this._boundsBuffer[4*this.getIndex()]}setBoundsXMin(E){this._boundsBuffer[4*
this.getIndex()]=E}getBoundsYMin(){return this._boundsBuffer[4*this.getIndex()+1]}setBoundsYMin(E){this._boundsBuffer[4*this.getIndex()+1]=E}getBoundsXMax(){return this._boundsBuffer[4*this.getIndex()+2]}setBoundsXMax(E){this._boundsBuffer[4*this.getIndex()+2]=E}getBoundsYMax(){return this._boundsBuffer[4*this.getIndex()+3]}setBoundsYMax(E){this._boundsBuffer[4*this.getIndex()+3]=E}readAttributeAsTimestamp(E){E=this.readAttribute(E);return"string"===typeof E?(new Date(E)).getTime():"number"===typeof E||
null==E?E:null}readAttribute(E,H=!1){var K=this._readAttribute(E,H);if(void 0!==K)return K;for(const J of this._joined)if(J.setIndex(this.getIndex()),K=J._readAttribute(E,H),void 0!==K)return K}readAttributes(){const E=this._readAttributes();for(const H of this._joined){H.setIndex(this.getIndex());const K=H._readAttributes();for(const J of Object.keys(K))E[J]=K[J]}return E}joinAttributes(E){this._joined.push(E)}registerOverrides(E){this._overrides=E}withoutOverrides(){const E=this.copy();E._overrides=
null;return E}readOptimizedFeatureWorldSpace(){const E=this.readGeometryWorldSpace(),H=this.readAttributes(),K=this.readCentroidWorldSpace();return new q.OptimizedFeature(E,H,K,this.getObjectId(),this.getDisplayId())}readLegacyFeatureForDisplay(){const E=this.readCentroidForDisplay();return{attributes:this.readAttributes(),geometry:this.readLegacyGeometryForDisplay(),centroid:(E&&{x:E.coords[0],y:E.coords[1]})??null}}readLegacyFeatureWorldSpace(){const E=this.readCentroidWorldSpace();return{attributes:this.readAttributes(),
geometry:this._readLegacyGeometryWorldSpace(),centroid:(E&&{x:E.coords[0],y:E.coords[1]})??null}}readLegacyGeometryForDisplay(){const E=this.readGeometryForDisplay();return g.convertToGeometry(E,this.geometryType,!1,!1)}readXForDisplay(){return this._readX()}readYForDisplay(){return this._readY()}readXWorldSpace(){const E=this._readX(),H=this.getInTransform();return null==H?E:E*H.scale[0]+H.translate[0]}readYWorldSpace(){const E=this._readY(),H=this.getInTransform();return null==H?E:H.translate[1]-
E*H.scale[1]}readGeometryForDisplay(){var E=this._readGeometryDeltaDecoded(!0);return E?E:(E=this._createDeltaQuantizedGeometryFromServerCentroid())?E.deltaDecode():null}readGeometryForDisplayTransformed(E){var H=this.readGeometryForDisplay();H&&=g.quantizeForDisplay(H,E,this.metadata.geometryType,this.hasZ,this.hasM);if(!H){const K=this.readCentroidForDisplay();if(!K)return null;H=b.quantizeX(E,K.coords[0]);E=b.quantizeY(E,K.coords[1]);return this._createDeltaQuantizedExtrudedGeometry(H,E).deltaDecode()}return H}readGeometryWorldSpace(){var E=
this._readGeometry();E||=this._createDeltaQuantizedGeometryFromServerCentroid();if(!E)return null;E=E.clone();const H=this.getInTransform();null!=H&&g.unquantizeOptimizedGeometry(E,E,this.hasZ,this.hasM,H);return E}readCentroidForDisplay(){const E=this.readGeometryForDisplay();return E?this._computeDisplayCentroid(E):this._readServerCentroid()}readCentroidWorldSpace(){var E=this.readGeometryForDisplay();E=E?this._computeDisplayCentroid(E):this._readServerCentroid();if(!E)return null;E=E.clone();const H=
this.getInTransform();null!=H&&g.unquantizeOptimizedGeometry(E,E,this.hasZ,this.hasM,H);return E}setCache(E){let H=this._caches.get(E);null==H&&(H=new u.FeatureSetCache(this.getSize()),this._caches.set(E,H));this._activeCache=H}setCachedValue(E){this._activeCache.set(this.getIndex(),E)}hasCachedValue(){return this._activeCache.has(this.getIndex())}getCachedValue(){return this._activeCache.get(this.getIndex())}_readGeometryDeltaDecoded(E){E=this._readGeometry(E);return"esriGeometryPoint"!==this.geometryType&&
E&&this.getInTransform()?E.deltaDecode():E}get contextTimeZone(){return this._contextTimeZone}set contextTimeZone(E){this._contextTimeZone=E}readArcadeFeature(){return this}hasField(E){return this.fields.has(E)||this._joined.some(H=>H.hasField(E))}geometry(){var E=this.readGeometryWorldSpace();E=g.convertToGeometry(E,this.geometryType,this.hasZ,this.hasM);if(E=d.fromJSON(E)){if(!this.metadata.outSpatialReference)throw Error("InternalError: Expected spatial reference to be defined");E.spatialReference=
this.metadata.outSpatialReference}return E}autocastArcadeDate(E,H){return H&&H instanceof Date?this.isUnknownDateTimeField(E)?r.ArcadeDate.unknownDateJSToArcadeDate(H):r.ArcadeDate.dateJSAndZoneToArcadeDate(H,this.contextTimeZone??h.system):H}isUnknownDateTimeField(E){return this.metadata.fieldsIndex.getTimeZone(E)===h.unknown}field(E){let H=this.fields.get(E);if(H)switch(H.type){case "date-only":case "esriFieldTypeDateOnly":return e.DateOnly.fromReader(this.readAttribute(E,!1));case "time-only":case "esriFieldTypeTimeOnly":return n.TimeOnly.fromReader(this.readAttribute(E,
!1));case "esriFieldTypeTimestampOffset":case "timestamp-offset":return r.ArcadeDate.fromReaderAsTimeStampOffset(this.readAttribute(E,!1));case "date":case "esriFieldTypeDate":return this.autocastArcadeDate(E,this.readAttribute(E,!0));default:return this.readAttribute(E,!1)}for(const K of this._joined)if(K.setIndex(this.getIndex()),H=K.fields.get(E))switch(H.type){case "date-only":case "esriFieldTypeDateOnly":return e.DateOnly.fromReader(K._readAttribute(E,!1));case "time-only":case "esriFieldTypeTimeOnly":return n.TimeOnly.fromReader(K._readAttribute(E,
!1));case "esriFieldTypeTimestampOffset":case "timestamp-offset":return r.ArcadeDate.fromReaderAsTimeStampOffset(K._readAttribute(E,!1));case "date":case "esriFieldTypeDate":return this.autocastArcadeDate(E,K._readAttribute(E,!0));default:return this.readAttribute(E,!1)}throw Error(`Field ${E} does not exist`);}setField(E,H){throw Error("Unable to update feature attribute values, feature is readonly");}keys(){return this.fields.fields.map(E=>E.name)}castToText(E=!1){if(!E)return JSON.stringify(this.readLegacyFeatureForDisplay());
E=this.readLegacyFeatureForDisplay();if(!E)return JSON.stringify(null);E={geometry:E.geometry,attributes:{...(E.attributes??{})}};for(const H in E.attributes){const K=E.attributes[H];K instanceof Date&&(E.attributes[H]=K.getTime())}return JSON.stringify(E)}gdbVersion(){return null}fullSchema(){return this.metadata.arcadeSchema}castAsJson(E=null){return{attributes:this._readAttributes(),geometry:!0===E?.keepGeometryType?this.geometry():this.geometry()?.toJSON()??null}}castAsJsonAsync(E,H=null){return Promise.resolve(this.castAsJson(H))}_getExists(){if(this._overrides){const E=
this.getObjectId();return!this._overrides.hasOverride(E)}return!0}_computeDisplayCentroid(E){if(null==this.getInTransform())return f.getCentroidOptimizedGeometry(new c,E,this.hasM,this.hasZ);E=m.GeometryCursor.fromOptimized(E,this.geometryType);E.yFactor*=-1;return(E=a.getLabelPoint(E))?(E[1]*=-1,new c([],E)):null}copyInto(E){E._joined=this._joined;E._overrides=this._overrides;E._objectIdToIndex=this._objectIdToIndex;E._boundsBuffer=this._boundsBuffer;E._activeCache=this._activeCache;E._caches=this._caches;
E._contextTimeZone=this._contextTimeZone}_readLegacyGeometryWorldSpace(){const E=this.readGeometryWorldSpace();return g.convertToGeometry(E,this.geometryType,!1,!1)}_createDeltaQuantizedGeometryFromServerCentroid(){const E=this._readServerCentroid();if(!E)return null;const [H,K]=E.coords;return this._createDeltaQuantizedExtrudedGeometry(H,K)}_createDeltaQuantizedExtrudedGeometry(E,H){return"esriGeometryPolyline"===this.geometryType?this._createDeltaQuantizedExtrudedLine(E,H):this._createDeltaQuantizedExtrudedQuad(E,
H)}_createDeltaQuantizedExtrudedQuad(E,H){return new c([5],[E-1,H,1,-1,1,1,-1,1,-1,-1])}_createDeltaQuantizedExtrudedLine(E,H){return new c([2],[E-1,H+1,1,-1])}}k.FeatureSetReader=G;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/DateOnly":function(){define(["exports","../../arcade/ArcadeDate","../../intl/locale","../../chunks/datetime"],function(k,r,p,e){function n(l){l=l.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$\x26]");let d="";const a=/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;
for(const b of l.match(a)||[])switch(b){case "D":d+="d";break;case "DD":d+="dd";break;case "DDD":d+="o";break;case "d":d+="c";break;case "ddd":d+="ccc";break;case "dddd":d+="cccc";break;case "M":d+="L";break;case "MM":d+="LL";break;case "MMM":d+="LLL";break;case "MMMM":d+="LLLL";break;case "YY":d+="yy";break;case "Y":case "YYYY":d+="yyyy";break;case "Q":d+="q";break;case "X":case "x":d+=b;break;default:d=2<=b.length&&"["===b.slice(0,1)&&"]"===b.slice(-1)?d+`'${b.slice(1,-1)}'`:d+`'${b}'`}return d}
class m{constructor(l,d,a){this._year=l;this._month=d;this._day=a;this.declaredRootClass="esri.core.sql.dateonly"}static isDateOnly(l){return"object"===typeof l&&null!=l&&"declaredRootClass"in l&&"esri.core.sql.dateonly"===l.declaredRootClass}get month(){return this._month}get monthJS(){return this._month-1}get year(){return this._year}get day(){return this._day}get isValid(){return this.toDateTime("unknown").isValid}equals(l){return m.isDateOnly(l)&&l.day===this.day&&l.month===this.month&&l.year===
this.year}clone(){return new m(this._year,this._month,this._day)}toDateTime(l){return e.DateTime.fromObject({day:this.day,month:this.month,year:this.year},{zone:r.createDateTimeZone(l)})}toDateTimeLuxon(l){return e.DateTime.fromObject({day:this.day,month:this.month,year:this.year},{zone:r.createDateTimeZone(l)})}toString(){return`${this.year.toString().padStart(4,"0")}-${this.month.toString().padStart(2,"0")}-${this.day.toString().padStart(2,"0")}`}toFormat(l=null,d=!0){if(null===l||""===l)return this.toString();
d&&(l=n(l));if(!l)return"";d=this.toDateTime("unknown");return r.ArcadeDate.dateTimeToArcadeDate(d).toFormat(l,{locale:p.getLocale(),numberingSystem:"latn"})}toArcadeDate(){const l=this.toDateTime("unknown");return r.ArcadeDate.dateTimeToArcadeDate(l)}toNumber(){return this.toDateTime("unknown").toMillis()}toJSDate(){return this.toDateTime("unknown").toJSDate()}toStorageFormat(){return this.toFormat("yyyy-LL-dd",!1)}toSQLValue(){return this.toFormat("yyyy-LL-dd",!1)}toSQLWithKeyword(){return"date '"+
this.toFormat("yyyy-LL-dd",!1)+"'"}plus(l,d){return m.fromDateTime(this.toUTCDateTime().plus({[l]:d}))}toUTCDateTime(){return e.DateTime.utc(this.year,this.month,this.day,0,0,0,0)}difference(l,d){switch(d.toLowerCase()){case "days":case "day":case "d":return this.toUTCDateTime().diff(l.toUTCDateTime(),"days").days;case "months":case "month":return this.toUTCDateTime().diff(l.toUTCDateTime(),"months").months;case "minutes":case "minute":case "m":return"M"===d?this.toUTCDateTime().diff(l.toUTCDateTime(),
"months").months:this.toUTCDateTime().diff(l.toUTCDateTime(),"minutes").minutes;case "seconds":case "second":case "s":return this.toUTCDateTime().diff(l.toUTCDateTime(),"seconds").seconds;case "milliseconds":case "millisecond":case "ms":return this.toUTCDateTime().diff(l.toUTCDateTime(),"milliseconds").milliseconds;case "hours":case "hour":case "h":return this.toUTCDateTime().diff(l.toUTCDateTime(),"hours").hours;case "years":case "year":case "y":return this.toUTCDateTime().diff(l.toUTCDateTime(),
"years").years;default:return this.toUTCDateTime().diff(l.toUTCDateTime(),"milliseconds").milliseconds}}static fromMilliseconds(l){l=e.DateTime.fromMillis(l,{zone:e.FixedOffsetZone.utcInstance});return l.isValid?m.fromParts(l.year,l.month,l.day):null}static fromSeconds(l){l=e.DateTime.fromSeconds(l,{zone:e.FixedOffsetZone.utcInstance});return l.isValid?m.fromParts(l.year,l.month,l.day):null}static fromReader(l){if(!l)return null;l=l.split("-");return 3!==l.length?null:new m(parseInt(l[0],10),parseInt(l[1],
10),parseInt(l[2],10))}static fromParts(l,d,a){l=new m(l,d,a);return!1===l.isValid?null:l}static fromDateJS(l){return m.fromParts(l.getFullYear(),l.getMonth()+1,l.getDay())}static fromDateTime(l){return m.fromParts(l.year,l.month,l.day)}static fromSqlTimeStampOffset(l){return this.fromDateTime(l.toDateTime())}static fromString(l,d=null){if(""===l||null===l)return null;var a=[];if(d)(d=n(d))&&a.push(d);else if(null===d||""===d)return l=e.DateTime.fromISO(l,{setZone:!0}),l.isValid?m.fromParts(l.year,
l.month,l.day):null;for(const b of a)if(a=e.DateTime.fromFormat(l,d??b),a.isValid)return new m(a.year,a.month,a.day);return null}static fromNow(l="system"){l=e.DateTime.fromJSDate(new Date).setZone(r.createDateTimeZone(l));return new m(l.year,l.month,l.day)}}k.DateOnly=m;k.standardizeDateOnlyFormat=n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/TimeOnly":function(){define(["exports","../../arcade/kernel","../../intl/locale","../../chunks/datetime"],function(k,r,p,
e){function n(l){if(!l)return"";const d=/(a|A|hh?|HH?|mm?|ss?|SSS|S|.)/g;let a="";for(const b of l.match(d)||[])switch(b){case "SSS":a+=b;break;case "A":case "a":a+="a";break;case "m":case "mm":case "h":case "hh":case "H":case "HH":case "s":case "ss":a+=b;break;default:a+=`'${b}'`}return a}class m{constructor(l,d,a,b){this._hour=l;this._minute=d;this._second=a;this._millisecond=b;this.declaredRootClass="esri.core.sql.timeonly"}static isTimeOnly(l){return"object"===typeof l&&null!=l&&"declaredRootClass"in
l&&"esri.core.sql.timeonly"===l.declaredRootClass}get hour(){return this._hour}get minute(){return this._minute}get second(){return this._second}get millisecond(){return this._millisecond}equals(l){return m.isTimeOnly(l)&&l.hour===this.hour&&l.minute===this.minute&&l.second===this.second&&l.millisecond===this.millisecond}clone(){return new m(this.hour,this.minute,this.second,this.millisecond)}isValid(){return r.isInteger(this.hour)&&r.isInteger(this.minute)&&r.isInteger(this.second)&&r.isInteger(this.millisecond)&&
0<=this.hour&&24>this.hour&&0<=this.minute&&60>this.minute&&0<=this.second&&60>this.second&&0<=this.millisecond&&1E3>this.millisecond}toString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`+(0<this.millisecond?"."+this.millisecond.toString().padStart(3,"0"):"")}toSQLValue(){return this.toString()}toSQLWithKeyword(){return`time '${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,
"0")}${0<this.millisecond?"."+this.millisecond.toString().padStart(3,"0"):""}'`}toStorageString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`}toFormat(l=null){return null===l||""===l?this.toString():(l=n(l))?e.DateTime.local(1970,1,1,this._hour,this._minute,this._second,this._millisecond).toFormat(l,{locale:p.getLocale(),numberingSystem:"latn"}):""}toNumber(){return this.millisecond+1E3*this.second+6E4*this.minute+
36E5*this.hour}static fromParts(l,d,a,b){l=new m(l,d,a,b);return l.isValid()?l:null}static fromReader(l){if(!l)return null;l=l.split(":");return 3!==l.length?null:new m(parseInt(l[0],10),parseInt(l[1],10),parseInt(l[2],10),0)}static fromMilliseconds(l){return 864E5<l||0>l?null:new m(Math.floor(l/36E5%24),Math.floor(l/6E4%60),Math.floor(l/1E3%60),Math.floor(l%1E3))}static fromDateJS(l){return new m(l.getHours(),l.getMinutes(),l.getSeconds(),l.getMilliseconds())}static fromDateTime(l){return new m(l.hour,
l.minute,l.second,l.millisecond)}static fromSqlTimeStampOffset(l){return this.fromDateTime(l.toDateTime())}static fromString(l,d=null){if(""===l||null===l)return null;const a=[];if(d)(d=n(d))&&a.push(d);else if(null===d||""===d)a.push("HH:mm:ss"),a.push("HH:mm:ss.SSS"),a.push("hh:mm:ss a"),a.push("hh:mm:ss.SSS a"),a.push("HH:mm"),a.push("hh:mm a"),a.push("H:mm"),a.push("h:mm a"),a.push("H:mm:ss"),a.push("h:mm:ss a"),a.push("H:mm:ss.SSS"),a.push("h:mm:ss.SSS a");for(const b of a)if(d=e.DateTime.fromFormat(l,
b),d.isValid)return new m(d.hour,d.minute,d.second,d.millisecond);return null}plus(l,d){switch(l){case "days":case "years":case "months":return this.clone();case "hours":case "minutes":case "seconds":case "milliseconds":return m.fromDateTime(this.toUTCDateTime().plus({[l]:d}))}return null}toUTCDateTime(){return e.DateTime.utc(1970,1,1,this.hour,this.minute,this.second,this.millisecond)}difference(l,d){switch(d.toLowerCase()){case "days":case "day":case "d":return this.toUTCDateTime().diff(l.toUTCDateTime(),
"days").days;case "months":case "month":return this.toUTCDateTime().diff(l.toUTCDateTime(),"months").months;case "minutes":case "minute":case "m":return"M"===d?this.toUTCDateTime().diff(l.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(l.toUTCDateTime(),"minutes").minutes;case "seconds":case "second":case "s":return this.toUTCDateTime().diff(l.toUTCDateTime(),"seconds").seconds;case "milliseconds":case "millisecond":case "ms":return this.toUTCDateTime().diff(l.toUTCDateTime(),"milliseconds").milliseconds;
case "hours":case "hour":case "h":return this.toUTCDateTime().diff(l.toUTCDateTime(),"hours").hours;case "years":case "year":case "y":return this.toUTCDateTime().diff(l.toUTCDateTime(),"years").years;default:return this.toUTCDateTime().diff(l.toUTCDateTime(),"milliseconds").milliseconds}}}k.TimeOnly=m;k.standardizeTimeFormat=n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/kernel":function(){define(["exports","../geometry/Extent"],function(k,r){k.cloneGeometry=function(p){if(null==
p)return null;const e=p.clone();void 0!==p.cache._geVersion&&(e.cache._geVersion=p.cache._geVersion);return e};k.isInteger=function(p){return"number"===typeof p&&isFinite(p)&&Math.floor(p)===p};k.sameGeomType=function(p,e){return p===e||"point"===p&&"esriGeometryPoint"===e||"polyline"===p&&"esriGeometryPolyline"===e||"polygon"===p&&"esriGeometryPolygon"===e||"extent"===p&&"esriGeometryEnvelope"===e||"multipoint"===p&&"esriGeometryMultipoint"===e||"point"===e&&"esriGeometryPoint"===p||"polyline"===
e&&"esriGeometryPolyline"===p||"polygon"===e&&"esriGeometryPolygon"===p||"extent"===e&&"esriGeometryEnvelope"===p||"multipoint"===e&&"esriGeometryMultipoint"===p?!0:!1};k.shapeExtent=function(p){if(null==p)return null;switch(p.type){case "polygon":case "multipoint":case "polyline":return p.extent;case "point":return new r({xmin:p.x,ymin:p.y,xmax:p.x,ymax:p.y,spatialReference:p.spatialReference});case "extent":return p}return null};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetCache":function(){define(["exports",
"./StaticBitSet"],function(k,r){class p{constructor(e){this._valid=r.StaticBitSet.create(e);this._data=Array(e)}has(e){return this._valid.has(e)}set(e,n){this._valid.set(e);this._data[e]=n}get(e){return this._data[e]}}k.FeatureSetCache=p;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/whereUtils":function(){define(["exports","../../../../../core/Error","../../../../../core/Logger","../../../../../core/sql"],function(k,r,p,e){const n=()=>p.getLogger("esri.views.2d.layers.FeatureLayerView2D"),
m={getAttribute(l,d){return l.readAttribute(d)}};k.createWhereClause=async function(l,d){try{const a=await e.parseWhereClause(l,d);a.isStandardized||n().error(new r("sql-parse-error","expression is not standardized",{where:l}));return(b,f)=>{b=b.readArcadeFeature();try{return a.testFeatureCompiled(b,m,f.currentUser)}catch(g){return n().warn(new r("sql-runtime-error","Encountered an error when evaluating where clause",{where:l,error:g})),!0}}}catch(a){return n().warn(new r("sql-runtime-error","Encountered an error when evaluating where clause",
{where:l,error:a})),b=>!0}};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/ComputedAttributeStorage":function(){define("exports ../../../../../core/Error ../../../../../core/Logger ../../../../../geometry/support/aaBoundingBox ../../../engine/webgl/DisplayId ./CachedField ./ComputedExpression ./ComputedLegacyLabelExpression ./NormalizedField ./StaticBitSet ./whereUtils".split(" "),function(k,r,p,e,n,m,l,d,a,b,f){function g(h,u,A){if(!(h.length>
u))for(;h.length<=u;)h.push(A)}const q=()=>p.getLogger("esri.views.2d.layers.features.support.ComputedAttributeStorage");class c{constructor(h){this._numerics=[];this._strings=[];this._allocatedSize=256;this._bitsets=[];this._instanceIds=[];this._bounds=[];this._dirtyBitset=this.getBitset(this.createBitset());this.compilationOptions=h}createBitset(){const h=this._bitsets.length;this._bitsets.push(b.StaticBitSet.create(this._allocatedSize,n.displayIdTexelMask));return h+1}async createComputedField(h,
u=!1){if(h.expression)try{if(!this.compilationOptions)throw Error("InternalError: Compilation options not defined");return u?await d.ComputedLegacyLabelExpression.create(h.expression,this.compilationOptions):await l.ComputedExpression.create(h.expression,this.compilationOptions)}catch(A){return h=new r("featurelayer","Failed to compile arcade expression",{error:A,expression:h.expression}),q().error(h),null}if(h.normalizationType||h.normalizationField)return new a.NormalizedField(h.field,h);if(h.field)return new m.CachedField(h.field);
h=new r("featurelayer","Unable to create computed field. No expression or field found",{info:h});q().error(h);return null}async createWhereClause(h){return h?f.createWhereClause(h,this.compilationOptions.fields):null}getBitset(h){return this._bitsets[h-1]}getComputedNumeric(h,u){return this.getComputedNumericAtIndex(h&n.displayIdTexelMask,0)}setComputedNumeric(h,u,A){return this.setComputedNumericAtIndex(h&n.displayIdTexelMask,A,0)}getComputedString(h,u){return this.getComputedStringAtIndex(h&n.displayIdTexelMask,
0)}setComputedString(h,u,A){return this.setComputedStringAtIndex(h&n.displayIdTexelMask,0,A)}getComputedNumericAtIndex(h,u){h&=n.displayIdTexelMask;this._ensureNumeric(u,h);return this._numerics[u][h]}setComputedNumericAtIndex(h,u,A){h&=n.displayIdTexelMask;this._ensureNumeric(u,h);this._numerics[u][h]=A}getPackedChunkId(h){h&=n.displayIdTexelMask;this._ensureInstanceId(h);return this._instanceIds[h]}setPackedChunkId(h,u){h&=n.displayIdTexelMask;this._ensureInstanceId(h);this._instanceIds[h]=u}getComputedStringAtIndex(h,
u){h&=n.displayIdTexelMask;this._ensureString(u,h);return this._strings[u][h]}setComputedStringAtIndex(h,u,A){h&=n.displayIdTexelMask;this._ensureString(u,h);this._strings[u][h]=A}getXMin(h){return this._bounds[4*(h&n.displayIdTexelMask)]}getYMin(h){return this._bounds[4*(h&n.displayIdTexelMask)+1]}getXMax(h){return this._bounds[4*(h&n.displayIdTexelMask)+2]}getYMax(h){return this._bounds[4*(h&n.displayIdTexelMask)+3]}setBounds(h,u,A=!1){const z=h&n.displayIdTexelMask;if(!A&&!this._dirtyBitset.has(h))return 4294967295!==
this._bounds[4*z];this._dirtyBitset.unset(h);h=u.readGeometryWorldSpace();g(this._bounds,4*z+4,0);if(!h||!h.coords.length)return this._bounds[4*z]=4294967295,this._bounds[4*z+1]=4294967295,this._bounds[4*z+2]=4294967295,this._bounds[4*z+3]=4294967295,!1;let t=Infinity,w=Infinity,x=-Infinity,B=-Infinity;h.forEachVertex((C,y)=>{t=Math.min(t,C);w=Math.min(w,y);x=Math.max(x,C);B=Math.max(B,y)});this._bounds[4*z]=t;this._bounds[4*z+1]=w;this._bounds[4*z+2]=x;this._bounds[4*z+3]=B;return!0}getBounds(h,
u){const A=this.getXMin(u),z=this.getYMin(u),t=this.getXMax(u);u=this.getYMax(u);e.fromRectValues(h,A,z,t,u);return 4294967295!==A}_ensureNumeric(h,u){this._numerics[h]||(this._numerics[h]=[]);g(this._numerics[h],u,0)}_ensureInstanceId(h){g(this._instanceIds,h,0)}_ensureString(h,u){this._strings[h]||(this._strings[h]=[]);g(this._strings[h],u,null)}}k.ComputedAttributeStorage=c;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/CachedField":function(){define(["exports",
"./AComputedField"],function(k,r){class p extends r.AComputedField{constructor(e){super();this._field=e}resize(e){throw Error("Method not implemented.");}read(e,n){return e.readAttribute(this._field)}readWithDefault(e,n){return e.readAttribute(this._field)}hasArcadeDependency(e){return!1}}k.CachedField=p;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/ComputedExpression":function(){define(["exports","../../../../../core/string","../../../../../support/arcadeOnDemand",
"../../../arcade/callExpressionWithCursor","./AComputedField"],function(k,r,p,e,n){class m extends n.AComputedField{static async create(l,d){d=await p.createRendererExpression(l,d.spatialReference,d.fields);l=r.numericHash(l);return new m(d,l)}constructor(l,d){super();this._compiled=l;this._cacheKey=d}resize(l){}read(l,d){return this.hasArcadeDependency("scale")||"system"!==d.$view.timeZone?e.callExpressionWithCursor(this._compiled,l,d):this._readCached(l,d)}readWithDefault(l,d,a){return this.hasArcadeDependency("scale")||
"system"!==d.$view.timeZone?e.callExpressionWithCursorWithDefault(this._compiled,l,d,a):this._readWithDefaultCached(l,d,a)}hasArcadeDependency(l){return this._compiled?.references(l)??!1}_getCacheKey(l){if(!this._compiled?.references("timeProperties"))return this._cacheKey;const {currentStart:d,currentEnd:a}=l.$view.timeProperties;l=43758.5453*Math.sin(12.9898*(d??1)+78.233*(a??1));return this._cacheKey+(l-Math.floor(l))}_readCached(l,d){l.setCache(this._getCacheKey(d));if(l.hasCachedValue())return l.getCachedValue();
d=e.callExpressionWithCursor(this._compiled,l,d);l.setCachedValue(d);return d}_readWithDefaultCached(l,d,a){l.setCache(this._getCacheKey(d));if(l.hasCachedValue())return l.getCachedValue();d=e.callExpressionWithCursorWithDefault(this._compiled,l,d,a);l.setCachedValue(d);return d}}k.ComputedExpression=m;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/arcade/callExpressionWithCursor":function(){define(["exports","../../../core/has","../../../core/Logger"],function(k,r,
p){function e(n){return null==n||Infinity===n||-Infinity===n||"number"===typeof n&&isNaN(n)}k.callExpressionWithCursor=function(n,m,l){if(null==n)return null;const d=m.readArcadeFeature();m.contextTimeZone=l.$view?.timeZone;try{return n.evaluate({...l,$feature:d},n.services)}catch(a){return p.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}};k.callExpressionWithCursorWithDefault=function(n,m,l,d){if(null==n)return null!=d?d:null;const a=m.readArcadeFeature();
m.contextTimeZone=l.$view?.timeZone;n=n.evaluate({...l,$feature:a},n.services);return e(n)?null!=d?d:null:n};k.isBadArcadeResult=e;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/ComputedLegacyLabelExpression":function(){define(["exports","../../../../../layers/support/labelFormatUtils","../../../../../layers/support/labelUtils","../../../arcade/callExpressionWithCursor","./AComputedField"],function(k,r,p,e,n){class m extends n.AComputedField{static async create(l,
d){const a=p.sqlToTemplateString(l);return new m(b=>a.replaceAll(/{[^}]*}/g,f=>{const g=f.slice(1,-1),q=b.metadata.fieldsIndex.get(g);if(null==q)return f;f=b.readAttribute(g);return null==f?"":r.formatField(f,q)}))}constructor(l){super();this._evaluator=l}resize(l){}read(l,d){return this._evaluator(l)}readWithDefault(l,d,a){l=this._evaluator(l);return e.isBadArcadeResult(l)?a:l}hasArcadeDependency(l){return!1}}k.ComputedLegacyLabelExpression=m;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},
"esri/layers/support/labelFormatUtils":function(){define("exports ../../core/Error ../../core/Logger ../../core/sql ../../intl/date ../../intl/number ./domainUtils ./fieldUtils ./labelUtils ../../support/arcadeExpressionUtils ../../support/arcadeOnDemand".split(" "),function(k,r,p,e,n,m,l,d,a,b,f){function g(u,A){if(null==u)return"";const z=A.domain;if(z)if("codedValue"===z.type||"coded-value"===z.type)for(var t of z.codedValues){if(t.code===u)return t.name}else if("range"===z.type){const {max:w,
min:x}=l.getDomainRange(A);t=+u;if(null!=x&&null!=w&&x<=t&&t<=w)return z.name}d.isDateField(A)?u=n.formatDate(u,n.convertDateFormatToIntlOptions("short-date")):d.isNumericField(A)&&(u=m.formatNumber(+u));return u||""}const q=()=>p.getLogger("esri.layers.support.labelFormatUtils"),c={type:"simple",evaluate(){return null}},h={getAttribute(u,A){return u.field(A)}};k.createLabelFunction=async function(u,A,z){if(!u||!u.symbol||!A)return c;const t=u.where,w=a.getLabelExpression(u);if("arcade"===w.type){u=
b.getFieldNameFromSimpleExpression(w.expression);const x=A.get(u);if(x&&(d.isIntegerField(x)||d.isNumericField(x)||d.isStringField(x)))z={type:"simple",evaluate(B){B="attributes"in B?B.attributes?.[x.name]:B.field(x.name);return null==B?"":B.toString()}};else{const B=await f.createLabelExpression(w.expression,z,A);if(null==B)return c;z={type:"arcade",evaluate(C,y){try{const v="attributes"in C?B.repurposeFeature(C):C;v.contextTimeZone=y??null;const F=B.evaluate({$view:{timeZone:y},$feature:v},B.services);
if(null!=F)return F.toString()}catch(v){q().error(new r("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:v,feature:C,expression:w}))}return null},needsHydrationToEvaluate(){return null==a.getSingleFieldArcadeExpression(w.expression)}}}}else z={type:"simple",evaluate(x){return w.expression.replaceAll(/{[^}]*}/g,B=>{var C=B.slice(1,-1);C=A.get(C);if(!C)return B;B=null;B="attributes"in x?x?.attributes?.[C.name]:x.field(C.name);return null==B?"":g(B,
C)})}};if(t){let x;try{x=await e.parseWhereClause(t,A)}catch(C){return q().error(new r("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:t,error:C})),c}const B=z.evaluate;z.evaluate=(C,y)=>{const v="attributes"in C?void 0:h;try{if(x.testFeature(C,v))return B(C,y)}catch(F){q().error(new r("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:t,feature:C,error:F}))}return null}}return z};k.formatField=g;Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/NormalizedField":function(){define(["exports","./AComputedField"],function(k,r){class p extends r.AComputedField{constructor(e,n){super();this._field=e;this._normalizationInfo=n}resize(e){throw Error("Method not implemented.");}read(e,n){return this._readNormalized(e)}readWithDefault(e,n){return this._readNormalized(e)}hasArcadeDependency(e){return!1}_readNormalized(e){const n=e.readAttribute(this._field);if(null==n)return null;
const {normalizationField:m,normalizationTotal:l,normalizationType:d}=this._normalizationInfo;e=e.readAttribute(m);switch(d??"esriNormalizeByField"){case "esriNormalizeByField":return e?(e||void 0)&&n/e:null;case "esriNormalizeByLog":return Math.log(n)*Math.LOG10E;case "esriNormalizeByPercentOfTotal":return l?n/l*100:null}}}k.NormalizedField=p;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureMetadata":function(){define(["exports","../../../../../geometry/SpatialReference",
"../../../../../layers/support/FieldsIndex"],function(k,r,p){class e{static minimal(m,l,d=[]){return new e({geometryType:m,fieldsIndex:(new p(d)).toJSON(),objectIdField:l,subtypes:null,subtypeField:null,types:null,globalIdField:null,spatialReference:null,outSpatialReference:null,timeInfo:null,timeReferenceUnknownClient:null,dateFieldsTimeZone:null,typeIdField:null})}static createFeature(m){return new e(m)}constructor(m){this._options=m;this._fieldsIndex=p.fromJSON(m.fieldsIndex);m.spatialReference&&
(this._spatialReference=r.fromJSON(m.spatialReference));m.outSpatialReference&&(this._outSpatialReference=r.fromJSON(m.outSpatialReference));this._arcadeSchema={fields:this.fieldsIndex.fields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,objectIdField:this.objectIdField,globalIdField:this._options.globalIdField,spatialReference:this._spatialReference,timeInfo:this._options.timeInfo,typeIdField:this._options.typeIdField??void 0,types:this._options.types??void 0,subtypeField:this._options.subtypeField,
subtypes:this._options.subtypes??void 0,datesInUnknownTimezone:this._options.timeReferenceUnknownClient??void 0,dateFieldsTimeZone:this._options.dateFieldsTimeZone??void 0}}get fieldsIndex(){return this._fieldsIndex}get geometryType(){return"esriGeometryMultiPatch"===this._options.geometryType?"esriGeometryPolygon":this._options.geometryType}get serviceGeometryType(){return this._options.geometryType}get subtypeField(){return this._options.subtypeField}get timeInfo(){return this._options.timeInfo}get objectIdField(){return this._options.objectIdField}get globalIdField(){return this._options.globalIdField}get arcadeSchema(){return this._arcadeSchema}get spatialReference(){return this._spatialReference}get outSpatialReference(){return this._outSpatialReference}get timeReferenceUnknownClient(){return this._options.timeReferenceUnknownClient}weakCloneWithAdditionalFields(m){return new e({fieldsIndex:{fields:[...this._fieldsIndex.fields,
...m],timeZoneByFieldName:null},geometryType:this.geometryType,globalIdField:this.globalIdField,objectIdField:this.objectIdField,spatialReference:this.spatialReference,outSpatialReference:this.outSpatialReference,subtypeField:this.subtypeField,subtypes:this._options.subtypes,timeInfo:this.timeInfo,timeReferenceUnknownClient:this.timeReferenceUnknownClient,dateFieldsTimeZone:this._options.dateFieldsTimeZone,typeIdField:this._options.typeIdField,types:this._options.types})}}class n extends e{static createGraphics(m){return new n({fieldsIndex:(new p).toJSON(),
objectIdField:"uid",geometryType:null,spatialReference:m,outSpatialReference:m,globalIdField:null,subtypeField:null,subtypes:null,timeInfo:null,typeIdField:null,types:null,timeReferenceUnknownClient:null,dateFieldsTimeZone:null})}}k.FeatureMetadata=e;k.GraphicsMetadata=n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/GraphicsReader":function(){define("exports ../../../../../geometry/support/centroid ../../../../../geometry/support/jsonUtils ../../../../../layers/graphics/featureConversionUtils ../../../../../layers/graphics/OptimizedGeometry ../../../engine/webgl/definitions ./FeatureSetReader".split(" "),
function(k,r,p,e,n,m,l){class d extends l.FeatureSetReader{static from(a,b,f){return new d(a,b,f)}constructor(a,b,f){super(f);this._items=a;this._tile=b;this._index=-1;this._cachedGeometry=null;a=b.lod;a.wrap&&(this._wrappingInfo={worldSizeX:a.worldSize[0]})}get _current(){return this._items[this._index]}getItem(){return this._current}getZOrder(){return this._current.zOrder}getMeshWriters(){return this._current.symbolResource?.symbolInfo.meshWriters??[]}hasField(a){return null!=this._current.attributes[a]}field(a){return this.readAttribute(a)}get geometryType(){const a=
p.getJsonType(this._current.geometry);return"esriGeometryPoint"===a?"esriGeometryMultipoint":a}getCursor(){return this.copy()}copy(){const a=new d(this._items,this._tile,this.metadata);this.copyInto(a);return a}copyInto(a){super.copyInto(a);a._cachedGeometry=this._cachedGeometry;a._index=this._index}get fields(){throw Error("Fields reading not supported to graphics.");}get hasFeatures(){return!!this._items.length}get hasNext(){return this._index+1<this._items.length}get exceededTransferLimit(){throw Error("InternalError: exceededTransferLimit not implemented for graphics.");
}get hasZ(){return!1}get hasM(){return!1}get usedMemory(){return this._current.usedMemory}getInTransform(){return this._tile.transform}getSize(){return this._items.length}getAttributeHash(){let a="";for(const b in this._current.attributes)a+=this._current.attributes[b];return a}getObjectId(){return this._items[this._index].objectId}getDisplayId(){return this._current.displayId}setDisplayId(a){throw Error("InternalError: Setting displayId not supported for graphics.");}setIndex(a){this._index=a}getIndex(){return this._index}next(){for(this._cachedGeometry=
null;++this._index<this._items.length&&!this._getExists(););return this._index<this._items.length}readGeometryArea(){throw Error("InternalError: readGeometryArea not supported for graphics.");}_readGeometry(){if(!this._cachedGeometry){let a=e.convertFromGeometry(this._current.projectedGeometry,this.hasZ,this.hasM);"esriGeometryPolyline"===this.geometryType&&(a=e.generalizeOptimizedGeometry(new n,a,this.hasZ,this.hasM,this.geometryType,this._tile.transform.scale[0]));this._cachedGeometry=e.quantizeOptimizedGeometry(new n,
a,this.hasZ,this.hasM,this.geometryType,this._tile.transform);if(!this._cachedGeometry)return null;this._wrapGeometry(this._cachedGeometry)}return this._cachedGeometry}_wrapGeometry(a){if(this._wrappingInfo){var {worldSizeX:b}=this._wrappingInfo;if(a.isPoint)1===b?(a.coords.push(m.tileSize,0),a.coords.push(-1024,0),a.lengths.push(3)):2===b?(a.coords.push(2*m.tileSize,0),a.coords.push(-2048,0),a.lengths.push(3)):this._wrapVertex(a.coords,0,2,b);else if("esriGeometryMultipoint"===this.geometryType)if(1===
b){b=a.coords.slice();b[0]-=512;const f=a.coords.slice();f[0]+=512;a.coords.push(...b,...f);b=a.lengths[0];a.lengths.push(b,b)}else this._wrapVertex(a.coords,0,2,b)}}_wrapVertex(a,b,f,g){b*=f;f=a[b];f<-(m.tileSize*(g-2))?a[b]=f+m.tileSize*g:f>m.tileSize*(g-1)&&(a[b]=f-m.tileSize*g)}_readX(){const a=this._readGeometry();return null!=a?a.coords[0]:0}_readY(){const a=this._readGeometry();return null!=a?a.coords[1]:0}_readServerCentroid(){switch(this.geometryType){case "esriGeometryPolygon":var a=r.polygonCentroid(this._current.projectedGeometry);
a=new n([],a);return e.quantizeOptimizedGeometry(new n,a,this.hasZ,this.hasM,this.geometryType,this._tile.transform);case "esriGeometryPolyline":return a=r.ringsCentroid(this._current.projectedGeometry.paths,this.hasZ),a=new n([],a),e.quantizeOptimizedGeometry(new n,a,this.hasZ,this.hasM,this.geometryType,this._tile.transform)}return null}_readAttribute(a,b){b=this._current.attributes[a];if(void 0!==b)return b;a=a.toLowerCase();for(const f in this._current.attributes)if(f.toLowerCase()===a)return this._current.attributes[f]}_readAttributes(){return this._current.attributes}}
k.GraphicsReader=d;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/graphics/GraphicStore":function(){define("../../../../core/has ../../../../core/screenUtils ../../../../chunks/rbush ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/normalizeUtils ../../../../geometry/support/spatialReferenceUtils ../../../../symbols/cim/CIMSymbolDrawHelper ../../../../symbols/cim/CIMSymbolHelper ../../engine/webgl/definitions ./GraphicStoreItem ./graphicsUtils ./GraphicUpdateMessage".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g){function q(h,u){return u.zOrder-h.zOrder}class c{constructor(h,u,A,z,t){this._items=new Map;this._boundsDirty=!1;this._outSpatialReference=h;this._cimResourceManager=u;this._hittestDrawHelper=new l.HittestDrawHelper(u);this._tileInfoView=A;this._store=t;h=A.getClosestInfoForScale(z);this._resolution=this._tileInfoView.getTileResolution(h.level)}destroy(){this._hittestDrawHelper.destroy()}items(){return this._items.values()}getItem(h){return this._items.get(h)}async update(h,
u,A){const z=[],t=[],w=[],x=new Set,B=[];let C=0;for(const F of h.items){C++;var y=F.uid;h=this._items.get(y);var v=u(F);x.add(y);h?(v=h.update(F,v,C),y=h.updateDensificationResolution(this._resolution),v&&B.push(this._updateItem(h,A)),(v||y)&&t.push(h)):(h=this._store.createDisplayIdForObjectId(y),h=b.GraphicStoreItem.fromGraphic(F,v,C,h),h.updateDensificationResolution(this._resolution),B.push(this._updateItem(h,A)),this._items.set(h.objectId,h),z.push(h))}for(const [F,D]of this._items.entries())x.has(F)||
(this._store.releaseDisplayIdForObjectId(F),this._items.delete(F),w.push(D));await Promise.all(B);this._index=null;return new g.GraphicUpdateMessage(z,t,w)}updateLevel(h){if(this._resolution===h)return!1;this._index=null;this._boundsDirty=!0;this._resolution=h;for(const u of this.items())if(u.hasCurvedGeoemtry)return!0;return!1}hitTest(h,u,A,z,t){var w=(A=k("esri-mobile"))?a.hittestToleranceMobile:a.hittestToleranceDesktop,x=w+(A?0:a.hittestToleranceSmallSymbol);h=n.normalizeMapX(h,this._tileInfoView.spatialReference);
var B=z*window.devicePixelRatio*x;A=e.create();A[0]=h-B;A[1]=u-B;A[2]=h+B;A[3]=u+B;B=z*window.devicePixelRatio*w;w=e.create();w[0]=h-B;w[1]=u-B;w[2]=h+B;w[3]=u+B;x=.5*z*(x+f.pixelBuffer);u=this._searchIndex(h-x,u-x,h+x,u+x);if(!u||0===u.length)return[];h=[];x=e.create();B=e.create();for(var C of u){if(!C.visible)continue;const {geometryBounds:y,symbolResource:v}=C;this._getSymbolBounds(x,v,y,B,t);B[3]=B[2]=B[1]=B[0]=0;e.intersects(x,A)&&h.push(C)}if(0===h.length)return[];C=this._hittestDrawHelper;
A=[];for(const y of h){const {projectedGeometry:v,symbolResource:F}=y;if(!F)continue;const {textInfo:D,symbolInfo:G}=F;C.hitTest(w,G.cimSymbol.symbol,v,D,t,z)&&A.push(y)}A.sort(q);return A.map(y=>y.objectId)}queryItems(h){return 0===this._items.size?[]:this._searchForItems(h)}clear(){this._items.clear();this._index=null}async _updateItem(h,u){await h.projectAndNormalize(this._outSpatialReference);await u(h);({size:u}=h);u[0]=u[1]=u[2]=u[3]=0;this._getSymbolBounds(h.symbolBounds,h.symbolResource,h.geometryBounds,
h.size,0)}_searchIndex(h,u,A,z){this._boundsDirty&&(this._items.forEach(t=>this._getSymbolBounds(t.symbolBounds,t.symbolResource,t.geometryBounds,t.size,0)),this._boundsDirty=!1);this._index||(this._index=p.rbush(9,t=>({minX:t.symbolBounds[0],minY:t.symbolBounds[1],maxX:t.symbolBounds[2],maxY:t.symbolBounds[3]})),this._index.load(Array.from(this._items.values())));return this._index.search({minX:h,minY:u,maxX:A,maxY:z})}_searchForItems(h){var u=this._tileInfoView.spatialReference,A=h.bounds,z=m.getInfo(u);
if(z&&u.isWrappable){const [t,w]=z.valid;u=1E-5>Math.abs(A[2]-w);z=1E-5>Math.abs(A[0]-t);if(!(u&&z||!u&&!z))return h=h.resolution,h=u?e.create([t,A[1],t+h*f.pixelBuffer,A[3]]):e.create([w-h*f.pixelBuffer,A[1],w,A[3]]),A=this._searchIndex(A[0],A[1],A[2],A[3]),h=this._searchIndex(h[0],h[1],h[2],h[3]),[...(new Set([...A,...h]))]}return this._searchIndex(A[0],A[1],A[2],A[3])}_getSymbolBounds(h,u,A,z,t){if(!u||!u.symbolInfo.linearCIM)return null;h||=e.create();e.copy(h,A);if(!z||0===z[0]&&0===z[1]&&0===
z[2]&&0===z[3]){const {textInfo:w,symbolInfo:x}=u;u=x.cimSymbol;z||=[0,0,0,0];t=d.CIMSymbolInflatedSizeHelper.getSymbolInflateSize(z,u.symbol,this._cimResourceManager,t,w);z[0]=r.pt2px(t[0]);z[1]=r.pt2px(t[1]);z[2]=r.pt2px(t[2]);z[3]=r.pt2px(t[3])}t=this._resolution;z=d.CIMSymbolInflatedSizeHelper.safeSize(z);h[0]-=z*t;h[1]-=z*t;h[2]+=z*t;h[3]+=z*t;return h}}return c})},"esri/views/2d/layers/graphics/GraphicStoreItem":function(){define("exports ../../../../core/memoryEstimations ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/boundsUtils ../../../../geometry/support/coordsUtils ../../../../geometry/support/curveUtils ../../../../geometry/support/densifyUtils ../../../../geometry/support/jsonUtils ../../../../geometry/support/normalizeUtilsSync ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/data/projectionSupport ./densificationConstants ./graphicsUtils".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g,q){async function c(u,A,z){await f.checkProjectionSupport(u.spatialReference,z);if(u=a.normalizeCentralMeridianForDisplay(u))return(A=f.project(u,A,z))&&n.closeRingsAndFixWinding(A),d.isExtent(A)?q.polygonFromExtent(A):A}class h{static fromGraphic(u,A,z,t){return new h(u.geometry,A,u.attributes,u.visible,u.uid,u.version,z,t)}constructor(u,A,z,t,w,x,B,C){this.geometry=u;this.symbol=A;this.attributes=z;this.visible=t;this.objectId=w;this._version=x;this.zOrder=B;this.displayId=
C;this.symbolBounds=p.empty();this.prevSymbolBounds=p.empty();this.size=[0,0,0,0];this.geometryBounds=p.empty();this._isDensificationDirty=!1;this._densificationSegmentLength=Infinity}get projectedGeometry(){return this._projectedGeometry}get linearCIM(){return this.symbolResource?.symbolInfo.linearCIM}get usedMemory(){return 128+r.estimateAttributesMemory(this.attributes)+b.estimateGeometryMemory(this.geometry)}get hasAnimations(){const {linearCIM:u}=this;return u?u.some(A=>"animationParams"in A&&
!!A.animationParams):!1}get hasCurvedGeoemtry(){return null!=this.geometry&&"mesh"!==this.geometry.type&&m.isCurvedGeometry(this.geometry)}update(u,A,z){if(this._version===u.version&&this.zOrder===z&&this.symbol===A)return!1;this.prevSymbolBounds=this.symbolBounds;this.symbolBounds=p.empty();this.zOrder=z;this.geometry=u.geometry;this.attributes=u.attributes;this.symbol=A;this.visible=u.visible;this._version=u.version;this._projectedGeometry=this.symbolResource=null;p.empty(this.geometryBounds);this._minDensificationSegmentLength=
null;return!0}updateDensificationResolution(u){if(!this.hasCurvedGeoemtry)return!1;u=Math.max(2**Math.round(Math.log2(u))*g.getPixelsPerSegment(),this._minDensificationSegmentLength??0);if(u===this._densificationSegmentLength)return!1;this._densificationSegmentLength=u;return this._isDensificationDirty=!0}async projectAndNormalize(u){var A=this.geometry;if(A&&A.spatialReference&&"mesh"!==A.type){"extent"===A.type&&(A=q.polygonFromExtent(A));var z=m.isCurvedGeometry(A)?l.densifyCurvedGeometry(A,{maxSegmentLength:Infinity,
minSegmentsPerCurve:g.getCoarseDensificationSegments()}):A.toJSON();this._projectedGeometry=await c(z,A.spatialReference,u);e.getBoundsXY(this.geometryBounds,this._projectedGeometry);this.hasCurvedGeoemtry&&null!=this._projectedGeometry&&(u=p.width(this.geometryBounds),A=p.height(this.geometryBounds),u||A)&&(this._minDensificationSegmentLength=Math.max(u,A)/g.getApproximateMaxDensificationSegments())}}async densifyCurvedGeometryForDisplay(u){if(this.hasCurvedGeoemtry&&this._isDensificationDirty){this._isDensificationDirty=
!1;var A=this.geometry;if(A&&A.spatialReference&&"mesh"!==A.type){var z=l.densifyCurvedGeometry(A,{maxSegmentLength:u.metersPerUnit/A.spatialReference.metersPerUnit*this._densificationSegmentLength,minSegmentsPerCurve:g.getMinDensificationSegments()});this._projectedGeometry=await c(z,A.spatialReference,u)}}}}k.GraphicStoreItem=h;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/curveUtils":function(){define(["exports"],function(k){function r(n){return"b"in n}
function p(n){return"c"in n}function e(n){return"a"in n}k.getCurves=function(n){return"curveRings"in n?n.curveRings:n.curvePaths};k.getEndpoint=function(n){return r(n)?n.b[0]:p(n)?n.c[0]:e(n)?n.a[0]:n};k.isBezierCurve=r;k.isCircularArc=p;k.isCoordinate=function(n){return Array.isArray(n)};k.isCurvedGeometry=function(n){return"curveRings"in n&&!!n.curveRings?.length||"curvePaths"in n&&!!n.curvePaths?.length};k.isEllipticArc=e;k.isEllipticArc4=function(n){return 4===n.a.length};k.isEllipticArc7=function(n){return 7===
n.a.length};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/densifyUtils":function(){define("exports ../../core/mathUtils ../../core/libs/gl-matrix-2/math/mat3 ../../core/libs/gl-matrix-2/factories/mat3f64 ../../core/libs/gl-matrix-2/math/vec2 ./curveUtils".split(" "),function(k,r,p,e,n,m){function l(c,h){c=Math.atan2(c,h);return 0>c?c+2*Math.PI:c}function d(c,h,u,{maxSegmentLength:A,maxSegmentsPerCurve:z,minSegmentsPerCurve:t},w){A*=A;z=1/z;var x=w(0);const B=
w(1);1E-6<n.squaredDistance(h,x)&&c.push(x);h=[1];const C=[B];var y=1/t;for(--t;0<t;t--){var v=t*y;h.push(v);C.push(w(v))}for(t=0;0<h.length;)y=h.pop(),v=C.pop(),n.squaredDistance(x,v)<A||t===y||y-t<z?(c.push(v),t=y,x=v):(h.push(y),C.push(v),y=(t+y)/2,h.push(y),C.push(w(y)));1E-6<n.squaredDistance(u,B)&&c.push([...u]);return c}function a(c,h,u,A){const [z,t,w]=u.b;return d(c,h,z,A,x=>{var B=1-x,C=B*B;const y=x*x,v=C*B;C*=3*x;B*=3*y;x*=y;return[h[0]*v+t[0]*C+w[0]*B+z[0]*x,h[1]*v+t[1]*C+w[1]*B+z[1]*
x]})}function b(c,h,u,A,z,t,w,x,{maxSegmentLength:B,maxSegmentsPerCurve:C,minSegmentsPerCurve:y}){var v=2*t;const F=[A+t*Math.cos(w),z+t*Math.sin(w)],D=[A+t*Math.cos(x),z+t*Math.sin(x)];1E-6<n.squaredDistance(h,F)&&c.push(F);h=x-w;B=Math.min(C,Math.max(y,Math.ceil(Math.abs(h/(B<v?2*Math.asin(B/v):h)))));C=1/B;for(y=1;y<B;y++)v=y*C,v=w*(1-v)+x*v,c.push([A+t*Math.cos(v),z+t*Math.sin(v)]);c.push(D);1E-6<n.squaredDistance(u,D)&&c.push([...u]);return c}function f(c,h,u){const [,,A,z]=u.a;var t=Math.abs(c-
h);u=t>Math.PI;const w=t<Math.PI;t=r.floatEqualAbsolute(t,Math.PI);if(!t&&(u&&A||w&&!A)||t&&(c>h&&z||c<h&&!z))c+=2*(Math.sign(h-c)||1)*Math.PI;return c}function g(c,h,u,A){const [z,t,,,w,x,B]=u.a,[C,y]=h,[v,F]=z,[D,G]=t,E=x*B,H=Math.cos(w),K=Math.sin(w),J=l(1/E*(y-G)*H-1/E*(C-D)*K,1/x*(y-G)*K+1/x*(C-D)*H),L=f(l(1/E*(F-G)*H-1/E*(v-D)*K,1/x*(F-G)*K+1/x*(v-D)*H),J,u);return d(c,h,z,A,P=>{var Q=J*(1-P)+L*P;P=Math.cos(Q);Q=Math.sin(Q);return[x*P*H-E*Q*K+D,x*P*K+E*Q*H+G]})}const q=e.create();k.densifyCurvedGeometry=
function(c,h){if(!m.isCurvedGeometry(c))return c;var u=m.getCurves(c);const A=[];for(const v of u){u=[];for(let F=0,D=1;D<v.length;F=D++){var z=m.getEndpoint(v[F]);0===F&&u.push(z);var t=u,w=v[D],x={maxSegmentLength:h.maxSegmentLength??Infinity,maxSegmentsPerCurve:h.maxSegmentsPerCurve??12E3,minSegmentsPerCurve:Math.max(h.minSegmentsPerCurve??1,1)};if(m.isBezierCurve(w))a(t,z,w,x);else if(m.isCircularArc(w))b:{const [G,E]=w.c;{w=[];const [X,aa]=z,[ba,fa]=E,[I,M]=G;var B=X*X+aa*aa;const N=ba*ba+fa*
fa,R=I*I+M*M;p.set(q,X,ba,I,aa,fa,M,1,1,1);var C=p.determinant(q);if(0===C)w=null;else{p.set(q,B,N,R,aa,fa,M,1,1,1);var y=p.determinant(q);p.set(q,B,N,R,X,ba,I,1,1,1);B=p.determinant(q);w[0]=y/C*.5;w[1]=B/C*-.5}}if(null==w){t.push([...G]);break b}const [H,K]=z,[J,L]=E,[P,Q]=G,[S,U]=w;w=H-S;C=K-U;w=Math.sqrt(w*w+C*C);C=l(K-U,H-S);y=l(L-U,J-S);B=l(Q-U,P-S);0>(y-C)*(B-y)&&(B+=2*Math.sign(C-B)*Math.PI);b(t,z,G,S,U,w,C,B,x)}else if(m.isEllipticArc(w))if(m.isEllipticArc4(w)){const [G,E]=w.a,[H,K]=z,[J,
L]=G,[P,Q]=E;C=H-P;y=K-Q;C=Math.sqrt(C*C+y*y);y=l(K-Q,H-P);w=f(l(L-Q,J-P),y,w);b(t,z,G,P,Q,C,y,w,x)}else g(t,z,w,x);else m.isCoordinate(w)&&t.push([...w])}A.push(u)}return"curvePaths"in c?{paths:A,spatialReference:c.spatialReference}:{rings:A,spatialReference:c.spatialReference}};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/normalizeUtilsSync":function(){define("exports ../../core/JSONSupport ./aaBoundingRect ./boundsUtils ./coordsUtils ./jsonUtils ./normalizeUtilsCommon ./spatialReferenceUtils".split(" "),
function(k,r,p,e,n,m,l,d){function a(x,B){if(null==x)return null;var C=x.spatialReference,y=d.getInfo(C);x=r.isSerializable(x)?x.toJSON():x;if(!y)return x;C=d.isWebMercator(C)?102100:4326;const v=l.cutParams[C].maxX,F=l.cutParams[C].minX;if(m.isPoint(x))return f(x,v,F);if(m.isMultipoint(x))x.points=x.points.map(D=>f(D,v,F));else{if(m.isExtent(x))return b(x,y);if(m.isPolygon(x)||m.isPolyline(x)){C=e.getBoundsXY(t,x);y=C[0];C=C[2];const D=2*l.offsetMagnitude(y,F)*v;x=0===D?x:l.updatePolyGeometry(x,
D);y+=D;C+=D;return C>v?u(x,v,B):y<F?u(x,F,B):x}}return x}function b(x,B){if(!B)return x;const C=g(x,B).map(y=>y.extent);return 2>C.length?C[0]||x:2<C.length?(x.xmin=B.valid[0],x.xmax=B.valid[1],x):{rings:C.map(y=>[[y.xmin,y.ymin],[y.xmin,y.ymax],[y.xmax,y.ymax],[y.xmax,y.ymin],[y.xmin,y.ymin]])}}function f(x,B,C){if(Array.isArray(x)){var y=x[0];y>B?(C=l.offsetMagnitude(y,B),x[0]=y+-2*C*B):y<C&&(B=l.offsetMagnitude(y,C),x[0]=y+-2*B*C)}else y=x.x,y>B?(C=l.offsetMagnitude(y,B),x.x+=-2*C*B):y<C&&(B=
l.offsetMagnitude(y,C),x.x+=-2*B*C);return x}function g(x,B){const C=[],{ymin:y,ymax:v,xmin:F,xmax:D}=x;var G=x.xmax-x.xmin;const [E,H]=B.valid,{x:K,frameId:J}=q(x.xmin,B),{x:L,frameId:P}=q(x.xmax,B);x=K===L&&0<G;if(G>2*H){G={xmin:F<D?K:L,ymin:y,xmax:H,ymax:v};x={xmin:E,ymin:y,xmax:F<D?L:K,ymax:v};B={xmin:0,ymin:y,xmax:H,ymax:v};const Q={xmin:E,ymin:y,xmax:0,ymax:v},S=[],U=[];c(G,B)&&S.push(J);c(G,Q)&&U.push(J);c(x,B)&&S.push(P);c(x,Q)&&U.push(P);for(let X=J+1;X<P;X++)S.push(X),U.push(X);C.push(new z(G,
[J]),new z(x,[P]),new z(B,S),new z(Q,U))}else K>L||x?C.push(new z({xmin:K,ymin:y,xmax:H,ymax:v},[J]),new z({xmin:E,ymin:y,xmax:L,ymax:v},[P])):C.push(new z({xmin:K,ymin:y,xmax:L,ymax:v},[J]));return C}function q(x,B){const [C,y]=B.valid;B=2*y;var v=0;x>y?(v=Math.ceil(Math.abs(x-y)/B),x-=v*B):x<C&&(v=Math.ceil(Math.abs(x-C)/B),x+=v*B,v=-v);return{x,frameId:v}}function c(x,B){const {xmin:C,ymin:y,xmax:v,ymax:F}=B;return h(x,C,y)&&h(x,C,F)&&h(x,v,F)&&h(x,v,y)}function h(x,B,C){return B>=x.xmin&&B<=x.xmax&&
C>=x.ymin&&C<=x.ymax?!0:!1}function u(x,B,C=!0){const y=!m.isPolyline(x);y&&n.closeRings(x);if(C)return(new w).cut(x,B);C=y?x.rings:x.paths;const v=y?4:2,F=C.length;B*=-2;for(let D=0;D<F;D++){const G=C[D];if(G&&G.length>=v){const E=[];for(const H of G)E.push([H[0]+B,H[1]]);C.push(E)}}y?x.rings=C:x.paths=C;return x}function A(x,B,C){const y=x.length;1<y&&x[y-1][0]===B&&x[y-2][0]===B?x[y-1][1]=C:x.push([B,C])}class z{constructor(x,B){this.extent=x;this.frameIds=B}}const t=p.create();class w{constructor(){this._linesIn=
[];this._linesOut=[]}cut(x,B){this._xCut=B;if(x.rings)this._closed=!0,B=x.rings,this._minPts=4;else if(x.paths)this._closed=!1,B=x.paths,this._minPts=2;else return null;for(var C of B)if(C&&!(C.length<this._minPts)){B=!0;for(const y of C)B?(this.moveTo(y),B=!1):this.lineTo(y);this._closed&&this.close()}this._pushLineIn();this._pushLineOut();B=[];for(const y of this._linesIn)y&&y.length>=this._minPts&&B.push(y);C=-2*this._xCut;for(const y of this._linesOut)if(y&&y.length>=this._minPts){for(const v of y)v[0]+=
C;B.push(y)}this._closed?x.rings=B:x.paths=B;return x}moveTo(x){this._pushLineIn();this._pushLineOut();this._prevSide=this._side(x[0]);this._moveTo(x[0],x[1],this._prevSide);this._firstPt=this._prevPt=x}lineTo(x){const B=this._side(x[0]);if(-1===B*this._prevSide){const C=this._intersect(this._prevPt,x);this._lineTo(this._xCut,C,0);this._prevSide=0}this._lineTo(x[0],x[1],B);this._prevSide=B;this._prevPt=x}close(){const x=this._firstPt,B=this._prevPt;x[0]===B[0]&&x[1]===B[1]||this.lineTo(x);this._checkClosingPt(this._lineIn);
this._checkClosingPt(this._lineOut)}_moveTo(x,B,C){this._closed?(this._lineIn.push([0>=C?x:this._xCut,B]),this._lineOut.push([0<=C?x:this._xCut,B])):(0>=C&&this._lineIn.push([x,B]),0<=C&&this._lineOut.push([x,B]))}_lineTo(x,B,C){this._closed?(A(this._lineIn,0>=C?x:this._xCut,B),A(this._lineOut,0<=C?x:this._xCut,B)):0>C?(0===this._prevSide&&this._pushLineOut(),this._lineIn.push([x,B])):0<C?(0===this._prevSide&&this._pushLineIn(),this._lineOut.push([x,B])):0>this._prevSide?(this._lineIn.push([x,B]),
this._lineOut.push([x,B])):0<this._prevSide&&(this._lineOut.push([x,B]),this._lineIn.push([x,B]))}_checkClosingPt(x){const B=x.length;3<B&&x[0][0]===this._xCut&&x[B-2][0]===this._xCut&&x[1][0]===this._xCut&&(x[0][1]=x[B-2][1],x.pop())}_side(x){return x<this._xCut?-1:x>this._xCut?1:0}_intersect(x,B){return x[1]+(this._xCut-x[0])/(B[0]-x[0])*(B[1]-x[1])}_pushLineIn(){this._lineIn&&this._lineIn.length>=this._minPts&&this._linesIn.push(this._lineIn);this._lineIn=[]}_pushLineOut(){this._lineOut&&this._lineOut.length>=
this._minPts&&this._linesOut.push(this._lineOut);this._lineOut=[]}}k.CutVertical=w;k.normalizeCentralMeridianForDisplay=function(x){return a(x,!1)};k.normalizeCentralMeridianSync=function(x){return a(x,!0)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedFeatures":function(){define("exports ../../core/has ../../core/memoryEstimations ../../core/uid ../../geometry/SpatialReference ../../geometry/support/aaBoundingBox ../../geometry/support/aaBoundingRect ../../geometry/support/quantizationUtils ../../geometry/support/typeUtils ../support/Field ../../views/2d/layers/graphics/densificationConstants ./dehydratedFeatureComparison".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g){function q(w,x,B,C){return{uid:e.generateUID(),objectId:C&&w.attributes?w.attributes[C]:null,attributes:w.attributes,geometry:c(w.geometry,x,B),visible:!0}}function c(w,x,B){if(null==w)return null;switch(x){case "point":return{x:w.x,y:w.y,z:w.z,m:w.m,hasZ:null!=w.z,hasM:null!=w.m,type:"point",spatialReference:B};case "polyline":return{paths:w.paths,hasZ:!!w.hasZ,hasM:!!w.hasM,type:"polyline",spatialReference:B};case "polygon":return{rings:w.rings,hasZ:!!w.hasZ,hasM:!!w.hasM,
type:"polygon",spatialReference:B};case "multipoint":return{points:w.points,hasZ:!!w.hasZ,hasM:!!w.hasM,type:"multipoint",spatialReference:B}}}function h(w){if(null==w)return 0;switch(w.type){case "point":return p.baseObjectMemory+10+8+24;case "polyline":case "polygon":var x=0;x=2+(w.hasZ?1:0)+(w.hasM?1:0);const B="polyline"===w.type?w.paths:w.rings;("polyline"===w.type?w.curvePaths:w.curveRings)?.length?(w=384*f.getApproximateMaxDensificationSegments(),x=8*w*x+128*w+32*(B.length+1)):x=p.estimateNestedObjectMemory(B);
return p.baseObjectMemory+64+x+34;case "multipoint":return w=p.estimateNestedObjectMemory(w.points),p.baseObjectMemory+w+64+34+32;case "extent":return p.baseObjectMemory+10+64+34;case "mesh":return w=w.vertexAttributes,p.baseObjectMemory+p.estimateNumberArrayMemory(w.position,w.normal,w.uv,w.tangent);default:return p.baseObjectMemory}}function u(w,x){return null!=w.objectId?w.objectId:w.attributes&&x?w.attributes[x]:null}function A(w,x,B,C){if(x?.size&&null!=B&&w)for(const y in w){if(!x.has(y))continue;
const v=w[y];"string"===typeof v&&v.length>B&&(C(y),w[y]="")}}class z{constructor(w,x,B){this.uid=w;this.geometry=x;this.attributes=B;this.visible=!0;this.centroid=this.objectId=null}}class t{constructor(){this.exceededTransferLimit=!1;this.features=[];this.fields=[];this.hasZ=this.hasM=!1;this.transform=this.spatialReference=this.geohashFieldName=this.geometryProperties=this.globalIdFieldName=this.objectIdFieldName=this.geometryType=null}}k.equals=g.equals;k.DehydratedFeatureClass=z;k.DehydratedFeatureSetClass=
t;k.computeAABB=function(w,x){m.empty(x);"mesh"===w.type&&(w=w.extent);switch(w.type){case "point":x[0]=x[3]=w.x;x[1]=x[4]=w.y;w.hasZ&&(x[2]=x[5]=w.z);break;case "polyline":for(var B=0;B<w.paths.length;B++)m.expandWithNestedArray(x,w.paths[B],!!w.hasZ);break;case "polygon":for(B=0;B<w.rings.length;B++)m.expandWithNestedArray(x,w.rings[B],!!w.hasZ);break;case "multipoint":m.expandWithNestedArray(x,w.points,!!w.hasZ);break;case "extent":x[0]=w.xmin,x[1]=w.ymin,x[3]=w.xmax,x[4]=w.ymax,null!=w.zmin&&
(x[2]=w.zmin),null!=w.zmax&&(x[5]=w.zmax)}};k.computeAABR=function(w,x){l.empty(x);"mesh"===w.type&&(w=w.extent);switch(w.type){case "point":x[0]=x[2]=w.x;x[1]=x[3]=w.y;break;case "polyline":for(var B=0;B<w.paths.length;B++)l.expandWithNestedArray(x,w.paths[B]);break;case "polygon":for(B=0;B<w.rings.length;B++)l.expandWithNestedArray(x,w.rings[B]);break;case "multipoint":l.expandWithNestedArray(x,w.points);break;case "extent":x[0]=w.xmin,x[1]=w.ymin,x[2]=w.xmax,x[3]=w.ymax}};k.estimateGeometryMemory=
h;k.estimateSize=function(w){let x;x=32+p.estimateAttributesMemory(w.attributes);return x=x+3+(8+h(w.geometry))};k.fromFeatureSetJSON=function(w,x){const B=a.featureGeometryTypeKebabDictionary.fromJSON(w.geometryType),C=n.fromJSON(w.spatialReference),y=w.transform,v=w.objectIdFieldName,F=x?.maxStringAttributeLength,D=x?.maxStringAttributeFields;let G;x=w.features.map(E=>{const H=q(E,B,C,w.objectIdFieldName);E=H.geometry;A(H.attributes,D,F,K=>{G??=[];const J=u(H,v);null!=J&&G.push({objectId:J,attribute:K})});
if(null!=E&&y)switch(E.type){case "point":H.geometry=d.unquantizePoint(y,E,E);break;case "multipoint":H.geometry=d.unquantizeMultipoint(y,E,E);break;case "polygon":H.geometry=d.unquantizePolygon(y,E,E);break;case "polyline":H.geometry=d.unquantizePolyline(y,E,E);break;case "extent":H.geometry=E;break;case "mesh":H.geometry=E}return H});return{geometryType:B,features:x,spatialReference:C,fields:w.fields?.map(E=>b.fromJSON(E))??[],objectIdFieldName:w.objectIdFieldName,globalIdFieldName:w.globalIdFieldName,
geohashFieldName:w.geohashFieldName,geometryProperties:w.geometryProperties,hasZ:w.hasZ,hasM:w.hasM,exceededTransferLimit:w.exceededTransferLimit,transform:null,missingAttributes:G}};k.fromJSONGeometry=c;k.getObjectId=u;k.hasGeometry=function(w){return null!=w.geometry};k.hasVertices=function(w){if(null==w)return!1;switch(w.type){case "extent":case "point":return!0;case "polyline":for(const x of w.paths)if(0<x.length)return!0;return!1;case "polygon":for(const x of w.rings)if(0<x.length)return!0;return!1;
case "multipoint":return 0<w.points.length;case "mesh":return!w.loaded||0<w.vertexAttributes.position.length}};k.numVertices=function(w){if(null==w)return 0;switch(w.type){case "point":return 1;case "polyline":var x=0;for(var B of w.paths)x+=B.length;return x;case "polygon":B=0;for(x of w.rings)B+=x.length;return B;case "multipoint":return w.points.length;case "extent":return 2;case "mesh":return(w=w.vertexAttributes&&w.vertexAttributes.position)?w.length/3:0}};k.removeLargeStringAttributes=A;Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/graphics/densificationConstants":function(){define(["exports","../../../../core/has"],function(k,r){k.getApproximateMaxDensificationSegments=function(){return r("curve-densification-max-segments")};k.getCoarseDensificationSegments=function(){return r("curve-densification-coarse-segments")};k.getMinDensificationSegments=function(){return r("curve-densification-min-segments")};k.getPixelsPerSegment=function(){return r("curve-densification-pixels-per-segment")};
Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedFeatureComparison":function(){define(["exports","../../core/has","../../core/mathUtils","../../geometry/support/spatialReferenceUtils"],function(k,r,p,e){function n(b,f){if(b===f)return!0;if(null==b||null==f||b.length!==f.length)return!1;for(let g=0;g<b.length;g++){const q=b[g],c=f[g];if(q.length!==c.length)return!1;for(let h=0;h<q.length;h++)if(q[h]!==c[h])return!1}return!0}function m(b,f){if(b===f)return!0;
if(null==b||null==f||b.length!==f.length)return!1;for(let g=0;g<b.length;g++)if(!n(b[g],f[g]))return!1;return!0}function l(b,f){return b===f||null!=b&&null!=f&&e.equals(b.spatialReference,f.spatialReference)&&b.x===f.x&&b.y===f.y&&b.z===f.z&&b.m===f.m}function d(b,f){if(b===f)return!0;if(null==b||null==f||b.type!==f.type)return!1;switch(b.type){case "point":return l(b,f);case "extent":return b=b.hasZ!==f.hasZ||b.hasM!==f.hasM?!1:e.equals(b.spatialReference,f.spatialReference)?b.xmin===f.xmin&&b.ymin===
f.ymin&&b.zmin===f.zmin&&b.xmax===f.xmax&&b.ymax===f.ymax&&b.zmax===f.zmax:!1,b;case "polyline":return b=b.hasZ!==f.hasZ||b.hasM!==f.hasM?!1:e.equals(b.spatialReference,f.spatialReference)?m(b.paths,f.paths):!1,b;case "polygon":return b=b.hasZ!==f.hasZ||b.hasM!==f.hasM?!1:e.equals(b.spatialReference,f.spatialReference)?m(b.rings,f.rings):!1,b;case "multipoint":return b=b.hasZ!==f.hasZ||b.hasM!==f.hasM?!1:e.equals(b.spatialReference,f.spatialReference)?n(b.points,f.points):!1,b;case "mesh":return!1}}
function a(b,f){if(b===f)return!0;if(!b||!f)return!1;const g=Object.keys(b),q=Object.keys(f);if(g.length!==q.length)return!1;for(const c of g)if(b[c]!==f[c])return!1;return!0}k.equals=function(b,f){return b===f?!0:null!=b&&null!=f&&b.objectId===f.objectId&&d(b.geometry,f.geometry)&&a(b.attributes,f.attributes)?!0:!1};k.pointEquals=l;k.pointNear=function(b,f,g){return b===f||null!=b&&null!=f&&e.equals(b.spatialReference,f.spatialReference)&&p.floatEqualAbsolute(b.x,f.x,g)&&p.floatEqualAbsolute(b.y,
f.y,g)&&p.floatEqualAbsolute(b.z??0,f.z??0,g)&&p.floatEqualAbsolute(b.m??0,f.m??0,g)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/graphics/GraphicUpdateMessage":function(){define(["exports"],function(k){class r{constructor(p,e,n){this.added=p;this.updated=e;this.removed=n}hasAnyUpdate(){return!!(this.added.length||this.updated.length||this.removed.length)}}k.GraphicUpdateMessage=r;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/FeatureCommandQueue":function(){define(["exports",
"../../../../core/promiseUtils","../../../../core/QueueProcessor","./UpdateTracking2D"],function(k,r,p,e){class n{constructor(){this.type="override-batch";this.messages=[];this._resovler=r.createResolver()}get promise(){return this._resovler.promise}resolve(){this._resovler.resolve()}add(l){this.messages.push(l)}}class m{constructor(l){this.updateTracking=new e.UpdateTracking2D({debugName:"FeatureCommandQueue"});this.process=l.process;this._queueProcessor=new p.QueueProcessor({concurrency:1,process:async d=>
{if("override-batch"===d.type){d=this._nextOverrideBatch;if(null==d)throw Error("InternalError: Override should be defined");this._nextOverrideBatch=null;await this.process(d);d.resolve()}else return this.process(d)}})}destroy(){this.updateTracking.destroy();this._queueProcessor.destroy();this.clear()}clear(){this._queueProcessor.clear()}async push(l){return r.ignoreAbortErrors(this.updateTracking.addPromise(this._doPush(l)))}async _doPush(l){const d=this._queueProcessor,a=d.last();switch(l.type){case "update":case "highlight":if(a?.type===
l.type)break;return d.push(l);case "override":case "edit":return this._pushOverride(l)}}_pushOverride(l){null==this._nextOverrideBatch&&(this._nextOverrideBatch=new n,this._queueProcessor.push(this._nextOverrideBatch));this._nextOverrideBatch.add(l);return this._nextOverrideBatch.promise}}k.FeatureCommandQueue=m;k.OverrideBatch=n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/UpdateTracking2D":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/ReactiveMap ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/support/UpdatingHandles".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f){k.UpdateTracking2D=class extends p{constructor(g){super(g);this.debugName="";this._updatingHandles=new f.UpdatingHandles;this._idToUpdatingState=new n}get updating(){const g=this._updatingHandles.updating||Array.from(this._idToUpdatingState.values()).some(q=>q);if(e("esri-2d-log-updating")){const q=Array.from(this._idToUpdatingState.entries()).map(([c,h])=>`-> ${c}: ${h}`).join("\n");console.log(`${this.debugName}: Updating: ${g}\n-> Handles: ${this._updatingHandles.updating}\n${q}`)}return g}addUpdateTracking(g,
q){const c=m.watch(()=>q.updating,h=>this._idToUpdatingState.set(g,h),{sync:!0});this.addHandles(c)}addPromise(g){return this._updatingHandles.addPromise(g)}};r.__decorate([l.property({constructOnly:!0})],k.UpdateTracking2D.prototype,"debugName",void 0);r.__decorate([l.property({readOnly:!0})],k.UpdateTracking2D.prototype,"updating",null);k.UpdateTracking2D=r.__decorate([b.subclass("esri.views.2d.layers.support.UpdateTracking2D")],k.UpdateTracking2D);Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/layers/graphics/GraphicContainer":function(){define(["../../engine/webgl/enums","./AGraphicContainer","../support/util"],function(k,r,p){class e extends r.AGraphicContainer{renderChildren(n){for(const m of this.children)m.setTransform(n.state);super.renderChildren(n);this._updateAttributeView();if(this.children.some(m=>m.hasData)){switch(n.drawPhase){case k.WGLDrawPhase.MAP:this._renderChildren(n,k.FeatureSelection.All);break;case k.WGLDrawPhase.HIGHLIGHT:this.hasHighlight&&this._renderHighlight(n)}this._boundsRenderer&&
this._boundsRenderer.doRender(n)}}_renderHighlight(n){p.renderHighlight(n,!1,m=>{this._renderChildren(m,k.FeatureSelection.Highlight)})}}return e})},"esri/views/2d/layers/graphics/AGraphicContainer":function(){define("exports ../../../../core/maybe ../../engine/AFeatureContainer ../../engine/webgl/enums ../../engine/webgl/shaderGraph/techniques/GraphicInstanceStore ./GraphicBoundsRenderer".split(" "),function(k,r,p,e,n,m){class l extends p.AFeatureContainer{constructor(d){super(d);this._instanceStore=
new n.GraphicInstanceStore;this.checkHighlight=()=>!0}destroy(){super.destroy();this._boundsRenderer=r.destroyMaybe(this._boundsRenderer)}get instanceStore(){return this._instanceStore}enableRenderingBounds(d){this._boundsRenderer=new m(d);this.requestRender()}get hasHighlight(){return this.checkHighlight()}onTileData(d,a){d.onMessage(a);this.contains(d)||this.addChild(d);this.requestRender()}_renderChildren(d,a){d.selection=a;for(const b of this.children)b.visible&&b.getDisplayList(this._instanceStore,
e.FeatureBatchingStrategy.STRICT_ORDER)?.render(d)}}k.AGraphicContainer=l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/AFeatureContainer":function(){define(["exports","./webgl/AttributeStoreView","./webgl/definitions","./webgl/TileContainer"],function(k,r,p,e){class n extends e{constructor(m){super(m);this._statisticsByLevel=new Map;this._entityIndex=new Map;this.attributeView=new r.AttributeStoreView}destroy(){this.children.forEach(m=>m.destroy());this.removeAllChildren();
this.attributeView.destroy()}doRender(m){m.context.capabilities.enable("textureFloatLinear");super.doRender(m)}get hasAnimations(){for(const m of this.children)if(m.hasAnimations)return!0;return!1}_reindexAndUpdateFeaturesIfNeeded(){if(this.hasAnimations&&(this._reindexFeatures(),0!==this.attributeView.size))for(const m of this._entityIndex.values())m.dirty&&(this.attributeView.setData(m.displayId,p.AttributeDataType.LocalTimeOrigin,0,m.firstIndexed),m.dirty=!1)}restartAnimation(m){if(m=this._entityIndex.get(m)){var l=
performance.now()/1E3;m.firstIndexed=l;m.dirty=!0}}restartAllAnimations(){const m=performance.now()/1E3;for(const [,l]of this._entityIndex)l.firstIndexed=m,l.dirty=!0}_reindexFeatures(){const m=performance.now()/1E3;for(const l of this.children)for(const d of l.entityIds){const {objectId:a}=d;let b=this._entityIndex.get(a);b||(b={objectId:a,displayId:0,firstIndexed:m,lastIndexed:0,dirty:!0},this._entityIndex.set(a,b));b.lastIndexed=m;b.displayId=d.displayId}for(const [l,d]of this._entityIndex)60<
m-d.lastIndexed&&this._entityIndex.delete(l)}_updateAttributeView(){this.attributeView.update();this._reindexAndUpdateFeaturesIfNeeded()}createRenderParams(m){m=super.createRenderParams(m);m.attributeView=this.attributeView;m.instanceStore=this._instanceStore;m.statisticsByLevel=this._statisticsByLevel;return m}}k.AFeatureContainer=n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/AttributeStoreView":function(){define("exports ../../../../core/Error ../../../../core/has ../../../../core/Logger ./definitions ./DisplayId ./Utils ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f){class g{constructor(c,h,u){this._lastTexture=this._texture=null;this._fbos={};this.texelSize=4;const {buffer:A,pixelType:z,textureOnly:t}=c;c=l.getPixelArrayCtor(z);this.blockIndex=u;this.pixelType=z;this.size=h;this.textureOnly=t;t||(this.data=new c(A));this._resetRange()}destroy(){this._texture?.dispose();for(const c in this._fbos){const h=this._fbos[c];h&&("0"===c&&h.detachColorTexture(),h.dispose());this._fbos[c]=null}this._texture=null}get _textureDesc(){const c=
new f.TextureDescriptor;c.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;c.samplingMode=d.TextureSamplingMode.NEAREST;c.dataType=this.pixelType;c.width=this.size;c.height=this.size;return c}setData(c,h,u){c=m.getDisplayIdTexel(c);const A=this.data;h=c*this.texelSize+h;!A||h>=A.length||(A[h]=u,this.dirtyStart=Math.min(this.dirtyStart,c),this.dirtyEnd=Math.max(this.dirtyEnd,c))}getData(c,h){if(null==this.data)return null;c=m.getDisplayIdTexel(c)*this.texelSize+h;return!this.data||c>=this.data.length?null:
this.data[c]}getTexture(c){return this._texture??this._initTexture(c)}getFBO(c,h=0){if(!this._fbos[h]){const u=0===h?this.getTexture(c):this._textureDesc;this._fbos[h]=new a.FramebufferObject(c,u)}return this._fbos[h]}get hasDirty(){return this.dirtyEnd>=this.dirtyStart}updateTexture(c,h){try{const v=this.dirtyStart,F=this.dirtyEnd;if(this.hasDirty){p("esri-2d-update-debug")&&console.debug(`Version[${h}] AttributeStoreView.updateTexture`,{start:v,end:F,firstBytes:new Uint8Array(this.data.buffer.slice(0,
16)),block:this});this._resetRange();var u=this.data.buffer,A=this.getTexture(c),z=(v-v%this.size)/this.size,t=(F-F%this.size)/this.size,w=z*this.size*4,x=4*(this.size+t*this.size)-w,B=l.getPixelArrayCtor(this.pixelType),C=new B(u,w*B.BYTES_PER_ELEMENT,x),y=this.size;c=t-z+1;c>this.size?e.getLogger("esri.views.2d.engine.webgl.AttributeStoreView").error(new r("mapview-webgl","Out-of-bounds index when updating AttributeData")):A.updateData(0,0,z,y,c,C)}}catch(v){}}update(c){const {data:h,start:u,end:A}=
c;if(null!=h&&null!=this.data){const z=this.data,t=u*this.texelSize;for(let w=0;w<h.length;w++)c.layout&1<<w%this.texelSize&&(z[t+w]=h[w])}this.dirtyStart=Math.min(this.dirtyStart,u);this.dirtyEnd=Math.max(this.dirtyEnd,A)}resize(c,h){const u=this.size;this.size=h;this.textureOnly?u!==this.size&&(this._lastTexture=this._texture,this._texture=null):(h=l.getPixelArrayCtor(this.pixelType),this.destroy(),this.data=new h(c.buffer))}_resetRange(){this.dirtyStart=2147483647;this.dirtyEnd=0}_initTexture(c){const h=
new b.Texture(c,this._textureDesc,this.data??void 0);if(null!=this._lastTexture&&this._fbos[0]){const z=this._lastTexture.descriptor.width,t=this._lastTexture.descriptor.height,w=this._lastTexture.descriptor.dataType,x=this._lastTexture.descriptor.pixelFormat,B=this.getFBO(c);var u=l.getPixelBytes(w),A=l.getPixelArrayCtor(w);u=new ArrayBuffer(z*t*u*this.texelSize);A=new A(u);u=c.getBoundFramebufferObject();const {x:C,y,width:v,height:F}=c.getViewport();c.bindFramebuffer(B);B.readPixels(0,0,z,t,x,
w,A);h.updateData(0,0,0,2*z,t/2,A);c.setViewport(C,y,v,F);c.bindFramebuffer(u)}this.destroy();return this._texture=h}}class q{constructor(){this.size=0;this._pendingAttributeUpdates=[];this._epoch=this._version=0;this._locked=!1}get locked(){return this._locked}_initialize(c){if(!c)throw Error("InternalError: initArgs must be defined");const h=c.blockDescriptors;this.size=c.blockSize;p("esri-2d-update-debug")&&console.debug("AttributeStoreView.initialize",{message:c});if(null==this._data)this._data=
h.map((u,A)=>null!=u?new g(u,this.size,A):null);else for(c=0;c<this._data.length;c++){const u=this._data[c],A=h[c];null!=A&&(null==u?this._data[c]=new g(A,this.size,c):u.resize(A,this.size))}}destroy(){for(const c of this._data??[])c?.destroy();this._defaultTexture?.dispose();this._defaultTexture=null;this._pendingAttributeUpdates=[]}isEmpty(){return null==this._data}getBlock(c){return null==this._data?null:this._data[c]}setLabelMinZoom(c,h){this.setData(c,n.AttributeDataType.FilterFlags,1,h)}setLocalTimeOrigin(c,
h){this.setData(c,n.AttributeDataType.LocalTimeOrigin,0,h)}getLabelMinZoom(c){return this.getData(c,n.AttributeDataType.FilterFlags,1,255)}getFilterFlags(c){return this.getData(c,n.AttributeDataType.FilterFlags,0,0)}getVisualVariableData(c,h){return this.getData(c,n.AttributeDataType.VV,h,0)}getData(c,h,u,A){if(!this._data)return 0;h=this._data[h];if(null==h)return 0;c=h.getData(c,u);return null!=c?c:A}setData(c,h,u,A){this._data[h].setData(c,u,A)}lockTextureUploads(){this._locked=!0}unlockTextureUploads(){this._locked=
!1;this.update()}requestUpdate(c){this._version=c.version;this._pendingAttributeUpdates.push(c);p("esri-2d-update-debug")&&console.debug(`Version[${this._version}] AttributeStoreView.requestUpdate`,{message:c})}get currentEpoch(){return this._epoch}update(){if(!this._locked){var c=this._pendingAttributeUpdates;this._pendingAttributeUpdates=[];for(const h of c){const {blockData:u,initArgs:A,sendUpdateEpoch:z,version:t}=h;p("esri-2d-update-debug")&&console.debug(`Version[${this._version}] Epoch[${z}] AttributeStoreView.applyUpdate`);
this._version=t;this._epoch=z;null!=A&&this._initialize(A);c=this._data;for(let w=0;w<u.length;w++){const x=u[w],B=c[w];null!=B&&null!=x&&(p("esri-2d-update-debug")&&console.debug(`Version[${this._version}] CpuBlock[${w}] AttributeStoreView.update`,{block:x}),B.update(x))}}}}getUniforms(c){return{filterFlags:{texture:this._getTexture(c,n.AttributeDataType.FilterFlags),unit:n.filterFlagsUnit},animation:{texture:this._getTexture(c,n.AttributeDataType.Animation),unit:n.animationUnit},gpgpu:{texture:this._getTexture(c,
n.AttributeDataType.GPGPU),unit:n.gpgpuUnit},localTimeOrigin:{texture:this._getTexture(c,n.AttributeDataType.LocalTimeOrigin),unit:n.localTimeOriginUnit},visualVariableData:{texture:this._getTexture(c,n.AttributeDataType.VV),unit:n.visualVariableUnit},dataDriven0:{texture:this._getTexture(c,n.AttributeDataType.DD0),unit:n.dataDrivenUnit0},dataDriven1:{texture:this._getTexture(c,n.AttributeDataType.DD1),unit:n.dataDrivenUnit1},dataDriven2:{texture:this._getTexture(c,n.AttributeDataType.DD2),unit:n.dataDrivenUnit2},
size:this.size}}_getTexture(c,h){h=this._data?.[h];if(!h)return this._getDefaultTexture(c);h.updateTexture(c,this._version);return h.getTexture(c)}_getDefaultTexture(c){if(null==this._defaultTexture){const h=new f.TextureDescriptor;h.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;h.samplingMode=d.TextureSamplingMode.NEAREST;h.width=1;h.height=1;this._defaultTexture=new b.Texture(c,h,new Uint8Array(4))}return this._defaultTexture}}k.AttributeStoreView=q;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/TileContainer":function(){define(["../../../../core/has","./enums","./WGLContainer","./brushes/WGLBrushStencil","./brushes/WGLBrushTileDebugInfo"],function(k,r,p,e,n){const m=(d,a)=>0!==d.key.level-a.key.level?d.key.level-a.key.level:0!==d.key.row-a.key.row?d.key.row-a.key.row:d.key.col-a.key.col;class l extends p{constructor(d){super();this.tileInfoView=d;this.sortFunction=m}renderChildren(d){this.setStencilReference(d);super.renderChildren(d)}createRenderParams(d){const {state:a}=
d;d=super.createRenderParams(d);d.requiredLevel=this.tileInfoView.getClosestInfoForScale(a.scale).level;d.displayLevel=this.tileInfoView.tileInfo.scaleToZoom(a.scale);return d}prepareRenderPasses(d){const a=super.prepareRenderPasses(d);a.push(d.registerRenderPass({name:"stencil",brushes:[e],drawPhase:r.WGLDrawPhase.DEBUG|r.WGLDrawPhase.MAP|r.WGLDrawPhase.HIGHLIGHT|r.WGLDrawPhase.LABEL,target:()=>this.getStencilTarget()}));k("esri-tiles-debug")&&a.push(d.registerRenderPass({name:"tileInfo",brushes:[n],
drawPhase:r.WGLDrawPhase.DEBUG,target:()=>this.children}));return a}getStencilTarget(){return this.children}setStencilReference(d){d=1;for(const a of this.children)a.stencilRef=d++}}return l})},"esri/views/2d/engine/webgl/WGLContainer":function(){define(["../../../../core/has","../brushes","../Container","./ClippingInfo","./enums"],function(k,r,p,e,n){class m extends p.Container{set clips(l){super.clips=l;this._updateClippingInfo(l)}renderChildren(l){l.painter.setPipelineState(null);null==this._renderPasses&&
(this._renderPasses=this.prepareRenderPasses(l.painter));for(const d of this._renderPasses)try{d.render(l)}catch(a){}}prepareRenderPasses(l){return[l.registerRenderPass({name:"clip",brushes:[r.brushes.clip],target:()=>this._clippingInfos,drawPhase:n.WGLDrawPhase.MAP|n.WGLDrawPhase.LABEL|n.WGLDrawPhase.LABEL_ALPHA|n.WGLDrawPhase.DEBUG|n.WGLDrawPhase.HIGHLIGHT})]}_updateClippingInfo(l){null!=this._clippingInfos&&(this._clippingInfos.forEach(d=>d.destroy()),this._clippingInfos=null);null!=l&&l.length&&
(this._clippingInfos=l.items.map(d=>e.fromClipArea(this.stage,d)));this.requestRender()}}return m})},"esri/views/2d/engine/webgl/ClippingInfo":function(){define("../../../../core/Error ../../../../core/Logger ../../../../core/reactiveUtils ../../../../core/libs/gl-matrix-2/factories/mat3f32 ../DisplayObject ./Mesh2D ../../support/clippingUtils ../../../webgl/VertexArrayObject".split(" "),function(k,r,p,e,n,m,l,d){class a extends n.DisplayObject{constructor(b,f){super();this._clip=f;this._cache={};
this.stage=b;this._handle=p.watch(()=>f.version,()=>this._invalidate());this.ready()}static fromClipArea(b,f){return new a(b,f)}_destroyGL(){null!=this._cache.mesh&&(this._cache.mesh.destroy(),this._cache.mesh=null);null!=this._cache.vao&&(this._cache.vao.dispose(),this._cache.vao=null)}destroy(){this._destroyGL();this._handle.remove()}getVAO(b,f,g,q){const [c,h]=f.size;if("geometry"===this._clip.type||this._lastWidth!==c||this._lastHeight!==h)this._lastWidth=c,this._lastHeight=h,this._destroyGL();
if(null==this._cache.vao){f=this._createMesh(f,this._clip);const u=f.getIndexBuffer(b),A=f.getVertexBuffers(b);this._cache.mesh=f;this._cache.vao=new d.VertexArrayObject(b,g,q,A,u)}return this._cache.vao}_createTransforms(){return{displayViewScreenMat3:e.create()}}_invalidate(){this._destroyGL();this.requestRender()}_createMesh(b,f){switch(f.type){case "rect":return m.fromScreenExtent(l.createScreenExtent(f,b.size[0],b.size[1]));case "path":return m.fromPath(f);case "geometry":return m.fromGeometry(b,
f);default:return r.getLogger("esri.views.2d.engine.webgl.ClippingInfo").error(new k("mapview-bad-type","Unable to create ClippingInfo mesh from clip of type: ${clip.type}")),m.fromScreenExtent({xmin:0,ymin:0,xmax:1,ymax:1})}}}return a})},"esri/views/2d/engine/webgl/Mesh2D":function(){define("../../../../core/Error ../../../../core/Logger ../../../../chunks/earcut ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../layers/graphics/featureConversionUtils ../../../../layers/graphics/OptimizedGeometry ./number ../../../webgl/BufferObject ../../../webgl/enums".split(" "),
function(k,r,p,e,n,m,l,d,a,b){const f=({coords:q,lengths:c},h)=>{const u=[];for(let t=0,w=0;t<c.length;w+=c[t],t+=1){const x=w;for(var A=[];t<c.length-1;t+=1,w+=c[t]){var z=w+c[t];let B=0;for(let C=1;C<c[t+1];C++)B+=(q[2*(z+C)]-q[2*(z+C-1)])*(q[2*(z+C)+1]+q[2*(z+C-1)+1]);if(!(h?0<B:0>B))break;A.push(w+c[t]-x)}z=q.slice(2*x,2*(w+c[t]));A=p.earcut(z,A,2);for(const B of A)u.push(B+x)}return u};class g{constructor(q,c,h,u=!1){this._cache={};this.vertices=q;this.indices=c;this.primitiveType=h;this.isMapSpace=
u}static fromPath(q){var c=m.convertFromNestedArray(new l,q.path,!1,!1);q=c.coords;c=new Uint32Array(f(c,!0));const h=new Uint32Array(q.length/2);for(let u=0;u<h.length;u++)h[u]=d.i1616to32(Math.floor(q[2*u]),Math.floor(q[2*u+1]));return new g({geometry:h},c,b.PrimitiveType.TRIANGLES)}static fromGeometry(q,c){const h=c.geometry?.type;switch(h){case "polygon":return g.fromPolygon(q,c.geometry);case "extent":return g.fromMapExtent(q,c.geometry);default:return r.getLogger("esri.views.2d.engine.webgl.Mesh2D").error(new k("mapview-bad-type",
`Unable to create a mesh from type ${h}`,c)),g.fromScreenExtent({xmin:0,ymin:0,xmax:1,ymax:1})}}static fromPolygon(q,c){var h=m.convertFromPolygon(new l,c,!1,!1);c=h.coords;h=new Uint32Array(f(h,!1));const u=new Uint32Array(c.length/2),A=n.create(),z=n.create();for(let t=0;t<u.length;t++)e.set(A,c[2*t],c[2*t+1]),q.toScreen(z,A),u[t]=d.i1616to32(Math.floor(z[0]),Math.floor(z[1]));return new g({geometry:u},h,b.PrimitiveType.TRIANGLES,!0)}static fromScreenExtent({xmin:q,xmax:c,ymin:h,ymax:u}){q={geometry:new Uint32Array([d.i1616to32(q,
h),d.i1616to32(c,h),d.i1616to32(q,u),d.i1616to32(q,u),d.i1616to32(c,h),d.i1616to32(c,u)])};c=new Uint32Array([0,1,2,3,4,5]);return new g(q,c,b.PrimitiveType.TRIANGLES)}static fromMapExtent(q,c){const [h,u]=q.toScreen([0,0],[c.xmin,c.ymin]),[A,z]=q.toScreen([0,0],[c.xmax,c.ymax]);q={geometry:new Uint32Array([d.i1616to32(h,u),d.i1616to32(A,u),d.i1616to32(h,z),d.i1616to32(h,z),d.i1616to32(A,u),d.i1616to32(A,z)])};c=new Uint32Array([0,1,2,3,4,5]);return new g(q,c,b.PrimitiveType.TRIANGLES)}destroy(){null!=
this._cache.indexBuffer&&this._cache.indexBuffer.dispose();this._cache.vertexBuffers?.forEach(q=>q?.dispose());this._cache.indexBuffer=this._cache.vertexBuffers=null}get elementType(){a:switch(this.indices.BYTES_PER_ELEMENT){case 1:var q=b.DataType.UNSIGNED_BYTE;break a;case 2:q=b.DataType.UNSIGNED_SHORT;break a;case 4:q=b.DataType.UNSIGNED_INT;break a;default:throw new k("Cannot get DataType of array");}return q}getIndexBuffer(q,c=b.Usage.STATIC_DRAW){let h;(h=this._cache).indexBuffer??(h.indexBuffer=
a.BufferObject.createIndex(q,c,this.indices));return this._cache.indexBuffer}getVertexBuffers(q,c=b.Usage.STATIC_DRAW){let h;(h=this._cache).vertexBuffers??(h.vertexBuffers=new Map(Object.keys(this.vertices).reduce((u,A)=>{u.push([A,a.BufferObject.createVertex(q,c,this.vertices[A])]);return u},[])));return this._cache.vertexBuffers}}return g})},"esri/views/2d/engine/webgl/shaderGraph/techniques/GraphicInstanceStore":function(){define(["exports","./TechniqueInstance","./TechniqueRegistry","./mesh/instanceIdUtils"],
function(k,r,p,e){function n(a,b){return new r.FeatureTechniqueInstance(e.castInstanceId(m++),a,b)}let m=0;const l={visualVariableColor:null,visualVariableOpacity:null,visualVariableSizeMinMaxValue:null,visualVariableSizeScaleStops:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null,visualVariableRotation:null,visualVariableSizeOutlineScaleStops:null};class d{constructor(){this.instances={fill:n(p.Techniques.fill,{uniforms:l,optionalAttributes:{zoomRange:!0}}),marker:n(p.Techniques.marker,
{uniforms:l,optionalAttributes:{zoomRange:!0}}),line:n(p.Techniques.line,{uniforms:l,optionalAttributes:{zoomRange:!0}}),text:n(p.Techniques.text,{uniforms:l,optionalAttributes:{zoomRange:!0,referenceSymbol:!1,clipAngle:!1}}),complexFill:n(p.Techniques.complexFill,{uniforms:l,optionalAttributes:{zoomRange:!0}}),gradientFill:n(p.Techniques.gradientFill,{uniforms:l,optionalAttributes:{zoomRange:!0}}),texturedLine:n(p.Techniques.texturedLine,{uniforms:l,optionalAttributes:{zoomRange:!0}}),gradientStroke:n(p.Techniques.gradientStroke,
{uniforms:l,optionalAttributes:{zoomRange:!0}}),animatedMarker:n(p.Techniques.animatedMarker,{uniforms:l,optionalAttributes:{zoomRange:!0}})};this._instancesById=Object.values(this.instances).reduce((a,b)=>{a.set(b.instanceId,b);return a},new Map)}getInstance(a){return this._instancesById.get(a)}}k.GraphicInstanceStore=d;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/TechniqueInstance":function(){define(["exports","./mesh/instanceIdUtils"],
function(k,r){class p{constructor(e,n,m){this._instanceId=e;this.techniqueRef=n;this._input=m}get instanceId(){return r.castStrictInstanceId(this._instanceId)}createMeshInfo(e){return{id:r.castStrictInstanceId(this._instanceId),techniqueType:this.techniqueRef.type,inputParams:e,optionalAttributes:this._input.optionalAttributes}}getInput(){return this._input}setInput(e){this._input=e}}k.FeatureTechniqueInstance=p;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/instanceIdUtils":function(){define(["exports"],
function(k){k.castInstanceId=function(r){return r};k.castStrictInstanceId=function(r){return r};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/graphics/GraphicBoundsRenderer":function(){define("../../../../core/maybe ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../../../core/libs/gl-matrix-2/factories/vec3f32 ../../../../geometry/support/normalizeUtils ../../engine/DisplayObject ../../engine/webgl/Utils ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f){const g=Math.PI/180;class q extends l.DisplayObject{constructor(h){super();this._indexBuffer=this._vertexBuffer=this._vao=this._program=null;this._dvsMat3=p.create();this._localOrigin={x:0,y:0};this._getBounds=h}destroy(){this._vao&&(this._vao.dispose(),this._indexBuffer=this._vertexBuffer=this._vao=null);this._program=k.disposeMaybe(this._program)}doRender(h){const {context:u}=h,A=this._getBounds();1>A.length||(this._createShaderProgram(u),this._updateMatricesAndLocalOrigin(h),
this._updateBufferData(u,A),u.setBlendingEnabled(!0),u.setDepthTestEnabled(!1),u.setStencilWriteMask(0),u.setStencilTestEnabled(!1),u.setBlendFunction(b.BlendFactor.ONE,b.BlendFactor.ONE_MINUS_SRC_ALPHA),u.setColorMask(!0,!0,!0,!0),h=this._program,u.bindVAO(this._vao),u.useProgram(h),h.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),u.gl.lineWidth(1),u.drawElements(b.PrimitiveType.LINES,8*A.length,b.DataType.UNSIGNED_INT,0),u.bindVAO())}_createTransforms(){return{displayViewScreenMat3:p.create()}}_createShaderProgram(h){this._program||
(this._program=h.programCache.acquire("precision highp float;\n        uniform mat3 u_dvsMat3;\n\n        attribute vec2 a_position;\n\n        void main() {\n          mediump vec3 pos \x3d u_dvsMat3 * vec3(a_position, 1.0);\n          gl_Position \x3d vec4(pos.xy, 0.0, 1.0);\n        }","precision mediump float;\n      void main() {\n        gl_FragColor \x3d vec4(0.75, 0.0, 0.0, 0.75);\n      }",c().attributes))}_updateMatricesAndLocalOrigin(h){var {state:u}=h;const {displayMat3:A,size:z,resolution:t,
pixelRatio:w,rotation:x,viewpoint:B}=u;h=g*x;const {x:C,y}=B.targetGeometry;u=m.normalizeMapX(C,u.spatialReference);this._localOrigin.x=u;this._localOrigin.y=y;u=w*z[0];const v=w*z[1],F=t*u,D=t*v,G=r.identity(this._dvsMat3);r.multiply(G,G,A);r.translate(G,G,e.fromValues(u/2,v/2));r.scale(G,G,n.fromValues(z[0]/F,-v/D,1));r.rotate(G,G,-h)}_updateBufferData(h,u){const {x:A,y:z}=this._localOrigin,t=new Float32Array(8*u.length),w=new Uint32Array(8*u.length);let x=0,B=0;for(const C of u)C&&(t[2*x]=C[0]-
A,t[2*x+1]=C[1]-z,t[2*x+2]=C[0]-A,t[2*x+3]=C[3]-z,t[2*x+4]=C[2]-A,t[2*x+5]=C[3]-z,t[2*x+6]=C[2]-A,t[2*x+7]=C[1]-z,w[B]=x+0,w[B+1]=x+3,w[B+2]=x+3,w[B+3]=x+2,w[B+4]=x+2,w[B+5]=x+1,w[B+6]=x+1,w[B+7]=x+0,x+=4,B+=8);this._vertexBuffer?this._vertexBuffer.setData(t.buffer):this._vertexBuffer=a.BufferObject.createVertex(h,b.Usage.DYNAMIC_DRAW,t.buffer);this._indexBuffer?this._indexBuffer.setData(w):this._indexBuffer=a.BufferObject.createIndex(h,b.Usage.DYNAMIC_DRAW,w);this._vao||(u=c(),this._vao=new f.VertexArrayObject(h,
u.attributes,u.bufferLayouts,new Map([["geometry",this._vertexBuffer]]),this._indexBuffer))}}const c=()=>d.createProgramDescriptor("bounds",{geometry:[{location:0,name:"a_position",count:2,type:b.DataType.FLOAT}]});return q})},"esri/views/2d/navigation/MapViewNavigation":function(){define("../../../chunks/tslib.es6 ../../../Viewpoint ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/Point ../viewpointUtils ./duration ./ZoomBox ./actions/Pan ./actions/Pinch ./actions/Rotate".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g,q,c,h,u){const A=new r({targetGeometry:new b}),z=[0,0];r=class extends p{constructor(t){super(t);this.animationManager=this._lastEventTimestamp=this._endTimer=null;this.interacting=!1}initialize(){this.pan=new c({navigation:this});this.rotate=new u({navigation:this});this.pinch=new h({navigation:this});this.zoomBox=new q({view:this.view,navigation:this})}destroy(){this.pan=e.destroyMaybe(this.pan);this.rotate=e.destroyMaybe(this.rotate);this.pinch=e.destroyMaybe(this.pinch);
this.zoomBox=e.destroyMaybe(this.zoomBox);this.animationManager=null}begin(){this.stop();this._set("interacting",!0)}end(){this._lastEventTimestamp=performance.now();this._startTimer(250)}async zoom(t,w=this._getDefaultAnchor()){this.begin();if(this.view.constraints.snapToZoom&&this.view.constraints.effectiveLODs)return 1>t?this.zoomIn(w):this.zoomOut(w);this.setViewpoint(w,t,0,[0,0])}async zoomIn(t){var w=this.view;w=w.constraints.snapToNextScale(w.scale);return this._zoomToScale(w,t)}async zoomOut(t){var w=
this.view;w=w.constraints.snapToPreviousScale(w.scale);return this._zoomToScale(w,t)}setViewpoint(t,w,x,B){this.begin();this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,t,w,x,B);this.end()}setViewpointImmediate(t,w=0,x=[0,0],B=this._getDefaultAnchor()){this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,B,t,w,x)}continuousRotateClockwise(){const t=this.view.viewpoint;this.animationManager?.animateContinuous(t,
w=>{f.rotateBy(w,w,-1)})}continuousRotateCounterclockwise(){const t=this.view.viewpoint;this.animationManager?.animateContinuous(t,w=>{f.rotateBy(w,w,1)})}resetRotation(){this.view.constraints.rotationEnabled&&(this.view.rotation=0)}continuousPanLeft(){this._continuousPan([-10,0])}continuousPanRight(){this._continuousPan([10,0])}continuousPanUp(){this._continuousPan([0,10])}continuousPanDown(){this._continuousPan([0,-10])}continuousPanVector({x:t,y:w}){this._continuousPan([10*t,10*w])}stop(){this.pan.stopMomentumNavigation();
this.animationManager?.stop();this.end();null!==this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))}_continuousPan(t){const w=this.view.viewpoint;this.animationManager?.animateContinuous(w,x=>{f.translateBy(x,x,t);this.view.constraints.constrainByGeometry(x)})}_startTimer(t){return null!==this._endTimer?this._endTimer:this._endTimer=setTimeout(()=>{this._endTimer=null;const w=performance.now()-(this._lastEventTimestamp??0);250>w?this._endTimer=this._startTimer(w):
this._set("interacting",!1)},t)}_getDefaultAnchor(){const {size:t,padding:{left:w,right:x,top:B,bottom:C}}=this.view;z[0]=.5*(t[0]-x+w);z[1]=.5*(t[1]-C+B);return z}async _zoomToScale(t,w=this._getDefaultAnchor()){const {view:x}=this,{constraints:B,scale:C,viewpoint:y,size:v,padding:F}=x,D=B.canZoomInTo(t),G=B.canZoomOutTo(t);if(!(t<C&&!D||t>C&&!G))return f.padAndScaleAndRotateBy(A,y,t/C,0,w,v,F),B.constrainByGeometry(A),x.goTo(A,{animate:!0,animationMode:"always",duration:g.getGoToDuration(),pickClosestTarget:!1})}_scaleRotateTranslateViewpoint(t,
w,x,B,C){var {view:y}=this;const {size:v,padding:F,constraints:D,scale:G,viewpoint:E}=y;var H=G*x;y=D.canZoomInTo(H);H=D.canZoomOutTo(H);if(1>x&&!y||1<x&&!H)x=1;f.translateBy(E,E,C);f.padAndScaleAndRotateBy(t,E,x,B,w,v,F);return D.constrainByGeometry(t)}};k.__decorate([n.property()],r.prototype,"animationManager",void 0);k.__decorate([n.property({type:Boolean,readOnly:!0})],r.prototype,"interacting",void 0);k.__decorate([n.property()],r.prototype,"pan",void 0);k.__decorate([n.property()],r.prototype,
"pinch",void 0);k.__decorate([n.property()],r.prototype,"rotate",void 0);k.__decorate([n.property()],r.prototype,"view",void 0);k.__decorate([n.property()],r.prototype,"zoomBox",void 0);return r=k.__decorate([a.subclass("esri.views.2d.navigation.MapViewNavigation")],r)})},"esri/views/2d/navigation/ZoomBox":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/screenUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./duration ../../input/InputManager".split(" "),
function(k,r,p,e,n,m,l,d,a,b){r=class extends r{constructor(f){super(f);this._boxShape=this._backgroundShape=this._overlay=this._container=null;this._box={x:0,y:0,width:0,height:0};this._rafId=null;this._redraw=this._redraw.bind(this)}destroy(){this.view=null}set view(f){this.removeAllHandles();this._destroyOverlay();this._set("view",f);f&&this.addHandles([f.on("drag",["Shift"],g=>this._handleDrag(g,1),b.ViewEventPriorities.INTERNAL),f.on("drag",["Shift","Control"],g=>this._handleDrag(g,-1),b.ViewEventPriorities.INTERNAL)])}_start(){this._createContainer();
this._createOverlay();this.navigation.begin()}_update(f,g,q,c){this._box.x=f;this._box.y=g;this._box.width=q;this._box.height=c;this._rafId||(this._rafId=requestAnimationFrame(this._redraw))}_end(f,g,q,c,h){const u=this.view;f=u.toMap(p.createScreenPoint(f+.5*q,g+.5*c));q=Math.max(q/u.width,c/u.height);-1===h&&(q=1/q);this._destroyOverlay();this.navigation.end();u.goTo({center:f,scale:u.scale*q},{animationMode:"always",duration:a.getGoToDuration()})}_updateBox(f,g,q,c){const h=this._boxShape;h.setAttributeNS(null,
"x",""+f);h.setAttributeNS(null,"y",""+g);h.setAttributeNS(null,"width",""+q);h.setAttributeNS(null,"height",""+c);h.setAttributeNS(null,"class","esri-zoom-box__outline")}_updateBackground(f,g,q,c){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(f,g,q,c,this.view.width,this.view.height))}_createContainer(){const f=document.createElement("div");f.className="esri-zoom-box__container";this.view.root.appendChild(f);this._container=f}_createOverlay(){var f=this.view.width,g=this.view.height;
const q=document.createElementNS("http://www.w3.org/2000/svg","path");q.setAttributeNS(null,"d","M 0 0 L "+f+" 0 L "+f+" "+g+" L 0 "+g+" Z");q.setAttributeNS(null,"class","esri-zoom-box__overlay-background");f=document.createElementNS("http://www.w3.org/2000/svg","rect");g=document.createElementNS("http://www.w3.org/2000/svg","svg");g.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink");g.setAttributeNS(null,"class","esri-zoom-box__overlay");g.appendChild(q);
g.appendChild(f);this._container.appendChild(g);this._backgroundShape=q;this._boxShape=f;this._overlay=g}_destroyOverlay(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container);this._container=this._backgroundShape=this._boxShape=this._overlay=null}_toSVGPath(f,g,q,c,h,u){q=f+q;c=g+c;return"M 0 0 L "+h+" 0 L "+h+" "+u+" L 0 "+u+" ZM "+f+" "+g+" L "+f+" "+c+" L "+q+" "+c+" L "+q+" "+g+" Z"}_handleDrag(f,g){var q=f.x,c=f.y,h=f.origin.x;const u=f.origin.y;
let A;q>h?(A=h,h=q-h):(A=q,h-=q);c>u?(q=u,c-=u):(q=c,c=u-c);switch(f.action){case "start":this._start();break;case "update":this._update(A,q,h,c);break;case "end":this._end(A,q,h,c,g)}f.stopPropagation()}_redraw(){if(this._rafId&&(this._rafId=null,this._overlay)){var {x:f,y:g,width:q,height:c}=this._box;this._updateBox(f,g,q,c);this._updateBackground(f,g,q,c);this._rafId=requestAnimationFrame(this._redraw)}}};k.__decorate([e.property()],r.prototype,"navigation",void 0);k.__decorate([e.property()],
r.prototype,"view",null);return r=k.__decorate([d.subclass("esri.views.2d.navigation.ZoomBox")],r)})},"esri/views/2d/navigation/actions/Pan":function(){define("../../../../chunks/tslib.es6 ../../../../Viewpoint ../../../../core/Accessor ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/Point ../../viewpointUtils ../../../navigation/PanPlanarMomentumEstimator".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g,q,c,h){p=class extends p{constructor(u){super(u);this.animationTime=0;this.momentumEstimator=new h.PanPlanarMomentumEstimator(500,6,.92);this.momentum=null;this.tmpMomentum=g.create();this.momentumFinished=!1;this.viewpoint=new r({targetGeometry:new q,scale:0,rotation:0});this._previousDrag=null;e.when(()=>this.momentumFinished,()=>this.navigation.stop())}begin(u,A){this.navigation.begin();this.momentumEstimator.reset();this.addToEstimator(A);this._previousDrag=A}update(u,
A){this.addToEstimator(A);let z=A.center.x,t=A.center.y;const w=this._previousDrag;z=w?w.center.x-z:-z;t=w?t-w.center.y:t;u.viewpoint=c.translateBy(this.viewpoint,u.viewpoint,[z||0,t||0]);this._previousDrag=A}end(u,A){this.addToEstimator(A);this.momentum=u.navigation.effectiveMomentumEnabled?this.momentumEstimator.evaluateMomentum():null;this.animationTime=0;if(this.momentum)this.onAnimationUpdate(u);this._previousDrag=null;this.navigation.end()}addToEstimator(u){var A=u.center.x;const z=u.center.y,
t=n.createScreenPointArray(-A,z);A=g.fromValues(-A,z,0);this.momentumEstimator.add(t,A,.001*u.timestamp)}onAnimationUpdate(u){this.navigation.animationManager?.animateContinuous(u.viewpoint,(A,z)=>{const {momentum:t,animationTime:w,tmpMomentum:x}=this;var B=this.momentumFinished=!t||t.isFinished(w);z*=.001;B||(B=t.valueDelta(w,z),f.scale(x,t.direction,B),c.translateBy(A,A,x),u.constraints.constrainByGeometry(A));this.animationTime+=z})}stopMomentumNavigation(){this.momentum&&(this.momentumEstimator.reset(),
this.momentum=null,this.navigation.stop())}};k.__decorate([m.property()],p.prototype,"momentumFinished",void 0);k.__decorate([m.property()],p.prototype,"viewpoint",void 0);k.__decorate([m.property()],p.prototype,"navigation",void 0);return p=k.__decorate([b.subclass("esri.views.2d.navigation.actions.Pan")],p)})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define(["exports","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","./FilteredFiniteDifference","./Momentum"],
function(k,r,p,e,n){class m extends n.Momentum{constructor(d,a,b,f,g){super(d,a,b);this._sceneVelocity=f;this.direction=g}value(d){return super.valueFromInitialVelocity(this._sceneVelocity,d)}}class l{constructor(d=300,a=12,b=.84){this._minimumInitialVelocity=d;this._stopVelocity=a;this._friction=b;this.enabled=!0;this._time=new e.FilteredFiniteDifference(.6);this._screen=[new e.FilteredFiniteDifference(.4),new e.FilteredFiniteDifference(.4)];this._scene=[new e.FilteredFiniteDifference(.6),new e.FilteredFiniteDifference(.6),
new e.FilteredFiniteDifference(.6)];this._tmpDirection=p.create()}add(d,a,b){!this.enabled||this._time.hasLastValue()&&.015>this._time.computeDelta(b)||(this._screen[0].update(d[0]),this._screen[1].update(d[1]),this._scene[0].update(a[0]),this._scene[1].update(a[1]),this._scene[2].update(a[2]),this._time.update(b))}reset(){this._screen[0].reset();this._screen[1].reset();this._scene[0].reset();this._scene[1].reset();this._scene[2].reset();this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||
!this._time.hasFilteredDelta())return null;var d=this._screen[0].filteredDelta,a=this._screen[1].filteredDelta;d=null==d||null==a?0:Math.sqrt(d*d+a*a);a=this._time.filteredDelta;d=null==a||null==d?0:d/a;return Math.abs(d)<this._minimumInitialVelocity?null:this.createMomentum(d,this._stopVelocity,this._friction)}createMomentum(d,a,b){r.set(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const f=r.length(this._tmpDirection);0<f&&r.scale(this._tmpDirection,
this._tmpDirection,1/f);const g=this._time.filteredDelta;return new m(d,a,b,null==g?0:f/g,this._tmpDirection)}}k.PanPlanarMomentum=m;k.PanPlanarMomentumEstimator=l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["exports"],function(k){class r{constructor(p){this._gain=p;this.filteredDelta=this.lastValue=void 0}update(p){if(this.hasLastValue()){const e=this.computeDelta(p);this._updateDelta(e)}this.lastValue=p}reset(){this.filteredDelta=
this.lastValue=void 0}hasLastValue(){return void 0!==this.lastValue}hasFilteredDelta(){return void 0!==this.filteredDelta}computeDelta(p){return void 0===this.lastValue?NaN:p-this.lastValue}_updateDelta(p){this.filteredDelta=void 0!==this.filteredDelta?(1-this._gain)*this.filteredDelta+this._gain*p:p}}k.FilteredFiniteDifference=r;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/Momentum":function(){define(["exports"],function(k){class r{constructor(p,e,n){this._initialVelocity=
p;this._stopVelocity=e;this._friction=n;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(p){return p>this.duration}get friction(){return this._friction}value(p){return this.valueFromInitialVelocity(this._initialVelocity,p)}valueDelta(p,e){const n=this.value(p);return this.value(p+e)-n}valueFromInitialVelocity(p,e){e=Math.min(e,this.duration);const n=1-this.friction;return p*(n**e-1)/Math.log(n)}}
k.Momentum=r;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/navigation/actions/Pinch":function(){define("../../../../chunks/tslib.es6 ../../../../Viewpoint ../../../../core/Accessor ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../geometry/Point ../../viewpointUtils ../../../navigation/RotationMomentumEstimator ../../../navigation/ZoomMomentumEstimator".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g,q,c,h){p=class extends p{constructor(u){super(u);this._animationTime=0;this._momentumFinished=!1;this._previousRadius=this._previousAngle=0;this._previousCenter=null;this._rotationMomentumEstimator=new c.RotationMomentumEstimator(.6,.15,.95);this._rotationDirection=1;this._startRadius=this._startAngle=0;this._updateTimestamp=null;this._zoomDirection=1;this._zoomMomentumEstimator=new h.ZoomMomentumEstimator;this._zoomOnly=null;this.viewpoint=new r({targetGeometry:new g,
scale:0,rotation:0});this.rotateMomentum=this.zoomMomentum=null;this.addHandles(e.when(()=>this._momentumFinished,()=>this.navigation.stop()))}begin(u,A){this.navigation.begin();this._rotationMomentumEstimator.reset();this._zoomMomentumEstimator.reset();this._zoomOnly=null;this._previousAngle=this._startAngle=A.angle;this._previousRadius=this._startRadius=A.radius;this._previousCenter=A.center;this._updateTimestamp=null;u.constraints.rotationEnabled&&this.addToRotateEstimator(0,A.timestamp);this.addToZoomEstimator(A,
1)}update(u,A){null===this._updateTimestamp&&(this._updateTimestamp=A.timestamp);const z=A.angle,t=A.radius,w=A.center,x=Math.abs(180*(z-this._startAngle)/Math.PI),B=Math.abs(t-this._startRadius),C=this._startRadius/t;if(this._previousRadius&&this._previousCenter){const y=t/this._previousRadius;let v=180*(z-this._previousAngle)/Math.PI;this._rotationDirection=0<=v?1:-1;this._zoomDirection=1<=y?1:-1;u.constraints.rotationEnabled?(null===this._zoomOnly&&200<A.timestamp-this._updateTimestamp&&(this._zoomOnly=
0<B-x),null===this._zoomOnly||this._zoomOnly?v=0:this.addToRotateEstimator(z-this._startAngle,A.timestamp)):v=0;this.addToZoomEstimator(A,C);this.navigation.setViewpoint([w.x,w.y],1/y,v,[this._previousCenter.x-w.x,w.y-this._previousCenter.y])}this._previousAngle=z;this._previousRadius=t;this._previousCenter=w}end(u){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum();this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum();this._animationTime=0;if(this.rotateMomentum||this.zoomMomentum)this.onAnimationUpdate(u);
this.navigation.end()}addToRotateEstimator(u,A){this._rotationMomentumEstimator.add(u,.001*A)}addToZoomEstimator(u,A){this._zoomMomentumEstimator.add(A,.001*u.timestamp)}canZoomIn(u){const A=u.scale;u=u.constraints.effectiveMaxScale;return 0===u||A>u}canZoomOut(u){const A=u.scale;u=u.constraints.effectiveMinScale;return 0===u||A<u}onAnimationUpdate(u){this.navigation.animationManager?.animateContinuous(u.viewpoint,(A,z)=>{var t=!this.canZoomIn(u)&&1<this._zoomDirection||!this.canZoomOut(u)&&1>this._zoomDirection,
w=!this.rotateMomentum||this.rotateMomentum.isFinished(this._animationTime);t=t||!this.zoomMomentum||this.zoomMomentum.isFinished(this._animationTime);z*=.001;this._momentumFinished=w&&t;if(!this._momentumFinished){w=this.rotateMomentum?Math.abs(this.rotateMomentum.valueDelta(this._animationTime,z))*this._rotationDirection*180/Math.PI:0;t=this.zoomMomentum?Math.abs(this.zoomMomentum.valueDelta(this._animationTime,z)):1;const B=f.create();var x=f.create();if(this._previousCenter){b.set(B,this._previousCenter.x,
this._previousCenter.y);q.getPaddingScreenTranslation(x,u.size,u.padding);b.add(B,B,x);const {constraints:C,scale:y}=u;x=y*t;1>t&&!C.canZoomInTo(x)?(t=y/C.effectiveMaxScale,this.rotateMomentum=this.zoomMomentum=null):1<t&&!C.canZoomOutTo(x)&&(t=y/C.effectiveMinScale,this.rotateMomentum=this.zoomMomentum=null);q.scaleAndRotateBy(A,u.viewpoint,t,w,B,u.size);u.constraints.constrainByGeometry(A)}}this._animationTime+=z})}stopMomentumNavigation(){if(this.rotateMomentum||this.zoomMomentum)this.rotateMomentum&&
(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop()}};k.__decorate([n.property()],p.prototype,"_momentumFinished",void 0);k.__decorate([n.property()],p.prototype,"viewpoint",void 0);k.__decorate([n.property()],p.prototype,"navigation",void 0);return p=k.__decorate([a.subclass("esri.views.2d.navigation.actions.Pinch")],p)})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["exports",
"./MomentumEstimator"],function(k,r){class p extends r.MomentumEstimator{constructor(e=3,n=.01,m=.95,l=12){super(e,n,m,l)}add(e,n){const m=this.value.lastValue;if(null!=m){for(e-=m;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;e=m+e}super.add(e,n)}}k.RotationMomentumEstimator=p;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/MomentumEstimator":function(){define(["exports","../../core/mathUtils","./FilteredFiniteDifference","./Momentum"],function(k,r,
p,e){class n{constructor(m=2.5,l=.01,d=.95,a=12){this._minimumInitialVelocity=m;this._stopVelocity=l;this._friction=d;this._maxVelocity=a;this.enabled=!0;this.value=new p.FilteredFiniteDifference(.8);this.time=new p.FilteredFiniteDifference(.3)}add(m,l){if(this.enabled&&null!=l){if(this.time.hasLastValue()){if(.01>this.time.computeDelta(l))return;if(this.value.hasFilteredDelta()){const d=this.value.computeDelta(m);0>this.value.filteredDelta*d&&this.value.reset()}}this.time.update(l);this.value.update(m)}}reset(){this.value.reset();
this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let m=this.value.filteredDelta/this.time.filteredDelta;m=r.clamp(m,-this._maxVelocity,this._maxVelocity);return Math.abs(m)<this._minimumInitialVelocity?null:this.createMomentum(m,this._stopVelocity,this._friction)}createMomentum(m,l,d){return new e.Momentum(m,l,d)}}k.MomentumEstimator=n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["exports",
"./Momentum","./MomentumEstimator"],function(k,r,p){class e extends r.Momentum{constructor(m,l,d){super(m,l,d)}value(m){m=super.value(m);return Math.exp(m)}valueDelta(m,l){const d=super.value(m);m=super.value(m+l);return Math.exp(m-d)}}class n extends p.MomentumEstimator{constructor(m=2.5,l=.01,d=.95,a=12){super(m,l,d,a)}add(m,l){super.add(Math.log(m),l)}createMomentum(m,l,d){return new e(m,l,d)}}k.ZoomMomentum=e;k.ZoomMomentumEstimator=n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/navigation/actions/Rotate":function(){define("../../../../chunks/tslib.es6 ../../../../Viewpoint ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../geometry/Point ../../viewpointUtils".split(" "),function(k,r,p,e,n,m,l,d,a,b,
f,g){const q=b.create(),c=b.create();p=class extends p{constructor(h){super(h);this._previousCenter=b.create();this.viewpoint=new r({targetGeometry:new f,scale:0,rotation:0})}begin(h,u){this.navigation.begin();a.set(this._previousCenter,u.center.x,u.center.y)}update(h,u){const {state:{size:A,padding:z}}=h;a.set(q,u.center.x,u.center.y);g.getAnchor(c,A,z);h.viewpoint=g.rotateBy(this.viewpoint,h.state.paddedViewState.viewpoint,g.angleBetween(c,this._previousCenter,q));a.copy(this._previousCenter,q)}end(){this.navigation.end()}};
k.__decorate([e.property()],p.prototype,"viewpoint",void 0);k.__decorate([e.property()],p.prototype,"navigation",void 0);return p=k.__decorate([d.subclass("esri.views.2d.navigation.actions.Rotate")],p)})},"esri/views/2d/magnifier/MagnifierView2D":function(){define("../../../request ../../../core/asyncUtils ../../../core/Handles ../../../core/maybe ../../../core/reactiveUtils ../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../core/support/UpdatingHandles ../engine/DisplayObject ../engine/webgl/enums ../engine/webgl/shaderGraph/techniques/magnifier/MagnifierTechnique ../../magnifier/resources".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f){class g extends d.DisplayObject{constructor(){super();this._handles=new p;this._magnifierTechnique=new b.MagnifierTechnique;this.updatingHandles=new l.UpdatingHandles;this.visible=!1}destroy(){this._handles=e.destroyMaybe(this._handles);this._magnifierTechnique.shutdown();this._resourcesTask=e.abortMaybe(this._resourcesTask)}get backgroundColor(){return this._backgroundColor}set backgroundColor(q){this._backgroundColor=q;this.requestRender()}get magnifier(){return this._magnifier}set magnifier(q){this._magnifier=
q;this._handles.removeAll();this._handles.add([n.watch(()=>q.version,()=>{this.visible=q.visible&&null!=q.position&&0<q.size;this.requestRender()},n.initial),n.watch(()=>[q.maskUrl,q.overlayUrl],()=>this._reloadResources()),n.watch(()=>q.size,()=>{this._magnifierTechnique.shutdown();this.requestRender()})])}_createTransforms(){return{displayViewScreenMat3:m.create()}}doRender(q){if(!this._resourcesTask)this._reloadResources();else if(q.drawPhase===a.WGLDrawPhase.MAP&&this._canRender()){var c=this._magnifier;
if(null!=c.position){this._magnifierTechnique.updateResources(q,this._mask,this._overlay,c);var h=this.backgroundColor;this._magnifierTechnique.render(q,{background:h?[h.a*h.r/255,h.a*h.g/255,h.a*h.b/255,h.a]:[1,1,1,1],maskEnabled:c.maskEnabled?1:0,overlayEnabled:c.overlayEnabled?1:0})}}}_canRender(){return this._mask&&this._overlay&&null!=this._magnifier}_reloadResources(){this._resourcesTask&&this._resourcesTask.abort();const q=null!=this._magnifier?this._magnifier.maskUrl:null,c=null!=this._magnifier?
this._magnifier.overlayUrl:null;this._resourcesTask=r.createTask(async h=>{const u=null==q||null==c?f.loadMagnifierResources(h):null,A=null!=q?k(q,{responseType:"image",signal:h}).then(w=>w.data):u.then(w=>w.mask);h=null!=c?k(c,{responseType:"image",signal:h}).then(w=>w.data):u.then(w=>w.overlay);const [z,t]=await Promise.all([A,h]);this._mask=z;this._overlay=t;this._magnifierTechnique.shutdown();this.requestRender()});this.updatingHandles.addPromise(this._resourcesTask.promise)}}return g})},"esri/views/2d/engine/webgl/shaderGraph/techniques/magnifier/MagnifierTechnique":function(){define("exports ../../../../../../../core/mathUtils ../../../../../../../core/maybe ../../../../../../../core/urlUtils ../../utils ../Technique ../TechniqueType ../shaders/MagnifierShader ../../../../../../webgl/enums ../../../../../../webgl/Texture ../../../../../../webgl/TextureDescriptor".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f){class g extends m.Technique{constructor(){super(...arguments);this.type=l.TechniqueType.Magnifier;this._resourcePixelRatio=1;this._position=[0,0,0,0];this.shaders={magnifier:new d.MagnifierShader}}updateResources(q,c,h,u){q.pixelRatio!==this._resourcePixelRatio&&this._destroyResources();this._readbackTexture||this._initializeResources(q,c,h,u);const {context:A,pixelRatio:z}=q,{factor:t,offset:w,position:x}=u;({size:h}=q.state);u=u.size*z;c=Math.ceil(1/t*u);this._readbackTexture.resize(c,
c);q=z*h[0];h=z*h[1];var B=.5*c,C=.5*c;const y=r.clamp(z*x.x,B,q-B-1),v=r.clamp(h-z*x.y,C,h-C-1);B=y-B;C=v-C;const F=this._readbackTexture;A.bindTexture(F,0);A.gl.copyTexImage2D(F.descriptor.target,0,F.descriptor.pixelFormat,B,C,c,c,0);c=w.y*z;this._position[0]=-1+(y+w.x*z)/q*2;this._position[1]=-1+(v-c)/h*2;this._position[2]=u/q*2;this._position[3]=u/h*2}render(q,c){const {context:h,painter:u}=q;u.setPipelineState(n.simplePipelineState);u.submitDrawMesh(h,{shader:this.shaders.magnifier,uniforms:{config:{readbackTexture:{texture:this._readbackTexture,
unit:0},maskTexture:{texture:this._maskTexture,unit:7},overlayTexture:{texture:this._overlayTexture,unit:6},drawPos:this._position,...c}},defines:null,optionalAttributes:null,useComputeBuffer:!1},u.quadMesh)}shutdown(){this._destroyResources()}_initializeResources(q,c,h,u){const A=q.context;this._resourcePixelRatio=q.pixelRatio;const z=Math.ceil(u.size*q.pixelRatio);h.width=z;h.height=z;const t=new f.TextureDescriptor;t.internalFormat=a.PixelFormat.RGBA;t.wrapMode=a.TextureWrapMode.CLAMP_TO_EDGE;
t.samplingMode=a.TextureSamplingMode.NEAREST;t.flipped=!0;t.preMultiplyAlpha=!e.isSVG(h.src)||!q.context.driverTest.svgPremultipliesAlpha.result;this._overlayTexture=new b.Texture(A,t,h);c.width=z;c.height=z;t.pixelFormat=t.internalFormat=a.PixelFormat.ALPHA;this._maskTexture=new b.Texture(A,t,c);q=1/u.factor;t.pixelFormat=t.internalFormat=a.PixelFormat.RGBA;t.width=t.height=Math.ceil(q*z);t.samplingMode=a.TextureSamplingMode.LINEAR;t.flipped=!1;this._readbackTexture=new b.Texture(A,t)}_destroyResources(){p.disposeMaybe(this._maskTexture);
p.disposeMaybe(this._overlayTexture);p.disposeMaybe(this._readbackTexture)}}k.MagnifierTechnique=g;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/MagnifierShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./constants"],function(k,r,p,e,n){function m(f){const g=f.multiply(new e.Vec2(2)).subtract(1);return e.ifElse(e.equal(g.x,new e.Float(0)).and(e.equal(g.y,
new e.Float(0))),new e.Vec2(.5),()=>{var q=e.atan(g.y,g.x);const c=e.pow(e.length(g),new e.Float(n.magnifierBarrelFactor));q=new e.Vec2(e.cos(q),e.sin(q));return c.multiply(q).multiply(new e.Vec2(.5)).add(new e.Float(.5))})}class l extends p.VertexInput{}r.__decorate([p.location(0,e.Vec2)],l.prototype,"position",void 0);class d extends p.FragmentInput{}class a extends p.UniformGroup{}r.__decorate([p.uniform(e.Sampler2D)],a.prototype,"readbackTexture",void 0);r.__decorate([p.uniform(e.Sampler2D)],
a.prototype,"maskTexture",void 0);r.__decorate([p.uniform(e.Sampler2D)],a.prototype,"overlayTexture",void 0);r.__decorate([p.uniform(e.Vec4)],a.prototype,"background",void 0);r.__decorate([p.uniform(e.Vec4)],a.prototype,"drawPos",void 0);r.__decorate([p.uniform(e.Float)],a.prototype,"maskEnabled",void 0);r.__decorate([p.uniform(e.Float)],a.prototype,"overlayEnabled",void 0);class b extends p.GraphShaderModule{constructor(){super(...arguments);this.type="MagnifierShader"}vertex(f){const g=f.position;
f=f.position.subtract(new e.Vec2(.5)).multiply(this.config.drawPos.zw);f=this.config.drawPos.xy.add(f);return{glPosition:new e.Vec4(f,0,1),texCoord:g}}fragment(f){let g=e.texture2D(this.config.readbackTexture,m(f.texCoord));g=g.add((new e.Float(1)).subtract(g.a)).multiply(this.config.background);var q=e.ifElse(e.equal(this.config.maskEnabled,new e.Float(1)),e.texture2D(this.config.maskTexture,f.texCoord).a,new e.Float(1));g=g.multiply(q);f=e.ifElse(e.equal(this.config.overlayEnabled,new e.Float(1)),
e.texture2D(this.config.overlayTexture,f.texCoord),new e.Vec4(0));q=new p.FragmentOutput;q.fragColor=f.add((new e.Float(1)).subtract(f.a).multiply(g));return q}}r.__decorate([p.uniform(a)],b.prototype,"config",void 0);r.__decorate([r.__param(0,p.input(l))],b.prototype,"vertex",null);r.__decorate([r.__param(0,p.input(d))],b.prototype,"fragment",null);k.MagnifierShader=b;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/magnifier/resources":function(){define(["require","exports",
"../../core/promiseUtils","../../support/requestImageUtils"],function(k,r,p,e){const n=m=>Object.freeze(Object.defineProperty({__proto__:null,default:m},Symbol.toStringTag,{value:"Module"}));r.loadMagnifierResources=async function(m){var l=new Promise((a,b)=>k(["./mask-svg"],f=>a(n(f)),b)),d=new Promise((a,b)=>k(["./overlay-svg"],f=>a(n(f)),b));l=e.requestImage((await l).default,{signal:m});d=e.requestImage((await d).default,{signal:m});d={mask:await l,overlay:await d};p.throwIfAborted(m);return d};
Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})})},"esri/support/requestImageUtils":function(){define(["exports","../request"],function(k,r){k.requestImage=async function(p,e){({data:p}=await r(p,{responseType:"image",...e}));return p};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/grid/GridView2D":function(){define("../../../core/Handles ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/unitUtils ../../../core/libs/gl-matrix-2/math/mat3 ../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../core/libs/gl-matrix-2/math/vec2 ../../../core/libs/gl-matrix-2/factories/vec2f32 ../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../geometry/projection ../../../geometry/support/normalizeUtils ../../../geometry/support/scaleUtils ../../../geometry/support/spatialReferenceUtils ../engine/DisplayObject ../engine/webgl/enums ../engine/webgl/shaderGraph/techniques/grid/GridTechnique ./constants ./gridUtils".split(" "),
function(k,r,p,e,n,m,l,d,a,b,f,g,q,c,h,u,A,z,t){function w(C){const [y,v,F,D]=C.toArray().map(G=>G/255);return[y*D,v*D,F*D,D]}const x=b.create();class B extends h.DisplayObject{constructor(){super();this._handles=new k;this._metersPerSRUnit=this._projectedCenter=null;this._technique=new A.GridTechnique;this._grid=null;this.visible=!0}destroy(){this._handles=p.destroyMaybe(this._handles);this._technique.shutdown()}get grid(){return this._grid}set grid(C){this._grid=C;this._handles.removeAll();this._handles.add([e.watch(()=>
C?.center,()=>{this._projectedCenter=null},e.initial),e.watch(()=>[C?.center,C?.dynamicScaling,C?.majorLineColor,C?.majorLineInterval,C?.minorLineColor,C?.rotateWithMap,C?.rotation,C?.spacing,C?.units],()=>this.requestRender(),e.initial)])}_createTransforms(){return{displayViewScreenMat3:l.create()}}doRender(C){if(C.drawPhase===u.WGLDrawPhase.MAP&&null!=this.grid&&this.visible){var {spacing:y,units:v,majorLineInterval:F,dynamicScaling:D,majorLineColor:G,minorLineColor:E}=this.grid;if(0!==y&&(this._updateDerivedValues(C),
null!=this._projectedCenter&&null!=this._metersPerSRUnit)){var {scale:H,spatialReference:K}=C.state,J=n.convertUnit(y,v,"meters"),L=this._metersPerSRUnit*q.getResolutionForScale(H,K),P=J/L;!D&&P<z.minimumPixelsPerStrideForDisplayWhenScalingOff||(J*=t.getScaleFactor(F,P,D),this._updateTransform(C,L,J),this._technique.render(C,{transform:{dvs:this.transforms.displayViewScreenMat3},config:{pxPerCell:J/L,minorLineColor:w(E),majorLineColor:w(G),majorLineInterval:F,halfWidth:.25,aaWidth:.5}}))}}}_updateDerivedValues(C){if(this.grid){var {center:y}=
this.grid;({spatialReference:C}=C.state);this._projectedCenter&&c.equals(this._projectedCenter.spatialReference,C)||(this._metersPerSRUnit=null,c.equals(y.spatialReference,C)?this._projectedCenter=y:f.isLoadedOrLoadFor(y.spatialReference,C)?this._projectedCenter=f.project(y,C):this.requestRender());null==this._metersPerSRUnit&&null!=this._projectedCenter&&(this._metersPerSRUnit=t.measureMetersPerUnitAtReferencePoint(this._projectedCenter))}}_updateTransform(C,y,v){const {grid:F}=this,{center:D,rotation:G,
size:E,spatialReference:H}=C.state;if(null!=F&&null!=this._projectedCenter&&null!=this._metersPerSRUnit){C=E[0]/2*y;var K=E[1]/2*y,J=this._metersPerSRUnit/v,L=this._projectedCenter,P=r.deg2rad(F.rotation),Q=r.deg2rad(G);y=this.transforms.displayViewScreenMat3;m.fromRotation(y,-P);var S=H.isWrappable?g.getClosestDenormalizedXToReference(L.x,D[0],H):L.x;L=d.set(x,S,L.y);L=d.sub(x,D,L);d.scale(L,L,J);F.rotateWithMap||d.rotate(L,L,a.ZEROS,-Q);d.rotate(L,L,a.ZEROS,-P);d.scale(L,L,1/F.majorLineInterval);
L[0]-=Math.trunc(L[0]);L[1]-=Math.trunc(L[1]);d.scale(L,L,F.majorLineInterval);d.rotate(L,L,a.ZEROS,P);m.translate(y,y,L);F.rotateWithMap&&m.rotate(y,y,Q);v=d.set(x,C/v,K/v);m.scaleByVec2(y,y,v)}}}return B})},"esri/views/2d/engine/webgl/shaderGraph/techniques/grid/GridTechnique":function(){define(["exports","../../utils","../Technique","../TechniqueType","../shaders/GridShader"],function(k,r,p,e,n){class m extends p.Technique{constructor(){super(...arguments);this.type=e.TechniqueType.Grid;this.shaders=
{grid:new n.GridShader}}render(l,d){const {context:a,painter:b}=l;b.setPipelineState(r.simplePipelineState);b.submitDrawMesh(a,{shader:this.shaders.grid,uniforms:d,defines:null,optionalAttributes:null,useComputeBuffer:!1},b.quadMesh)}}k.GridTechnique=m;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/GridShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],
function(k,r,p,e){class n extends p.VertexInput{}r.__decorate([p.location(0,e.Vec2)],n.prototype,"position",void 0);class m extends p.FragmentInput{}class l extends p.UniformGroup{}r.__decorate([p.uniform(e.Mat3)],l.prototype,"dvs",void 0);class d extends p.UniformGroup{}r.__decorate([p.uniform(e.Float)],d.prototype,"halfWidth",void 0);r.__decorate([p.uniform(e.Float)],d.prototype,"aaWidth",void 0);r.__decorate([p.uniform(e.Float)],d.prototype,"pxPerCell",void 0);r.__decorate([p.uniform(e.Vec4)],
d.prototype,"minorLineColor",void 0);r.__decorate([p.uniform(e.Vec4)],d.prototype,"majorLineColor",void 0);r.__decorate([p.uniform(e.Int)],d.prototype,"majorLineInterval",void 0);class a extends p.GraphShaderModule{constructor(){super(...arguments);this.type="GridShader"}vertex(b){var f=b.position.multiply(2).subtract(1);b=this.transform.dvs.multiply(new e.Vec3(f,1)).xy;f=new e.Vec4(f,0,1);return{gridPos:b,glPosition:f}}fragment(b){var f=e.abs(b.gridPos),g=e.fract(f);b=e.min(g.x,(new e.Float(1)).subtract(g.x));
g=e.min(g.y,(new e.Float(1)).subtract(g.y));g=(new e.Vec2(b,g)).multiply(this.config.pxPerCell).subtract(this.config.halfWidth);b=e.min(g.x,g.y);b=(new e.Float(1)).subtract(e.smoothstep(new e.Float(0),this.config.aaWidth,b));var q=new e.Int(e.round(f.x)),c=new e.Int(e.round(f.y));f=new e.Float(e.intMod(q,this.config.majorLineInterval));c=new e.Float(e.intMod(c,this.config.majorLineInterval));q=e.ifElse(e.lessThan(g.x,g.y),f,c);g=e.greaterThan(e.multiply(e.step(g.x,this.config.aaWidth),e.step(g.y,
this.config.aaWidth)),new e.Float(.5));f=e.min(f,c);g=e.ifElse(g,f,q);g=e.mix(this.config.majorLineColor,this.config.minorLineColor,e.min(g,new e.Float(1)));f=new p.FragmentOutput;f.fragColor=g.multiply(b);return f}}r.__decorate([p.uniform(l)],a.prototype,"transform",void 0);r.__decorate([p.uniform(d)],a.prototype,"config",void 0);r.__decorate([r.__param(0,p.input(n))],a.prototype,"vertex",null);r.__decorate([r.__param(0,p.input(m))],a.prototype,"fragment",null);k.GridShader=a;Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/grid/constants":function(){define(["exports"],function(k){k.minimumPixelsPerStrideForDisplayWhenScalingOff=5;k.pixelsPerCell=50;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/grid/gridUtils":function(){define("exports ../../../core/unitUtils ../../../geometry/Point ../../../geometry/Polyline ../../../geometry/SpatialReference ../../../geometry/support/geodesicUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils ./constants".split(" "),
function(k,r,p,e,n,m,l,d,a,b){function f(g){const {isGeographic:q,isWebMercator:c}=g;return!q&&!c}k.getScaleFactor=function(g,q,c){g=1===g?10:g;return g**(c?Math.round(Math.log(b.pixelsPerCell/q)/Math.log(g)):0)};k.measureMetersPerUnitAtReferencePoint=function(g,q,c){var h="number"==typeof g?null:g;c=c??h?.spatialReference;if(null==c||!d.isValid(c)||f(c))return r.getMetersPerUnitForSR(c);g=h?.x??g;q=h?.y??q;var u=1/Math.sqrt(2);h=g+u;u=q+u;const {isWebMercator:A,isGeographic:z}=c;var t=z&&!m.isSupported(c)?
n.WGS84:c;A&&(t=new p({x:g,y:q,spatialReference:c}),a.webMercatorToGeographic(t,!0,t),g=t.x,q=t.y,t=new p({x:h,y:u,spatialReference:c}),a.webMercatorToGeographic(t,!0,t),h=t.x,u=t.y,t=n.WGS84);g=new e({paths:[[[g,q],[h,u]]],spatialReference:t});g=l.straightLineDensify(g,10);let w;try{[w]=m.geodesicLengths([g],"meters")}catch{return r.getMetersPerUnitForSR(c)}return w};k.shouldUsePlanar=f;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/geodesicUtils":function(){define("exports ../../core/Error ../../core/unitUtils ../../core/accessorSupport/ensureType ../Point ../Polygon ../Polyline ../SpatialReference ./geodesicConstants ./spatialReferenceUtils".split(" "),
function(k,r,p,e,n,m,l,d,a,b){function f(w){if(!w)return null;var x=w.wkid;if(x)return a.spheroids[x];(w=w.wkt2??w.wkt)?(w=a.wktSpheroidRegex.exec(w))&&2===w.length?(x=w[1].split(","),!x||3>x.length?w=null:(w=parseFloat(x[1]),x=parseFloat(x[2]),w=isNaN(w)||isNaN(x)?null:{a:w,f:0===x?0:1/x})):w=null:w=null;return w}function g(w){w=f(w);if(null!=w&&"b"in w&&"eSq"in w&&"radius"in w)return w;const x=w.a*(1-w.f);return Object.assign(w,{b:x,eSq:1-(x/w.a)**2,radius:(2*w.a+x)/3,densificationRatio:1E4/((2*
w.a+x)/3)})}function q(w){return null!=w&&0>w?w+360:w}function c(w,x,B){const {a:C,eSq:y}=g(B);B=Math.sqrt(y);const v=Math.sin(x[1]*a.toRadians);x=C*x[0]*a.toRadians;B=0<y?C*(1-y)*(v/(1-y*v*v)-1/(2*B)*Math.log((1-B*v)/(1+B*v)))*.5:C*v;w[0]=x;w[1]=B;return w}function h(w){return b.isGeographic(w)&&!!f(w)}function u(w,x){if("polyline"!==w.type&&"polygon"!==w.type)throw new r("geodesic-densify:invalid-geometry","the input geometry is neither polyline nor polygon");const {spatialReference:B}=w;if(!h(B))throw new r("geodesic-densify:invalid-spatial-reference",
"the input geometry spatial reference is not supported");var C="polyline"===w.type?w.paths:w.rings;const y=[],v=[0,0],F=new t;for(const E of C){C=[];y.push(C);C.push([E[0][0],E[0][1]]);var D=E[0][0],G=E[0][1];let H,K;for(let J=0;J<E.length-1;J++){H=E[J+1][0];K=E[J+1][1];if(D===H&&G===K)continue;const L=[D,G];z(F,[D,G],[H,K],B);const {azimuth:P,distance:Q}=F;D=Q/x;if(1<D){for(G=1;G<=D-1;G++)A(v,L,P,G*x,B),C.push(v.slice());A(v,L,P,(Q+Math.floor(D-1)*x)/2,B);C.push(v.slice())}A(v,L,P,Q,B);C.push(v.slice());
D=v[0];G=v[1]}}x=e.ensureClass(d,B);return"polyline"===w.type?new l({paths:y,spatialReference:x}):new m({rings:y,spatialReference:x})}function A(w,x,B,C,y){const v=x[0]*a.toRadians;x=x[1]*a.toRadians;B=(B??0)*a.toRadians;const {a:F,b:D,f:G}=g(y);y=Math.sin(B);B=Math.cos(B);var E=(1-G)*Math.tan(x);x=1/Math.sqrt(1+E*E);const H=E*x,K=Math.atan2(E,B);E=x*y;const J=E*E;var L=1-J,P=L*(F*F-D*D)/(D*D);const Q=1+P/16384*(4096+P*(-768+P*(320-175*P))),S=P/1024*(256+P*(-128+P*(74-47*P)));P=C/(D*Q);let U=2*Math.PI,
X,aa,ba;for(;1E-12<Math.abs(P-U);){ba=Math.cos(2*K+P);X=Math.sin(P);aa=Math.cos(P);const fa=S*X*(ba+S/4*(aa*(-1+2*ba*ba)-S/6*ba*(-3+4*X*X)*(-3+4*ba*ba)));U=P;P=C/(D*Q)+fa}C=H*X-x*aa*B;C=Math.atan2(H*aa+x*X*B,(1-G)*Math.sqrt(J+C*C));L=G/16*L*(4+G*(4-3*L));w[0]=(v+(Math.atan2(X*y,x*aa-H*X*B)-(1-L)*G*E*(P+L*X*(ba+L*aa*(-1+2*ba*ba)))))/a.toRadians;w[1]=C/a.toRadians;return w}function z(w,x,B,C){var y=x[0]*a.toRadians;x=x[1]*a.toRadians;var v=B[0]*a.toRadians;B=B[1]*a.toRadians;const {a:F,b:D,f:G,radius:E}=
g(C),H=v-y;var K=Math.atan((1-G)*Math.tan(x)),J=Math.atan((1-G)*Math.tan(B));C=Math.sin(K);K=Math.cos(K);const L=Math.sin(J);J=Math.cos(J);let P=1E3,Q=H,S,U,X;let aa,ba,fa;do{var I=Math.sin(Q);var M=Math.cos(Q);X=Math.sqrt(J*I*J*I+(K*L-C*J*M)*(K*L-C*J*M));if(0===X)return w.distance=0,w.azimuth=void 0,w.reverseAzimuth=void 0,w;M=C*L+K*J*M;aa=Math.atan2(X,M);ba=K*J*I/X;U=1-ba*ba;I=M-2*C*L/U;isNaN(I)&&(I=0);fa=G/16*U*(4+G*(4-3*U));S=Q;Q=H+(1-fa)*G*ba*(aa+fa*X*(I+fa*M*(-1+2*I*I)))}while(1E-12<Math.abs(Q-
S)&&0<--P);if(0===P)return C=Math.acos(Math.sin(x)*Math.sin(B)+Math.cos(x)*Math.cos(B)*Math.cos(v-y))*E,y=v-y,w.azimuth=Math.atan2(Math.sin(y)*Math.cos(B),Math.cos(x)*Math.sin(B)-Math.sin(x)*Math.cos(B)*Math.cos(y))/a.toRadians,w.distance=C,w.reverseAzimuth=void 0,w;y=U*(F*F-D*D)/(D*D);x=y/1024*(256+y*(-128+y*(74-47*y)));v=Math.atan2(K*Math.sin(Q),K*L*Math.cos(Q)-C*J);w.azimuth=Math.atan2(J*Math.sin(Q),K*L-C*J*Math.cos(Q))/a.toRadians;w.distance=D*(1+y/16384*(4096+y*(-768+y*(320-175*y))))*(aa-x*X*
(I+x/4*(M*(-1+2*I*I)-x/6*I*(-3+4*X*X)*(-3+4*I*I))));w.reverseAzimuth=v/a.toRadians;return w}class t{constructor(w=0,x,B){this.distance=w;this.azimuth=x;this.reverseAzimuth=B}}k.InverseGeodeticSolverResult=t;k.directGeodeticSolver=A;k.geodesicAreas=function(w,x="square-meters"){if(w.some(v=>!h(v.spatialReference)))throw new r("geodesic-areas:invalid-spatial-reference","the input geometries spatial reference is not supported");const B=[];for(var C=0;C<w.length;C++){var y=w[C];const {radius:v,densificationRatio:F}=
g(y.spatialReference);B.push(u(y,v*F))}w=[];C=[0,0];y=[0,0];for(let v=0;v<B.length;v++){const {rings:F,spatialReference:D}=B[v];let G=0;for(let E=0;E<F.length;E++){const H=F[E];c(C,H[0],D);c(y,H[H.length-1],D);let K=y[0]*C[1]-C[0]*y[1];for(let J=0;J<H.length-1;J++)c(C,H[J+1],D),c(y,H[J],D),K+=y[0]*C[1]-C[0]*y[1];G+=K}G=p.convertUnit(G,"square-meters",x);w.push(G/-2)}return w};k.geodesicCompatibleSpatialReference=function(w){return h(w)?w:b.isWebMercator(w)?d.WGS84:null};k.geodesicDensify=u;k.geodesicDistance=
function(w,x,B="meters"){if(!w||!x)throw new r("geodesic-distance:missing-parameters","one or both input parameters are missing");if(!w.spatialReference||!x.spatialReference)throw new r("geodesic-distance:invalid-parameters","one or both input points do not have a spatial reference");if(!b.equals(w.spatialReference,x.spatialReference))throw new r("geodesic-distance:invalid-parameters","spatial references of input parameters do not match");const {spatialReference:C}=w;if(!h(C))throw new r("geodesic-distance:not-supported",
"input geometry spatial reference is not supported");if(w.x===x.x&&w.y===x.y)return new t(0,0,0);const y=new t;z(y,[w.x,w.y],[x.x,x.y],C);y.distance=p.convertUnit(y.distance,"meters",B);y.azimuth=q(y.azimuth);y.reverseAzimuth=q(y.reverseAzimuth);return y};k.geodesicLengths=function(w,x="meters"){if(!w)throw new r("geodesic-lengths:invalid-geometries","the input geometries type is not supported");if(w.some(y=>!h(y.spatialReference)))throw new r("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");
const B=[];for(let y=0;y<w.length;y++){var C=w[y];const {spatialReference:v}=C;C="polyline"===C.type?C.paths:C.rings;let F=0;for(let D=0;D<C.length;D++){const G=C[D];let E=0;for(let H=1;H<G.length;H++){const K=G[H-1][0],J=G[H][0],L=G[H-1][1],P=G[H][1];if(L!==P||K!==J){const Q=new t;z(Q,[K,L],[J,P],v);E+=Q.distance}}F+=E}F=p.convertUnit(F,"meters",x);B.push(F)}return B};k.inverseGeodeticSolver=z;k.isSupported=h;k.pointFromDistance=function(w,x,B){if(!w||null==x||null==B)throw new r("point-from-distance:missing-parameters",
"one or more input parameters are missing or undefined");if(0>B||360<B)throw new r("point-from-distance:-of-bounds","azimuth is restricted to angles between, and including, 0\u00b0 to 360\u00b0 degrees");if(!w.spatialReference)throw new r("point-from-distance:missing-spatial-reference","the input point must have a spatial reference");const {spatialReference:C}=w;if(!h(C))throw new r("geodesic-distance:not-supported","input geometry spatial reference is not supported");const y=[0,0];A(y,[w.x,w.y],
B,x,C);return new n({x:y[0],y:y[1],spatialReference:C})};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/mat4":function(){define(["exports","./math/mat4"],function(k,r){k.mat4=r.mat4;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/mat4f32":function(){define(["exports","./factories/mat4f32"],function(k,r){k.mat4f32=r.mat4f32;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/vec3f32":function(){define(["exports",
"./factories/vec3f32"],function(k,r){k.vec3f32=r.vec3f32;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/vec4f32":function(){define(["exports","./factories/vec4f32"],function(k,r){k.vec4f32=r.vec4f32;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/Bitmap":function(){define("exports ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/math/mat3 ../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../core/libs/gl-matrix-2/factories/vec2f32 ./DisplayObject ./ImageryBitmapSource ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor".split(" "),
function(k,r,p,e,n,m,l,d,a,b){function f(c){return c&&"render"in c}function g(c){const h=document.createElement("canvas");h.width=c.width;h.height=c.height;c.render(h.getContext("2d"));return h}class q extends m.DisplayObject{constructor(c=null,h=!1){super();this.blendFunction="standard";this._sourceHeight=this._sourceWidth=0;this._textureInvalidated=!1;this.stencilRef=0;this.coordScale=[1,1];this._height=void 0;this.pixelRatio=1;this.rotation=this.resolution=0;this._texture=this._source=null;this._width=
void 0;this.y=this.x=0;this.immutable=h;this.source=c;this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null);null!=this._uploadStatus&&(this._uploadStatus.controller.abort(),this._uploadStatus=null)}get isSourceScaled(){return this.width!==this._sourceWidth||this.height!==this._sourceHeight}get height(){return void 0!==this._height?this._height:this._sourceHeight}set height(c){this._height=c}get source(){return this._source}set source(c){if(null!=
c||null!=this._source)this._source=c,this.invalidateTexture(),this.requestRender()}get texture(){return this._texture}get width(){return void 0!==this._width?this._width:this._sourceWidth}set width(c){this._width=c}beforeRender(c){super.beforeRender(c);this.updateTexture(c)}async setSourceAsync(c,h){null!=this._uploadStatus&&this._uploadStatus.controller.abort();const u=new AbortController,A=r.createResolver();r.onAbortOrThrow(h,()=>u.abort());r.onAbortOrThrow(u,z=>A.reject(z));this._uploadStatus=
{controller:u,resolver:A};this.source=c;return A.promise}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this._source instanceof HTMLImageElement?(this._sourceHeight=this._source.naturalHeight,this._sourceWidth=this._source.naturalWidth):this._source&&(this._sourceHeight=this._source.height,this._sourceWidth=this._source.width))}transitionStep(c,h){64<=c&&(this.fadeTransitionEnabled=!1);super.transitionStep(c,h)}setTransform(c){const h=p.identity(this.transforms.displayViewScreenMat3),
[u,A]=c.toScreenNoRotation([0,0],[this.x,this.y]);var z=this.resolution/this.pixelRatio/c.resolution;const t=z*this.width;z*=this.height;const w=Math.PI*this.rotation/180;p.translate(h,h,n.fromValues(u,A));p.translate(h,h,n.fromValues(t/2,z/2));p.rotate(h,h,-w);p.translate(h,h,n.fromValues(-t/2,-z/2));p.scaleByVec2(h,h,n.fromValues(t,z));p.multiply(this.transforms.displayViewScreenMat3,c.displayViewMat3,h)}setSamplingProfile(c){this._texture&&(c.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),
this._texture.setSamplingMode(c.samplingMode))}bind(c,h){this._texture&&c.bindTexture(this._texture,h)}async updateTexture({context:c,painter:h}){if(this._textureInvalidated)if(this._textureInvalidated=!1,this._texture||(this._texture=this._createTexture(c)),this.source){this._texture.resize(this._sourceWidth,this._sourceHeight);c=this.source;c=f(c)?c instanceof l?c.getRenderedRasterPixels()?.renderedRasterPixels:g(c):c;try{if(null!=this._uploadStatus){const {controller:u,resolver:A}=this._uploadStatus,
z={signal:u.signal},{width:t,height:w}=this;await h.textureUploadManager.enqueueTextureUpdate({data:c,texture:this._texture,width:t,height:w},z);A.resolve();this._uploadStatus=null}else this._texture.setData(c);this.ready()}catch(u){r.throwIfNotAbortError(u)}}else this._texture.setData(null)}onDetach(){this.destroy()}_createTransforms(){return{displayViewScreenMat3:e.create()}}_createTexture(c){const h=this.immutable,u=new b.TextureDescriptor;u.internalFormat=h?d.SizedPixelFormat.RGBA8:d.PixelFormat.RGBA;
u.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;u.isImmutable=h;u.width=this._sourceWidth;u.height=this._sourceHeight;return new a.Texture(c,u)}}k.Bitmap=q;k.isImageSource=f;k.rasterize=g;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/ImageryBitmapSource":function(){define(function(){class k{constructor(r,p,e){this.pixelBlock=r;this.extent=p;this.originalPixelBlock=e}get width(){return null!=this.pixelBlock?this.pixelBlock.width:0}get height(){return null!=this.pixelBlock?
this.pixelBlock.height:0}render(r){var p=this.pixelBlock;if(null!=p){var e=this.filter({extent:this.extent,pixelBlock:this.originalPixelBlock??p});null!=e.pixelBlock&&(e.pixelBlock.maskIsAlpha&&(e.pixelBlock.premultiplyAlpha=!0),p=e.pixelBlock.getAsRGBA(),e=r.createImageData(e.pixelBlock.width,e.pixelBlock.height),e.data.set(p),r.putImageData(e,0,0))}}getRenderedRasterPixels(){const r=this.filter({extent:this.extent,pixelBlock:this.pixelBlock});if(null==r.pixelBlock)return null;r.pixelBlock.maskIsAlpha&&
(r.pixelBlock.premultiplyAlpha=!0);return{width:r.pixelBlock.width,height:r.pixelBlock.height,renderedRasterPixels:new Uint8Array(r.pixelBlock.getAsRGBA().buffer)}}}return k})},"esri/views/2d/engine/BitmapContainer":function(){define(["exports","./webgl/enums","./webgl/WGLContainer","./webgl/shaderGraph/techniques/bitmap/BitmapTechnique"],function(k,r,p,e){class n extends p{constructor(){super(...arguments);this._hasCrossfade=!1;this._bitmapTechnique=null}get requiresDedicatedFBO(){return super.requiresDedicatedFBO||
this._hasCrossfade}beforeRender(m){super.beforeRender(m);this._manageFade()}onAttach(){super.onAttach();this._bitmapTechnique=new e.BitmapTechnique}onDetach(){super.onDetach();this._bitmapTechnique?.shutdown();this._bitmapTechnique=null}renderChildren(m){super.renderChildren(m);this.visible&&m.drawPhase===r.WGLDrawPhase.MAP&&null!=this._bitmapTechnique&&this._bitmapTechnique.render(m,{bitmaps:this.children})}_manageFade(){2<=this.children.reduce((m,l)=>m+(l.inFadeTransition?1:0),0)?(this.children.forEach(m=>
m.blendFunction="additive"),this._hasCrossfade=!0):(this.children.forEach(m=>m.blendFunction="standard"),this._hasCrossfade=!1)}}k.BitmapContainer=n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/bitmap/BitmapTechnique":function(){define("exports ../../../definitions ../Technique ../TechniqueType ../shaders/BitmapShader ../../../../../../webgl/enums".split(" "),function(k,r,p,e,n,m){const l={nearest:{samplingMode:m.TextureSamplingMode.NEAREST,
mips:!1},bilinear:{samplingMode:m.TextureSamplingMode.LINEAR,mips:!1},bicubic:{samplingMode:m.TextureSamplingMode.LINEAR,mips:!1},trilinear:{samplingMode:m.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,mips:!0}};class d extends p.Technique{constructor(){super(...arguments);this.name="BrushBitmap";this.type=e.TechniqueType.Bitmap;this.shaders={bitmap:new n.BitmapShader}}render(a,b){const {context:f,renderingOptions:g,painter:q}=a;for(const h of b.bitmaps){b=h.texture;if(!h.source||!h.isReady||null==b)continue;
if("dynamic"===g.samplingMode){({state:c}=a);const t=h.resolution/h.pixelRatio/c.resolution,w=Math.round(a.pixelRatio)!==a.pixelRatio;var c=c.rotation||1.05<t||.95>t||w||h.isSourceScaled||h.rotation?l.bilinear:l.nearest}else c=l[g.samplingMode];a.timeline.begin(this.name);q.setPipelineState({depth:!1,stencil:{test:{mask:255,ref:h.stencilRef,compare:m.CompareFunction.EQUAL,op:{fail:m.StencilOperation.KEEP,zFail:m.StencilOperation.KEEP,zPass:m.StencilOperation.KEEP}},write:!1},color:{write:[!0,!0,!0,
!0],blendMode:"additive"===h.blendFunction?"additive":"composite"}});h.setSamplingProfile(c);const {coordScale:u,computedOpacity:A,transforms:z}=h;q.submitDrawMesh(f,{shader:this.shaders.bitmap,uniforms:{config:{texture:{texture:b,unit:r.textureBindingBitmap},dvsMat3:z.displayViewScreenMat3,coordScale:u,opacity:A}},defines:{bicubic:c===l.bicubic},optionalAttributes:null,useComputeBuffer:!1},q.quadMesh);a.timeline.end(this.name)}}}k.BitmapTechnique=d;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/BitmapShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./bitmapUtils"],function(k,r,p,e,n){class m extends p.VertexInput{}r.__decorate([p.location(0,e.Vec2)],m.prototype,"position",void 0);class l extends p.FragmentInput{}class d extends p.UniformGroup{}r.__decorate([p.uniform(e.Sampler2D)],d.prototype,"texture",void 0);r.__decorate([p.uniform(e.Mat3)],d.prototype,"dvsMat3",
void 0);r.__decorate([p.uniform(e.Vec2)],d.prototype,"coordScale",void 0);r.__decorate([p.uniform(e.Float)],d.prototype,"opacity",void 0);class a extends p.GraphShaderModule{constructor(){super(...arguments);this.type="BitmapShader"}vertex(b){const f=this.config.dvsMat3.multiply(new e.Vec3(b.position.multiply(this.config.coordScale),1));return{glPosition:new e.Vec4(f,1),texcoord:b.position}}fragment(b){const f=new p.FragmentOutput;b=this.bicubic?n.sampleBicubicBSpline(this.config.texture,b.texcoord,
this.config.coordScale):e.texture2D(this.config.texture,b.texcoord);f.fragColor=new e.Vec4(b.rgb.multiply(this.config.opacity),b.a.multiply(this.config.opacity));return f}}r.__decorate([p.uniform(d)],a.prototype,"config",void 0);r.__decorate([p.define],a.prototype,"bicubic",void 0);r.__decorate([r.__param(0,p.input(m))],a.prototype,"vertex",null);r.__decorate([r.__param(0,p.input(l))],a.prototype,"fragment",null);k.BitmapShader=a;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/bitmapUtils":function(){define(["exports",
"../../graph/glsl"],function(k,r){function p(e){var n=new r.Float(1/6),m=e.multiply(e);var l=m.multiply(e);var d=n.multiply(l.multiply(-1).add((new r.Float(3)).multiply(m)).subtract((new r.Float(3)).multiply(e)).add(1)),a=n.multiply(l.multiply(3).subtract(m.multiply(6)).add(4));m=n.multiply(l.multiply(-3).add(m.multiply(3)).add(e.multiply(3)).add(1));n=n.multiply(l);l=new r.Vec4(d,a,m,n);d=l.x.add(l.y);a=l.z.add(l.w);n=(new r.Float(1)).subtract(l.y.divide(d)).add(e);e=(new r.Float(1)).add(l.w.divide(a)).subtract(e);
return new r.Vec4(n,e,d,a)}k.sampleBicubicBSpline=function(e,n,m){var l=new r.Vec2((new r.Float(1)).divide(m.x),0),d=new r.Vec2(0,(new r.Float(1)).divide(m.y)),a=n.multiply(m).subtract(.5);m=p(r.fract(a).x).xyz;a=p(r.fract(a).y).xyz;var b=n.add(m.x.multiply(l));let f=n.subtract(m.y.multiply(l));n=b.add(a.x.multiply(d));l=f.add(a.x.multiply(d));b=b.subtract(a.y.multiply(d));f=f.subtract(a.y.multiply(d));d=r.texture2D(e,f);b=r.texture2D(e,b);l=r.texture2D(e,l);e=r.texture2D(e,n);d=r.mix(d,l,a.z);b=
r.mix(b,e,a.z);return d=r.mix(d,b,m.z)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/BitmapTile":function(){define(["exports","../../../core/libs/gl-matrix-2/factories/mat3f32","./Bitmap","./webgl/TiledDisplayObject"],function(k,r,p,e){class n extends e.TiledDisplayObject{constructor(m,l,d,a,b,f,g=null){super(m,l,d,a,b,f);this.bitmap=new p.Bitmap(g);this.bitmap.coordScale=[b,f];this.bitmap.once("isReady",()=>this.ready())}destroy(){super.destroy();this.bitmap.destroy()}beforeRender(m){this.bitmap.beforeRender(m);
super.beforeRender(m)}afterRender(m){this.bitmap.afterRender(m);super.afterRender(m)}set stencilRef(m){this.bitmap.stencilRef=m}get stencilRef(){return this.bitmap.stencilRef}_createTransforms(){return{displayViewScreenMat3:r.create(),tileMat3:r.create()}}setTransform(m){super.setTransform(m);this.bitmap.transforms.displayViewScreenMat3=this.transforms.displayViewScreenMat3}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap&&(this.bitmap.stage=null)}}k.BitmapTile=n;Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/BitmapTileContainer":function(){define("exports ../../../geometry/support/aaBoundingRect ./BitmapTile ./webgl/enums ./webgl/TileContainer ./webgl/shaderGraph/techniques/bitmap/BitmapTechnique".split(" "),function(k,r,p,e,n,m){class l extends n{constructor(){super(...arguments);this._bitmapTechnique=null}get requiresDedicatedFBO(){return this.children.some(d=>"additive"===d.bitmap.blendFunction)}createTile(d){const a=this.tileInfoView.getTileBounds(r.create(),
d),b=this.tileInfoView.getTileResolution(d.level),[f,g]=this.tileInfoView.tileInfo.size;return new p.BitmapTile(d,b,a[0],a[3],f,g)}onAttach(){super.onAttach();this._bitmapTechnique=new m.BitmapTechnique}onDetach(){super.onDetach();this._bitmapTechnique?.shutdown();this._bitmapTechnique=null}renderChildren(d){super.renderChildren(d);if(this.visible&&d.drawPhase===e.WGLDrawPhase.MAP&&null!=this._bitmapTechnique){var a=this.children.map(b=>b.bitmap);this._bitmapTechnique.render(d,{bitmaps:a})}}}k.BitmapTileContainer=
l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/color":function(){define(["exports","./number"],function(k,r){k.premultiplyAlpha=function(p,e=0,n=!1){const m=p[e+3];p[e]*=m;p[e+1]*=m;p[e+2]*=m;n||(p[e+3]*=255);return p};k.premultiplyAlphaRGBA=function(p){if(!p)return 0;const {r:e,g:n,b:m,a:l}=p;return r.i8888to32(e*l,n*l,m*l,255*l)};k.premultiplyAlphaRGBAArray=function(p){if(!p)return 0;const [e,n,m,l]=p;return r.i8888to32(l/255*e,l/255*n,l/255*m,l)};
k.writeColor=function(p,e,n=0){if(null==e)p[n]=0,p[n+1]=0,p[n+2]=0,p[n+3]=0;else{var {r:m,g:l,b:d,a}=e;p[n]=m*a/255;p[n+1]=l*a/255;p[n+2]=d*a/255;p[n+3]=a}};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/Matcher":function(){define(["exports"],function(k){class r{constructor(){this._backgroundFillResult=this._defaultResult=null}static async from(p,e){const n=new r;n.setDefault(await p.createMeshWriters(e.meshes));return n}size(){return 1}getDefault(){return this._defaultResult}setDefault(p){this._defaultResult=
p}getBackgroundFill(){return this._backgroundFillResult}setBackgroundFill(p){this._backgroundFillResult=p}hasArcadeDependency(p){return this._defaultResult?.some(e=>e.hasArcadeDependency(p))??!1}match(p,e,n){return(p=this.doMatch(p,e)||this.getDefault())&&0<p.length&&(e=this.getBackgroundFill())?[...e,...p]:p}getSortKey(p,e){return 0}doMatch(p,e){return null}async fetchResources(p,e){}}k.FeatureMatcher=r;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"*noref":1}});
define("exports ./engine/Stage ./LabelManager ./layers/graphics/GraphicsView2D ./layers/graphics/GraphicContainer ./navigation/MapViewNavigation ./magnifier/MagnifierView2D ./grid/GridView2D".split(" "),function(k,r,p,e,n,m,l,d){k.Stage=r.Stage;Object.defineProperty(k,"LabelManager",{enumerable:!0,get:()=>p.LabelManager});k.GraphicsView2D=e;k.GraphicContainer=n;k.MapViewNavigation=m;k.MagnifierView2D=l;k.GridView2D=d;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})});