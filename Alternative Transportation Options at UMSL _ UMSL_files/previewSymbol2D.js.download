// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.32/esri/copyright.txt for details.
//>>built
define("exports ../../Color ../../core/colorUtils ../../core/Error ../../core/fontUtils ../../core/screenUtils ../../geometry/support/quantizationUtils ./gfxUtils ./previewUtils ./renderUtils ./textUtils".split(" "),function(x,D,E,Q,R,p,F,r,q,S,y){function G(a,b,d){if("polygon"===a.type){var c=a.extent;a=F.quantizePolygon({originPosition:"upperLeft",scale:[(0===c.width?1:c.width)/b,(0===c.height?1:c.height)/d],translate:[c.xmin,c.ymax]},{},a);b="";for(d=0;d<a.rings.length;d++){c=a.rings[d];for(var l=
0;l<c.length;l++){var h=c[l][0],e=c[l][1],k="";k=0===l?`M${h.toString()} ${e.toString()}`:l===c.length-1?`l${h.toString()} ${e.toString()} Z`:`l${h.toString()} ${e.toString()}`;""!==b&&(k=` ${k}`);b+=k}}return b}if("polyline"===a.type){c=a.extent;a=F.quantizePolyline({originPosition:"upperLeft",scale:[(0===c.width?1:c.width)/b,(0===c.height?1:c.height)/d],translate:[c.xmin,c.ymax]},{},a);b="";for(d=0;d<a.paths.length;d++)for(c=a.paths[d],l=0;l<c.length;l++)h=c[l][0],e=c[l][1],k="",k=0===l?`M${h.toString()} ${e.toString()}`:
`l${h.toString()} ${e.toString()}`,""!==b&&(k=` ${k}`),b+=k;return b}return""}function H(a,b){const d=T.getContext("2d"),c=[];b&&(b.weight&&c.push(b.weight),b.size&&c.push(b.size+"px"),b.family&&c.push(b.family));d.font=c.join(" ");const {width:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:e,actualBoundingBoxAscent:k,actualBoundingBoxDescent:m}=d.measureText(a);return{width:Math.ceil(Math.max(l,h+e)),height:Math.ceil(k+m),x:Math.floor(h),y:Math.floor((k-m)/2)}}function t(a){var b=a?.size;a=null!=
b&&"object"===typeof b&&"width"in b?p.pt2px(b.width):null;b=null!=b&&"object"===typeof b&&"height"in b?p.pt2px(b.height):null;return{width:a,height:b}}async function U(a,b){const d=b.fill,c=a.color;"pattern"===d?.type&&c&&"picture-fill"!==a.type&&(a=await r.getPatternUrlWithColor(d.src,c.toCss(!0)),d.src=a,b.fill=d)}async function V(a,b,d,c){if("font"in a&&a.font&&"text"===b.shape.type){try{await R.loadFont(a.font)}catch{}var {width:l,height:h}=t(c);if(!/[\uE600-\uE6FF]/.test(b.shape.text)){const {width:e,
height:k,x:m,y:n}=H(b.shape.text,{weight:b.font?.weight,size:b.font?.size,family:b.font?.family});d[0]=l??e;d[1]=h??k;b.shape.x=m;b.shape.y=n;a="angle"in a?a.angle:null;null!=c?.rotation&&(a=(a??0)+c.rotation);a&&(c=Math.PI/180*a,d[1]=d[0]*Math.abs(Math.sin(c))+d[1]*Math.abs(Math.cos(c)))}}}function W(a,b,d,c,l){if(null!=a.haloColor&&null!=a.haloSize){l.masking??(l.masking=d.map(()=>[]));const h=p.pt2px(a.haloSize);c[0]+=h;c[1]+=h;d.unshift([{...b,fill:null,stroke:{color:a.haloColor,width:2*h,join:"round",
cap:"round"}}]);l.masking.unshift([{shape:{type:"rect",x:0,y:0,width:c[0]+2*y.backgroundPadding,height:c[1]+2*y.backgroundPadding},fill:[255,255,255],stroke:null},{...b,fill:[0,0,0,0],stroke:null}])}if(null!=a.backgroundColor||null!=a.borderLineColor)c[0]+=2*y.backgroundPadding,c[1]+=2*y.backgroundPadding,d.unshift([{shape:{type:"rect",x:0,y:0,width:c[0],height:c[1]},fill:a.backgroundColor,stroke:{color:a.borderLineColor,width:p.pt2px(a.borderLineSize)}}]),l.masking?.unshift([])}function I(a,b){return a>
b?"dark":"light"}function J(a,b){var d="number"===typeof b?.size?b?.size:null,c=null!=d?p.pt2px(d):null,l=null!=b?.maxSize?p.pt2px(b.maxSize):null;d="angle"in a?a.angle:null;null!=b?.rotation&&(d=(d??0)+b.rotation);var h=r.getFill(a),e=r.getStroke(a);"dark"!==K(a,245)||b?.ignoreWhiteSymbols||(e={width:.75,...e,color:"#bdc3c7"});let k=null;h={shape:null,fill:h,stroke:e,offset:[0,0]};e?.width&&(e.width=Math.min(e.width,X));var m=e?.width||0,n=null==b?.size?!1:null!=b?.scale?b?.scale:!0,f=0,g=0;let u=
!1;switch(a.type){case "simple-marker":e=a.style;const {width:v,height:z}=t(b);c=v===z&&null!=v?v:null!=c?c:Math.min(p.pt2px(a.size),l||w);!0===b?.useMarkerSymbolSize&&null!==v&&null!==z&&(f=Math.min(p.pt2px(a.size),l||w),c=f>v&&f>z?Math.min(v,z):f);g=f=c;switch(e){case "circle":h.shape={type:"circle",cx:0,cy:0,r:.5*c};n||(f+=m,g+=m);break;case "cross":h.shape={type:"path",path:[{command:"M",values:[0,.5*g]},{command:"L",values:[f,.5*g]},{command:"M",values:[.5*f,0]},{command:"L",values:[.5*f,g]}]};
break;case "diamond":h.shape={type:"path",path:[{command:"M",values:[0,.5*g]},{command:"L",values:[.5*f,0]},{command:"L",values:[f,.5*g]},{command:"L",values:[.5*f,g]},{command:"Z",values:[]}]};n||(f+=m,g+=m);break;case "square":h.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[f,0]},{command:"L",values:[f,g]},{command:"L",values:[0,g]},{command:"Z",values:[]}]};n||(f+=m,g+=m);d&&(u=!0);break;case "triangle":h.shape={type:"path",path:[{command:"M",values:[.5*f,0]},{command:"L",
values:[f,g]},{command:"L",values:[0,g]},{command:"Z",values:[]}]};n||(f+=m,g+=m);d&&(u=!0);break;case "x":h.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[f,g]},{command:"M",values:[f,0]},{command:"L",values:[0,g]}]};d&&(u=!0);break;case "path":h.shape={type:"path",path:a.path||""},n||(f+=m,g+=m),d&&(u=!0),n=!0}break;case "simple-line":const {width:Y,height:L}=t(b);f=(n=r.getDashArray(e).reduce((Z,aa)=>Z+aa,0))&&Math.ceil(M/n);a=L??c??m;f=Y??(n*f||M);n=!0;"polyline"===b?.geometry?.type&&
b?.geometry?.extent?(g=L??f,k=[f,g],g=k[0]>k[1]?1E3*k[1]/k[0]:1E3,f=k[0]>k[1]?1E3:1E3*k[0]/k[1],e?.width&&(e.width=1E3*e.width/(k[1]>k[0]?k[1]:k[0]),150<e.width&&(e.width=150)),h.shape={type:"path",path:G(b.geometry,f,g)}):(f=null!=b?.maxSize?Math.min(f,b.maxSize):f,g=a,e&&(e.width=a),h.shape={type:"path",path:[{command:"M",values:[a/2,g/2]},{command:"L",values:[f-a/2,g/2]}]});break;case "picture-fill":case "simple-fill":a="object"===typeof b?.symbolConfig&&!!b?.symbolConfig?.isSquareFill;const {width:A,
height:B}=t(b);f=!a&&A!==B||null==A?null!=c?c:ba:A;g=!a&&A!==B||null==B?f:B;n||(f+=m,g+=m);n=!0;b?.geometry?.extent&&"polygon"===b?.geometry?.type?(k=[f,g],g=k[0]>k[1]?1E3*k[1]/k[0]:1E3,f=k[0]>k[1]?1E3:1E3*k[0]/k[1],h.shape={type:"path",path:G(b.geometry,f,g)}):h.shape=a?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[f,0]},{command:"L",values:[f,g]},{command:"L",values:[0,g]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:q.shapes.fill[0];break;case "picture-marker":f=Math.min(p.pt2px(a.width),
l||w);g=Math.min(p.pt2px(a.height),l||w);const {width:C,height:ca}=t(b);c=C===ca&&null!=C?C:null!=c?c:Math.max(f,g);g=a.width/a.height;f=1>=g?Math.ceil(c*g):c;g=1>=g?c:Math.ceil(c/g);h.shape={type:"image",x:-Math.round(f/2),y:-Math.round(g/2),width:f,height:g,src:a.url||""};d&&(u=!0);break;case "text":m=b?.overrideText||a.text||"Aa";e=a.font;const {width:da,height:N}=t(b);c=null!=N?N:null!=c?c:Math.min(p.pt2px(e.size),l||w);const {width:ea,height:O}=H(m,{weight:e.weight,size:c,family:e.family});l=
/[\uE600-\uE6FF]/.test(m);f=da??(l?c:ea);g=l?c:O;let P=.5*(l?c:O);l&&(P+=5);h.shape={type:"text",text:m,x:a.xoffset||0,y:a.yoffset||P,align:"middle",alignBaseline:a.verticalAlignment,decoration:e&&e.decoration,rotated:a.rotated,kerning:a.kerning};h.font=e&&{size:c,style:e.style,decoration:e.decoration,weight:e.weight,family:e.family}}return{shapeDescriptor:h,size:[f,g],outputSize:k,renderOptions:{node:b?.node,scale:n,opacity:b?.opacity,rotations:[d],useRotationSize:u,effectView:b?.effectView,ariaLabel:b?.ariaLabel}}}
function K(a,b=225){var d=r.getFill(a);a=r.getStroke(a);d=!d||"type"in d?null:new D(d);a=a?.color?new D(a?.color):null;d=d?I(E.getColorLuminance(d),b):null;return(a=a?I(E.getColorLuminance(a),b):null)?d?d===a?d:225<=b?"light":"dark":a:d}const ba=q.SymbolSizeDefaults.size,w=q.SymbolSizeDefaults.maxSize,X=q.SymbolSizeDefaults.maxOutlineSize,M=q.SymbolSizeDefaults.lineWidth,T=document.createElement("canvas");x.getContrastingBackgroundTheme=K;x.getRenderSymbolParameters=J;x.previewSymbol2D=async function(a,
b){const {shapeDescriptor:d,size:c,renderOptions:l,outputSize:h}=J(a,b);if(!d.shape)throw new Q("symbolPreview: renderPreviewHTML2D","symbol not supported.");await U(a,d);await V(a,d,c,b);var e=[[d]];"object"===typeof b?.symbolConfig&&b?.symbolConfig?.applyColorModulation&&(b=.6*c[0],e.unshift([{...d,offset:[-b,0],fill:q.adjustColorBrightness(d.fill,-.3)}]),e.push([{...d,offset:[b,0],fill:q.adjustColorBrightness(d.fill,.3)}]),c[0]+=2*b,l.scale=!1);"text"===a.type&&W(a,d,e,c,l);a=S.renderSymbol(e,
c,l);h&&a&&(e="img"===a.nodeName.toLowerCase()?a:a.firstChild,"svg"===e.nodeName.toLowerCase()&&e.setAttribute("viewBox",`0 0 ${c[0].toString()} ${c[1].toString()}`),e.setAttribute("width",h[0].toString()),e.setAttribute("height",h[1].toString()),2<h.length&&(e.style.setProperty("padding-left",h[2]?.toString()+"px"),e.style.setProperty("padding-right",h[2]?.toString()+"px"),e.style.setProperty("padding-top",h[3]?.toString()+"px"),e.style.setProperty("padding-bottom",h[3]?.toString()+"px"),e.style.setProperty("box-sizing",
"border-box")));return a};Object.defineProperty(x,Symbol.toStringTag,{value:"Module"})});